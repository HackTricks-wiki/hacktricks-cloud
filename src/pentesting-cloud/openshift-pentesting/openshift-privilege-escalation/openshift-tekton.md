# OpenShift - Tekton

**Oryginalnym autorem tej strony jest** [**Haroun**](https://www.linkedin.com/in/haroun-al-mounayar-571830211)

### Czym jest tekton

Zgodnie z dokumentacją: _Tekton to potężny i elastyczny framework open-source do tworzenia systemów CI/CD, umożliwiający deweloperom budowanie, testowanie i wdrażanie w różnych dostawcach chmury oraz na systemach lokalnych._ Zarówno Jenkins, jak i Tekton mogą być używane do testowania, budowania i wdrażania aplikacji, jednak Tekton jest Cloud Native.&#x20;

W Tekton wszystko jest reprezentowane przez pliki YAML. Deweloperzy mogą tworzyć Zasoby Niestandardowe (CR) typu `Pipelines` i określać w nich wiele `Tasks`, które chcą uruchomić. Aby uruchomić Pipeline, muszą zostać utworzone zasoby typu `PipelineRun`.

Gdy tekton jest zainstalowany, w każdej przestrzeni nazw tworzony jest konto usługi (sa) o nazwie pipeline. Gdy Pipeline jest uruchamiany, tworzony jest pod przy użyciu tego sa o nazwie `pipeline`, aby uruchomić zadania zdefiniowane w pliku YAML.

{{#ref}}
https://tekton.dev/docs/getting-started/pipelines/
{{#endref}}

### Możliwości konta usługi Pipeline

Domyślnie konto usługi pipeline może korzystać z możliwości `pipelines-scc`. Wynika to z globalnej domyślnej konfiguracji tekton. Właściwie, globalna konfiguracja tekton jest również YAML w obiekcie openshift o nazwie `TektonConfig`, który można zobaczyć, jeśli masz pewne role czytelnicze w klastrze.
```yaml
apiVersion: operator.tekton.dev/v1alpha1
kind: TektonConfig
metadata:
name: config
spec:
...
...
platforms:
openshift:
scc:
default: "pipelines-scc"
```
W dowolnej przestrzeni nazw, jeśli możesz uzyskać token konta serwisowego potoku, będziesz mógł używać `pipelines-scc`.

### Błąd w konfiguracji

Problem polega na tym, że domyślna scc, którą może używać konto serwisowe potoku, jest kontrolowana przez użytkownika. Można to zrobić za pomocą etykiety w definicji przestrzeni nazw. Na przykład, jeśli mogę stworzyć przestrzeń nazw z następującą definicją yaml:
```yaml
apiVersion: v1
kind: Namespace
metadata:
name: test-namespace
annotations:
operator.tekton.dev/scc: privileged
```
Operator tekton przyzna kontu usługi pipeline w `test-namespace` możliwość używania scc privileged. Umożliwi to montowanie węzła.

### Rozwiązanie

Dokumenty Tekton opisują, jak ograniczyć nadpisywanie scc, dodając etykietę w obiekcie `TektonConfig`.

{{#ref}}
https://tekton.dev/docs/operator/sccconfig/
{{#endref}}

Ta etykieta nazywa się `max-allowed`&#x20;
```yaml
apiVersion: operator.tekton.dev/v1alpha1
kind: TektonConfig
metadata:
name: config
spec:
...
...
platforms:
openshift:
scc:
default: "restricted-v2"
maxAllowed: "privileged"
```

