# Openshift - SCC

**Ο αρχικός συγγραφέας αυτής της σελίδας είναι** [**Guillaume**](https://www.linkedin.com/in/guillaume-chapela-ab4b9a196)

## Ορισμός

Στο πλαίσιο του OpenShift, SCC σημαίνει **Security Context Constraints**. Οι περιορισμοί πλαισίου ασφαλείας είναι πολιτικές που ελέγχουν τις άδειες για τα pods που εκτελούνται σε κλάστερ OpenShift. Ορίζουν τις παραμέτρους ασφαλείας υπό τις οποίες επιτρέπεται να εκτελείται ένα pod, συμπεριλαμβανομένων των ενεργειών που μπορεί να εκτελέσει και των πόρων που μπορεί να έχει πρόσβαση.

Οι SCC βοηθούν τους διαχειριστές να επιβάλλουν πολιτικές ασφαλείας σε όλο το κλάστερ, διασφαλίζοντας ότι τα pods εκτελούνται με κατάλληλες άδειες και τηρούν τα οργανωτικά πρότυπα ασφαλείας. Αυτοί οι περιορισμοί μπορούν να καθορίσουν διάφορες πτυχές της ασφάλειας των pods, όπως:

1. Linux capabilities: Περιορισμός των δυνατοτήτων που είναι διαθέσιμες σε κοντέινερ, όπως η ικανότητα εκτέλεσης προνομιακών ενεργειών.
2. SELinux context: Επιβολή SELinux contexts για κοντέινερ, τα οποία καθορίζουν πώς οι διαδικασίες αλληλεπιδρούν με τους πόρους στο σύστημα.
3. Read-only root filesystem: Αποτροπή των κοντέινερ από την τροποποίηση αρχείων σε ορισμένους καταλόγους.
4. Allowed host directories and volumes: Καθορισμός των καταλόγων και των όγκων του host που μπορεί να προσαρτήσει ένα pod.
5. Run as UID/GID: Καθορισμός των αναγνωριστικών χρήστη και ομάδας υπό τα οποία εκτελείται η διαδικασία του κοντέινερ.
6. Network policies: Έλεγχος της δικτυακής πρόσβασης για pods, όπως ο περιορισμός της εξόδου κυκλοφορίας.

Με την παραμετροποίηση των SCC, οι διαχειριστές μπορούν να διασφαλίσουν ότι τα pods εκτελούνται με το κατάλληλο επίπεδο απομόνωσης ασφαλείας και ελέγχων πρόσβασης, μειώνοντας τον κίνδυνο ευπαθειών ασφαλείας ή μη εξουσιοδοτημένης πρόσβασης εντός του κλάστερ.

Βασικά, κάθε φορά που ζητείται η ανάπτυξη ενός pod, εκτελείται μια διαδικασία αποδοχής όπως η παρακάτω:

<figure><img src="../../images/Managing SCCs in OpenShift-1.png" alt=""><figcaption></figcaption></figure>

Αυτή η επιπλέον στρώση ασφαλείας από προεπιλογή απαγορεύει τη δημιουργία προνομιακών pods, την προσαρμογή του συστήματος αρχείων του host ή την ρύθμιση οποιωνδήποτε χαρακτηριστικών που θα μπορούσαν να οδηγήσουν σε κλιμάκωση προνομίων.

{{#ref}}
../kubernetes-security/abusing-roles-clusterroles-in-kubernetes/pod-escape-privileges.md
{{#endref}}

## Λίστα SCC

Για να καταγράψετε όλα τα SCC με τον πελάτη Openshift:
```bash
$ oc get scc #List all the SCCs

$ oc auth can-i --list | grep securitycontextconstraints #Which scc user can use

$ oc describe scc $SCC #Check SCC definitions
```
Όλοι οι χρήστες έχουν πρόσβαση στο προεπιλεγμένο SCC "**restricted**" και "**restricted-v2**" που είναι τα αυστηρότερα SCC.

## Χρήση SCC

Το SCC που χρησιμοποιείται για ένα pod ορίζεται μέσα σε μια αναφορά :
```bash
$ oc get pod MYPOD -o yaml | grep scc
openshift.io/scc: privileged
```
Όταν ένας χρήστης έχει πρόσβαση σε πολλαπλά SCC, το σύστημα θα χρησιμοποιήσει αυτό που ευθυγραμμίζεται με τις τιμές του ασφαλούς πλαισίου. Διαφορετικά, θα προκαλέσει ένα σφάλμα απαγόρευσης.
```bash
$ oc apply -f evilpod.yaml #Deploy a privileged pod
Error from server (Forbidden): error when creating "evilpod.yaml": pods "evilpod" is forbidden: unable to validate against any security context constrain
```
## SCC Bypass

{{#ref}}
openshift-privilege-escalation/openshift-scc-bypass.md
{{#endref}}

## Αναφορές

- [https://www.redhat.com/en/blog/managing-sccs-in-openshift](https://www.redhat.com/en/blog/managing-sccs-in-openshift)
