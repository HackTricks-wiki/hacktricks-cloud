# Openshift - SCC

**このページの元の著者は** [**Guillaume**](https://www.linkedin.com/in/guillaume-chapela-ab4b9a196)

## 定義

OpenShiftの文脈において、SCCは**セキュリティコンテキスト制約**を指します。セキュリティコンテキスト制約は、OpenShiftクラスター上で実行されるポッドの権限を制御するポリシーです。これらは、ポッドが実行される際のセキュリティパラメータを定義し、どのようなアクションを実行できるか、どのリソースにアクセスできるかを含みます。

SCCは、管理者がクラスター全体でセキュリティポリシーを強制するのに役立ち、ポッドが適切な権限で実行され、組織のセキュリティ基準に従っていることを保証します。これらの制約は、ポッドのセキュリティのさまざまな側面を指定できます。例えば：

1. Linuxの能力：特権アクションを実行する能力など、コンテナに利用可能な能力を制限します。
2. SELinuxコンテキスト：コンテナのSELinuxコンテキストを強制し、プロセスがシステム上のリソースとどのように相互作用するかを定義します。
3. 読み取り専用のルートファイルシステム：特定のディレクトリ内のファイルをコンテナが変更するのを防ぎます。
4. 許可されたホストディレクトリとボリューム：ポッドがマウントできるホストディレクトリとボリュームを指定します。
5. UID/GIDとして実行：コンテナプロセスが実行されるユーザーおよびグループIDを指定します。
6. ネットワークポリシー：ポッドのネットワークアクセスを制御し、出口トラフィックを制限します。

SCCを構成することで、管理者はポッドが適切なレベルのセキュリティ隔離とアクセス制御で実行されていることを保証し、クラスター内のセキュリティ脆弱性や不正アクセスのリスクを減少させることができます。

基本的に、ポッドデプロイメントが要求されるたびに、次のような入場プロセスが実行されます：

<figure><img src="../../images/Managing SCCs in OpenShift-1.png" alt=""><figcaption></figcaption></figure>

この追加のセキュリティレイヤーは、デフォルトで特権ポッドの作成、ホストファイルシステムのマウント、または特権昇格につながる可能性のある属性の設定を禁止します。

{{#ref}}
../kubernetes-security/abusing-roles-clusterroles-in-kubernetes/pod-escape-privileges.md
{{#endref}}

## SCCのリスト

OpenShiftクライアントを使用してすべてのSCCをリストするには：
```bash
$ oc get scc #List all the SCCs

$ oc auth can-i --list | grep securitycontextconstraints #Which scc user can use

$ oc describe scc $SCC #Check SCC definitions
```
すべてのユーザーは、最も厳格なSCCであるデフォルトのSCC "**restricted**" と "**restricted-v2**" にアクセスできます。

## SCCの使用

ポッドに使用されるSCCは、アノテーション内で定義されています：
```bash
$ oc get pod MYPOD -o yaml | grep scc
openshift.io/scc: privileged
```
ユーザーが複数のSCCにアクセスできる場合、システムはセキュリティコンテキスト値に一致するものを利用します。そうでない場合、禁止エラーが発生します。
```bash
$ oc apply -f evilpod.yaml #Deploy a privileged pod
Error from server (Forbidden): error when creating "evilpod.yaml": pods "evilpod" is forbidden: unable to validate against any security context constrain
```
## SCC バイパス

{{#ref}}
openshift-privilege-escalation/openshift-scc-bypass.md
{{#endref}}

## 参考文献

- [https://www.redhat.com/en/blog/managing-sccs-in-openshift](https://www.redhat.com/en/blog/managing-sccs-in-openshift)
