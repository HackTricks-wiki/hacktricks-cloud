# GCP - Sourcerepos Privesc

{{#include ../../../banners/hacktricks-training.md}}

## Source Repositories

Kwa taarifa zaidi kuhusu Source Repositories angalia:

{{#ref}}
../gcp-services/gcp-source-repositories-enum.md
{{#endref}}

### `source.repos.get`

Kwa ruhusa hii inawezekana kupakua repository lokalini:

<details><summary>Clone source repository</summary>
```bash
gcloud source repos clone <repo-name> --project=<project-uniq-name>
```
</details>

### `source.repos.update`

Mtu mwenye ruhusa hii **ataweza kuandika code ndani ya repository iliyokopia kwa `gcloud source repos clone <repo>`**. Lakini kumbuka kuwa ruhusa hii haiwezi kuambatishwa kwenye custom roles, kwa hivyo lazima itolewe kupitia role zilizowekwa tayari kama:

- Owner
- Editor
- Source Repository Administrator (`roles/source.admin`)
- Source Repository Writer (`roles/source.writer`)

Ili kuandika, fanya tu **`git push`** ya kawaida.

### `source.repos.setIamPolicy`

Kwa ruhusa hii mshambuliaji anaweza kujipa ruhusa zilizotajwa hapo awali.

### Ufikiaji wa siri

Ikiwa mshambuliaji ana **ufikiaji wa siri** ambazo tokens zimehifadhiwa, ataweza kuziiba. Kwa maelezo zaidi kuhusu jinsi ya kufikia secret angalia:

{{#ref}}
gcp-secretmanager-privesc.md
{{#endref}}

### Ongeza SSH keys

Inawezekana **kuongeza ssh keys kwenye project ya Source Repository** kwenye web console. Inafanya POST request kwa **`/v1/sshKeys:add`** na inaweza kusanidiwa kwenye [https://source.cloud.google.com/user/ssh_keys](https://source.cloud.google.com/user/ssh_keys)

Mara ssh key yako itakapowekwa, unaweza kufikia repo kwa:

<details><summary>Clone repository using SSH</summary>
```bash
git clone ssh://username@domain.com@source.developers.google.com:2022/p/<proj-name>/r/<repo-name>
```
</details>

Na kisha tumia **`git`** amri kama kawaida.

### Cheti za Mkono

Inawezekana kuunda cheti kwa mkono ili kupata Source Repositories:

<figure><img src="../../../images/image (324).png" alt=""><figcaption></figcaption></figure>

Kubofya kiungo cha kwanza kitatuelekeza kwa [https://source.developers.google.com/auth/start?scopes=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-platform\&state\&authuser=3](https://source.developers.google.com/auth/start?scopes=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-platform&state&authuser=3)

Which will prompt an **Oauth authorization prompt** to give access to **Google Cloud Development**. So you will need either the **credentials of the user** or an **open session in the browser** for this.

Hii itakutuma kwenye ukurasa ulio na **bash script to execute** na itakusanidi git cookie katika **`$HOME/.gitcookies`**

<figure><img src="../../../images/image (323).png" alt=""><figcaption></figcaption></figure>

Ukitekeleza script hiyo unaweza kisha kutumia git clone, push... na itafanya kazi.

### `source.repos.updateProjectConfig`

Kwa ruhusa hii inawezekana kuzima ulinzi wa asili wa Source Repositories ambao unazuia kupakia code zenye Private Keys:

<details><summary>Zima pushblock na rekebisha mipangilio ya pub/sub</summary>
```bash
gcloud source project-configs update --disable-pushblock
```
Unaweza pia kusanidi pub/sub topic tofauti au hata kuizima kabisa:
```bash
gcloud source project-configs update --remove-topic=REMOVE_TOPIC
gcloud source project-configs update --remove-topic=UPDATE_TOPIC
```
</details>

{{#include ../../../banners/hacktricks-training.md}}
