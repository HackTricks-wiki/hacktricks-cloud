# GCP - Apikeys Privesc

{{#include ../../../banners/hacktricks-training.md}}

## Apikeys

Die volgende toestemmings is nuttig om API sleutels te skep en te steel, let op dit uit die dokumentasie: _'n API-sleutel is 'n eenvoudige versleutelde string wat **'n toepassing identifiseer sonder enige prinsiep**. Hulle is nuttig om **publieke data anoniem** te benader, en word gebruik om **te assosieer** API versoeke met jou projek vir kwota en **faktuur**._

Daarom, met 'n API-sleutel kan jy daardie maatskappy laat betaal vir jou gebruik van die API, maar jy sal nie in staat wees om voorregte te verhoog nie.

Vir meer inligting oor API Sleutels, kyk:

{{#ref}}
../gcp-services/gcp-api-keys-enum.md
{{#endref}}

Vir ander maniere om API sleutels te skep, kyk:

{{#ref}}
gcp-serviceusage-privesc.md
{{#endref}}

### Brute Force API Key toegang <a href="#apikeys.keys.create" id="apikeys.keys.create"></a>

Soos jy dalk nie weet watter API's geaktiveer is in die projek of die beperkings wat op die API-sleutel wat jy gevind het, toegepas is nie, sal dit interessant wees om die hulpmiddel [**https://github.com/ozguralp/gmapsapiscanner**](https://github.com/ozguralp/gmapsapiscanner) te gebruik en te kyk **wat jy kan benader met die API-sleutel.**

### `apikeys.keys.create` <a href="#apikeys.keys.create" id="apikeys.keys.create"></a>

Hierdie toestemming laat toe om **'n API-sleutel te skep**:
```bash
gcloud services api-keys create
Operation [operations/akmf.p7-[...]9] complete. Result: {
"@type":"type.googleapis.com/google.api.apikeys.v2.Key",
"createTime":"2022-01-26T12:23:06.281029Z",
"etag":"W/\"HOhA[...]==\"",
"keyString":"AIzaSy[...]oU",
"name":"projects/5[...]6/locations/global/keys/f707[...]e8",
"uid":"f707[...]e8",
"updateTime":"2022-01-26T12:23:06.378442Z"
}
```
You can find a script to automate the [**creation, exploit and cleaning of a vuln environment here**](https://github.com/carlospolop/gcp_privesc_scripts/blob/main/tests/b-apikeys.keys.create.sh).

> [!CAUTION]
> Let daarop dat gebruikers standaard toestemming het om nuwe projekte te skep en hulle word die Eienaar rol oor die nuwe projek toegeken. So 'n gebruiker kan c**reate a project and an API key inside this project**.

### `apikeys.keys.getKeyString` , `apikeys.keys.list` <a href="#apikeys.keys.getkeystringapikeys.keys.list" id="apikeys.keys.getkeystringapikeys.keys.list"></a>

Hierdie toestemmings laat **list and get all the apiKeys and get the Key** toe:
```bash
for  key  in  $(gcloud services api-keys list --uri); do
gcloud services api-keys get-key-string "$key"
done
```
You can find a script to automate the [**creation, exploit and cleaning of a vuln environment here**](https://github.com/carlospolop/gcp_privesc_scripts/blob/main/tests/c-apikeys.keys.getKeyString.sh).

### `apikeys.keys.undelete` , `apikeys.keys.list` <a href="#serviceusage.apikeys.regenerateapikeys.keys.list" id="serviceusage.apikeys.regenerateapikeys.keys.list"></a>

Hierdie toestemmings laat jou toe om **verwyderde api sleutels te lys en te hergenerer**. Die **API-sleutel word in die uitvoer gegee** nadat die **undelete** voltooi is:
```bash
gcloud services api-keys list --show-deleted
gcloud services api-keys undelete <key-uid>
```
### Skep Interne OAuth-toepassing om ander werkers te phish

Kyk na die volgende bladsy om te leer hoe om dit te doen, alhoewel hierdie aksie aan die diens **`clientauthconfig`** behoort [volgens die dokumentasie](https://cloud.google.com/iap/docs/programmatic-oauth-clients#before-you-begin):

{{#ref}}
../../workspace-security/gws-google-platforms-phishing/
{{#endref}}

{{#include ../../../banners/hacktricks-training.md}}
