# GCP - Apikeys Privesc

{{#include ../../../banners/hacktricks-training.md}}

## Apikeys

Οι ακόλουθες άδειες είναι χρήσιμες για τη δημιουργία και την κλοπή API keys. Σημείωση από την τεκμηρίωση: _An API key is a simple encrypted string that **identifies an application without any principal**. They are useful for accessing **public data anonymously**, and are used to **associate** API requests with your project for quota and **billing**._

Επομένως, με ένα API key μπορείτε να κάνετε την εταιρεία να πληρώσει για τη χρήση του API από εσάς, αλλά δεν θα μπορείτε να κλιμακώσετε προνόμια.

Για περισσότερες πληροφορίες σχετικά με API Keys δείτε:

{{#ref}}
../gcp-services/gcp-api-keys-enum.md
{{#endref}}

Για άλλους τρόπους δημιουργίας API keys δείτε:

{{#ref}}
gcp-serviceusage-privesc.md
{{#endref}}

### Brute Force API Key access <a href="#apikeys.keys.create" id="apikeys.keys.create"></a>

Καθώς ίσως δεν γνωρίζετε ποιες APIs είναι ενεργοποιημένες στο project ή τους περιορισμούς που έχουν εφαρμοστεί στο API key που βρήκατε, είναι ενδιαφέρον να τρέξετε το εργαλείο [**https://github.com/ozguralp/gmapsapiscanner**](https://github.com/ozguralp/gmapsapiscanner) και να ελέγξετε **τι μπορείτε να προσπελάσετε με το API key.**

### `apikeys.keys.create` <a href="#apikeys.keys.create" id="apikeys.keys.create"></a>

Αυτό το δικαίωμα επιτρέπει να **δημιουργήσετε ένα API key**:

<details>
<summary>Δημιουργήστε ένα API key χρησιμοποιώντας gcloud</summary>
```bash
gcloud services api-keys create
Operation [operations/akmf.p7-[...]9] complete. Result: {
"@type":"type.googleapis.com/google.api.apikeys.v2.Key",
"createTime":"2022-01-26T12:23:06.281029Z",
"etag":"W/\"HOhA[...]=\"",
"keyString":"AIzaSy[...]oU",
"name":"projects/5[...]6/locations/global/keys/f707[...]e8",
"uid":"f707[...]e8",
"updateTime":"2022-01-26T12:23:06.378442Z"
}
```
</details>

You can find a script to automate the [**creation, exploit and cleaning of a vuln environment here**](https://github.com/carlospolop/gcp_privesc_scripts/blob/main/tests/b-apikeys.keys.create.sh).

> [!CAUTION]
> Σημειώστε ότι από προεπιλογή οι χρήστες έχουν δικαιώματα να δημιουργούν νέα projects και τους αποδίδεται ο ρόλος Owner στο νέο project. Έτσι, ένας χρήστης θα μπορούσε να **δημιουργήσει ένα project και ένα API key μέσα σε αυτό το project**.

### `apikeys.keys.getKeyString` , `apikeys.keys.list` <a href="#apikeys.keys.getkeystringapikeys.keys.list" id="apikeys.keys.getkeystringapikeys.keys.list"></a>

Αυτά τα δικαιώματα επιτρέπουν την **απαρίθμηση και ανάκτηση όλων των apiKeys και την λήψη του Key**:

<details>
<summary>Απαρίθμηση και ανάκτηση όλων των API keys</summary>
```bash
for  key  in  $(gcloud services api-keys list --uri); do
gcloud services api-keys get-key-string "$key"
done
```
</details>

Μπορείτε να βρείτε ένα script για να αυτοματοποιήσετε την [**δημιουργία, exploit και καθαρισμό ενός vuln περιβάλλοντος εδώ**](https://github.com/carlospolop/gcp_privesc_scripts/blob/main/tests/c-apikeys.keys.getKeyString.sh).

### `apikeys.keys.undelete` , `apikeys.keys.list` <a href="#serviceusage.apikeys.regenerateapikeys.keys.list" id="serviceusage.apikeys.regenerateapikeys.keys.list"></a>

Αυτά τα δικαιώματα σας επιτρέπουν να **απαριθμήσετε και να αναδημιουργήσετε διαγραμμένα api keys**. Το **API key δίνεται στην έξοδο** μετά την εκτέλεση του **undelete**:

<details>
<summary>Απαρίθμηση και ανάκτηση API keys</summary>
```bash
gcloud services api-keys list --show-deleted
gcloud services api-keys undelete <key-uid>
```
</details>

### Δημιουργία εσωτερικής εφαρμογής OAuth για phish άλλους εργαζόμενους

Δείτε την παρακάτω σελίδα για να μάθετε πώς να το κάνετε, αν και αυτή η ενέργεια ανήκει στην υπηρεσία **`clientauthconfig`** [σύμφωνα με την τεκμηρίωση](https://cloud.google.com/iap/docs/programmatic-oauth-clients#before-you-begin):

{{#ref}}
../../workspace-security/gws-google-platforms-phishing/
{{#endref}}

{{#include ../../../banners/hacktricks-training.md}}
