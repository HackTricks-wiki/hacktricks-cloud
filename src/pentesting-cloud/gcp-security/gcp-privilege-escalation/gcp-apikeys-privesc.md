# GCP - Apikeys Privesc

{{#include ../../../banners/hacktricks-training.md}}

## Apikeys

Οι παρακάτω άδειες είναι χρήσιμες για τη δημιουργία και κλοπή API keys, σημειώστε αυτό από τα έγγραφα: _Ένα API key είναι μια απλή κρυπτογραφημένη συμβολοσειρά που **ταυτοποιεί μια εφαρμογή χωρίς κανένα κύριο**. Είναι χρήσιμα για την πρόσβαση σε **δημόσια δεδομένα ανώνυμα**, και χρησιμοποιούνται για να **συσχετίσουν** τα API αιτήματα με το έργο σας για ποσοστά και **χρέωση**._

Επομένως, με ένα API key μπορείτε να κάνετε την εταιρεία να πληρώσει για τη χρήση του API, αλλά δεν θα μπορείτε να αναβαθμίσετε τα δικαιώματα.

Για περισσότερες πληροφορίες σχετικά με τα API Keys ελέγξτε:

{{#ref}}
../gcp-services/gcp-api-keys-enum.md
{{#endref}}

Για άλλους τρόπους δημιουργίας API keys ελέγξτε:

{{#ref}}
gcp-serviceusage-privesc.md
{{#endref}}

### Brute Force API Key access <a href="#apikeys.keys.create" id="apikeys.keys.create"></a>

Καθώς μπορεί να μην γνωρίζετε ποιες APIs είναι ενεργοποιημένες στο έργο ή τους περιορισμούς που εφαρμόζονται στο API key που βρήκατε, θα ήταν ενδιαφέρον να εκτελέσετε το εργαλείο [**https://github.com/ozguralp/gmapsapiscanner**](https://github.com/ozguralp/gmapsapiscanner) και να ελέγξετε **τι μπορείτε να αποκτήσετε πρόσβαση με το API key.**

### `apikeys.keys.create` <a href="#apikeys.keys.create" id="apikeys.keys.create"></a>

Αυτή η άδεια επιτρέπει να **δημιουργήσετε ένα API key**:
```bash
gcloud services api-keys create
Operation [operations/akmf.p7-[...]9] complete. Result: {
"@type":"type.googleapis.com/google.api.apikeys.v2.Key",
"createTime":"2022-01-26T12:23:06.281029Z",
"etag":"W/\"HOhA[...]==\"",
"keyString":"AIzaSy[...]oU",
"name":"projects/5[...]6/locations/global/keys/f707[...]e8",
"uid":"f707[...]e8",
"updateTime":"2022-01-26T12:23:06.378442Z"
}
```
Μπορείτε να βρείτε ένα σενάριο για την αυτοματοποίηση της [**δημιουργίας, εκμετάλλευσης και καθαρισμού ενός ευάλωτου περιβάλλοντος εδώ**](https://github.com/carlospolop/gcp_privesc_scripts/blob/main/tests/b-apikeys.keys.create.sh).

> [!CAUTION]
> Σημειώστε ότι από προεπιλογή οι χρήστες έχουν άδειες να δημιουργούν νέα έργα και τους χορηγείται ο ρόλος του Ιδιοκτήτη στο νέο έργο. Έτσι, ένας χρήστης θα μπορούσε να **δημιουργήσει ένα έργο και ένα API key μέσα σε αυτό το έργο**.

### `apikeys.keys.getKeyString` , `apikeys.keys.list` <a href="#apikeys.keys.getkeystringapikeys.keys.list" id="apikeys.keys.getkeystringapikeys.keys.list"></a>

Αυτές οι άδειες επιτρέπουν **να καταγράφετε και να αποκτάτε όλα τα apiKeys και να αποκτάτε το Key**:
```bash
for  key  in  $(gcloud services api-keys list --uri); do
gcloud services api-keys get-key-string "$key"
done
```
Μπορείτε να βρείτε ένα σενάριο για την αυτοματοποίηση της [**δημιουργίας, εκμετάλλευσης και καθαρισμού ενός ευάλωτου περιβάλλοντος εδώ**](https://github.com/carlospolop/gcp_privesc_scripts/blob/main/tests/c-apikeys.keys.getKeyString.sh).

### `apikeys.keys.undelete` , `apikeys.keys.list` <a href="#serviceusage.apikeys.regenerateapikeys.keys.list" id="serviceusage.apikeys.regenerateapikeys.keys.list"></a>

Αυτές οι άδειες σας επιτρέπουν να **καταγράφετε και να αναγεννάτε διαγραμμένα api keys**. Το **API key παρέχεται στην έξοδο** μετά την ολοκλήρωση της **αναίρεσης διαγραφής**:
```bash
gcloud services api-keys list --show-deleted
gcloud services api-keys undelete <key-uid>
```
### Δημιουργία Εσωτερικής Εφαρμογής OAuth για phishing άλλων εργαζομένων

Ελέγξτε την παρακάτω σελίδα για να μάθετε πώς να το κάνετε αυτό, αν και αυτή η ενέργεια ανήκει στην υπηρεσία **`clientauthconfig`** [σύμφωνα με τα έγγραφα](https://cloud.google.com/iap/docs/programmatic-oauth-clients#before-you-begin):

{{#ref}}
../../workspace-security/gws-google-platforms-phishing/
{{#endref}}

{{#include ../../../banners/hacktricks-training.md}}
