# GCP - Apikeys Privesc

{{#include ../../../banners/hacktricks-training.md}}

## Apikeys

Die volgende toestemmings is nuttig om API keys te skep en te steel, nie hierdie uit die dokumentasie: _'n API key is 'n eenvoudige ge√Ønkripteerde string wat **'n toepassing identifiseer sonder enige principal**. Dit is nuttig om **publieke data anoniem te benader**, en word gebruik om API-versoeke te **assosieer** met jou projek vir kwota en **fakturering**._

Dus kan jy met 'n API key die maatskappy laat betaal vir jou gebruik van die API, maar jy sal nie in staat wees om voorregte te eskaleer nie.

Vir meer inligting oor API Keys sien:

{{#ref}}
../gcp-services/gcp-api-keys-enum.md
{{#endref}}

Vir ander maniere om API keys te skep sien:

{{#ref}}
gcp-serviceusage-privesc.md
{{#endref}}

### Brute Force API Key access <a href="#apikeys.keys.create" id="apikeys.keys.create"></a>

Aangesien jy dalk nie weet watter APIs in die projek geaktiveer is of watter beperkings op die API key wat jy gevind het toegepas is nie, is dit interessant om die hulpmiddel [**https://github.com/ozguralp/gmapsapiscanner**](https://github.com/ozguralp/gmapsapiscanner) te laat loop en te kontroleer **wat jy met die API key kan benader.**

### `apikeys.keys.create` <a href="#apikeys.keys.create" id="apikeys.keys.create"></a>

Hierdie toestemming laat toe om 'n **API key te skep**:

<details>
<summary>Skep 'n API key met gcloud</summary>
```bash
gcloud services api-keys create
Operation [operations/akmf.p7-[...]9] complete. Result: {
"@type":"type.googleapis.com/google.api.apikeys.v2.Key",
"createTime":"2022-01-26T12:23:06.281029Z",
"etag":"W/\"HOhA[...]=\"",
"keyString":"AIzaSy[...]oU",
"name":"projects/5[...]6/locations/global/keys/f707[...]e8",
"uid":"f707[...]e8",
"updateTime":"2022-01-26T12:23:06.378442Z"
}
```
</details>

Jy kan 'n skrip vind om die [**skep, exploit en skoonmaak van 'n vuln-omgewing hier**](https://github.com/carlospolop/gcp_privesc_scripts/blob/main/tests/b-apikeys.keys.create.sh).

> [!CAUTION]
> Let wel dat gebruikers standaard toestemming het om nuwe projekte te skep en hulle word die Owner-rol oor die nuwe projek gegee. Dus kan 'n gebruiker c**skep 'n projek en 'n API-sleutel binne hierdie projek**.

### `apikeys.keys.getKeyString` , `apikeys.keys.list` <a href="#apikeys.keys.getkeystringapikeys.keys.list" id="apikeys.keys.getkeystringapikeys.keys.list"></a>

Hierdie permissies laat toe om **alle apiKeys te lys en die Key te kry**:

<details>
<summary>Lys en haal alle API-sleutels op</summary>
```bash
for  key  in  $(gcloud services api-keys list --uri); do
gcloud services api-keys get-key-string "$key"
done
```
</details>

Jy kan 'n skrip vind om die [**skep, exploit en skoonmaak van 'n vuln environment hier**](https://github.com/carlospolop/gcp_privesc_scripts/blob/main/tests/c-apikeys.keys.getKeyString.sh) te outomatiseer.

### `apikeys.keys.undelete` , `apikeys.keys.list` <a href="#serviceusage.apikeys.regenerateapikeys.keys.list" id="serviceusage.apikeys.regenerateapikeys.keys.list"></a>

Hierdie toestemmings laat jou toe om **verwyderde api keys te lys en te hergenereer**. Die **API key word in die output gegee** nadat die **undelete** voltooi is:

<details>
<summary>Lys en herstel verwyderde API keys</summary>
```bash
gcloud services api-keys list --show-deleted
gcloud services api-keys undelete <key-uid>
```
</details>

### Skep 'n interne OAuth-toepassing om ander werknemers te phish

Kyk na die volgende bladsy om te leer hoe om dit te doen, alhoewel hierdie aksie behoort tot die diens **`clientauthconfig`** [volgens die dokumentasie](https://cloud.google.com/iap/docs/programmatic-oauth-clients#before-you-begin):

{{#ref}}
../../workspace-security/gws-google-platforms-phishing/
{{#endref}}

{{#include ../../../banners/hacktricks-training.md}}
