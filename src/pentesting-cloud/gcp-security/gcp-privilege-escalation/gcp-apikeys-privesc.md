# GCP - Apikeys Privesc

{{#include ../../../banners/hacktricks-training.md}}

## Apikeys

Aşağıdaki izinler API key oluşturmak ve çalmak için kullanışlıdır, dokümandan bir not: _An API key is a simple encrypted string that **bir principal olmaksızın bir uygulamayı tanımlar**. They are useful for accessing **kamu verilerine anonim olarak erişim** için yararlıdır ve kota ve **faturalama** için API isteklerini projenizle **ilişkilendirmek** için kullanılır._

Therefore, with an API key you can make that company pay for your use of the API, but you won't be able to escalate privileges.
Bu nedenle, bir API key ile şirketin API kullanımınızın bedelini ödemesini sağlayabilirsiniz, ancak privilege escalation yapamazsınız.

For more information about API Keys check:

{{#ref}}
../gcp-services/gcp-api-keys-enum.md
{{#endref}}

For other ways to create API keys check:

{{#ref}}
gcp-serviceusage-privesc.md
{{#endref}}

### Brute Force API Key access <a href="#apikeys.keys.create" id="apikeys.keys.create"></a>

Projede hangi API'lerin etkin olduğunu veya bulduğunuz API key'e hangi kısıtlamaların uygulandığını bilmeyebileceğiniz için [**https://github.com/ozguralp/gmapsapiscanner**](https://github.com/ozguralp/gmapsapiscanner) aracını çalıştırıp **API key ile nereye erişebileceğinizi** kontrol etmek ilginç olur.

### `apikeys.keys.create` <a href="#apikeys.keys.create" id="apikeys.keys.create"></a>

Bu izin **bir API key oluşturmayı** sağlar:

<details>
<summary>gcloud kullanarak bir API key oluşturma</summary>
```bash
gcloud services api-keys create
Operation [operations/akmf.p7-[...]9] complete. Result: {
"@type":"type.googleapis.com/google.api.apikeys.v2.Key",
"createTime":"2022-01-26T12:23:06.281029Z",
"etag":"W/\"HOhA[...]=\"",
"keyString":"AIzaSy[...]oU",
"name":"projects/5[...]6/locations/global/keys/f707[...]e8",
"uid":"f707[...]e8",
"updateTime":"2022-01-26T12:23:06.378442Z"
}
```
</details>

Bu işlemi otomatikleştirmek için bir scripti [**creation, exploit and cleaning of a vuln environment here**](https://github.com/carlospolop/gcp_privesc_scripts/blob/main/tests/b-apikeys.keys.create.sh) adresinde bulabilirsiniz.

> [!CAUTION]
> Varsayılan olarak kullanıcıların yeni projeler oluşturma izinlerine sahip olduklarını ve yeni proje üzerinde Owner rolü verildiğini unutmayın. Bu yüzden bir kullanıcı **bir proje oluşturabilir ve bu proje içinde bir API key oluşturabilir**.

### `apikeys.keys.getKeyString` , `apikeys.keys.list` <a href="#apikeys.keys.getkeystringapikeys.keys.list" id="apikeys.keys.getkeystringapikeys.keys.list"></a>

Bu izinler **tüm apiKeys'leri listeleme ve Key'i alma** sağlar:

<details>
<summary>Tüm API keys'leri listeleyin ve alın</summary>
```bash
for  key  in  $(gcloud services api-keys list --uri); do
gcloud services api-keys get-key-string "$key"
done
```
</details>

Otomatikleştirmek için bir scripti [**creation, exploit and cleaning of a vuln environment here**](https://github.com/carlospolop/gcp_privesc_scripts/blob/main/tests/c-apikeys.keys.getKeyString.sh) adresinde bulabilirsiniz.

### `apikeys.keys.undelete` , `apikeys.keys.list` <a href="#serviceusage.apikeys.regenerateapikeys.keys.list" id="serviceusage.apikeys.regenerateapikeys.keys.list"></a>

Bu izinler size **list and regenerate deleted api keys** yapma imkânı sağlar. **undelete** gerçekleştirildikten sonra çıktı olarak **API key is given in the output**:

<details>
<summary>API keys'leri listeleme ve geri alma</summary>
```bash
gcloud services api-keys list --show-deleted
gcloud services api-keys undelete <key-uid>
```
</details>

### Diğer çalışanları phish etmek için İç OAuth Uygulaması Oluştur

Bunu nasıl yapacağınızı öğrenmek için aşağıdaki sayfayı inceleyin; ancak bu eylem hizmet **`clientauthconfig`** [according to the docs](https://cloud.google.com/iap/docs/programmatic-oauth-clients#before-you-begin):

{{#ref}}
../../workspace-security/gws-google-platforms-phishing/
{{#endref}}

{{#include ../../../banners/hacktricks-training.md}}
