# GCP - Apikeys Privesc

{{#include ../../../banners/hacktricks-training.md}}

## Apikeys

निम्नलिखित permissions API keys बनाने और चुराने के लिए उपयोगी हैं, दस्तावेज़ों से उद्धरण: _एक API key एक सरल एन्क्रिप्टेड स्ट्रिंग है जो **किसी प्रिंसिपल के बिना एक application की पहचान करती है**। ये **सार्वजनिक डेटा को गुमनाम रूप से एक्सेस करने** के लिए उपयोगी हैं, और quota और **billing** के लिए API अनुरोधों को आपके प्रोजेक्ट के साथ **associate** करने के लिए उपयोग किए जाते हैं।_

इसलिए, एक API key के साथ आप उस कंपनी को आपके API उपयोग का भुगतान करवा सकते हैं, लेकिन आप privileges escalate नहीं कर पाएंगे।

For more information about API Keys check:

{{#ref}}
../gcp-services/gcp-api-keys-enum.md
{{#endref}}

For other ways to create API keys check:

{{#ref}}
gcp-serviceusage-privesc.md
{{#endref}}

### Brute Force API Key access <a href="#apikeys.keys.create" id="apikeys.keys.create"></a>

चूंकि आपको पता नहीं हो सकता कि प्रोजेक्ट में कौन-कौन से APIs enabled हैं या मिली हुई API key पर कौन सी restrictions लागू हैं, इसलिए यह उपयोगी होगा कि आप टूल [**https://github.com/ozguralp/gmapsapiscanner**](https://github.com/ozguralp/gmapsapiscanner) चलाएँ और जाँचें **आप API key के साथ क्या access कर सकते हैं।**

### `apikeys.keys.create` <a href="#apikeys.keys.create" id="apikeys.keys.create"></a>

यह permission **API key बनाने** की अनुमति देता है:

<details>
<summary>gcloud का उपयोग करके API key बनाना</summary>
```bash
gcloud services api-keys create
Operation [operations/akmf.p7-[...]9] complete. Result: {
"@type":"type.googleapis.com/google.api.apikeys.v2.Key",
"createTime":"2022-01-26T12:23:06.281029Z",
"etag":"W/\"HOhA[...]=\"",
"keyString":"AIzaSy[...]oU",
"name":"projects/5[...]6/locations/global/keys/f707[...]e8",
"uid":"f707[...]e8",
"updateTime":"2022-01-26T12:23:06.378442Z"
}
```
</details>

आप एक स्क्रिप्ट पा सकते हैं जो [**creation, exploit and cleaning of a vuln environment here**](https://github.com/carlospolop/gcp_privesc_scripts/blob/main/tests/b-apikeys.keys.create.sh) को स्वचालित करती है।

> [!CAUTION]
> ध्यान दें कि डिफ़ॉल्ट रूप से उपयोगकर्ताओं के पास नए प्रोजेक्ट बनाने की permissions होती हैं और उन्हें नए प्रोजेक्ट पर Owner role प्रदान किया जाता है। इसलिए कोई उपयोगकर्ता **एक प्रोजेक्ट बना सकता है और उसी प्रोजेक्ट के अंदर एक API key बना सकता है**।

### `apikeys.keys.getKeyString` , `apikeys.keys.list` <a href="#apikeys.keys.getkeystringapikeys.keys.list" id="apikeys.keys.getkeystringapikeys.keys.list"></a>

ये permissions **सभी apiKeys को सूचीबद्ध और प्राप्त करने और Key को प्राप्त करने** की अनुमति देते हैं:

<details>
<summary>सभी API keys सूचीबद्ध और प्राप्त करें</summary>
```bash
for  key  in  $(gcloud services api-keys list --uri); do
gcloud services api-keys get-key-string "$key"
done
```
</details>

You can find a script to automate the [**creation, exploit and cleaning of a vuln environment here**](https://github.com/carlospolop/gcp_privesc_scripts/blob/main/tests/c-apikeys.keys.getKeyString.sh).

### `apikeys.keys.undelete` , `apikeys.keys.list` <a href="#serviceusage.apikeys.regenerateapikeys.keys.list" id="serviceusage.apikeys.regenerateapikeys.keys.list"></a>

ये permissions आपको **deleted API keys को सूचीबद्ध और regenerate** करने की अनुमति देती हैं। **API key** **undelete** किए जाने के बाद आउटपुट में दिया जाता है:

<details>
<summary>API keys की सूची देखें और undelete करें</summary>
```bash
gcloud services api-keys list --show-deleted
gcloud services api-keys undelete <key-uid>
```
</details>

### अन्य कर्मचारियों को phish करने के लिए Internal OAuth Application बनाएं

यह कैसे करना है जानने के लिए निम्नलिखित पेज देखें, हालांकि यह क्रिया सेवा **`clientauthconfig`** के अंतर्गत आती है [दस्तावेज़ों के अनुसार](https://cloud.google.com/iap/docs/programmatic-oauth-clients#before-you-begin):

{{#ref}}
../../workspace-security/gws-google-platforms-phishing/
{{#endref}}

{{#include ../../../banners/hacktricks-training.md}}
