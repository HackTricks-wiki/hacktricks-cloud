# GCP - Orgpolicy Privesc

{{#include ../../../banners/hacktricks-training.md}}

## orgpolicy

### `orgpolicy.policy.set`

Mshambuliaji anayevutia/akitumia `orgpolicy.policy.set` anaweza kubadilisha sera za shirika, ambazo zitamruhusu kuondoa vikwazo fulani vinavyozuia shughuli maalum. Kwa mfano, kizuizi `appengine.disableCodeDownload` kwa kawaida kinazuia kupakuliwa kwa source code ya App Engine. Hata hivyo, kwa kutumia `orgpolicy.policy.set`, mshambuliaji anaweza kuzimisha kizuizi hiki, na hivyo kupata uwezo wa kupakua source code, ingawa ilikuwa imehifadhiwa hapo awali.
```bash
# Get info
gcloud resource-manager org-policies describe <org-policy> [--folder <id> | --organization <id> | --project <id>]

# Disable
gcloud resource-manager org-policies disable-enforce <org-policy> [--folder <id> | --organization <id> | --project <id>]
```
A python script for this method can be found [here](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/orgpolicy.policy.set.py).

### `orgpolicy.policy.set`, `iam.serviceAccounts.actAs`

Kwa kawaida haiwezekani kuambatisha service account kutoka project tofauti kwenye resource kwa sababu kuna kikomo cha sera kinachotekelezwa kinachoitwa **`iam.disableCrossProjectServiceAccountUsage`** ambacho kinazuia kitendo hiki.

Inawezekana kuthibitisha kama kikomo hiki kinatekelezwa kwa kuendesha amri ifuatayo:
```bash
gcloud resource-manager org-policies describe \
constraints/iam.disableCrossProjectServiceAccountUsage \
--project=<project-id> \
--effective

booleanPolicy:
enforced: true
constraint: constraints/iam.disableCrossProjectServiceAccountUsage
```
Hii inazuia mshambuliaji kutumia vibaya ruhusa **`iam.serviceAccounts.actAs`** kujifanya akaunti ya huduma kutoka kwenye mradi mwingine bila ruhusa za ziada za miundombinu, kama kuanzisha VM mpya kwa mfano, jambo ambalo lingeweza kusababisha kupandishwa kwa ruhusa.

Hata hivyo, mshambuliaji aliye na ruhusa **`orgpolicy.policy.set`** anaweza kupita kizuizi hiki kwa kuzima constraint **`iam.disableServiceAccountProjectWideAccess`**. Hii inamwezesha mshambuliaji kuambatisha akaunti ya huduma kutoka kwenye mradi mwingine kwa rasilimali katika mradi wake mwenyewe, na kwa ufanisi kupandisha ruhusa zake.
```bash
gcloud resource-manager org-policies disable-enforce \
iam.disableCrossProjectServiceAccountUsage \
--project=<project-id>
```
## Marejeo

- [https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/](https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/)

{{#include ../../../banners/hacktricks-training.md}}
