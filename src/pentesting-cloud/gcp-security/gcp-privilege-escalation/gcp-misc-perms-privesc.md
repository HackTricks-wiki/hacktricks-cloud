# GCP - Generic Permissions Privesc

{{#include ../../../banners/hacktricks-training.md}}

## 일반적으로 흥미로운 권한

### \*.setIamPolicy

리소스에서 **`setIamPolicy`** 권한을 가진 사용자를 소유하고 있다면 그 리소스의 IAM 정책을 변경할 수 있으므로 해당 리소스에서 **escalate privileges in that resource** 할 수 있습니다.\
이 권한은 리소스가 코드를 실행할 수 있고 `iam.ServiceAccounts.actAs`가 필요하지 않을 경우 **escalate to other principals** 하는 데도 사용될 수 있습니다.

- _cloudfunctions.functions.setIamPolicy_
- Modify the policy of a Cloud Function to allow yourself to invoke it.

이와 같은 권한을 가진 리소스 유형이 수십 가지 있으므로, setIamPolicy를 검색해 [https://cloud.google.com/iam/docs/permissions-reference](https://cloud.google.com/iam/docs/permissions-reference)에서 모두 확인할 수 있습니다.

### \*.create, \*.update

이 권한들은 새로운 리소스를 **생성하거나 업데이트**하여 리소스에서 권한을 상승시키려 할 때 매우 유용할 수 있습니다. 특히 해당 리소스에 대해 .create/.update 권한을 갖고 있고, 동시에 특정 Service Account에 대해 **iam.serviceAccounts.actAs** 권한도 가지고 있으며 해당 리소스가 Service Account를 연결(attach)할 수 있다면 더욱 유용합니다.

### \*ServiceAccount\*

이 권한은 보통 일부 리소스에서 Service Account에 **접근하거나 수정(access or modify)** 할 수 있게 해줍니다(예: compute.instances.setServiceAccount). 이는 경우에 따라 **could lead to a privilege escalation** 벡터가 될 수 있지만, 각 사례에 따라 달라집니다.

### iam.ServiceAccounts.actAs

이 권한은 지원하는 리소스(예: Compute Engine VM, Cloud Function, Cloud Run 등)에 Service Account를 연결할 수 있게 해줍니다.\
만약 자신의 사용자보다 더 많은 권한을 가진 Service Account를 코드 실행이 가능한 리소스에 연결할 수 있다면, 해당 Service Account로 코드를 실행하여 권한을 상승(escalate your privileges)시킬 수 있습니다.

Cloud Hacktricks에서 `iam.ServiceAccounts.actAs`를 검색하면 이 권한으로 권한 상승을 수행하는 여러 예제를 찾을 수 있습니다.

{{#include ../../../banners/hacktricks-training.md}}
