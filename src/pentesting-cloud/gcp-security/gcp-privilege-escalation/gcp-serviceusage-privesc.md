# GCP - Serviceusage Privesc

{{#include ../../../banners/hacktricks-training.md}}

## serviceusage

The following permissions are useful to create and steal API keys, not this from the docs: _API key ã¯å˜ç´”ãªæš—å·åŒ–æ–‡å­—åˆ—ã§ã€**ä»»æ„ã®ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã‚’ä¼´ã‚ãšã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è­˜åˆ¥ã—ã¾ã™**ã€‚ã“ã‚Œã‚‰ã¯**åŒ¿åã§å…¬é–‹ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹**ã®ã«ä¾¿åˆ©ã§ã€ã‚¯ã‚©ãƒ¼ã‚¿ã‚„**èª²é‡‘**ã®ãŸã‚ã« API ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«**ç´ä»˜ã‘ã‚‹**ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚_

ã—ãŸãŒã£ã¦ã€API key ã‚’ä½¿ãˆã°ãã®ä¼šç¤¾ã« API ã®åˆ©ç”¨æ–™é‡‘ã‚’è² æ‹…ã•ã›ã‚‹ã“ã¨ã¯ã§ãã¾ã™ãŒã€æ¨©é™æ˜‡æ ¼ã¯ã§ãã¾ã›ã‚“ã€‚

To learn other permissions and ways to generate API keys check:

{{#ref}}
gcp-apikeys-privesc.md
{{#endref}}

### `serviceusage.apiKeys.create`

An undocumented API was found that can be used to **API key ã‚’ä½œæˆã™ã‚‹:**

<details><summary>æœªæ–‡æ›¸ã® API ã‚’ä½¿ã£ã¦ API key ã‚’ä½œæˆã™ã‚‹</summary>
```bash
curl -XPOST "https://apikeys.clients6.google.com/v1/projects/<project-uniq-name>/apiKeys?access_token=$(gcloud auth print-access-token)"
```
</details>

### `serviceusage.apiKeys.list`

æ—¢ã«ä½œæˆã•ã‚ŒãŸ API ã‚­ãƒ¼ã‚’ä¸€è¦§è¡¨ç¤ºã™ã‚‹ãŸã‚ã®åˆ¥ã®æœªå…¬é–‹ API ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼ˆAPI ã‚­ãƒ¼ã¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å«ã¾ã‚Œã¾ã™ï¼‰:

<details><summary>æœªå…¬é–‹ API ã‚’ä½¿ç”¨ã—ã¦ API ã‚­ãƒ¼ã‚’ä¸€è¦§è¡¨ç¤º</summary>
```bash
curl "https://apikeys.clients6.google.com/v1/projects/<project-uniq-name>/apiKeys?access_token=$(gcloud auth print-access-token)"
```
</details>

### **`serviceusage.services.enable`** , **`serviceusage.services.use`**

ã“ã‚Œã‚‰ã®æ¨©é™ãŒã‚ã‚Œã° attacker ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã§æ–°ã—ã„ã‚µãƒ¼ãƒ“ã‚¹ã‚’æœ‰åŠ¹åŒ–ã—ã¦ä½¿ç”¨ã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Š attacker ãŒ admin ã‚„ cloudidentity ã®ã‚ˆã†ãªã‚µãƒ¼ãƒ“ã‚¹ã‚’æœ‰åŠ¹ã«ã—ã¦ Workspace æƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹ã‚’è©¦ã¿ãŸã‚Šã€ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ã£ã¦èˆˆå‘³æ·±ã„ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

## **å‚è€ƒè³‡æ–™**

- [https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/](https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/)

<details>

<summary><strong>HackTricks ã‚’æ”¯æ´ã—ã¦ç‰¹å…¸ã‚’å¾—ã‚ˆã†ï¼</strong></summary>

ã‚ãªãŸã¯ **cybersecurity company** ã«å‹¤å‹™ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ ä¼šç¤¾ã‚’ HackTricks ã§å®£ä¼ã—ãŸã„ã§ã™ã‹ï¼Ÿ ã¾ãŸã¯ **latest version of the PEASS or download HackTricks in PDF** ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã„ã§ã™ã‹ï¼Ÿ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼

Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)

Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)

**å‚åŠ ã—ã¦** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) ã¾ãŸã¯ [**telegram group**](https://t.me/peass) ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/carlospolopm)**.**

**Share your hacking tricks submitting PRs to the** [**hacktricks github repo**](https://github.com/carlospolop/hacktricks)\*\*\*\*

**.**

</details>



{{#include ../../../banners/hacktricks-training.md}}
