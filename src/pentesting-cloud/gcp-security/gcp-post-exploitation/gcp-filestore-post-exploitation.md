# GCP - Filestore Post Exploitation

{{#include ../../../banners/hacktricks-training.md}}

## Filestore

Za više informacija o Filestore pogledajte:

{{#ref}}
../gcp-services/gcp-filestore-enum.md
{{#endref}}

### Mount Filestore

Deljeni fajl sistem **može sadržati osetljive informacije** koje su interesantne iz perspektive napadača. Sa pristupom Filestore moguće je **mount it**:

<details>

<summary>Mount Filestore filesystem</summary>
```bash
sudo apt-get update
sudo apt-get install nfs-common
# Check the share name
showmount -e <IP>
# Mount the share
mkdir /mnt/fs
sudo mount [FILESTORE_IP]:/[FILE_SHARE_NAME] /mnt/fs
```
</details>

Da biste pronašli IP address filestore instance, proverite sekciju za enumeraciju na stranici:

{{#ref}}
../gcp-services/gcp-filestore-enum.md
{{#endref}}

### Uklanjanje ograničenja i dobijanje dodatnih permissions

Ako attacker nije na IP address koji ima access na share, ali imate dovoljno permissions da ga izmenite, moguće je ukloniti ograničenja ili pristup nad njim. Takođe je moguće dodeliti više privilegija vašem IP address-u kako biste imali admin access nad share-om:

<details>

<summary>Ažuriraj Filestore instance da omogući access</summary>
```bash
gcloud filestore instances update nfstest \
--zone=<exact-zone> \
--flags-file=nfs.json

# Contents of nfs.json
{
"--file-share":
{
"capacity": "1024",
"name": "<share-name>",
"nfs-export-options": [
{
"access-mode": "READ_WRITE",
"ip-ranges": [
"<your-ip-private-address>/32"
],
"squash-mode": "NO_ROOT_SQUASH",
"anon_uid": 1003,
"anon_gid": 1003
}
]
}
}
```
</details>

### Vraćanje backup-a

Ako postoji backup, moguće ga je **vratiti** u postojećoj ili u novoj instanci tako da njegovi **podaci postanu dostupni:**

<details>

<summary>Kreirajte novu instancu i vratite backup</summary>
```bash
# Create a new filestore if you don't want to modify the old one
gcloud filestore instances create <new-instance-name> \
--zone=<zone> \
--tier=STANDARD \
--file-share=name=vol1,capacity=1TB \
--network=name=default,reserved-ip-range=10.0.0.0/29

# Restore a backups in a new instance
gcloud filestore instances restore <new-instance-name> \
--zone=<zone> \
--file-share=<instance-file-share-name> \
--source-backup=<backup-name> \
--source-backup-region=<backup-region>

# Follow the previous section commands to mount it
```
</details>

### Napravite backup i izvršite restore

Ako **nemate pristup share-u i ne želite da ga menjate**, moguće je **kreirati backup** od njega i **restore** izvršiti kako je ranije pomenuto:

<details>

<summary>Kreirajte backup i izvršite restore u novoj instance</summary>
```bash
# Create share backup
gcloud filestore backups create <back-name> \
--region=<region> \
--instance=<instance-name> \
--instance-zone=<instance-zone> \
--file-share=<share-name>

# Follow the previous section commands to restore it and mount it
```
</details>

{{#include ../../../banners/hacktricks-training.md}}
