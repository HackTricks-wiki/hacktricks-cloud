# GCP - Pub/Sub Enum

{{#include ../../../banners/hacktricks-training.md}}

## Pub/Sub <a href="#reviewing-cloud-pubsub" id="reviewing-cloud-pubsub"></a>

[Google **Cloud Pub/Sub**](https://cloud.google.com/pubsub/) inafafanuliwa kama huduma inayowezesha ubadilishanaji wa ujumbe kati ya programu huru. Vipengele vya msingi ni **mada**, ambazo programu zinaweza **kujiandikisha**. Programu zilizojiandikisha zina uwezo wa **kutuma na kupokea ujumbe**. Kila ujumbe unajumuisha maudhui halisi pamoja na metadata inayohusiana.

**Mada ni foleni** ambapo ujumbe utaenda kutumwa, wakati **usajili** ni **vitu** ambavyo watumiaji wataweza kutumia ili **kufikia ujumbe katika mada**. Kunaweza kuwa na zaidi ya **usajili 1 kwa mada** na kuna aina 4 za usajili:

- **Pull**: Mtumiaji(wa) usajili huu anahitaji kuvuta ujumbe.
- **Push**: Kituo cha URL kinatolewa na ujumbe utatumwa mara moja kwake.
- **Big query table**: Kama push lakini kuweka ujumbe ndani ya meza ya Big query.
- **Cloud Storage**: Toa ujumbe moja kwa moja kwenye ndoo iliyopo.

Kwa **default**, **usajili unakoma baada ya siku 31**, ingawa unaweza kuwekwa kutokufa kamwe.

Kwa **default**, ujumbe unahifadhiwa kwa **siku 7**, lakini wakati huu unaweza **kuongezwa hadi siku 31**. Pia, ikiwa hauja **ACKed ndani ya sekunde 10** inarudi kwenye foleni. Inaweza pia kuwekwa kwamba ujumbe walio ACKed waendelee kuhifadhiwa.

Mada kwa default inasimbwa kwa kutumia **funguo ya usimbaji inayosimamiwa na Google**. Lakini **CMEK** (Funguo ya Usimbaji inayosimamiwa na Mteja) kutoka KMS inaweza pia kuchaguliwa.

**Barua ya kifo**: Usajili unaweza kuweka **idadi ya juu ya majaribio ya usambazaji**. Wakati ujumbe hauwezi kusambazwa, unarejelewa kwenye mada ya barua ya kifo iliyoainishwa.

### Snapshots & Schemas

Snapshot ni kipengele ambacho **kinakamata hali ya usajili katika wakati maalum**. Kimsingi ni **hifadhi ya kawaida ya ujumbe ambao haujakubaliwa katika usajili**. Kwa kuunda snapshot, unahifadhi hali ya kukubali ujumbe ya usajili, ikikuruhusu kuendelea na matumizi ya ujumbe kutoka mahali snapshot ilipokamatwa, hata baada ya ujumbe wa asili ungekuwa umefutwa.\
Ikiwa umebahatika, snapshot inaweza kuwa na **habari nyeti za zamani** kutoka wakati snapshot ilipokamatwa.

Unapounda mada, unaweza kuashiria kwamba **ujumbe wa mada lazima ufuate muundo**.

### Enumeration
```bash
# Get a list of topics in the project
gcloud pubsub topics list
gcloud pubsub topics describe <topic>
gcloud pubsub topics list-subscriptions <topic>
gcloud pubsub topics get-iam-policy <topic>

# Get a list of subscriptions across all topics
gcloud pubsub subscriptions list
gcloud pubsub subscriptions describe <subscription>
gcloud pubsub subscriptions get-iam-policy <subscription>

# Get list of schemas
gcloud pubsub schemas list
gcloud pubsub schemas describe <schema>
gcloud pubsub schemas list-revisions <schema>

# Get list of snapshots
gcloud pubsub snapshots list
gcloud pubsub snapshots describe <snapshot>
```
Hata hivyo, unaweza kupata matokeo bora zaidi [**ukiiomba seti kubwa ya data**](https://cloud.google.com/pubsub/docs/replay-overview), ikiwa ni pamoja na ujumbe wa zamani. Hii ina baadhi ya mahitaji na inaweza kuathiri programu, hivyo hakikisha unajua unachofanya.

### Privilege Escalation & Post Exploitation

{{#ref}}
../gcp-post-exploitation/gcp-pub-sub-post-exploitation.md
{{#endref}}

## Pub/Sub Lite

[**Pub/Sub Lite**](https://cloud.google.com/pubsub/docs/choosing-pubsub-or-lite) ni huduma ya ujumbe yenye **hifadhi ya eneo**. Pub/Sub Lite **ni ya gharama ndogo** ikilinganishwa na Pub/Sub na imekusudiwa kwa **michakato ya utiririshaji wa kiasi kikubwa** (hadi ujumbe milioni 10 kwa sekunde) na mifumo inayotegemea matukio ambapo gharama ya chini ndiyo kipaumbele.

Katika PubSub Lite kuna **mada** na **usajili**, hakuna **picha za hali** na **mifano** na kuna:

- **Hifadhi**: Hifadhi za Pub/Sub Lite ni kipengele kinachowaruhusu watumiaji kuhifadhi uwezo katika eneo maalum kwa ajili ya mitiririko yao ya ujumbe.
- **Operesheni**: Inarejelea vitendo na kazi zinazohusika katika kusimamia na kuendesha Pub/Sub Lite.

### Enumeration
```bash
# lite-topics
gcloud pubsub lite-topics list
gcloud pubsub lite-topics describe <topic>
gcloud pubsub lite-topics list-subscriptions <topic>

# lite-subscriptions
gcloud pubsub lite-subscriptions list
gcloud pubsub lite-subscriptions describe <subscription>

# lite-reservations
gcloud pubsub lite-reservations list
gcloud pubsub lite-reservations describe <topic>
gcloud pubsub lite-reservations list-topics <topic>

# lite-operations
gcloud pubsub lite-operations list
gcloud pubsub lite-operations describe <topic>
```
{{#include ../../../banners/hacktricks-training.md}}
