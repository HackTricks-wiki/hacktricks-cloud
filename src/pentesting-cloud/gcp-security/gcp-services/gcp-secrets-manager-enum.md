# GCP - Secrets Manager Enum

{{#include ../../../banners/hacktricks-training.md}}

## Secret Manager

Google [**Secret Manager**](https://cloud.google.com/solutions/secrets-management/)는 비밀번호, API 키, 인증서, 파일(최대 64KB) 및 기타 민감한 데이터를 저장하기 위한 금고와 같은 솔루션입니다.

비밀은 **다른 데이터를 저장하는 서로 다른 버전**을 가질 수 있습니다.

비밀은 **기본적으로 Google 관리 키를 사용하여 암호화**되지만, 비밀을 암호화하는 데 사용할 **KMS에서 키를 선택하는 것이 가능합니다**.

**회전**과 관련하여, **매일 특정 수의 메시지를 pub-sub로 전송하도록 구성**할 수 있으며, 해당 메시지를 수신하는 코드는 **비밀을 회전**할 수 있습니다.

**자동 삭제**를 위한 날짜를 구성할 수 있으며, 지정된 날짜가 **도달하면**, **비밀이 자동으로 삭제됩니다**.

### Enumeration
```bash
# First, list the entries
gcloud secrets list
gcloud secrets get-iam-policy <secret_name>

# Then, pull the clear-text of any version of any secret
gcloud secrets versions list <secret_name>
gcloud secrets versions access 1 --secret="<secret_name>"
```
### 권한 상승

다음 페이지에서 **secretmanager 권한을 악용하여 권한을 상승시키는 방법**을 확인할 수 있습니다.

{{#ref}}
../gcp-privilege-escalation/gcp-secretmanager-privesc.md
{{#endref}}

### 포스트 익스플로잇

{{#ref}}
../gcp-post-exploitation/gcp-secretmanager-post-exploitation.md
{{#endref}}

### 지속성

{{#ref}}
../gcp-persistence/gcp-secret-manager-persistence.md
{{#endref}}

### 회전 오용

공격자는 비밀을 **회전을 중지**하도록 업데이트할 수 있습니다(그래서 수정되지 않음), 또는 **회전을 훨씬 덜 자주** 하도록 할 수 있습니다(그래서 비밀이 수정되지 않음), 또는 **회전 메시지를 다른 pub/sub에 게시**하도록 하거나, 실행되는 회전 코드를 수정할 수 있습니다(이는 다른 서비스에서 발생하며, 아마도 Cloud Function에서 발생하므로 공격자는 Cloud Function 또는 다른 서비스에 대한 권한 있는 액세스가 필요합니다).

{{#include ../../../banners/hacktricks-training.md}}
