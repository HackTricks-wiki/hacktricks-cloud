# GCP - Secrets Manager Enum

{{#include ../../../banners/hacktricks-training.md}}

## Secret Manager

Google [**Secret Manager**](https://cloud.google.com/solutions/secrets-management/) 是一个类似保险库的解决方案，用于存储密码、API 密钥、证书、文件（最大 64KB）和其他敏感数据。

一个秘密可以有 **不同版本存储不同数据**。

秘密默认是 **使用 Google 管理的密钥加密**，但可以 **选择 KMS 中的密钥** 来加密秘密。

关于 **轮换**，可以配置 **每隔几天向 pub-sub 发送消息**，监听这些消息的代码可以 **轮换秘密**。

可以配置一个 **自动删除** 的日期，当到达指定日期时，**秘密将被自动删除**。

### Enumeration
```bash
# First, list the entries
gcloud secrets list
gcloud secrets get-iam-policy <secret_name>

# Then, pull the clear-text of any version of any secret
gcloud secrets versions list <secret_name>
gcloud secrets versions access 1 --secret="<secret_name>"
```
### 权限提升

在以下页面中，您可以查看如何**滥用 secretmanager 权限来提升权限。**

{{#ref}}
../gcp-privilege-escalation/gcp-secretmanager-privesc.md
{{#endref}}

### 后期利用

{{#ref}}
../gcp-post-exploitation/gcp-secretmanager-post-exploitation.md
{{#endref}}

### 持久性

{{#ref}}
../gcp-persistence/gcp-secret-manager-persistence.md
{{#endref}}

### 轮换滥用

攻击者可以更新秘密以**停止轮换**（这样它就不会被修改），或**使轮换频率大大降低**（这样秘密就不会被修改），或**将轮换消息发布到不同的 pub/sub**，或修改正在执行的轮换代码（这发生在不同的服务中，可能是在 Cloud Function 中，因此攻击者需要对 Cloud Function 或任何其他服务具有特权访问权限）

{{#include ../../../banners/hacktricks-training.md}}
