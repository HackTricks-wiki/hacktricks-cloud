# GCP - Secrets Manager Enum

{{#include ../../../banners/hacktricks-training.md}}

## Secret Manager

Google [**Secret Manager**](https://cloud.google.com/solutions/secrets-management/) είναι μια λύση τύπου θησαυροφυλακίου για την αποθήκευση κωδικών πρόσβασης, API keys, πιστοποιητικών, αρχείων (μέγιστο 64KB) και άλλων ευαίσθητων δεδομένων.

Ένα μυστικό μπορεί να έχει **διαφορετικές εκδόσεις που αποθηκεύουν διαφορετικά δεδομένα**.

Τα μυστικά από **προεπιλογή** είναι **κρυπτογραφημένα χρησιμοποιώντας ένα κλειδί που διαχειρίζεται η Google**, αλλά είναι **δυνατό να επιλέξετε ένα κλειδί από το KMS** για να χρησιμοποιηθεί για την κρυπτογράφηση του μυστικού.

Όσον αφορά την **περιστροφή**, είναι δυνατό να ρυθμίσετε **μηνύματα που θα αποστέλλονται στο pub-sub κάθε αριθμό ημερών**, ο κώδικας που ακούει αυτά τα μηνύματα μπορεί να **περιστρέψει το μυστικό**.

Είναι δυνατό να ρυθμίσετε μια ημέρα για **αυτόματη διαγραφή**, όταν η υποδεικνυόμενη ημέρα **φτάσει**, το **μυστικό θα διαγραφεί αυτόματα**.

### Enumeration
```bash
# First, list the entries
gcloud secrets list
gcloud secrets get-iam-policy <secret_name>

# Then, pull the clear-text of any version of any secret
gcloud secrets versions list <secret_name>
gcloud secrets versions access 1 --secret="<secret_name>"
```
### Privilege Escalation

In the following page you can check how to **καταχραστείτε τις άδειες του secretmanager για να κλιμακώσετε τα προνόμια.**

{{#ref}}
../gcp-privilege-escalation/gcp-secretmanager-privesc.md
{{#endref}}

### Post Exploitation

{{#ref}}
../gcp-post-exploitation/gcp-secretmanager-post-exploitation.md
{{#endref}}

### Persistence

{{#ref}}
../gcp-persistence/gcp-secret-manager-persistence.md
{{#endref}}

### Rotation misuse

An attacker could update the secret to **σταματήσει τις περιστροφές** (so it won't be modified), or **κάνει τις περιστροφές πολύ λιγότερο συχνά** (so the secret won't be modified) or to **δημοσιεύσει το μήνυμα περιστροφής σε διαφορετικό pub/sub**, or modifying the rotation code being executed (this happens in a different service, probably in a Clound Function, so the attacker will need privileged access over the Cloud Function or any other service)

{{#include ../../../banners/hacktricks-training.md}}
