# GCP - Secrets Manager Enum

{{#include ../../../banners/hacktricks-training.md}}

## Secret Manager

Google [**Secret Manager**](https://cloud.google.com/solutions/secrets-management/) ist eine vault-ähnliche Lösung zum Speichern von Passwörtern, API-Schlüsseln, Zertifikaten, Dateien (max 64KB) und anderen sensiblen Daten.

Ein Geheimnis kann **verschiedene Versionen mit unterschiedlichen Daten** haben.

Geheimnisse sind **standardmäßig** **mit einem von Google verwalteten Schlüssel verschlüsselt**, aber es ist **möglich, einen Schlüssel aus KMS auszuwählen**, um das Geheimnis zu verschlüsseln.

Bezüglich der **Rotation** ist es möglich, **Nachrichten zu konfigurieren, die alle paar Tage an Pub-Sub gesendet werden**, der Code, der auf diese Nachrichten hört, kann **das Geheimnis rotieren**.

Es ist möglich, einen Tag für die **automatische Löschung** zu konfigurieren; wenn der angegebene Tag **erreicht ist**, wird das **Geheimnis automatisch gelöscht**.

### Enumeration
```bash
# First, list the entries
gcloud secrets list
gcloud secrets get-iam-policy <secret_name>

# Then, pull the clear-text of any version of any secret
gcloud secrets versions list <secret_name>
gcloud secrets versions access 1 --secret="<secret_name>"
```
### Privilegieneskalation

Auf der folgenden Seite können Sie überprüfen, wie man **die Berechtigungen des Secret Managers missbrauchen kann, um Privilegien zu eskalieren.**

{{#ref}}
../gcp-privilege-escalation/gcp-secretmanager-privesc.md
{{#endref}}

### Post-Exploitation

{{#ref}}
../gcp-post-exploitation/gcp-secretmanager-post-exploitation.md
{{#endref}}

### Persistenz

{{#ref}}
../gcp-persistence/gcp-secret-manager-persistence.md
{{#endref}}

### Missbrauch der Rotation

Ein Angreifer könnte das Geheimnis aktualisieren, um **Rotationen zu stoppen** (damit es nicht geändert wird), oder **Rotationen viel seltener zu machen** (damit das Geheimnis nicht geändert wird) oder **die Rotationsnachricht an ein anderes Pub/Sub zu veröffentlichen**, oder den ausgeführten Rotationscode zu ändern (dies geschieht in einem anderen Dienst, wahrscheinlich in einer Cloud-Funktion, sodass der Angreifer privilegierten Zugriff auf die Cloud-Funktion oder einen anderen Dienst benötigt)

{{#include ../../../banners/hacktricks-training.md}}
