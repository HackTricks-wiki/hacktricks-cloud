# GCP - Secrets Manager Enum

{{#include ../../../banners/hacktricks-training.md}}

## Secret Manager

Google [**Secret Manager**](https://cloud.google.com/solutions/secrets-management/) je rešenje nalik trezoru za čuvanje lozinki, API ključeva, sertifikata, fajlova (maks 64KB) i drugih osetljivih podataka.

Tajna može imati **različite verzije koje čuvaju različite podatke**.

Tajne su po **default-u** **enkriptovane koristeći Google upravljani ključ**, ali je **moguće odabrati ključ iz KMS** za korišćenje u enkripciji tajne.

Što se tiče **rotacije**, moguće je konfigurisati **poruke koje će biti poslati na pub-sub svaka određena broj dana**, kod koji sluša te poruke može **rotirati tajnu**.

Moguće je konfigurisati dan za **automatsko brisanje**, kada se dostigne navedeni dan, **tajna će biti automatski obrisana**.

### Enumeration
```bash
# First, list the entries
gcloud secrets list
gcloud secrets get-iam-policy <secret_name>

# Then, pull the clear-text of any version of any secret
gcloud secrets versions list <secret_name>
gcloud secrets versions access 1 --secret="<secret_name>"
```
### Eskalacija privilegija

Na sledećoj stranici možete proveriti kako da **zloupotrebite dozvole secretmanager-a za eskalaciju privilegija.**

{{#ref}}
../gcp-privilege-escalation/gcp-secretmanager-privesc.md
{{#endref}}

### Post Eksploatacija

{{#ref}}
../gcp-post-exploitation/gcp-secretmanager-post-exploitation.md
{{#endref}}

### Postojanost

{{#ref}}
../gcp-persistence/gcp-secret-manager-persistence.md
{{#endref}}

### Zloupotreba rotacije

Napadač bi mogao da ažurira tajnu da **zaustavi rotacije** (tako da ne bude izmenjena), ili da **učini rotacije mnogo ređim** (tako da tajna ne bude izmenjena) ili da **objavi poruku o rotaciji na drugom pub/sub**, ili da izmeni kod rotacije koji se izvršava (to se dešava u drugoj usluzi, verovatno u Clound Function, tako da će napadač morati da ima privilegovan pristup Cloud Function-u ili bilo kojoj drugoj usluzi)

{{#include ../../../banners/hacktricks-training.md}}
