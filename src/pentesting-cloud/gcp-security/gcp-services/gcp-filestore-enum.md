# GCP - Filestore Enum

{{#include ../../../banners/hacktricks-training.md}}

## Basic Information

Google Cloud Filestore - це **керована служба зберігання файлів**, призначена для додатків, які потребують як **інтерфейсу файлової системи, так і спільної файлової системи для даних**. Ця служба відзначається високопродуктивними файловими спільними ресурсами, які можна інтегрувати з різними службами GCP. Її корисність проявляється в сценаріях, де традиційні інтерфейси та семантика файлових систем є критично важливими, такими як обробка медіа, управління контентом та резервне копіювання баз даних.

Ви можете розглядати це як будь-який інший **NFS** **спільний репозиторій документів -** потенційне джерело чутливої інформації.

### Connections

При створенні екземпляра Filestore можливо **вибрати мережу, в якій він буде доступний**.

Більше того, **за замовчуванням всі клієнти в обраній VPC-мережі та регіоні зможуть отримати до нього доступ**, однак можливо **обмежити доступ також за IP-адресою** або діапазоном та вказати привілей доступу (Admin, Admin Viewer, Editor, Viewer), який отримає користувач клієнта **в залежності від IP-адреси.**

Він також може бути доступний через **Private Service Access Connection:**

- Вони є для кожної VPC-мережі і можуть використовуватися для всіх керованих служб, таких як Memorystore, Tensorflow та SQL.
- Вони є **між вашою VPC-мережею та мережею, що належить Google, використовуючи VPC peering**, що дозволяє вашим екземплярам та службам спілкуватися виключно за допомогою **внутрішніх IP-адрес**.
- Створює ізольований проект для вас на стороні постачальника послуг, що означає, що жоден інший клієнт не ділиться ним. Вам буде виставлено рахунок лише за ресурси, які ви надаєте.
- VPC peering імпортує нові маршрути до вашої VPC.

### Backups

Можливо створити **резервні копії файлових спільних ресурсів**. Ці резервні копії можна пізніше **відновити в оригінальному** новому екземплярі Fileshare або в **нових**.

### Encryption

За замовчуванням буде використовуватися **ключ шифрування, керований Google**, але можливо вибрати **ключ шифрування, керований клієнтом (CMEK)**.

### Enumeration

Якщо ви знайдете доступний filestore у проекті, ви можете **підключити його** з вашого скомпрометованого екземпляра Compute. Використовуйте наступну команду, щоб перевірити, чи існують які-небудь.
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
> [!CAUTION]
> Зверніть увагу, що сервіс filestore може бути в **повністю новій підмережі, створеній для нього** (всередині Private Service Access Connection, який є **VPC peer**).\
> Тому вам може знадобитися **перерахувати VPC peers**, щоб також запустити nmap по цих мережевих діапазонах.
>
> ```bash
> # Отримати пірінги
> gcloud compute networks peerings list
> # Отримати маршрути, імпортовані з пірінга
> gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
> ```

### Підвищення привілеїв та постексплуатація

Немає способів підвищити привілеї в GCP, безпосередньо зловживаючи цим сервісом, але використовуючи деякі **трюки постексплуатації, можливо отримати доступ до даних** і, можливо, ви зможете знайти деякі облікові дані для підвищення привілеїв:

{{#ref}}
../gcp-post-exploitation/gcp-filestore-post-exploitation.md
{{#endref}}

### Постійність

{{#ref}}
../gcp-persistence/gcp-filestore-persistence.md
{{#endref}}

{{#include ../../../banners/hacktricks-training.md}}
