# GCP - Filestore Enum

{{#include ../../../banners/hacktricks-training.md}}

## 基本信息

Google Cloud Filestore 是一个 **托管文件存储服务**，专为需要 **文件系统接口和共享文件系统的数据** 的应用程序量身定制。该服务通过提供高性能的文件共享而表现出色，可以与各种 GCP 服务集成。它在传统文件系统接口和语义至关重要的场景中表现尤为突出，例如媒体处理、内容管理和数据库备份。

你可以将其视为任何其他 **NFS** **共享文档库 -** 一个潜在的敏感信息来源。

### 连接

创建 Filestore 实例时，可以 **选择其可访问的网络**。

此外，**默认情况下，所选 VPC 网络和区域上的所有客户端都将能够访问它**，但是，可以通过 **IP 地址** 或范围来 **限制访问**，并指示客户端将根据 **IP 地址** 获得的访问权限（管理员、管理员查看者、编辑者、查看者）。

它还可以通过 **私有服务访问连接** 进行访问：

- 每个 VPC 网络，并且可以在所有托管服务中使用，例如 Memorystore、Tensorflow 和 SQL。
- 在您的 VPC 网络和 Google 拥有的网络之间使用 VPC 对等连接，使您的实例和服务能够仅通过 **使用内部 IP 地址** 进行通信。
- 在服务提供方为您创建一个隔离项目，这意味着没有其他客户共享它。您只需为您配置的资源付费。
- VPC 对等连接将导入新路由到您的 VPC。

### 备份

可以创建 **文件共享的备份**。这些备份可以在 **原始** 新文件共享实例或 **新实例** 中进行 **恢复**。

### 加密

默认情况下，将使用 **Google 管理的加密密钥** 来加密数据，但可以选择 **客户管理的加密密钥 (CMEK)**。

### 枚举

如果您在项目中发现可用的 Filestore，可以从您被攻陷的计算实例中 **挂载它**。使用以下命令查看是否存在。
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
> [!CAUTION]
> 注意，filestore 服务可能位于为其创建的 **全新子网络** 中（在一个 **私有服务访问连接** 内，即 **VPC 对等**）。\
> 因此，您可能需要 **枚举 VPC 对等** 以便在这些网络范围内运行 nmap。
>
> ```bash
> # 获取对等连接
> gcloud compute networks peerings list
> # 获取从对等连接导入的路由
> gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
> ```

### 权限提升与后期利用

在 GCP 中没有直接利用此服务提升权限的方法，但使用一些 **后期利用技巧可以访问数据**，也许您可以找到一些凭据来提升权限：

{{#ref}}
../gcp-post-exploitation/gcp-filestore-post-exploitation.md
{{#endref}}

### 持久性

{{#ref}}
../gcp-persistence/gcp-filestore-persistence.md
{{#endref}}

{{#include ../../../banners/hacktricks-training.md}}
