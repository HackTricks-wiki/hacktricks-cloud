# GCP - Filestore Enum

{{#include ../../../banners/hacktricks-training.md}}

## Basic Information

Το Google Cloud Filestore είναι μια **διαχειριζόμενη υπηρεσία αποθήκευσης αρχείων** που έχει σχεδιαστεί για εφαρμογές που χρειάζονται τόσο **διεπαφή συστήματος αρχείων όσο και κοινό σύστημα αρχείων για δεδομένα**. Αυτή η υπηρεσία διακρίνεται προσφέροντας υψηλής απόδοσης κοινές διανομές αρχείων, οι οποίες μπορούν να ενσωματωθούν με διάφορες υπηρεσίες GCP. Η χρησιμότητά της λάμπει σε σενάρια όπου οι παραδοσιακές διεπαφές και οι σημασιολογίες συστήματος αρχείων είναι κρίσιμες, όπως στην επεξεργασία πολυμέσων, τη διαχείριση περιεχομένου και την εφεδρεία βάσεων δεδομένων.

Μπορείτε να το σκεφτείτε όπως οποιοδήποτε άλλο **NFS** **κοινό αποθετήριο εγγράφων -** μια πιθανή πηγή ευαίσθητης πληροφορίας.

### Connections

Όταν δημιουργείτε μια παρουσία Filestore, είναι δυνατό να **επιλέξετε το δίκτυο όπου θα είναι προσβάσιμο**.

Επιπλέον, **κατά προεπιλογή όλοι οι πελάτες στο επιλεγμένο δίκτυο VPC και περιοχή θα μπορούν να το προσπελάσουν**, ωστόσο, είναι δυνατό να **περιορίσετε την πρόσβαση επίσης κατά διεύθυνση IP** ή εύρος και να υποδείξετε το δικαίωμα πρόσβασης (Admin, Admin Viewer, Editor, Viewer) που θα αποκτήσει ο χρήστης ανάλογα με τη διεύθυνση IP.

Μπορεί επίσης να είναι προσβάσιμο μέσω **Ιδιωτικής Σύνδεσης Υπηρεσίας:**

- Είναι ανά δίκτυο VPC και μπορούν να χρησιμοποιηθούν σε όλες τις διαχειριζόμενες υπηρεσίες όπως Memorystore, Tensorflow και SQL.
- Είναι **μεταξύ του δικτύου VPC σας και του δικτύου που ανήκει στην Google χρησιμοποιώντας VPC peering**, επιτρέποντας στις παρουσίες και τις υπηρεσίες σας να επικοινωνούν αποκλειστικά **χρησιμοποιώντας εσωτερικές διευθύνσεις IP**.
- Δημιουργεί ένα απομονωμένο έργο για εσάς στην πλευρά του παραγωγού υπηρεσιών, πράγμα που σημαίνει ότι κανένας άλλος πελάτης δεν το μοιράζεται. Θα χρεωθείτε μόνο για τους πόρους που προμηθεύετε.
- Το VPC peering θα εισάγει νέες διαδρομές στο VPC σας.

### Backups

Είναι δυνατό να δημιουργήσετε **αντίγραφα ασφαλείας των κοινών διανομών αρχείων**. Αυτά μπορούν να **αποκατασταθούν αργότερα στην αρχική** νέα παρουσία Fileshare ή σε **νέες**.

### Encryption

Κατά προεπιλογή θα χρησιμοποιηθεί ένα **κλειδί κρυπτογράφησης που διαχειρίζεται η Google** για την κρυπτογράφηση των δεδομένων, αλλά είναι δυνατό να επιλέξετε ένα **κλειδί κρυπτογράφησης που διαχειρίζεται ο πελάτης (CMEK)**.

### Enumeration

Εάν βρείτε ένα filestore διαθέσιμο στο έργο, μπορείτε να το **τοποθετήσετε** από την παραβιασμένη παρουσία Compute Instance σας. Χρησιμοποιήστε την παρακάτω εντολή για να δείτε αν υπάρχουν.
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
> [!CAUTION]
> Σημειώστε ότι μια υπηρεσία filestore μπορεί να βρίσκεται σε ένα **εντελώς νέο υποδίκτυο που έχει δημιουργηθεί γι' αυτό** (μέσα σε μια Ιδιωτική Σύνδεση Υπηρεσίας, η οποία είναι ένα **VPC peer**).\
> Έτσι, μπορεί να χρειαστεί να **καταγράψετε τα VPC peers** για να εκτελέσετε επίσης nmap σε αυτές τις διευθύνσεις δικτύου.
>
> ```bash
> # Get peerings
> gcloud compute networks peerings list
> # Get routes imported from a peering
> gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
> ```

### Privilege Escalation & Post Exploitation

Δεν υπάρχουν τρόποι για να κλιμακώσετε τα προνόμια στο GCP εκμεταλλευόμενοι άμεσα αυτή την υπηρεσία, αλλά χρησιμοποιώντας μερικά **tricks Post Exploitation είναι δυνατόν να αποκτήσετε πρόσβαση στα δεδομένα** και ίσως να βρείτε κάποια διαπιστευτήρια για να κλιμακώσετε τα προνόμια:

{{#ref}}
../gcp-post-exploitation/gcp-filestore-post-exploitation.md
{{#endref}}

### Persistence

{{#ref}}
../gcp-persistence/gcp-filestore-persistence.md
{{#endref}}

{{#include ../../../banners/hacktricks-training.md}}
