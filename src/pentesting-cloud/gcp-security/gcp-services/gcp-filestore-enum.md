# GCP - Filestore Enum

{{#include ../../../banners/hacktricks-training.md}}

## Temel Bilgiler

Google Cloud Filestore, **dosya sistemi arayüzü ve veri için paylaşılan bir dosya sistemi** gereksinimi olan uygulamalar için tasarlanmış **yönetilen dosya depolama hizmetidir**. Bu hizmet, çeşitli GCP hizmetleriyle entegre edilebilen yüksek performanslı dosya paylaşımları sunarak öne çıkar. Geleneksel dosya sistemi arayüzlerinin ve anlamlarının kritik olduğu medya işleme, içerik yönetimi ve veritabanı yedekleme gibi senaryolarda faydası belirgindir.

Bunu, potansiyel hassas bilgi kaynağı olan herhangi bir **NFS** **paylaşılan belge deposu** gibi düşünebilirsiniz.

### Bağlantılar

Bir Filestore örneği oluştururken, **erişilebilir olacağı ağı seçmek mümkündür**.

Ayrıca, **varsayılan olarak seçilen VPC ağı ve bölgedeki tüm istemcilerin buna erişebileceği** belirtilmiştir, ancak erişimi **IP adresi** veya aralığı ile **kısıtlamak da mümkündür** ve istemcinin alacağı erişim ayrıcalığını (Admin, Admin Viewer, Editor, Viewer) **IP adresine bağlı olarak** belirtebilirsiniz.

Ayrıca, **Özel Hizmet Erişim Bağlantısı** aracılığıyla erişilebilir:

- VPC ağı başına olup, Memorystore, Tensorflow ve SQL gibi tüm yönetilen hizmetler arasında kullanılabilir.
- **VPC peering kullanarak Google'a ait bir ağ ile VPC ağınız arasında** olup, örneklerinizin ve hizmetlerinizin yalnızca **iç IP adreslerini kullanarak** iletişim kurmasını sağlar.
- Hizmet üretici tarafında sizin için izole bir proje oluşturur, yani başka müşterilerin paylaşmadığı bir alan. Sadece sağladığınız kaynaklar için faturalandırılacaksınız.
- VPC peering, VPC'nize yeni yollar ekleyecektir.

### Yedeklemeler

**Dosya paylaşımlarının yedeklerini** oluşturmak mümkündür. Bunlar daha sonra **kaynağa** yeni Fileshare örneğinde veya **yeni olanlarda** **geri yüklenebilir**.

### Şifreleme

Varsayılan olarak, verileri şifrelemek için **Google tarafından yönetilen bir şifreleme anahtarı** kullanılacaktır, ancak **Müşteri tarafından yönetilen şifreleme anahtarı (CMEK)** seçmek de mümkündür.

### Sayım

Projede mevcut bir filestore bulursanız, **kompromize edilmiş Compute Instance'ınızdan** bunu **bağlayabilirsiniz**. Herhangi birinin var olup olmadığını görmek için aşağıdaki komutu kullanın.
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
> [!CAUTION]
> Bir filestore hizmetinin **tamamen yeni bir alt ağda oluşturulmuş olabileceğini** unutmayın (bir Özel Hizmet Erişim Bağlantısı içinde, bu bir **VPC eşleşmesi**dir).\
> Bu nedenle, bu ağ aralıklarında nmap çalıştırmak için **VPC eşleşmelerini** de **numaralandırmanız** gerekebilir.
>
> ```bash
> # Eşleşmeleri al
> gcloud compute networks peerings list
> # Bir eşleşmeden içe aktarılan yolları al
> gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
> ```

### Yetki Yükseltme & Sonrası İstismar

Bu hizmeti doğrudan kötüye kullanarak yetki yükseltmenin yolları yoktur, ancak bazı **Sonrası İstismar hileleri kullanarak verilere erişmek mümkündür** ve belki de yetki yükseltmek için bazı kimlik bilgileri bulabilirsiniz:

{{#ref}}
../gcp-post-exploitation/gcp-filestore-post-exploitation.md
{{#endref}}

### Süreklilik

{{#ref}}
../gcp-persistence/gcp-filestore-persistence.md
{{#endref}}

{{#include ../../../banners/hacktricks-training.md}}
