# GCP - Filestore Enum

{{#include ../../../banners/hacktricks-training.md}}

## Basic Information

Google Cloud Filestore ni **huduma ya kuhifadhi faili inayosimamiwa** iliyoundwa kwa ajili ya programu zinazohitaji **kiolesura cha mfumo wa faili na mfumo wa faili wa pamoja kwa data**. Huduma hii inajulikana kwa kutoa sehemu za faili zenye utendaji wa juu, ambazo zinaweza kuunganishwa na huduma mbalimbali za GCP. Faida yake inaonekana katika hali ambapo violesura vya mfumo wa faili wa jadi na semantiki ni muhimu, kama vile katika usindikaji wa vyombo vya habari, usimamizi wa maudhui, na nakala za hifadhidata.

Unaweza kufikiria hii kama **hifadhi ya hati ya pamoja ya NFS** - chanzo kinachoweza kuwa na habari nyeti.

### Connections

Unapounda mfano wa Filestore, inawezekana **kuchagua mtandao ambapo utaweza kuufikia**.

Zaidi ya hayo, kwa **kawaida wateja wote kwenye mtandao wa VPC uliochaguliwa na eneo wataweza kuufikia**, hata hivyo, inawezekana **kuzuia ufikiaji pia kwa anwani ya IP** au anuwai na kuashiria haki za ufikiaji (Admin, Admin Viewer, Editor, Viewer) ambazo mteja atapata **kulingana na anwani ya IP.**

Inaweza pia kufikiwa kupitia **Muunganisho wa Ufikiaji wa Huduma Binafsi:**

- Ni za kila mtandao wa VPC na zinaweza kutumika katika huduma zote zinazodhibitiwa kama Memorystore, Tensorflow na SQL.
- Ni **kati ya mtandao wako wa VPC na mtandao unaomilikiwa na Google kwa kutumia VPC peering**, ikiruhusu mifano yako na huduma kuwasiliana kwa kipekee kwa **kutumia anwani za IP za ndani**.
- Unda mradi uliofungwa kwako kwenye upande wa mtengenezaji wa huduma, ikimaanisha hakuna wateja wengine wanaoshiriki. Utatozwa ada kwa rasilimali pekee unazotoa.
- VPC peering itaunda njia mpya kwa mtandao wako wa VPC.

### Backups

Inawezekana kuunda **nakala za sehemu za faili**. Hizi zinaweza baadaye **kurudishwa katika mfano wa Fileshare wa asili** au katika **mpya**.

### Encryption

Kwa kawaida, **funguo za usimbaji zinazodhibitiwa na Google** zitatumika kusimbua data, lakini inawezekana kuchagua **funguo za usimbaji zinazodhibitiwa na Mteja (CMEK)**.

### Enumeration

Ikiwa unapata filestore inayopatikana katika mradi, unaweza **kuunganisha** kutoka ndani ya Mfano wako wa Compute ulioathirika. Tumia amri ifuatayo kuona kama kuna yoyote.
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
> [!CAUTION]
> Kumbuka kwamba huduma ya filestore inaweza kuwa katika **subnetwork mpya kabisa iliyoundwa kwa ajili yake** (ndani ya Muunganisho wa Huduma Binafsi, ambao ni **VPC peer**).\
> Hivyo unaweza kuhitaji **kuhesabu VPC peers** ili pia kufanyia nmap kwenye hizo anuwai za mtandao.
>
> ```bash
> # Pata peerings
> gcloud compute networks peerings list
> # Pata njia zilizopokelewa kutoka kwa peering
> gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
> ```

### Privilege Escalation & Post Exploitation

Hakuna njia za kupandisha mamlaka katika GCP kwa moja kwa moja kutumia huduma hii, lakini kwa kutumia baadhi ya **hila za Post Exploitation inawezekana kupata ufikiaji wa data** na labda unaweza kupata baadhi ya akreditif za kupandisha mamlaka:

{{#ref}}
../gcp-post-exploitation/gcp-filestore-post-exploitation.md
{{#endref}}

### Persistence

{{#ref}}
../gcp-persistence/gcp-filestore-persistence.md
{{#endref}}

{{#include ../../../banners/hacktricks-training.md}}
