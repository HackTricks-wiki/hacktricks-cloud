# GCP - Cloud Run Enum

{{#include ../../../banners/hacktricks-training.md}}

## Cloud Run <a href="#reviewing-cloud-run-configurations" id="reviewing-cloud-run-configurations"></a>

Cloud Run - це безсерверна керована обчислювальна платформа, яка дозволяє вам **запускати контейнери** безпосередньо на масштабованій інфраструктурі Google.

Ви можете запустити свій контейнер або, якщо ви використовуєте Go, Node.js, Python, Java, .NET Core або Ruby, ви можете скористатися опцією [deployment на основі коду](https://cloud.google.com/run/docs/deploying-source-code), яка **будує контейнер за вас.**

Google створив Cloud Run, щоб **добре працювати разом з іншими сервісами на Google Cloud**, тому ви можете створювати повнофункціональні додатки.

### Services and jobs <a href="#services-and-jobs" id="services-and-jobs"></a>

На Cloud Run ваш код може працювати безперервно як _**сервіс**_ або як _**робота**_. І сервіси, і роботи працюють в одному середовищі та можуть використовувати ті ж інтеграції з іншими сервісами на Google Cloud.

- **Сервіси Cloud Run.** Використовуються для запуску коду, який відповідає на веб-запити або події.
- **Роботи Cloud Run.** Використовуються для запуску коду, який виконує роботу (роботу) і завершується, коли робота закінчена.

## Cloud Run Service

Google [Cloud Run](https://cloud.google.com/run) - це ще одна безсерверна пропозиція, де ви також можете шукати змінні середовища. Cloud Run створює невеликий веб-сервер, який за замовчуванням працює на порту 8080 всередині контейнера, який чекає на HTTP GET запит. Коли запит отримано, виконується робота, а журнал роботи виводиться через HTTP-відповідь.

### Relevant details

- За **замовчуванням** доступ до веб-сервера є **публічним**, але його також можна **обмежити внутрішнім трафіком** (VPC...)\
Більше того, **автентифікація** для зв'язку з веб-сервером може бути **дозволена всім** або **вимагати автентифікацію через IAM**.
- За замовчуванням **шифрування** використовує **керований Google ключ**, але також можна **вибрати** **CMEK** (Ключ шифрування, керований клієнтом) з **KMS**.
- За **замовчуванням** використовується **обліковий запис служби**, який є **за замовчуванням для Compute Engine**, який має **доступ редактора** до проекту і має **обсяг `cloud-platform`.**
- Можна визначити **змінні середовища у відкритому тексті** для виконання, а також **монтувати хмарні секрети** або **додавати хмарні секрети до змінних середовища.**
- Також можливо **додавати з'єднання з Cloud SQL** та **монтувати файлову систему.**
- **URL-адреси** розгорнуті сервісів схожі на **`https://<svc-name>-<random>.a.run.app`**
- Сервіс Run може мати **більше ніж 1 версію або ревізію**, і **розподіляти трафік** між кількома ревізіями.

### Enumeration
```bash
# List services
gcloud run services list
gcloud run services list --platform=managed
gcloud run services list --platform=gke

# Get info of a service
gcloud run services describe --region <region> <svc-name>

# Get info of all the services together
gcloud run services list --format=yaml
gcloud run services list --platform=managed --format=json
gcloud run services list --platform=gke --format=json

# Get policy
gcloud run services get-iam-policy --region <region> <svc-name>

# Get revisions
gcloud run revisions list --region <region>
gcloud run revisions describe --region <region> <revision>

# Get domains
gcloud run domain-mappings list
gcloud run domain-mappings describe <name>

# Attempt to trigger a job unauthenticated
curl <url>

# Attempt to trigger a job with your current gcloud authorization
curl -H "Authorization: Bearer $(gcloud auth print-identity-token)" <url>
```
## Cloud Run Jobs

Cloud Run jobs є кращим варіантом для **контейнерів, які виконуються до завершення і не обслуговують запити**. Jobs не мають можливості обслуговувати запити або слухати на порту. Це означає, що на відміну від Cloud Run services, jobs не повинні включати веб-сервер. Натомість, контейнери jobs повинні завершуватися, коли вони закінчують свою роботу.

### Enumeration
```bash
gcloud beta run jobs list
gcloud beta run jobs describe --region <region> <job-name>
gcloud beta run jobs get-iam-policy --region <region> <job-name>
```
## Підвищення Привілеїв

На наступній сторінці ви можете перевірити, як **зловживати дозволами cloud run для підвищення привілеїв**:

{{#ref}}
../gcp-privilege-escalation/gcp-run-privesc.md
{{#endref}}

## Неавтентифікований Доступ

{{#ref}}
../gcp-unauthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md
{{#endref}}

## Після Експлуатації

{{#ref}}
../gcp-post-exploitation/gcp-cloud-run-post-exploitation.md
{{#endref}}

## Постійність

{{#ref}}
../gcp-persistence/gcp-cloud-run-persistence.md
{{#endref}}

## Посилання

- [https://cloud.google.com/run/docs/overview/what-is-cloud-run](https://cloud.google.com/run/docs/overview/what-is-cloud-run)

{{#include ../../../banners/hacktricks-training.md}}
