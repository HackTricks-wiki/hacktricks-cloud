# GCP - Cloud Scheduler Enum

{{#include ../../../banners/hacktricks-training.md}}

## Informações Básicas

O Google Cloud Scheduler é um **serviço de cron job** totalmente gerenciado que permite executar trabalhos arbitrários—como trabalhos em lote, trabalhos de big data, operações de infraestrutura em nuvem—em horários, datas ou intervalos fixos. Ele está integrado aos serviços do Google Cloud, fornecendo uma maneira de **automatizar várias tarefas, como atualizações ou processamento em lote em uma programação regular**.

Embora, do ponto de vista ofensivo, isso pareça incrível, na verdade não é tão interessante porque o serviço apenas permite agendar certas ações simples em um determinado momento e não executar código arbitrário.

No momento em que este texto foi escrito, estas são as ações que este serviço permite agendar:

<figure><img src="../../../images/image (347).png" alt="" width="563"><figcaption></figcaption></figure>

- **HTTP**: Enviar uma solicitação HTTP definindo os cabeçalhos e o corpo da solicitação.
- **Pub/Sub**: Enviar uma mensagem para um tópico específico.
- **App Engine HTTP**: Enviar uma solicitação HTTP para um aplicativo construído no App Engine.
- **Workflows**: Chamar um Workflow do GCP.

## Contas de Serviço

Uma conta de serviço nem sempre é necessária para cada agendador. Os tipos **Pub/Sub** e **App Engine HTTP** não requerem nenhuma conta de serviço. O **Workflow** requer uma conta de serviço, mas apenas invocará o workflow.\
Finalmente, o tipo HTTP regular não requer uma conta de serviço, mas é possível indicar que algum tipo de autenticação é necessária pelo workflow e adicionar um **token OAuth ou um token OIDC à solicitação** HTTP enviada.

> [!CAUTION]
> Portanto, é possível roubar o **token OIDC** e abusar do **token OAuth** das contas de serviço **abusando do tipo HTTP**. Mais sobre isso na página de escalonamento de privilégios.

Note que é possível limitar o escopo do token OAuth enviado, no entanto, por padrão, será `cloud-platform`.

## Enumeração
```bash
# Get schedulers in a location
gcloud scheduler jobs list --location us-central1

# Get information of an specific scheduler
gcloud scheduler jobs describe --location us-central1 <scheduler-name>
```
## Escalada de Privilégios

{{#ref}}
../gcp-privilege-escalation/gcp-cloudscheduler-privesc.md
{{#endref}}

{{#include ../../../banners/hacktricks-training.md}}
