# GCP - Vertex AI Enum

{{#include ../../../banners/hacktricks-training.md}}

## Vertex AI

[Vertex AI](https://cloud.google.com/vertex-ai) Google Cloud'un ölçekte AI modelleri oluşturmak, dağıtmak ve yönetmek için kullandığı birleşik machine learning platformudur. Veri bilimciler ve ML mühendislerinin:

- **Özel modelleri eğitmesini** AutoML veya özel training ile
- **Modelleri dağıtıp** tahminler için ölçeklenebilir endpoints'lere konuşlandırmasını
- **ML yaşam döngüsünü yönetmesini** deney aşamasından production'a kadar
- **Model Garden**'dan önceden eğitilmiş modellere erişmesini
- **Model performansını izleyip optimize etmesini**

sağlar.

### Temel Bileşenler

#### Models

Vertex AI **models**, tahmin sunmak için endpoints'e deploy edilebilen eğitilmiş machine learning modellerini temsil eder. Modeller:

- Özel container'lar veya model artifact'lerinden **yüklenebilir**
- **AutoML** ile oluşturulabilir
- **Model Garden**'dan (önceden eğitilmiş modeller) içe aktarılabilir
- Model başına birden fazla versiyon ile **versioned** olabilir

Her modelin framework, container image URI, artifact konumu ve serving konfigürasyonu gibi metadata'sı bulunur.

#### Endpoints

**Endpoints**, deploy edilmiş modelleri barındıran ve online tahminler sunan kaynaklardır. Öne çıkan özellikler:

- **Birden fazla deployed model** barındırabilir (traffic splitting ile)
- Gerçek zamanlı tahminler için **HTTPS endpoints** sağlar
- Trafiğe göre **autoscaling** destekler
- **Private** veya **public** erişim kullanabilir
- Trafik bölme ile **A/B testing** destekler

#### Custom Jobs

**Custom jobs**, kendi container'larınızı veya Python paketlerinizi kullanarak özel training kodu çalıştırmanıza olanak tanır. Özellikler:

- Birden fazla worker pool ile **distributed training** desteği
- Konfigüre edilebilir **machine types** ve **accelerators** (GPUs/TPUs)
- Diğer GCP kaynaklarına erişim için **service account** iliştirme
- Görselleştirme için **Vertex AI Tensorboard** entegrasyonu
- **VPC connectivity** seçenekleri

#### Hyperparameter Tuning Jobs

Bu job'lar farklı parametre kombinasyonlarıyla birden fazla training trial çalıştırarak optimal hyperparameter'ları otomatik olarak **aranmasını** sağlar.

#### Model Garden

**Model Garden**, şu kaynaklara erişim sağlar:

- Önceden eğitilmiş Google modelleri
- Açık kaynak modeller (Hugging Face dahil)
- Üçüncü taraf modeller
- Tek tıklamayla dağıtım imkanları

#### Tensorboards

**Tensorboards**, ML deneyleri için görselleştirme ve izleme sağlar; metrikleri, model grafikleri ve eğitim ilerlemesini takip eder.

### Service Accounts & Permissions

Varsayılan olarak, Vertex AI servisleri proje üzerinde **Editor** izinlerine sahip olan **Compute Engine default service account** (`PROJECT_NUMBER-compute@developer.gserviceaccount.com`) kullanır. Ancak şu durumlarda özel service account belirtebilirsiniz:

- Custom jobs oluştururken
- Modeller yüklerken
- Modelleri endpoints'e deploy ederken

Bu service account şunlar için kullanılır:
- Cloud Storage içindeki training verilerine erişim
- Cloud Logging'e log yazma
- Secret Manager'dan secret'lara erişim
- Diğer GCP servisleriyle etkileşim

### Data Storage

- **Model artifacts** Cloud Storage bucket'larında saklanır
- **Training data** genellikle Cloud Storage veya BigQuery'de bulunur
- **Container images** Artifact Registry veya Container Registry'de saklanır
- **Logs** Cloud Logging'e gönderilir
- **Metrics** Cloud Monitoring'e gönderilir

### Encryption

Varsayılan olarak, Vertex AI **Google-managed encryption keys** kullanır. Ayrıca şu şekilde yapılandırabilirsiniz:

- Cloud KMS'den **customer-managed encryption keys (CMEK)**
- Şifreleme model artifact'lerine, training verilerine ve endpoints'e uygulanır

### Networking

Vertex AI kaynakları için yapılandırma seçenekleri:

- **Public internet access** (varsayılan)
- **VPC peering** ile private erişim
- **Private Service Connect** ile güvenli bağlantı
- **Shared VPC** desteği

### Enumeration
```bash
# List models
gcloud ai models list --region=<region>
gcloud ai models describe <model-id> --region=<region>
gcloud ai models list-version <model-id> --region=<region>

# List endpoints
gcloud ai endpoints list --region=<region>
gcloud ai endpoints describe <endpoint-id> --region=<region>
gcloud ai endpoints list --list-model-garden-endpoints-only --region=<region>

# List custom jobs
gcloud ai custom-jobs list --region=<region>
gcloud ai custom-jobs describe <job-id> --region=<region>

# Stream logs from a running job
gcloud ai custom-jobs stream-logs <job-id> --region=<region>

# List hyperparameter tuning jobs
gcloud ai hp-tuning-jobs list --region=<region>
gcloud ai hp-tuning-jobs describe <job-id> --region=<region>

# List model monitoring jobs
gcloud ai model-monitoring-jobs list --region=<region>
gcloud ai model-monitoring-jobs describe <job-id> --region=<region>

# List Tensorboards
gcloud ai tensorboards list --region=<region>
gcloud ai tensorboards describe <tensorboard-id> --region=<region>

# List indexes (for vector search)
gcloud ai indexes list --region=<region>
gcloud ai indexes describe <index-id> --region=<region>

# List index endpoints
gcloud ai index-endpoints list --region=<region>
gcloud ai index-endpoints describe <index-endpoint-id> --region=<region>

# Get operations (long-running operations status)
gcloud ai operations describe <operation-id> --region=<region>

# Test endpoint predictions (if you have access)
gcloud ai endpoints predict <endpoint-id> \
--region=<region> \
--json-request=request.json

# Make direct predictions (newer API)
gcloud ai endpoints direct-predict <endpoint-id> \
--region=<region> \
--json-request=request.json
```
### Model Bilgi Toplama
```bash
# Get detailed model information including versions
gcloud ai models describe <model-id> --region=<region>

# Check specific model version
gcloud ai models describe <model-id>@<version> --region=<region>

# List all versions of a model
gcloud ai models list-version <model-id> --region=<region>

# Get model artifact location (usually a GCS bucket)
gcloud ai models describe <model-id> --region=<region> --format="value(artifactUri)"

# Get container image URI
gcloud ai models describe <model-id> --region=<region> --format="value(containerSpec.imageUri)"
```
### Uç Nokta Detayları
```bash
# Get endpoint details including deployed models
gcloud ai endpoints describe <endpoint-id> --region=<region>

# Get endpoint URL
gcloud ai endpoints describe <endpoint-id> --region=<region> --format="value(deployedModels[0].displayName)"

# Get service account used by endpoint
gcloud ai endpoints describe <endpoint-id> --region=<region> --format="value(deployedModels[0].serviceAccount)"

# Check traffic split between models
gcloud ai endpoints describe <endpoint-id> --region=<region> --format="value(trafficSplit)"
```
### Özel İş Bilgileri
```bash
# Get job details including command, args, and service account
gcloud ai custom-jobs describe <job-id> --region=<region>

# Get service account used by job
gcloud ai custom-jobs describe <job-id> --region=<region> --format="value(jobSpec.workerPoolSpecs[0].serviceAccount)"

# Get container image used
gcloud ai custom-jobs describe <job-id> --region=<region> --format="value(jobSpec.workerPoolSpecs[0].containerSpec.imageUri)"

# Check environment variables (may contain secrets)
gcloud ai custom-jobs describe <job-id> --region=<region> --format="value(jobSpec.workerPoolSpecs[0].containerSpec.env)"

# Get network configuration
gcloud ai custom-jobs describe <job-id> --region=<region> --format="value(jobSpec.network)"
```
### Erişim Kontrolü
```bash
# Note: IAM policies for individual Vertex AI resources are managed at the project level
# Check project-level permissions
gcloud projects get-iam-policy <project-id>

# Check service account permissions
gcloud iam service-accounts get-iam-policy <service-account-email>

# Check if endpoints allow unauthenticated access
# This is controlled by IAM bindings on the endpoint
gcloud projects get-iam-policy <project-id> \
--flatten="bindings[].members" \
--filter="bindings.role:aiplatform.user"
```
### Depolama ve Artefaktlar
```bash
# Models and training jobs often store artifacts in GCS
# List buckets that might contain model artifacts
gsutil ls

# Common artifact locations:
# gs://<project>-aiplatform-<region>/
# gs://<project>-vertex-ai/
# gs://<custom-bucket>/vertex-ai/

# Download model artifacts if accessible
gsutil -m cp -r gs://<bucket>/path/to/artifacts ./artifacts/

# Check for notebooks in AI Platform Notebooks
gcloud notebooks instances list --location=<location>
gcloud notebooks instances describe <instance-name> --location=<location>
```
### Model Garden
```bash
# List Model Garden endpoints
gcloud ai endpoints list --list-model-garden-endpoints-only --region=<region>

# Model Garden models are often deployed with default configurations
# Check for publicly accessible endpoints
```
### Ayrıcalık Yükseltme

Aşağıdaki sayfada, **Vertex AI izinlerini kötüye kullanarak ayrıcalıkları nasıl yükseltebileceğinizi** inceleyebilirsiniz:

{{#ref}}
../gcp-privilege-escalation/gcp-vertex-ai-privesc.md
{{#endref}}

## Kaynaklar

- [https://cloud.google.com/vertex-ai/docs](https://cloud.google.com/vertex-ai/docs)
- [https://cloud.google.com/vertex-ai/docs/reference/rest](https://cloud.google.com/vertex-ai/docs/reference/rest)

{{#include ../../../banners/hacktricks-training.md}}
