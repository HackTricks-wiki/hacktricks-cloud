# GCP - Vertex AI Ανίχνευση

{{#include ../../../banners/hacktricks-training.md}}

## Vertex AI

[Vertex AI](https://cloud.google.com/vertex-ai) είναι η **ενιαία πλατφόρμα μηχανικής μάθησης** του Google Cloud για την κατασκευή, ανάπτυξη και διαχείριση μοντέλων AI σε κλίμακα. Συνδυάζει διάφορες υπηρεσίες AI και ML σε μία ενιαία, ολοκληρωμένη πλατφόρμα, επιτρέποντας σε data scientists και ML engineers να:

- Εκπαιδεύσουν προσαρμοσμένα μοντέλα χρησιμοποιώντας AutoML ή προσαρμοσμένη εκπαίδευση
- Αναπτύξουν μοντέλα σε κλιμακούμενα endpoints για προβλέψεις
- Διαχειριστούν τον κύκλο ζωής του ML από το πειραματισμό έως την παραγωγή
- Έχουν πρόσβαση σε προεκπαιδευμένα μοντέλα από το Model Garden
- Παρακολουθούν και βελτιστοποιούν την απόδοση των μοντέλων

### Κύρια Συστατικά

#### Models

Τα Vertex AI **models** αντιπροσωπεύουν εκπαιδευμένα μοντέλα μηχανικής μάθησης που μπορούν να αναπτυχθούν σε endpoints για παροχή προβλέψεων. Τα μοντέλα μπορούν να:

- **Ανεβούν** από custom containers ή model artifacts
- Δημιουργηθούν μέσω **AutoML** training
- Εισαχθούν από το **Model Garden** (προεκπαιδευμένα μοντέλα)
- **Έχουν εκδόσεις** με πολλαπλές versions ανά μοντέλο

Κάθε model έχει metadata που περιλαμβάνει το framework του, container image URI, artifact location και την serving configuration.

#### Endpoints

Τα **endpoints** είναι πόροι που φιλοξενούν αναπτυγμένα μοντέλα και παρέχουν online προβλέψεις. Κύρια χαρακτηριστικά:

- Μπορούν να φιλοξενήσουν **πολλαπλά deployed models** (με traffic splitting)
- Παρέχουν **HTTPS endpoints** για real-time predictions
- Υποστηρίζουν **autoscaling** με βάση την κίνηση
- Μπορούν να χρησιμοποιούν **private** ή **public** πρόσβαση
- Υποστηρίζουν **A/B testing** μέσω traffic splitting

#### Custom Jobs

Οι **Custom jobs** επιτρέπουν την εκτέλεση προσαρμοσμένου training code χρησιμοποιώντας δικά σας containers ή Python packages. Χαρακτηριστικά:

- Υποστήριξη για **distributed training** με πολλαπλές worker pools
- Ρυθμιζόμενοι **machine types** και **accelerators** (GPUs/TPUs)
- Σύνδεση **service account** για πρόσβαση σε άλλους GCP πόρους
- Ενσωμάτωση με **Vertex AI Tensorboard** για οπτικοποίηση
- Επιλογές **VPC connectivity**

#### Hyperparameter Tuning Jobs

Αυτές οι εργασίες αυτόματα **αναζητούν βέλτιστες υπερπαραμέτρους** εκτελώντας πολλαπλά training trials με διαφορετικούς συνδυασμούς παραμέτρων.

#### Model Garden

Το **Model Garden** παρέχει πρόσβαση σε:

- Προεκπαιδευμένα Google models
- Open-source μοντέλα (συμπεριλαμβανομένου του Hugging Face)
- Μοντέλα τρίτων
- Δυνατότητες one-click deployment

#### Tensorboards

Τα **Tensorboards** παρέχουν οπτικοποίηση και παρακολούθηση για πειράματα ML, παρακολουθώντας metrics, model graphs και πρόοδο εκπαίδευσης.

### Service Accounts & Permissions

Από προεπιλογή, οι υπηρεσίες Vertex AI χρησιμοποιούν τον **Compute Engine default service account** (`PROJECT_NUMBER-compute@developer.gserviceaccount.com`), που έχει δικαιώματα **Editor** στο project. Ωστόσο, μπορείτε να ορίσετε custom service accounts όταν:

- Δημιουργείτε custom jobs
- Ανεβάζετε models
- Αναπτύσσετε models σε endpoints

Αυτός ο service account χρησιμοποιείται για:
- Πρόσβαση σε training data στο Cloud Storage
- Εγγραφή logs στο Cloud Logging
- Πρόσβαση σε secrets από το Secret Manager
- Αλληλεπίδραση με άλλες GCP υπηρεσίες

### Data Storage

- Τα **model artifacts** αποθηκεύονται σε κουτιά του **Cloud Storage**
- Τα **training data** συνήθως βρίσκονται σε Cloud Storage ή BigQuery
- Οι **container images** αποθηκεύονται στο **Artifact Registry** ή στο Container Registry
- Τα **logs** αποστέλλονται στο **Cloud Logging**
- Τα **metrics** αποστέλλονται στο **Cloud Monitoring**

### Encryption

Από προεπιλογή, το Vertex AI χρησιμοποιεί **Google-managed encryption keys**. Μπορείτε επίσης να ρυθμίσετε:

- **Customer-managed encryption keys (CMEK)** από το Cloud KMS
- Η κρυπτογράφηση εφαρμόζεται σε model artifacts, training data και endpoints

### Networking

Οι πόροι του Vertex AI μπορούν να ρυθμιστούν για:

- Πρόσβαση στο **public internet** (προεπιλογή)
- **VPC peering** για ιδιωτική πρόσβαση
- **Private Service Connect** για ασφαλή συνδεσιμότητα
- Υποστήριξη **Shared VPC**

### Ανίχνευση
```bash
# List models
gcloud ai models list --region=<region>
gcloud ai models describe <model-id> --region=<region>
gcloud ai models list-version <model-id> --region=<region>

# List endpoints
gcloud ai endpoints list --region=<region>
gcloud ai endpoints describe <endpoint-id> --region=<region>
gcloud ai endpoints list --list-model-garden-endpoints-only --region=<region>

# List custom jobs
gcloud ai custom-jobs list --region=<region>
gcloud ai custom-jobs describe <job-id> --region=<region>

# Stream logs from a running job
gcloud ai custom-jobs stream-logs <job-id> --region=<region>

# List hyperparameter tuning jobs
gcloud ai hp-tuning-jobs list --region=<region>
gcloud ai hp-tuning-jobs describe <job-id> --region=<region>

# List model monitoring jobs
gcloud ai model-monitoring-jobs list --region=<region>
gcloud ai model-monitoring-jobs describe <job-id> --region=<region>

# List Tensorboards
gcloud ai tensorboards list --region=<region>
gcloud ai tensorboards describe <tensorboard-id> --region=<region>

# List indexes (for vector search)
gcloud ai indexes list --region=<region>
gcloud ai indexes describe <index-id> --region=<region>

# List index endpoints
gcloud ai index-endpoints list --region=<region>
gcloud ai index-endpoints describe <index-endpoint-id> --region=<region>

# Get operations (long-running operations status)
gcloud ai operations describe <operation-id> --region=<region>

# Test endpoint predictions (if you have access)
gcloud ai endpoints predict <endpoint-id> \
--region=<region> \
--json-request=request.json

# Make direct predictions (newer API)
gcloud ai endpoints direct-predict <endpoint-id> \
--region=<region> \
--json-request=request.json
```
### Συλλογή Πληροφοριών Μοντέλου
```bash
# Get detailed model information including versions
gcloud ai models describe <model-id> --region=<region>

# Check specific model version
gcloud ai models describe <model-id>@<version> --region=<region>

# List all versions of a model
gcloud ai models list-version <model-id> --region=<region>

# Get model artifact location (usually a GCS bucket)
gcloud ai models describe <model-id> --region=<region> --format="value(artifactUri)"

# Get container image URI
gcloud ai models describe <model-id> --region=<region> --format="value(containerSpec.imageUri)"
```
### Λεπτομέρειες Τερματικού Σημείου
```bash
# Get endpoint details including deployed models
gcloud ai endpoints describe <endpoint-id> --region=<region>

# Get endpoint URL
gcloud ai endpoints describe <endpoint-id> --region=<region> --format="value(deployedModels[0].displayName)"

# Get service account used by endpoint
gcloud ai endpoints describe <endpoint-id> --region=<region> --format="value(deployedModels[0].serviceAccount)"

# Check traffic split between models
gcloud ai endpoints describe <endpoint-id> --region=<region> --format="value(trafficSplit)"
```
### Πληροφορίες Προσαρμοσμένης Εργασίας
```bash
# Get job details including command, args, and service account
gcloud ai custom-jobs describe <job-id> --region=<region>

# Get service account used by job
gcloud ai custom-jobs describe <job-id> --region=<region> --format="value(jobSpec.workerPoolSpecs[0].serviceAccount)"

# Get container image used
gcloud ai custom-jobs describe <job-id> --region=<region> --format="value(jobSpec.workerPoolSpecs[0].containerSpec.imageUri)"

# Check environment variables (may contain secrets)
gcloud ai custom-jobs describe <job-id> --region=<region> --format="value(jobSpec.workerPoolSpecs[0].containerSpec.env)"

# Get network configuration
gcloud ai custom-jobs describe <job-id> --region=<region> --format="value(jobSpec.network)"
```
### Έλεγχος Πρόσβασης
```bash
# Note: IAM policies for individual Vertex AI resources are managed at the project level
# Check project-level permissions
gcloud projects get-iam-policy <project-id>

# Check service account permissions
gcloud iam service-accounts get-iam-policy <service-account-email>

# Check if endpoints allow unauthenticated access
# This is controlled by IAM bindings on the endpoint
gcloud projects get-iam-policy <project-id> \
--flatten="bindings[].members" \
--filter="bindings.role:aiplatform.user"
```
### Αποθήκευση και Αρχεία
```bash
# Models and training jobs often store artifacts in GCS
# List buckets that might contain model artifacts
gsutil ls

# Common artifact locations:
# gs://<project>-aiplatform-<region>/
# gs://<project>-vertex-ai/
# gs://<custom-bucket>/vertex-ai/

# Download model artifacts if accessible
gsutil -m cp -r gs://<bucket>/path/to/artifacts ./artifacts/

# Check for notebooks in AI Platform Notebooks
gcloud notebooks instances list --location=<location>
gcloud notebooks instances describe <instance-name> --location=<location>
```
### Κήπος Μοντέλων
```bash
# List Model Garden endpoints
gcloud ai endpoints list --list-model-garden-endpoints-only --region=<region>

# Model Garden models are often deployed with default configurations
# Check for publicly accessible endpoints
```
### Privilege Escalation

Στην ακόλουθη σελίδα μπορείτε να δείτε πώς να **abuse Vertex AI permissions to escalate privileges**:

{{#ref}}
../gcp-privilege-escalation/gcp-vertex-ai-privesc.md
{{#endref}}

## Αναφορές

- [https://cloud.google.com/vertex-ai/docs](https://cloud.google.com/vertex-ai/docs)
- [https://cloud.google.com/vertex-ai/docs/reference/rest](https://cloud.google.com/vertex-ai/docs/reference/rest)

{{#include ../../../banners/hacktricks-training.md}}
