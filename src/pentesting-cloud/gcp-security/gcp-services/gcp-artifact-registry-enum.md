# GCP - Artifact Registry Enum

{{#include ../../../banners/hacktricks-training.md}}

## Basic Information

Google Cloud Artifact Registry is 'n volledig bestuurde diens wat jou toelaat om **jou sagteware artefakte te bestuur, te stoor en te beveilig**. Dit is in wese 'n repository vir **die stoor van bou afhanklikhede**, soos **Docker** beelde, **Maven**, npm pakkette, en ander tipes artefakte. Dit word **gewoonlik in CI/CD pyplyne** gebruik om die artefakte wat tydens die sagteware ontwikkelingsproses geproduseer word, te stoor en te versioneer.

Key features of Artifact Registry include:

1. **Unified Repository**: Dit ondersteun **meerdere tipes artefakte**, wat jou toelaat om 'n enkele repository vir Docker beelde, taal pakkette (soos Java se Maven, Node.js se npm), en ander tipes artefakte te hê, wat konsekwente toegangbeheer en 'n verenigde uitsig oor al jou artefakte moontlik maak.
2. **Fully Managed**: As 'n bestuurde diens, sorg dit vir die onderliggende infrastruktuur, skaal, en sekuriteit, wat die onderhoudsbelasting vir gebruikers verminder.
3. **Fine-grained Access Control**: Dit integreer met Google Cloud se Identiteit en Toegang Bestuur (IAM), wat jou toelaat om te definieer wie toegang kan hê, oplaai, of artefakte in jou repositories kan aflaai.
4. **Geo-replication**: Dit ondersteun die replika van artefakte oor meerdere streke, wat die spoed van aflaaie verbeter en beskikbaarheid verseker.
5. **Integration with Google Cloud Services**: Dit werk naatloos saam met **ander GCP dienste soos Cloud Build, Kubernetes Engine, en Compute Engine**, wat dit 'n gerieflike keuse maak vir spanne wat reeds binne die Google Cloud ekosisteem werk.
6. **Security**: Bied funksies soos **kwesbaarheid skandering en houer analise** om te help verseker dat die gestoor artefakte veilig is en vry van bekende sekuriteitskwessies.

### Formats and Modes

When creating a new repository it's possible to **select a the format/type** of the repository among several like Docker, Maven, npm, Python... and the mode which usually can be one of these three:

- **Standard Repository**: Standaard modus vir **die stoor van jou eie artefakte** (soos Docker beelde, Maven pakkette) direk in GCP. Dit is veilig, skaalbaar, en integreer goed binne die Google Cloud ekosisteem.
- **Remote Repository** (if available): Optree as 'n proxy vir **die kas van artefakte van eksterne**, openbare repositories. Dit help om probleme van afhanklikhede wat opwaarts verander te voorkom en verminder latensie deur gereeld toeganklike artefakte te kas.
- **Virtual Repository** (if available): Bied 'n **verenigde koppelvlak om toegang te verkry tot meerdere (standaard of afstand) repositories** deur 'n enkele eindpunt, wat kliënt-kant konfigurasie en toegang bestuur vir artefakte wat oor verskeie repositories versprei is, vereenvoudig.
- Vir 'n virtuele repository sal jy **repositories moet kies en hulle 'n prioriteit gee** (die repo met die grootste prioriteit sal gebruik word).
- Jy kan **afstands- en standaard** repositories in 'n **virtuele** een meng, as die **prioriteit** van die **afstands** groter is as die standaard, **pakkette van afstand (PyPi byvoorbeeld) sal gebruik word**. Dit kan lei tot 'n **Afhanklikheid Verwarring.**

Note that in the **Remote version of Docker** it's possible to give a username and token to access Docker Hub. The **token is then stored in the Secret Manager**.

### Encryption

Soos verwag, word 'n Google-bestuurde sleutel standaard gebruik, maar 'n Klant-bestuurde sleutel kan aangedui word (CMEK).

### Cleanup Policies

- **Delete artifacts:** Artefakte sal **verwyder word volgens die skoonmaakbeleid** kriteria.
- **Dry run:** (Standaard een) Artefakte sal **nie verwyder word** nie. Skoonmaakbeleide sal geëvalueer word, en toets verwyder gebeurtenisse sal na Cloud Audit Logging gestuur word.

### Vulnerability Scanning

It's possible to enable the **vulnerability scanner** which will check for vulnerabilities inside **container images**.

### Enumeration
```bash
# Get repositories
gcloud artifacts repositories list
gcloud artifacts repositories describe --location <location> <repo-name>
gcloud artifacts versions list --repository=<repo-name> -location <location> --package <package-name>

# Get settings of a repository (example using python but could be other)
gcloud artifacts print-settings python --repository <repo-name> --location <location>

# Get docker images
gcloud artifacts docker images list us-central1-docker.pkg.dev/<proj-name>/<repo-name>

# Get packages (like python and others...)
gcloud artifacts packages list --repository <repo-name> --location <location>

# Get SBOMB artifacts
gcloud artifacts sbom list

# Get vulnerabilities (docker images)
gcloud artifacts vulnerabilities list us-east1-docker.pkg.dev/project123/repository123/someimage@sha256:49765698074d6d7baa82f
gcloud artifacts docker images list-vulnerabilities projects/<proj-name>/locations/<location>/scans/<scan-uuid>
```
### Privilege Escalation

{{#ref}}
../gcp-privilege-escalation/gcp-artifact-registry-privesc.md
{{#endref}}

### Unauthenticated Access

{{#ref}}
../gcp-unauthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md
{{#endref}}

### Post-Exploitation

{{#ref}}
../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md
{{#endref}}

### Persistence

{{#ref}}
../gcp-persistence/gcp-artifact-registry-persistence.md
{{#endref}}

{{#include ../../../banners/hacktricks-training.md}}
