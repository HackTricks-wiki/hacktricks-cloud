# GCP - Artifact Registry Enum

{{#include ../../../banners/hacktricks-training.md}}

## Basic Information

Google Cloud Artifact Registry είναι μια πλήρως διαχειριζόμενη υπηρεσία που σας επιτρέπει να **διαχειρίζεστε, αποθηκεύετε και ασφαλίζετε τα λογισμικά σας artifacts**. Είναι ουσιαστικά ένα αποθετήριο για **την αποθήκευση εξαρτήσεων κατασκευής**, όπως **Docker** εικόνες, **Maven**, npm πακέτα και άλλους τύπους artifacts. Χρησιμοποιείται **συνήθως σε CI/CD pipelines** για την αποθήκευση και την έκδοση των artifacts που παράγονται κατά τη διάρκεια της διαδικασίας ανάπτυξης λογισμικού.

Τα κύρια χαρακτηριστικά του Artifact Registry περιλαμβάνουν:

1. **Ενοποιημένο Αποθετήριο**: Υποστηρίζει **πολλαπλούς τύπους artifacts**, επιτρέποντάς σας να έχετε ένα μόνο αποθετήριο για Docker εικόνες, γλωσσικά πακέτα (όπως το Maven της Java, το npm του Node.js) και άλλους τύπους artifacts, διευκολύνοντας τους συνεπείς ελέγχους πρόσβασης και μια ενοποιημένη θέα σε όλα τα artifacts σας.
2. **Πλήρως Διαχειριζόμενο**: Ως διαχειριζόμενη υπηρεσία, φροντίζει για την υποκείμενη υποδομή, την κλιμάκωση και την ασφάλεια, μειώνοντας το κόστος συντήρησης για τους χρήστες.
3. **Λεπτομερής Έλεγχος Πρόσβασης**: Ενσωματώνεται με την Ταυτότητα και Διαχείριση Πρόσβασης (IAM) της Google Cloud, επιτρέποντάς σας να ορίσετε ποιος μπορεί να έχει πρόσβαση, να ανεβάσει ή να κατεβάσει artifacts στα αποθετήριά σας.
4. **Γεω-αναπαραγωγή**: Υποστηρίζει την αναπαραγωγή artifacts σε πολλές περιοχές, βελτιώνοντας την ταχύτητα των λήψεων και εξασφαλίζοντας τη διαθεσιμότητα.
5. **Ενσωμάτωση με Υπηρεσίες Google Cloud**: Λειτουργεί απρόσκοπτα με **άλλες υπηρεσίες GCP όπως Cloud Build, Kubernetes Engine και Compute Engine**, καθιστώντας το μια βολική επιλογή για ομάδες που εργάζονται ήδη στο οικοσύστημα της Google Cloud.
6. **Ασφάλεια**: Προσφέρει χαρακτηριστικά όπως **σάρωση ευπαθειών και ανάλυση κοντέινερ** για να διασφαλίσει ότι τα αποθηκευμένα artifacts είναι ασφαλή και χωρίς γνωστά ζητήματα ασφάλειας.

### Formats and Modes

Όταν δημιουργείτε ένα νέο αποθετήριο, είναι δυνατόν να **επιλέξετε τη μορφή/τύπο** του αποθετηρίου ανάμεσα σε αρκετές όπως Docker, Maven, npm, Python... και τη λειτουργία που συνήθως μπορεί να είναι μία από αυτές τις τρεις:

- **Standard Repository**: Προεπιλεγμένη λειτουργία για **την αποθήκευση των δικών σας artifacts** (όπως Docker εικόνες, Maven πακέτα) απευθείας στο GCP. Είναι ασφαλές, κλιμακούμενο και ενσωματώνεται καλά στο οικοσύστημα της Google Cloud.
- **Remote Repository** (αν είναι διαθέσιμο): Λειτουργεί ως proxy για **την προσωρινή αποθήκευση artifacts από εξωτερικά**, δημόσια αποθετήρια. Βοηθά στην αποφυγή προβλημάτων από την αλλαγή εξαρτήσεων upstream και μειώνει την καθυστέρηση αποθηκεύοντας προσωρινά τα συχνά προσπελάσιμα artifacts.
- **Virtual Repository** (αν είναι διαθέσιμο): Παρέχει μια **ενοποιημένη διεπαφή για πρόσβαση σε πολλαπλά (standard ή remote) αποθετήρια** μέσω ενός μόνο σημείου πρόσβασης, απλοποιώντας τη διαμόρφωση και τη διαχείριση πρόσβασης για artifacts που είναι διασκορπισμένα σε διάφορα αποθετήρια.
- Για ένα εικονικό αποθετήριο θα χρειαστεί να **επιλέξετε αποθετήρια και να τους δώσετε προτεραιότητα** (το αποθετήριο με τη μεγαλύτερη προτεραιότητα θα χρησιμοποιηθεί).
- Μπορείτε να **συνδυάσετε remote και standard** αποθετήρια σε ένα **εικονικό**, αν η **προτεραιότητα** του **remote** είναι **μεγαλύτερη** από την standard, **τα πακέτα από remote (π.χ. PyPi) θα χρησιμοποιηθούν**. Αυτό θα μπορούσε να οδηγήσει σε **Dependency Confusion.**

Σημειώστε ότι στην **Remote έκδοση του Docker** είναι δυνατόν να δώσετε ένα όνομα χρήστη και ένα token για πρόσβαση στο Docker Hub. Το **token αποθηκεύεται στη συνέχεια στο Secret Manager**.

### Encryption

Όπως αναμενόταν, από προεπιλογή χρησιμοποιείται ένα κλειδί που διαχειρίζεται η Google, αλλά μπορεί να υποδειχθεί ένα κλειδί που διαχειρίζεται ο πελάτης (CMEK).

### Cleanup Policies

- **Διαγραφή artifacts:** Τα artifacts θα **διαγραφούν σύμφωνα με τα κριτήρια πολιτικής καθαρισμού**.
- **Dry run:** (Προεπιλεγμένο) Τα artifacts **δεν θα διαγραφούν**. Οι πολιτικές καθαρισμού θα αξιολογηθούν και θα σταλούν δοκιμαστικά γεγονότα διαγραφής στο Cloud Audit Logging.

### Vulnerability Scanning

Είναι δυνατόν να ενεργοποιήσετε τον **σάρωτη ευπαθειών** που θα ελέγξει για ευπάθειες μέσα σε **εικόνες κοντέινερ**.

### Enumeration
```bash
# Get repositories
gcloud artifacts repositories list
gcloud artifacts repositories describe --location <location> <repo-name>
gcloud artifacts versions list --repository=<repo-name> -location <location> --package <package-name>

# Get settings of a repository (example using python but could be other)
gcloud artifacts print-settings python --repository <repo-name> --location <location>

# Get docker images
gcloud artifacts docker images list us-central1-docker.pkg.dev/<proj-name>/<repo-name>

# Get packages (like python and others...)
gcloud artifacts packages list --repository <repo-name> --location <location>

# Get SBOMB artifacts
gcloud artifacts sbom list

# Get vulnerabilities (docker images)
gcloud artifacts vulnerabilities list us-east1-docker.pkg.dev/project123/repository123/someimage@sha256:49765698074d6d7baa82f
gcloud artifacts docker images list-vulnerabilities projects/<proj-name>/locations/<location>/scans/<scan-uuid>
```
### Ανάβαση Δικαιωμάτων

{{#ref}}
../gcp-privilege-escalation/gcp-artifact-registry-privesc.md
{{#endref}}

### Μη Αυθεντικοποιημένη Πρόσβαση

{{#ref}}
../gcp-unauthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md
{{#endref}}

### Μετά την Εκμετάλλευση

{{#ref}}
../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md
{{#endref}}

### Επιμονή

{{#ref}}
../gcp-persistence/gcp-artifact-registry-persistence.md
{{#endref}}

{{#include ../../../banners/hacktricks-training.md}}
