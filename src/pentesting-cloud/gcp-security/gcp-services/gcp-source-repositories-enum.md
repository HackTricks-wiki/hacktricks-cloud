# GCP - 소스 리포지토리 열거

{{#include ../../../banners/hacktricks-training.md}}

## 기본 정보 <a href="#reviewing-cloud-git-repositories" id="reviewing-cloud-git-repositories"></a>

Google Cloud Source Repositories는 완전한 기능을 갖춘 확장 가능한 **개인 Git 리포지토리 서비스**입니다. 이는 **완전 관리되는 환경에서 소스 코드를 호스팅하도록 설계되었으며**, 다른 GCP 도구 및 서비스와 원활하게 통합됩니다. 팀이 코드를 저장, 관리 및 추적할 수 있는 협업적이고 안전한 장소를 제공합니다.

Cloud Source Repositories의 주요 기능은 다음과 같습니다:

1. **완전 관리되는 Git 호스팅**: Git의 친숙한 기능을 제공하므로 일반 Git 명령 및 워크플로를 사용할 수 있습니다.
2. **GCP 서비스와의 통합**: Cloud Build, Pub/Sub 및 App Engine과 같은 다른 GCP 서비스와 통합되어 코드에서 배포까지의 종단 간 추적성을 제공합니다.
3. **개인 리포지토리**: 코드가 안전하고 비공식적으로 저장되도록 보장합니다. Cloud Identity and Access Management (IAM) 역할을 사용하여 액세스를 제어할 수 있습니다.
4. **소스 코드 분석**: 다른 GCP 도구와 함께 작동하여 소스 코드의 자동 분석을 제공하며, 버그, 취약점 또는 나쁜 코딩 관행과 같은 잠재적인 문제를 식별합니다.
5. **협업 도구**: 병합 요청, 댓글 및 리뷰와 같은 도구를 통해 협업 코딩을 지원합니다.
6. **미러 지원**: Cloud Source Repositories를 GitHub 또는 Bitbucket에 호스팅된 리포지토리와 연결할 수 있어 자동 동기화가 가능하며 모든 리포지토리에 대한 통합된 뷰를 제공합니다.

### OffSec 정보 <a href="#reviewing-cloud-git-repositories" id="reviewing-cloud-git-repositories"></a>

- 프로젝트 내의 소스 리포지토리 구성은 Cloud Pub/Sub 메시지를 게시하는 데 사용되는 **서비스 계정**을 가집니다. 기본적으로 사용되는 것은 **Compute SA**입니다. 그러나 **소스 리포지토리에서 그 토큰을 훔치는 것은 불가능하다고 생각합니다**. 이는 백그라운드에서 실행되고 있습니다.
- GCP Cloud Source Repositories 웹 콘솔 ([https://source.cloud.google.com/](https://source.cloud.google.com/))에서 코드를 보려면 코드가 **기본적으로 마스터 브랜치에 있어야** 합니다.
- **Github** 또는 **Bitbucket**의 리포지토리를 가리키는 **미러 Cloud Repository**를 **생성할 수 있습니다** (이 플랫폼에 대한 액세스를 제공).
- **GCP 내부에서 코드 작성 및 디버깅**이 가능합니다.
- 기본적으로 Source Repositories는 **개인 키가 커밋에 푸시되는 것을 방지**하지만, 이는 비활성화할 수 있습니다.

### 클라우드 셸에서 열기

클라우드 셸에서 리포지토리를 열 수 있으며, 다음과 같은 프롬프트가 나타납니다:

<figure><img src="../../../images/image (325).png" alt=""><figcaption></figcaption></figure>

이를 통해 클라우드 셸에서 코드 작성 및 디버깅이 가능하며 (cloudshell이 손상될 수 있음), 

### 열거
```bash
# Repos enumeration
gcloud source repos list #Get names and URLs
gcloud source repos describe <repo_name>
gcloud source repos get-iam-policy <repo_name>

# gcloud repo clone
gcloud source repos clone <REPO NAME>
gcloud source repos get-iam-policy <REPO NAME>
... git add & git commit -m ...
git push --set-upstream origin master
git push -u origin master

# Access via git
## To add a SSH key go to https://source.cloud.google.com/user/ssh_keys (no gcloud command)
git clone ssh://username@domain.com@source.developers.google.com:2022/p/<proj-name>/r/<repo-name>
git add, commit, push...
```
### 권한 상승 및 포스트 익스플로잇

{{#ref}}
../gcp-privilege-escalation/gcp-sourcerepos-privesc.md
{{#endref}}

### 인증되지 않은 열거

{{#ref}}
../gcp-unauthenticated-enum-and-access/gcp-source-repositories-unauthenticated-enum.md
{{#endref}}

{{#include ../../../banners/hacktricks-training.md}}
