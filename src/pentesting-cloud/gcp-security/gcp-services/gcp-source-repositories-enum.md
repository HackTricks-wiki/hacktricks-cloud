# GCP - Source Repositories Enum

{{#include ../../../banners/hacktricks-training.md}}

## Grundinformationen <a href="#reviewing-cloud-git-repositories" id="reviewing-cloud-git-repositories"></a>

Google Cloud Source Repositories ist ein vollständig ausgestatteter, skalierbarer, **privater Git-Repository-Dienst**. Er wurde entwickelt, um **Ihren Quellcode in einer vollständig verwalteten Umgebung zu hosten**, die nahtlos mit anderen GCP-Tools und -Diensten integriert ist. Er bietet einen kollaborativen und sicheren Ort für Teams, um ihren Code zu speichern, zu verwalten und zu verfolgen.

Wichtige Funktionen von Cloud Source Repositories sind:

1. **Vollständig verwaltetes Git-Hosting**: Bietet die vertraute Funktionalität von Git, was bedeutet, dass Sie reguläre Git-Befehle und -Workflows verwenden können.
2. **Integration mit GCP-Diensten**: Integriert sich mit anderen GCP-Diensten wie Cloud Build, Pub/Sub und App Engine für eine durchgängige Nachverfolgbarkeit vom Code bis zur Bereitstellung.
3. **Private Repositories**: Stellt sicher, dass Ihr Code sicher und privat gespeichert wird. Sie können den Zugriff mit Cloud Identity and Access Management (IAM)-Rollen steuern.
4. **Quellcodeanalyse**: Arbeitet mit anderen GCP-Tools zusammen, um eine automatisierte Analyse Ihres Quellcodes bereitzustellen, die potenzielle Probleme wie Bugs, Schwachstellen oder schlechte Programmierpraktiken identifiziert.
5. **Kollaborationstools**: Unterstützt kollaboratives Codieren mit Tools wie Merge-Anfragen, Kommentaren und Überprüfungen.
6. **Spiegelunterstützung**: Ermöglicht es Ihnen, Cloud Source Repositories mit Repositories zu verbinden, die auf GitHub oder Bitbucket gehostet werden, wodurch eine automatische Synchronisierung ermöglicht und eine einheitliche Ansicht aller Ihrer Repositories bereitgestellt wird.

### OffSec-Informationen <a href="#reviewing-cloud-git-repositories" id="reviewing-cloud-git-repositories"></a>

- Die Konfiguration der Quell-Repositorys innerhalb eines Projekts wird ein **Service-Konto** haben, das zum Veröffentlichen von Cloud Pub/Sub-Nachrichten verwendet wird. Das standardmäßig verwendete ist das **Compute SA**. Allerdings **glaube ich nicht, dass es möglich ist, sein Token** aus den Source Repositories zu stehlen, da es im Hintergrund ausgeführt wird.
- Um den Code in der GCP Cloud Source Repositories-Webkonsole ([https://source.cloud.google.com/](https://source.cloud.google.com/)) zu sehen, muss der Code **standardmäßig im Master-Branch sein**.
- Sie können auch **ein Spiegel-Cloud-Repository** erstellen, das auf ein Repo von **Github** oder **Bitbucket** verweist (Zugriff auf diese Plattformen gewährend).
- Es ist möglich, **aus GCP heraus zu codieren und zu debuggen**.
- Standardmäßig **verhindert Source Repositories, dass private Schlüssel in Commits gepusht werden**, aber dies kann deaktiviert werden.

### In Cloud Shell öffnen

Es ist möglich, das Repository in Cloud Shell zu öffnen, ein Prompt wie dieser wird erscheinen:

<figure><img src="../../../images/image (325).png" alt=""><figcaption></figcaption></figure>

Dies ermöglicht es Ihnen, in Cloud Shell zu codieren und zu debuggen (was dazu führen könnte, dass cloudshell kompromittiert wird).

### Enumeration
```bash
# Repos enumeration
gcloud source repos list #Get names and URLs
gcloud source repos describe <repo_name>
gcloud source repos get-iam-policy <repo_name>

# gcloud repo clone
gcloud source repos clone <REPO NAME>
gcloud source repos get-iam-policy <REPO NAME>
... git add & git commit -m ...
git push --set-upstream origin master
git push -u origin master

# Access via git
## To add a SSH key go to https://source.cloud.google.com/user/ssh_keys (no gcloud command)
git clone ssh://username@domain.com@source.developers.google.com:2022/p/<proj-name>/r/<repo-name>
git add, commit, push...
```
### Privilegieneskalation & Nach der Ausnutzung

{{#ref}}
../gcp-privilege-escalation/gcp-sourcerepos-privesc.md
{{#endref}}

### Unauthentifiziertes Enum

{{#ref}}
../gcp-unauthenticated-enum-and-access/gcp-source-repositories-unauthenticated-enum.md
{{#endref}}

{{#include ../../../banners/hacktricks-training.md}}
