# GCP - ソースリポジトリの列挙

{{#include ../../../banners/hacktricks-training.md}}

## 基本情報 <a href="#reviewing-cloud-git-repositories" id="reviewing-cloud-git-repositories"></a>

Google Cloud Source Repositoriesは、完全に機能し、スケーラブルな**プライベートGitリポジトリサービス**です。これは、**完全に管理された環境でソースコードをホストする**ように設計されており、他のGCPツールやサービスとシームレスに統合されます。チームがコードを保存、管理、追跡するための協力的で安全な場所を提供します。

Cloud Source Repositoriesの主な機能は次のとおりです：

1. **完全管理されたGitホスティング**：Gitの一般的な機能を提供し、通常のGitコマンドやワークフローを使用できます。
2. **GCPサービスとの統合**：Cloud Build、Pub/Sub、App Engineなどの他のGCPサービスと統合され、コードからデプロイメントまでのエンドツーエンドのトレーサビリティを提供します。
3. **プライベートリポジトリ**：コードが安全かつプライベートに保存されることを保証します。Cloud Identity and Access Management (IAM)ロールを使用してアクセスを制御できます。
4. **ソースコード分析**：他のGCPツールと連携して、ソースコードの自動分析を提供し、バグ、脆弱性、または悪いコーディングプラクティスなどの潜在的な問題を特定します。
5. **コラボレーションツール**：マージリクエスト、コメント、レビューなどのツールを使用して、協力的なコーディングをサポートします。
6. **ミラーサポート**：Cloud Source RepositoriesをGitHubやBitbucketにホストされたリポジトリと接続でき、自動同期を可能にし、すべてのリポジトリの統一ビューを提供します。

### OffSec情報 <a href="#reviewing-cloud-git-repositories" id="reviewing-cloud-git-repositories"></a>

- プロジェクト内のソースリポジトリの設定には、Cloud Pub/Subメッセージを公開するために使用される**サービスアカウント**があります。デフォルトで使用されるのは**Compute SA**です。ただし、**ソースリポジトリからそのトークンを盗むことは不可能だと思います**。これはバックグラウンドで実行されているためです。
- GCP Cloud Source RepositoriesのWebコンソール内のコードを見るには、コードが**デフォルトでマスターブランチ内にある必要があります**。
- **Github**または**Bitbucket**のリポジトリを指す**ミラーCloudリポジトリ**を**作成することもできます**（これらのプラットフォームへのアクセスを提供します）。
- **GCP内からコードを記述およびデバッグすることが可能です**。
- デフォルトでは、ソースリポジトリは**プライベートキーがコミットにプッシュされるのを防ぎます**が、これを無効にすることができます。

### Cloud Shellで開く

Cloud Shellでリポジトリを開くことが可能で、次のようなプロンプトが表示されます：

<figure><img src="../../../images/image (325).png" alt=""><figcaption></figcaption></figure>

これにより、Cloud Shellでコードを記述およびデバッグできます（これによりcloudshellが侵害される可能性があります）。

### 列挙
```bash
# Repos enumeration
gcloud source repos list #Get names and URLs
gcloud source repos describe <repo_name>
gcloud source repos get-iam-policy <repo_name>

# gcloud repo clone
gcloud source repos clone <REPO NAME>
gcloud source repos get-iam-policy <REPO NAME>
... git add & git commit -m ...
git push --set-upstream origin master
git push -u origin master

# Access via git
## To add a SSH key go to https://source.cloud.google.com/user/ssh_keys (no gcloud command)
git clone ssh://username@domain.com@source.developers.google.com:2022/p/<proj-name>/r/<repo-name>
git add, commit, push...
```
### 権限昇格とポストエクスプロイト

{{#ref}}
../gcp-privilege-escalation/gcp-sourcerepos-privesc.md
{{#endref}}

### 認証されていない列挙

{{#ref}}
../gcp-unauthenticated-enum-and-access/gcp-source-repositories-unauthenticated-enum.md
{{#endref}}

{{#include ../../../banners/hacktricks-training.md}}
