# GCP - Source Repositories Enum

{{#include ../../../banners/hacktricks-training.md}}

## Basic Information <a href="#reviewing-cloud-git-repositories" id="reviewing-cloud-git-repositories"></a>

Η Google Cloud Source Repositories είναι μια πλήρως λειτουργική, κλιμακούμενη, **ιδιωτική υπηρεσία αποθετηρίου Git**. Είναι σχεδιασμένη να **φιλοξενεί τον πηγαίο κώδικα σας σε ένα πλήρως διαχειριζόμενο περιβάλλον**, ενσωματώνοντας ομαλά με άλλα εργαλεία και υπηρεσίες GCP. Προσφέρει έναν συνεργατικό και ασφαλή χώρο για τις ομάδες να αποθηκεύουν, να διαχειρίζονται και να παρακολουθούν τον κώδικά τους.

Τα κύρια χαρακτηριστικά των Cloud Source Repositories περιλαμβάνουν:

1. **Πλήρως Διαχειριζόμενη Φιλοξενία Git**: Προσφέρει τη γνωστή λειτουργικότητα του Git, που σημαίνει ότι μπορείτε να χρησιμοποιείτε κανονικές εντολές και ροές εργασίας Git.
2. **Ενσωμάτωση με Υπηρεσίες GCP**: Ενσωματώνεται με άλλες υπηρεσίες GCP όπως Cloud Build, Pub/Sub και App Engine για πλήρη ιχνηλασιμότητα από τον κώδικα μέχρι την ανάπτυξη.
3. **Ιδιωτικά Αποθετήρια**: Διασφαλίζει ότι ο κώδικάς σας αποθηκεύεται με ασφάλεια και ιδιωτικότητα. Μπορείτε να ελέγξετε την πρόσβαση χρησιμοποιώντας ρόλους Cloud Identity and Access Management (IAM).
4. **Ανάλυση Πηγαίου Κώδικα**: Συνεργάζεται με άλλα εργαλεία GCP για να παρέχει αυτοματοποιημένη ανάλυση του πηγαίου κώδικα σας, εντοπίζοντας πιθανά προβλήματα όπως σφάλματα, ευπάθειες ή κακές πρακτικές προγραμματισμού.
5. **Εργαλεία Συνεργασίας**: Υποστηρίζει συνεργατικό προγραμματισμό με εργαλεία όπως αιτήματα συγχώνευσης, σχόλια και αναθεωρήσεις.
6. **Υποστήριξη Καθρέφτη**: Σας επιτρέπει να συνδέσετε τα Cloud Source Repositories με αποθετήρια που φιλοξενούνται στο GitHub ή Bitbucket, επιτρέποντας αυτόματη συγχρονισμό και παρέχοντας μια ενιαία εικόνα όλων των αποθετηρίων σας.

### OffSec information <a href="#reviewing-cloud-git-repositories" id="reviewing-cloud-git-repositories"></a>

- Η διαμόρφωση των αποθετηρίων πηγής μέσα σε ένα έργο θα έχει έναν **Λογαριασμό Υπηρεσίας** που χρησιμοποιείται για την αποστολή μηνυμάτων Cloud Pub/Sub. Ο προεπιλεγμένος που χρησιμοποιείται είναι ο **Compute SA**. Ωστόσο, **δεν νομίζω ότι είναι δυνατόν να κλέψετε το token του** από τα Source Repositories καθώς εκτελείται στο παρασκήνιο.
- Για να δείτε τον κώδικα μέσα στην κονσόλα ιστού GCP Cloud Source Repositories ([https://source.cloud.google.com/](https://source.cloud.google.com/)), χρειάζεται ο κώδικας να είναι **μέσα στο master branch από προεπιλογή**.
- Μπορείτε επίσης να **δημιουργήσετε ένα καθρέφτη Cloud Repository** που να δείχνει σε ένα repo από **Github** ή **Bitbucket** (δίνοντας πρόσβαση σε αυτές τις πλατφόρμες).
- Είναι δυνατόν να **κωδικοποιήσετε και να αποσφαλίσετε από μέσα στο GCP**.
- Από προεπιλογή, τα Source Repositories **αποτρέπουν την αποστολή ιδιωτικών κλειδιών σε commits**, αλλά αυτό μπορεί να απενεργοποιηθεί.

### Open In Cloud Shell

Είναι δυνατόν να ανοίξετε το αποθετήριο στο Cloud Shell, μια προτροπή όπως αυτή θα εμφανιστεί:

<figure><img src="../../../images/image (325).png" alt=""><figcaption></figcaption></figure>

Αυτό θα σας επιτρέψει να κωδικοποιήσετε και να αποσφαλίσετε στο Cloud Shell (το οποίο θα μπορούσε να έχει παραβιαστεί). 

### Enumeration
```bash
# Repos enumeration
gcloud source repos list #Get names and URLs
gcloud source repos describe <repo_name>
gcloud source repos get-iam-policy <repo_name>

# gcloud repo clone
gcloud source repos clone <REPO NAME>
gcloud source repos get-iam-policy <REPO NAME>
... git add & git commit -m ...
git push --set-upstream origin master
git push -u origin master

# Access via git
## To add a SSH key go to https://source.cloud.google.com/user/ssh_keys (no gcloud command)
git clone ssh://username@domain.com@source.developers.google.com:2022/p/<proj-name>/r/<repo-name>
git add, commit, push...
```
### Ανάβαση Δικαιωμάτων & Μετά την Εκμετάλλευση

{{#ref}}
../gcp-privilege-escalation/gcp-sourcerepos-privesc.md
{{#endref}}

### Μη Αυθεντικοποιημένη Enum

{{#ref}}
../gcp-unauthenticated-enum-and-access/gcp-source-repositories-unauthenticated-enum.md
{{#endref}}

{{#include ../../../banners/hacktricks-training.md}}
