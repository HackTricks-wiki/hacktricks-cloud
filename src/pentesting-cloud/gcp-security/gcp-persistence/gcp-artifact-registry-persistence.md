# GCP - Artifact Registry Persistence

{{#include ../../../banners/hacktricks-training.md}}

## Artifact Registry

Artifact Registry के बारे में अधिक जानकारी के लिए देखें:

{{#ref}}
../gcp-services/gcp-artifact-registry-enum.md
{{#endref}}

### Dependency Confusion

- क्या होता है अगर एक **remote और एक standard** repositories **एक virtual** में मिलाए जाते हैं और एक package दोनों में मौजूद है?
- **Virtual repository** में **highest priority** सेट किया गया वाला उपयोग किया जाता है
- अगर **priority समान है**:
- अगर **version** **समान है**, तो **policy name alphabetically** पहले वाले का उपयोग किया जाता है
- अगर नहीं, तो **highest version** का उपयोग किया जाता है

> [!CAUTION]
> इसलिए, यह संभव है कि एक सार्वजनिक package registry में **highest version (dependency confusion)** का **दुरुपयोग** किया जाए अगर remote repository की priority अधिक या समान है

यह तकनीक **persistence** और **unauthenticated access** के लिए उपयोगी हो सकती है क्योंकि इसे दुरुपयोग करने के लिए केवल **Artifact Registry** में संग्रहीत **library name** को **जानना** और **सार्वजनिक repository (उदाहरण के लिए Python के लिए PyPi)** में उसी library को उच्च version के साथ **बनाना** आवश्यक है।

Persistence के लिए आपको निम्नलिखित चरणों का पालन करना होगा:

- **Requirements**: एक **virtual repository** का **अस्तित्व** होना चाहिए और इसका उपयोग किया जाना चाहिए, एक **internal package** जिसका **name** **public repository** में मौजूद नहीं है, का उपयोग किया जाना चाहिए।
- अगर यह मौजूद नहीं है तो एक remote repository बनाएं
- Remote repository को virtual repository में जोड़ें
- Remote repository को उच्च (या समान) priority देने के लिए virtual registry की नीतियों को संपादित करें।\
कुछ ऐसा चलाएं:
- [gcloud artifacts repositories update --upstream-policy-file ...](https://cloud.google.com/sdk/gcloud/reference/artifacts/repositories/update#--upstream-policy-file)
- वैध package डाउनलोड करें, अपने दुर्भावनापूर्ण कोड को जोड़ें और इसे सार्वजनिक repository में उसी version के साथ पंजीकृत करें। हर बार जब एक developer इसे स्थापित करता है, तो वह आपका स्थापित करेगा!

Dependency confusion के बारे में अधिक जानकारी के लिए देखें:

{{#ref}}
https://book.hacktricks.xyz/pentesting-web/dependency-confusion
{{#endref}}

{{#include ../../../banners/hacktricks-training.md}}
