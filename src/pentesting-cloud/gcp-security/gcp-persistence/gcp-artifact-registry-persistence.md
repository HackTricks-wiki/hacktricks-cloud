# GCP - Збереження в реєстрі артефактів

{{#include ../../../banners/hacktricks-training.md}}

## Реєстр артефактів

Для отримання додаткової інформації про реєстр артефактів перегляньте:

{{#ref}}
../gcp-services/gcp-artifact-registry-enum.md
{{#endref}}

### Плутанина залежностей

- Що станеться, якщо **віддалені та стандартні** репозиторії **змішуються в віртуальному** і пакет існує в обох?
- Використовується той, у якого **найвищий пріоритет, встановлений у віртуальному репозиторії**
- Якщо **пріоритет однаковий**:
- Якщо **версія** однакова, використовується **ім'я політики в алфавітному порядку** першим у віртуальному репозиторії
- Якщо ні, використовується **найвища версія**

> [!CAUTION]
> Отже, можливо **зловживати найвищою версією (плутанина залежностей)** у публічному реєстрі пакетів, якщо віддалений репозиторій має вищий або той же пріоритет

Ця техніка може бути корисною для **збереження** та **неавтентифікованого доступу**, оскільки для зловживання не потрібно нічого, окрім **знати ім'я бібліотеки**, збереженої в реєстрі артефактів, і **створити ту ж бібліотеку в публічному репозиторії (наприклад, PyPi для python)** з вищою версією.

Для збереження потрібно виконати такі кроки:

- **Вимоги**: Повинен **існувати** і використовуватися **віртуальний репозиторій**, потрібно використовувати **внутрішній пакет** з **ім'ям**, яке не існує в **публічному репозиторії**.
- Створіть віддалений репозиторій, якщо його не існує
- Додайте віддалений репозиторій до віртуального репозиторію
- Відредагуйте політики віртуального реєстру, щоб надати вищий пріоритет (або той же) віддаленому репозиторію.\
Запустіть щось на зразок:
- [gcloud artifacts repositories update --upstream-policy-file ...](https://cloud.google.com/sdk/gcloud/reference/artifacts/repositories/update#--upstream-policy-file)
- Завантажте легітимний пакет, додайте свій шкідливий код і зареєструйте його в публічному репозиторії з тією ж версією. Кожного разу, коли розробник його встановлює, він встановлює ваш!

Для отримання додаткової інформації про плутанину залежностей перегляньте:

{{#ref}}
https://book.hacktricks.xyz/pentesting-web/dependency-confusion
{{#endref}}

{{#include ../../../banners/hacktricks-training.md}}
