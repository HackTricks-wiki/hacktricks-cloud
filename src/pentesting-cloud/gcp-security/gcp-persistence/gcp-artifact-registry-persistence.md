# GCP - Artifact Registry Persistence

{{#include ../../../banners/hacktricks-training.md}}

## Artifact Registry

Για περισσότερες πληροφορίες σχετικά με το Artifact Registry, ελέγξτε:

{{#ref}}
../gcp-services/gcp-artifact-registry-enum.md
{{#endref}}

### Dependency Confusion

- Τι συμβαίνει αν **μειχθούν ένα απομακρυσμένο και ένα κανονικό** αποθετήριο **σε ένα εικονικό** και ένα πακέτο υπάρχει και στα δύο;
- Το αποθετήριο με την **υψηλότερη προτεραιότητα που έχει οριστεί στο εικονικό αποθετήριο** χρησιμοποιείται
- Αν η **προτεραιότητα είναι η ίδια**:
- Αν η **έκδοση** είναι η **ίδια**, χρησιμοποιείται το **όνομα πολιτικής αλφαβητικά** πρώτο στο εικονικό αποθετήριο
- Αν όχι, χρησιμοποιείται η **υψηλότερη έκδοση**

> [!CAUTION]
> Επομένως, είναι δυνατόν να **καταχραστεί μια υψηλότερη έκδοση (dependency confusion)** σε ένα δημόσιο αποθετήριο πακέτων αν το απομακρυσμένο αποθετήριο έχει υψηλότερη ή ίδια προτεραιότητα

Αυτή η τεχνική μπορεί να είναι χρήσιμη για **persistency** και **μη αυθεντικοποιημένη πρόσβαση**, καθώς για να την καταχραστείς απαιτείται απλώς να **γνωρίζεις το όνομα μιας βιβλιοθήκης** που αποθηκεύεται στο Artifact Registry και να **δημιουργήσεις την ίδια βιβλιοθήκη στο δημόσιο αποθετήριο (PyPi για python για παράδειγμα)** με υψηλότερη έκδοση.

Για την επιμονή, αυτά είναι τα βήματα που πρέπει να ακολουθήσεις:

- **Απαιτήσεις**: Ένα **εικονικό αποθετήριο** πρέπει να **υπάρχει** και να χρησιμοποιείται, ένα **εσωτερικό πακέτο** με ένα **όνομα** που δεν υπάρχει στο **δημόσιο αποθετήριο** πρέπει να χρησιμοποιείται.
- Δημιούργησε ένα απομακρυσμένο αποθετήριο αν δεν υπάρχει
- Πρόσθεσε το απομακρυσμένο αποθετήριο στο εικονικό αποθετήριο
- Επεξεργάσου τις πολιτικές του εικονικού αποθετηρίου για να δώσεις υψηλότερη προτεραιότητα (ή ίδια) στο απομακρυσμένο αποθετήριο.\
Τρέξε κάτι σαν:
- [gcloud artifacts repositories update --upstream-policy-file ...](https://cloud.google.com/sdk/gcloud/reference/artifacts/repositories/update#--upstream-policy-file)
- Κατέβασε το νόμιμο πακέτο, πρόσθεσε τον κακόβουλο κώδικά σου και καταχώρησέ το στο δημόσιο αποθετήριο με την ίδια έκδοση. Κάθε φορά που ένας προγραμματιστής το εγκαθιστά, θα εγκαθιστά το δικό σου!

Για περισσότερες πληροφορίες σχετικά με την εξάρτηση σύγχυσης, ελέγξτε:

{{#ref}}
https://book.hacktricks.wiki/en/pentesting-web/dependency-confusion.html
{{#endref}}

{{#include ../../../banners/hacktricks-training.md}}
