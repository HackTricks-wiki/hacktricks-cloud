# GCP - Artifact Registry Persistence

{{#include ../../../banners/hacktricks-training.md}}

## Artifact Registry

Artifact Registry hakkında daha fazla bilgi için kontrol edin:

{{#ref}}
../gcp-services/gcp-artifact-registry-enum.md
{{#endref}}

### Bağımlılık Karışıklığı

- **Uzak ve standart** depolar **sanaldaki** bir depoda **karıştırılırsa** ve her ikisinde de bir paket varsa ne olur?
- **Sanal depoda en yüksek önceliğe sahip olan** kullanılır
- Eğer **öncelik aynıysa**:
- Eğer **sürüm** **aynıysa**, sanal depodaki **politika adı alfabetik olarak** ilk olan kullanılır
- Aksi takdirde, **en yüksek sürüm** kullanılır

> [!CAUTION]
> Bu nedenle, eğer uzak depo daha yüksek veya aynı önceliğe sahipse, bir kamu paket kayıt defterinde **en yüksek sürümün (bağımlılık karışıklığı)** **istismar edilmesi** mümkündür.

Bu teknik, **kalıcılık** ve **kimlik doğrulaması yapılmamış erişim** için faydalı olabilir; bunu istismar etmek için sadece Artifact Registry'de saklanan bir **kütüphane adını bilmek** ve **kamu deposunda (örneğin Python için PyPi) aynı kütüphaneyi daha yüksek bir sürümle oluşturmak** gerekir.

Kalıcılık için takip etmeniz gereken adımlar şunlardır:

- **Gereksinimler**: Bir **sanal depo** **var olmalı** ve kullanılmalı, **kamu deposunda** bulunmayan bir **isim** ile bir **iç paket** kullanılmalıdır.
- Eğer yoksa bir uzak depo oluşturun
- Uzak depoyu sanal depoya ekleyin
- Uzak depoya daha yüksek (veya aynı) öncelik vermek için sanal kayıt defterinin politikalarını düzenleyin.\
Şunu çalıştırın:
- [gcloud artifacts repositories update --upstream-policy-file ...](https://cloud.google.com/sdk/gcloud/reference/artifacts/repositories/update#--upstream-policy-file)
- Geçerli paketi indirin, kötü niyetli kodunuzu ekleyin ve aynı sürümle kamu deposuna kaydedin. Her seferinde bir geliştirici bunu yüklediğinde, sizinkini yükleyecek!

Bağımlılık karışıklığı hakkında daha fazla bilgi için kontrol edin:

{{#ref}}
https://book.hacktricks.xyz/pentesting-web/dependency-confusion
{{#endref}}

{{#include ../../../banners/hacktricks-training.md}}
