# GCP - Utrzymywanie w Rejestrze Artefaktów

{{#include ../../../banners/hacktricks-training.md}}

## Rejestr Artefaktów

Aby uzyskać więcej informacji na temat Rejestru Artefaktów, sprawdź:

{{#ref}}
../gcp-services/gcp-artifact-registry-enum.md
{{#endref}}

### Zamieszanie w Zależnościach

- Co się stanie, jeśli **zdalne i standardowe** repozytoria **są pomieszane w wirtualnym** i pakiet istnieje w obu?
- Używane jest to z **najwyższym priorytetem ustawionym w wirtualnym repozytorium**
- Jeśli **priorytet jest taki sam**:
- Jeśli **wersja** jest **taka sama**, używana jest **nazwa polityki alfabetycznie** pierwsza w wirtualnym repozytorium
- Jeśli nie, używana jest **najwyższa wersja**

> [!CAUTION]
> Dlatego możliwe jest **nadużycie najwyższej wersji (zamieszanie w zależnościach)** w publicznym rejestrze pakietów, jeśli zdalne repozytorium ma wyższy lub taki sam priorytet

Ta technika może być przydatna do **utrzymywania** i **nieautoryzowanego dostępu**, ponieważ aby ją nadużyć, wystarczy **znać nazwę biblioteki** przechowywanej w Rejestrze Artefaktów i **utworzyć tę samą bibliotekę w publicznym repozytorium (na przykład PyPi dla Pythona)** z wyższą wersją.

Aby uzyskać utrzymanie, należy wykonać następujące kroki:

- **Wymagania**: Musi **istnieć** i być używane **wirtualne repozytorium**, musi być użyty **wewnętrzny pakiet** o **nazwie**, która nie istnieje w **publicznym repozytorium**.
- Utwórz zdalne repozytorium, jeśli nie istnieje
- Dodaj zdalne repozytorium do wirtualnego repozytorium
- Edytuj polityki w wirtualnym rejestrze, aby nadać wyższy priorytet (lub taki sam) zdalnemu repozytorium.\
Uruchom coś takiego jak:
- [gcloud artifacts repositories update --upstream-policy-file ...](https://cloud.google.com/sdk/gcloud/reference/artifacts/repositories/update#--upstream-policy-file)
- Pobierz legalny pakiet, dodaj swój złośliwy kod i zarejestruj go w publicznym repozytorium z tą samą wersją. Za każdym razem, gdy deweloper go zainstaluje, zainstaluje Twój!

Aby uzyskać więcej informacji na temat zamieszania w zależnościach, sprawdź:

{{#ref}}
https://book.hacktricks.xyz/pentesting-web/dependency-confusion
{{#endref}}

{{#include ../../../banners/hacktricks-training.md}}
