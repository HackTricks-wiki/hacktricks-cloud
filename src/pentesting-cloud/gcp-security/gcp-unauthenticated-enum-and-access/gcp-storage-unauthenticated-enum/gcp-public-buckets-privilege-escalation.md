# GCP - Kamu Bucket'larında Yetki Yükseltme

{{#include ../../../../banners/hacktricks-training.md}}

## Bucket'larda Yetki Yükseltme

Eğer bucket politikası “allUsers” veya “allAuthenticatedUsers”'ın **bucket politikasını yazmasına** ( **storage.buckets.setIamPolicy** izni)** izin veriyorsa,** o zaman herkes bucket politikasını değiştirebilir ve kendisine tam erişim verebilir.

### İzinleri Kontrol Etme

Bir bucket üzerindeki izinleri kontrol etmenin 2 yolu vardır. Birincisi, `https://www.googleapis.com/storage/v1/b/BUCKET_NAME/iam` adresine bir istek yaparak veya `gsutil iam get gs://BUCKET_NAME` komutunu çalıştırarak izinleri istemektir.

Ancak, eğer kullanıcınız (potansiyel olarak allUsers veya allAuthenticatedUsers'a ait) bucket'ın iam politikasını okuma iznine sahip değilse (storage.buckets.getIamPolicy), bu işe yaramaz.

Her zaman işe yarayacak diğer seçenek, bucket'ın testPermissions uç noktasını kullanarak belirtilen izne sahip olup olmadığınızı belirlemektir. Örneğin, şu adresi erişerek: `https://www.googleapis.com/storage/v1/b/BUCKET_NAME/iam/testPermissions?permissions=storage.buckets.delete&permissions=storage.buckets.get&permissions=storage.buckets.getIamPolicy&permissions=storage.buckets.setIamPolicy&permissions=storage.buckets.update&permissions=storage.objects.create&permissions=storage.objects.delete&permissions=storage.objects.get&permissions=storage.objects.list&permissions=storage.objects.update`

### Yükseltme

`Storage Admin` yetkisini `allAuthenticatedUsers`'a vermek için şu komut çalıştırılabilir:
```bash
gsutil iam ch allAuthenticatedUsers:admin gs://BUCKET_NAME
```
Başka bir saldırı, **bucket'ı kaldırmak ve onu hesabınızda yeniden oluşturmak suretiyle sahipliği çalmaktır**.

## Referanslar

- [https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/](https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/)

{{#include ../../../../banners/hacktricks-training.md}}
