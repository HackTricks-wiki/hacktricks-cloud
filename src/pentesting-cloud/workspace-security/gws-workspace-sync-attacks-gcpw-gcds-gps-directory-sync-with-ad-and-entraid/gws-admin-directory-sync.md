# GWS - Admin Directory Sync

{{#include ../../../banners/hacktricks-training.md}}

## Basic Information

Tofauti kuu kati ya njia hii ya kuunganisha watumiaji na GCDS ni kwamba GCDS inafanywa kwa mikono na baadhi ya binaries unahitaji kupakua na kuendesha wakati **Admin Directory Sync haina seva** inasimamiwa na Google katika [https://admin.google.com/ac/sync/externaldirectories](https://admin.google.com/ac/sync/externaldirectories).

Wakati wa kuandika hii huduma iko kwenye beta na inasaidia aina 2 za kuunganisha: Kutoka **Active Directory** na kutoka **Azure Entra ID:**

- **Active Directory:** Ili kuweka hii unahitaji kutoa **ufikiaji kwa Google kwa mazingira yako ya Active Directory**. Na kwa kuwa Google ina ufikiaji tu kwa mitandao ya GCP (kupitia **VPC connectors**) unahitaji kuunda kiunganishi na kisha kufanya AD yako ipatikane kutoka kwa kiunganishi hicho kwa kuwa na hiyo katika VMs kwenye mtandao wa GCP au kutumia Cloud VPN au Cloud Interconnect. Kisha, unahitaji pia kutoa **akili** ya akaunti yenye ufikiaji wa kusoma juu ya directory na **cheti** ili kuwasiliana kupitia **LDAPS**.
- **Azure Entra ID:** Ili kuunda hii inahitajika tu **kuingia kwenye Azure na mtumiaji mwenye ufikiaji wa kusoma** juu ya usajili wa Entra ID katika pop-up inayonyeshwa na Google, na Google itahifadhi token yenye ufikiaji wa kusoma juu ya Entra ID.

Mara tu ikikamilishwa vizuri, chaguo zote mbili zitawawezesha **kuunganisha watumiaji na vikundi kwa Workspace**, lakini haitaruhusu kuunda watumiaji na vikundi kutoka Workspace hadi AD au EntraID.

Chaguzi nyingine ambazo zitapatikana wakati wa kuunganisha hii ni:

- Tuma barua pepe kwa watumiaji wapya kuingia
- Badilisha kiotomatiki anwani yao ya barua pepe kuwa ile inayotumika na Workspace. Hivyo kama Workspace inatumia `@hacktricks.xyz` na watumiaji wa EntraID wanatumia `@carloshacktricks.onmicrosoft.com`, `@hacktricks.xyz` itatumika kwa watumiaji walioundwa katika akaunti.
- Chagua **vikundi vinavyokuwa na watumiaji** ambao wataunganishwa.
- Chagua **vikundi** vya kuunganisha na kuunda katika Workspace (au onyesha kuunganisha vikundi vyote).

### From AD/EntraID -> Google Workspace (& GCP)

Ikiwa unafanikiwa kuathiri AD au EntraID utakuwa na udhibiti kamili wa watumiaji na vikundi ambavyo vitakuwa vinaundwa na Google Workspace.\
Hata hivyo, zingatia kwamba **nywila** ambazo watumiaji wanaweza kuwa wanatumia katika Workspace **zinaweza kuwa zile zile au si**.

#### Attacking users

Wakati wa kuunganisha inaweza kuunganisha **watumiaji wote kutoka AD au wale tu kutoka OU maalum** au tu **watumiaji wanachama wa vikundi maalum katika EntraID**. Hii inamaanisha kwamba ili kushambulia mtumiaji aliyeunganishwa (au kuunda mpya anayepata kuunganishwa) utahitaji kwanza kubaini ni watumiaji gani wanaounganishwa.

- Watumiaji wanaweza kuwa **wanatumia nywila tena au la kutoka AD au EntraID**, lakini hii inamaanisha kwamba utahitaji **kuathiri nywila za watumiaji kuingia**.
- Ikiwa una ufikiaji wa **barua pepe** za watumiaji, unaweza **kubadilisha nywila ya Workspace ya mtumiaji aliyepo**, au **kuunda mtumiaji mpya**, subiri hadi ipate kuunganishwa na kuanzisha akaunti hiyo.

Mara tu unapoingia mtumiaji ndani ya Workspace inaweza kutolewa baadhi ya **idhini za msingi**.

#### Attacking Groups

Unahitaji pia kubaini kwanza ni vikundi gani vinavyounganishwa. Ingawa kuna uwezekano kwamba **VIKUNDI VYOTE** vinavyounganishwa (kama Workspace inaruhusu hili).

> [!NOTE]
> Zingatia kwamba hata kama vikundi na uanachama vinapoingizwa katika Workspace, **watumiaji ambao hawajaunganishwa katika kuunganisha watumiaji hawataundwa** wakati wa kuunganisha vikundi hata kama ni wanachama wa mojawapo ya vikundi vilivyounganishwa.

Ikiwa unajua ni vikundi vipi kutoka Azure vinavyokuwa **vimepewa idhini katika Workspace au GCP**, unaweza tu kuongeza mtumiaji aliyeathiriwa (au aliyeundwa hivi karibuni) katika kikundi hicho na kupata hizo idhini.

Kuna chaguo lingine la kutumia vikundi vilivyokuwa na mamlaka katika Workspace. Kwa mfano, kikundi `gcp-organization-admins@<workspace.email>` kawaida kina mamlaka makubwa juu ya GCP.

Ikiwa kuunganisha kutoka, kwa mfano EntraID, hadi Workspace **kumewekwa ili kubadilisha domain** ya kitu kilichooanishwa **na barua pepe ya Workspace**, itakuwa inawezekana kwa mshambuliaji kuunda kikundi `gcp-organization-admins@<entraid.email>` katika EntraID, kuongeza mtumiaji katika kikundi hiki, na kusubiri hadi kuunganisha kwa vikundi vyote kutokea.\
**Mtumiaji ataongezwa katika kikundi `gcp-organization-admins@<workspace.email>` akipandisha mamlaka katika GCP.**

### From Google Workspace -> AD/EntraID

Zingatia kwamba Workspace inahitaji akili zenye ufikiaji wa kusoma tu juu ya AD au EntraID ili kuunganisha watumiaji na vikundi. Kwa hivyo, haiwezekani kutumia Google Workspace kufanya mabadiliko yoyote katika AD au EntraID. Hivyo **hii haiwezekani** kwa wakati huu.

Sijui pia Google inahifadhi wapi akili za AD au token ya EntraID na huwezi **kuziokoa kwa kuunda upya kuunganisha** (hazionekani katika fomu ya wavuti, unahitaji kuzipatia tena). Hata hivyo, kutoka kwenye wavuti inaweza kuwa inawezekana kutumia kazi ya sasa ili **orodhesha watumiaji na vikundi**.

{{#include ../../../banners/hacktricks-training.md}}
