# GWS - Workspace Pentesting

{{#include ../../banners/hacktricks-training.md}}

## 入口点

### Google 平台和 OAuth 应用钓鱼

检查如何使用不同的 Google 平台，如 Drive、Chat、Groups... 向受害者发送钓鱼链接，以及如何执行 Google OAuth 钓鱼：

{{#ref}}
gws-google-platforms-phishing/
{{#endref}}

### 密码喷洒

为了测试您找到的所有电子邮件（或基于您可能发现的电子邮件名称模式生成的电子邮件）的密码，您可以使用一个工具，如 [**https://github.com/ustayready/CredKing**](https://github.com/ustayready/CredKing)（尽管看起来没有维护），该工具将使用 AWS lambdas 更改 IP 地址。

## 后期利用

如果您已经获取了一些凭据或用户的会话，您可以执行多个操作以访问用户的潜在敏感信息并尝试提升权限：

{{#ref}}
gws-post-exploitation.md
{{#endref}}

### GWS <-->GCP 透传

了解更多关于在 GWS 和 GCP 之间透传的不同技术：

{{#ref}}
../gcp-security/gcp-to-workspace-pivoting/
{{#endref}}

## GWS <--> GCPW | GCDS | 目录同步 (AD & EntraID)

- **GCPW (Google Credential Provider for Windows)**：这是 Google Workspace 提供的单点登录，用户可以使用 **他们的 Workspace 凭据** 登录 Windows PC。此外，这将 **在 PC 的某些地方存储访问 Google Workspace 的令牌**。
- **GCDS (Google Cloud Directory Sync)**：这是一个可以用来 **将您的活动目录用户和组同步到您的 Workspace** 的工具。该工具需要 **Workspace 超级用户和特权 AD 用户的凭据**。因此，可能会在一个定期同步用户的域服务器中找到它。
- **管理员目录同步**：它允许您在无服务器的过程中从 [https://admin.google.com/ac/sync/externaldirectories](https://admin.google.com/ac/sync/externaldirectories) 同步 AD 和 EntraID 的用户。

{{#ref}}
gws-workspace-sync-attacks-gcpw-gcds-gps-directory-sync-with-ad-and-entraid/
{{#endref}}

## 持久性

如果您已经获取了一些凭据或用户的会话，请检查这些选项以保持持久性：

{{#ref}}
gws-persistence.md
{{#endref}}

## 账户被攻破后的恢复

- 登出所有会话
- 更改用户密码
- 生成新的 2FA 备份代码
- 移除应用密码
- 移除 OAuth 应用
- 移除 2FA 设备
- 移除电子邮件转发
- 移除电子邮件过滤器
- 移除恢复电子邮件/电话
- 移除恶意同步的智能手机
- 移除不良 Android 应用
- 移除不良账户委托

## 参考资料

- [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - Hacking G Suite: The Power of Dark Apps Script Magic
- [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch 和 Beau Bullock - OK Google, How do I Red Team GSuite?

{{#include ../../banners/hacktricks-training.md}}
