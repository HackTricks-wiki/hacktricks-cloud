# GWS - Workspace Pentesting

{{#include ../../banners/hacktricks-training.md}}

## Punkty wejścia

### Phishing aplikacji Google i OAuth

Sprawdź, jak możesz wykorzystać różne platformy Google, takie jak Drive, Chat, Groups... do wysłania ofierze linku phishingowego oraz jak przeprowadzić phishing Google OAuth w:

{{#ref}}
gws-google-platforms-phishing/
{{#endref}}

### Password Spraying

Aby przetestować hasła ze wszystkimi adresami e-mail, które znalazłeś (lub które wygenerowałeś na podstawie wzoru nazwy e-mail, który mogłeś odkryć), możesz użyć narzędzia takiego jak [**https://github.com/ustayready/CredKing**](https://github.com/ustayready/CredKing) (chociaż wygląda na nieutrzymywane), które wykorzysta AWS lambdy do zmiany adresu IP.

## Post-eksploatacja

Jeśli skompromitowałeś jakieś dane uwierzytelniające lub sesję użytkownika, możesz wykonać kilka działań, aby uzyskać dostęp do potencjalnie wrażliwych informacji użytkownika i spróbować zwiększyć uprawnienia:

{{#ref}}
gws-post-exploitation.md
{{#endref}}

### GWS <--> GCP Pivoting

Przeczytaj więcej o różnych technikach pivotowania między GWS a GCP w:

{{#ref}}
../gcp-security/gcp-to-workspace-pivoting/
{{#endref}}

## GWS <--> GCPW | GCDS | Synchronizacja katalogów (AD i EntraID)

- **GCPW (Google Credential Provider for Windows)**: To jest jednolity system logowania, który zapewnia Google Workspaces, aby użytkownicy mogli logować się na swoich komputerach z systemem Windows, używając **swoich danych uwierzytelniających Workspace**. Ponadto, to **przechowuje tokeny do uzyskania dostępu do Google Workspace** w niektórych miejscach na komputerze.
- **GCDS (Google Cloud Directory Sync)**: To narzędzie, które można wykorzystać do **synchronizacji użytkowników i grup z aktywnego katalogu do Workspace**. Narzędzie wymaga **danych uwierzytelniających superużytkownika Workspace i uprzywilejowanego użytkownika AD**. Dlatego może być możliwe znalezienie go na serwerze domeny, który synchronizowałby użytkowników od czasu do czasu.
- **Synchronizacja katalogu administratora**: Umożliwia synchronizację użytkowników z AD i EntraID w bezserwerowym procesie z [https://admin.google.com/ac/sync/externaldirectories](https://admin.google.com/ac/sync/externaldirectories).

{{#ref}}
gws-workspace-sync-attacks-gcpw-gcds-gps-directory-sync-with-ad-and-entraid/
{{#endref}}

## Utrzymywanie

Jeśli skompromitowałeś jakieś dane uwierzytelniające lub sesję użytkownika, sprawdź te opcje, aby utrzymać nad nimi kontrolę:

{{#ref}}
gws-persistence.md
{{#endref}}

## Odzyskiwanie skompromitowanego konta

- Wyloguj się ze wszystkich sesji
- Zmień hasło użytkownika
- Wygeneruj nowe kody zapasowe 2FA
- Usuń hasła aplikacji
- Usuń aplikacje OAuth
- Usuń urządzenia 2FA
- Usuń przekierowania e-mail
- Usuń filtry e-mail
- Usuń e-maile/telefony do odzyskiwania
- Usuń złośliwe zsynchronizowane smartfony
- Usuń złe aplikacje na Androida
- Usuń złe delegacje konta

## Odniesienia

- [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - Hacking G Suite: The Power of Dark Apps Script Magic
- [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch i Beau Bullock - OK Google, Jak mogę przeprowadzić Red Team GSuite?

{{#include ../../banners/hacktricks-training.md}}
