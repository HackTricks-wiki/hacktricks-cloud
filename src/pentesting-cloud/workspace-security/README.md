# GWS - Pentesting do Workspace

{{#include ../../banners/hacktricks-training.md}}

## Pontos de Entrada

### Phishing em Plataformas Google e Apps OAuth

Verifique como você poderia usar diferentes plataformas Google, como Drive, Chat, Grupos... para enviar ao vítima um link de phishing e como realizar um Phishing de Google OAuth em:

{{#ref}}
gws-google-platforms-phishing/
{{#endref}}

### Password Spraying

Para testar senhas com todos os e-mails que você encontrou (ou que você gerou com base em um padrão de nome de e-mail que você pode ter descoberto), você pode usar uma ferramenta como [**https://github.com/ustayready/CredKing**](https://github.com/ustayready/CredKing) (embora pareça não estar sendo mantida), que usará lambdas da AWS para mudar o endereço IP.

## Pós-Exploração

Se você comprometeu algumas credenciais ou a sessão do usuário, pode realizar várias ações para acessar informações potencialmente sensíveis do usuário e tentar escalar privilégios:

{{#ref}}
gws-post-exploitation.md
{{#endref}}

### GWS <--> GCP Pivoting

Leia mais sobre as diferentes técnicas para pivotar entre GWS e GCP em:

{{#ref}}
../gcp-security/gcp-to-workspace-pivoting/
{{#endref}}

## GWS <--> GCPW | GCDS | Sincronização de Diretório (AD & EntraID)

- **GCPW (Google Credential Provider for Windows)**: Este é o login único que o Google Workspaces fornece para que os usuários possam fazer login em seus PCs com Windows usando **suas credenciais do Workspace**. Além disso, isso **armazenará tokens para acessar o Google Workspace** em alguns lugares no PC.
- **GCDS (Google Cloud Directory Sync)**: Esta é uma ferramenta que pode ser usada para **sincronizar seus usuários e grupos do Active Directory com seu Workspace**. A ferramenta requer as **credenciais de um superusuário do Workspace e de um usuário privilegiado do AD**. Portanto, pode ser possível encontrá-la dentro de um servidor de domínio que estaria sincronizando usuários de tempos em tempos.
- **Admin Directory Sync**: Permite que você sincronize usuários do AD e EntraID em um processo sem servidor a partir de [https://admin.google.com/ac/sync/externaldirectories](https://admin.google.com/ac/sync/externaldirectories).

{{#ref}}
gws-workspace-sync-attacks-gcpw-gcds-gps-directory-sync-with-ad-and-entraid/
{{#endref}}

## Persistência

Se você comprometeu algumas credenciais ou a sessão do usuário, verifique estas opções para manter a persistência sobre isso:

{{#ref}}
gws-persistence.md
{{#endref}}

## Recuperação de Conta Comprometida

- Sair de todas as sessões
- Alterar a senha do usuário
- Gerar novos códigos de backup 2FA
- Remover senhas de aplicativos
- Remover aplicativos OAuth
- Remover dispositivos 2FA
- Remover encaminhadores de e-mail
- Remover filtros de e-mail
- Remover e-mails/telefones de recuperação
- Remover smartphones sincronizados maliciosos
- Remover aplicativos Android ruins
- Remover delegações de conta ruins

## Referências

- [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - Hacking G Suite: The Power of Dark Apps Script Magic
- [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch e Beau Bullock - OK Google, Como faço para Red Team GSuite?

{{#include ../../banners/hacktricks-training.md}}
