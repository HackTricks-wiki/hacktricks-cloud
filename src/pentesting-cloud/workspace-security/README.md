# GWS - Workspace Pentesting

{{#include ../../banners/hacktricks-training.md}}

## Entry Points

### Google Platforms and OAuth Apps Phishing

Controlla come potresti utilizzare diverse piattaforme Google come Drive, Chat, Groups... per inviare alla vittima un link di phishing e come eseguire un Google OAuth Phishing in:

{{#ref}}
gws-google-platforms-phishing/
{{#endref}}

### Password Spraying

Per testare le password con tutte le email che hai trovato (o che hai generato basandoti su un modello di nome email che potresti aver scoperto) potresti utilizzare uno strumento come [**https://github.com/ustayready/CredKing**](https://github.com/ustayready/CredKing) (anche se sembra non essere mantenuto) che utilizzerà le lambda AWS per cambiare indirizzo IP.

## Post-Exploitation

Se hai compromesso alcune credenziali o la sessione dell'utente, puoi eseguire diverse azioni per accedere a potenziali informazioni sensibili dell'utente e cercare di elevare i privilegi:

{{#ref}}
gws-post-exploitation.md
{{#endref}}

### GWS <-->GCP Pivoting

Leggi di più sulle diverse tecniche per pivotare tra GWS e GCP in:

{{#ref}}
../gcp-security/gcp-to-workspace-pivoting/
{{#endref}}

## GWS <--> GCPW | GCDS | Directory Sync (AD & EntraID)

- **GCPW (Google Credential Provider for Windows)**: Questo è il single sign-on che Google Workspaces fornisce affinché gli utenti possano accedere ai loro PC Windows utilizzando **le loro credenziali di Workspace**. Inoltre, questo **memorizzerà i token per accedere a Google Workspace** in alcuni luoghi nel PC.
- **GCDS (Google Cloud Directory Sync)**: Questo è uno strumento che può essere utilizzato per **sincronizzare gli utenti e i gruppi del tuo Active Directory con il tuo Workspace**. Lo strumento richiede le **credenziali di un superutente di Workspace e di un utente privilegiato di AD**. Quindi, potrebbe essere possibile trovarlo all'interno di un server di dominio che sincronizzerebbe gli utenti di tanto in tanto.
- **Admin Directory Sync**: Consente di sincronizzare gli utenti da AD e EntraID in un processo senza server da [https://admin.google.com/ac/sync/externaldirectories](https://admin.google.com/ac/sync/externaldirectories).

{{#ref}}
gws-workspace-sync-attacks-gcpw-gcds-gps-directory-sync-with-ad-and-entraid/
{{#endref}}

## Persistence

Se hai compromesso alcune credenziali o la sessione dell'utente, controlla queste opzioni per mantenere la persistenza su di esse:

{{#ref}}
gws-persistence.md
{{#endref}}

## Account Compromised Recovery

- Disconnetti tutte le sessioni
- Cambia la password dell'utente
- Genera nuovi codici di backup 2FA
- Rimuovi le password delle app
- Rimuovi le app OAuth
- Rimuovi i dispositivi 2FA
- Rimuovi i reindirizzatori email
- Rimuovi i filtri email
- Rimuovi email/telefoni di recupero
- Rimuovi smartphone sincronizzati malevoli
- Rimuovi cattive app Android
- Rimuovi cattive deleghe di account

## References

- [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - Hacking G Suite: The Power of Dark Apps Script Magic
- [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch e Beau Bullock - OK Google, come faccio a Red Team GSuite?

{{#include ../../banners/hacktricks-training.md}}
