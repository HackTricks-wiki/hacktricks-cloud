# Kubernetes SecurityContext(s)

{{#include ../../../banners/hacktricks-training.md}}

## PodSecurityContext <a href="#podsecuritycontext-v1-core" id="podsecuritycontext-v1-core"></a>

[**Belgelerden:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)

Bir Pod'un güvenlik bağlamını belirtirken birkaç özellik kullanabilirsiniz. Savunma güvenliği açısından dikkate almanız gerekenler:

- **runASNonRoot**'u **True** olarak ayarlamak
- **runAsUser**'ı yapılandırmak
- Mümkünse, **seLinuxOptions** ve **seccompProfile** belirterek **izinleri** **sınırlamayı** düşünmek
- **runAsGroup** ve **supplementaryGroups** aracılığıyla **yetki** **grubu** erişimi vermemek

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                                                                                 | <p>Bir <strong>pod içindeki tüm konteynerlere</strong> uygulanan özel bir ek gruptur. Bazı hacim türleri Kubelet'in bu hacmin <strong>sahipliğini değiştirmesine</strong> izin verir:<br>1. Sahip GID FSGroup olacaktır<br>2. setgid biti ayarlanmıştır (hacimde oluşturulan yeni dosyalar FSGroup tarafından sahip olunacaktır)<br>3. İzin bitleri rw-rw---- ile OR'lanır. Ayarlanmamışsa, Kubelet herhangi bir hacmin sahipliğini ve izinlerini değiştirmeyecektir.</p> |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroupChangePolicy</strong></a><br><em>string</em></p>                                                                                                                                                                                                                                      | Bu, Pod içinde sergilendikten önce **hacmin sahipliğini ve iznini değiştirme** davranışını tanımlar.                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                                                                              | **Konteyner sürecinin giriş noktasını çalıştırmak için GID**. Ayarlanmamışsa çalışma zamanı varsayılanını kullanır.                                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>boolean</em></p>                                                                                                                                                                                                                                            | Konteynerin kök olmayan bir kullanıcı olarak çalışması gerektiğini belirtir. Doğruysa, Kubelet görüntüyü çalışma zamanında doğrulayacak ve UID 0 (kök) olarak çalışmadığından emin olacak ve eğer çalışıyorsa konteyneri başlatmayı başarısız kılacaktır.                                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsUser</strong></a><br><em>integer</em></p>                                                                                                                                                                                                                                               | **Konteyner sürecinin giriş noktasını çalıştırmak için UID**. Belirtilmemişse, görüntü meta verilerinde belirtilen kullanıcıya varsayılan olarak ayarlanır.                                                                                                                                                                                                                                                                                                                                                              |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Hakkında daha fazla bilgi</em> <em><strong>seLinux</strong></em></p>                                                           | Tüm konteynerlere uygulanacak **SELinux bağlamı**. Belirtilmemişse, konteyner çalışma zamanı her konteyner için rastgele bir SELinux bağlamı tahsis edecektir.                                                                                                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a><br><em>Hakkında daha fazla bilgi</em> <em><strong>Seccomp</strong></em></p>                                                           | Bu pod'daki konteynerler tarafından kullanılacak **seccomp seçenekleri**.                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>supplementalGroups</strong></a><br><em>integer array</em></p>                                                                                                                                                                                                                                | Her konteynerde çalıştırılan ilk süreç için ek olarak uygulanan **grup listesi**, konteynerin birincil GID'sine ek olarak.                                                                                                                                                                                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>sysctls</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#sysctl-v1-core"><em>Sysctl</em></a> <em>dizi</em><br><em>Hakkında daha fazla bilgi</em> <a href="https://www.garron.me/en/go2linux/sysctl-linux.html"><em><strong>sysctls</strong></em></a></p> | Sysctls, pod için kullanılan **namespaced sysctls** listesini tutar. Desteklenmeyen sysctls (konteyner çalışma zamanı tarafından) olan pod'lar başlatılamayabilir.                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                                                                           | Tüm konteynerlere uygulanan Windows'a özgü ayarlar. Belirtilmemişse, bir konteynerin SecurityContext içindeki seçenekler kullanılacaktır.                                                                                                                                                                                                                                                                                                                                               |

## SecurityContext

[**Belgelerden:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

Bu bağlam **konteyner tanımlarının** içinde ayarlanır. Savunma güvenliği açısından dikkate almanız gerekenler:

- **allowPrivilegeEscalation**'ı **False** olarak ayarlamak
- Hassas **yetkiler** eklememek (ve ihtiyaç duymadıklarınızı kaldırmak)
- **privileged**'i **False** olarak ayarlamak
- Mümkünse, **readOnlyFilesystem**'ı **True** olarak ayarlamak
- **runAsNonRoot**'u **True** olarak ayarlamak ve bir **runAsUser** belirlemek
- Mümkünse, **seLinuxOptions** ve **seccompProfile** belirterek **izinleri** **sınırlamayı** düşünmek
- **runAsGroup** aracılığıyla **yetki** **grubu** erişimi vermemek.

**SecurityContext** ve **PodSecurityContext**'te ayarlanan özelliklerin her ikisinde de, **SecurityContext**'te belirtilen değer **önceliklidir**.

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>allowPrivilegeEscalation</strong></a><br><em>boolean</em></p>                                                                                                                                                                      | **AllowPrivilegeEscalation**, bir sürecin **ebeveyn sürecinden daha fazla yetki kazanıp kazanamayacağını** kontrol eder. Bu bool, konteyner sürecinde no_new_privs bayrağının ayarlanıp ayarlanmayacağını doğrudan kontrol eder. AllowPrivilegeEscalation, konteyner **Privileged** olarak çalıştırıldığında veya **CAP_SYS_ADMIN** varsa her zaman doğrudur. |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>capabilities</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#capabilities-v1-core"><em>Capabilities</em></a><br><em>Hakkında daha fazla bilgi</em> <em><strong>Capabilities</strong></em></p>  | Konteynerler çalıştırılırken **eklenecek/kaldırılacak yetkiler**. Varsayılan olarak yetkilerin varsayılan setidir.                                                                                                                                                                                                                |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>privileged</strong></a><br><em>boolean</em></p>                                                                                                                                                                                    | Konteyneri ayrıcalıklı modda çalıştırır. Ayrıcalıklı konteynerlerdeki süreçler esasen **host'ta root ile eşdeğerdir**. Varsayılan olarak false'dur.                                                                                                                                                                           |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>procMount</strong></a><br><em>string</em></p>                                                                                                                                                                                      | procMount, konteynerler için kullanılacak **proc mount türünü** belirtir. Varsayılan, yalnızca okunabilir yollar ve maskelenmiş yollar için konteyner çalışma zamanı varsayılanlarını kullanan DefaultProcMount'tır.                                                                                                                                |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>readOnlyRootFilesystem</strong></a><br><em>boolean</em></p>                                                                                                                                                                        | Bu **konteynerin yalnızca okunabilir bir kök dosya sistemine sahip olup olmadığını** belirtir. Varsayılan olarak false'dur.                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                    | **Konteyner sürecinin giriş noktasını çalıştırmak için GID**. Ayarlanmamışsa çalışma zamanı varsayılanını kullanır.                                                                                                                                                                                                                            |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>boolean</em></p>                                                                                                                                                                                  | Konteynerin **kök olmayan bir kullanıcı olarak çalışması gerektiğini** belirtir. Doğruysa, Kubelet görüntüyü çalışma zamanında doğrulayacak ve UID 0 (kök) olarak çalışmadığından emin olacak ve eğer çalışıyorsa konteyneri başlatmayı başarısız kılacaktır.                                                                                                      |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsUser</strong></a><br><em>integer</em></p>                                                                                                                                                                                     | **Konteyner sürecinin giriş noktasını çalıştırmak için UID**. Belirtilmemişse, görüntü meta verilerinde belirtilen kullanıcıya varsayılan olarak ayarlanır.                                                                                                                                                                                              |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Hakkında daha fazla bilgi</em> <em><strong>seLinux</strong></em></p> | Konteynere uygulanacak **SELinux bağlamı**. Belirtilmemişse, konteyner çalışma zamanı her konteyner için rastgele bir SELinux bağlamı tahsis edecektir.                                                                                                                                                              |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a></p>                                                               | Bu konteyner için kullanılacak **seccomp seçenekleri**.                                                                                                                                                                                                                                                                     |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                 | Tüm konteynerlere uygulanan **Windows'a özgü ayarlar**.                                                                                                                                                                                                                                                          |

## References

- [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)
- [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

{{#include ../../../banners/hacktricks-training.md}}
