# Kubernetes Basics

## Kubernetes Basics

{{#include ../../banners/hacktricks-training.md}}

**ã“ã®ãƒšãƒ¼ã‚¸ã®å…ƒã®è‘—è€…ã¯** [**ãƒ›ãƒ«ãƒ˜**](https://www.linkedin.com/in/jorge-belmonte-a924b616b/) **ã§ã™ï¼ˆå½¼ã®å…ƒã®æŠ•ç¨¿ã¯** [**ã“ã¡ã‚‰**](https://sickrov.github.io)**ï¼‰**

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨åŸºæœ¬

### Kubernetesã¯ä½•ã‚’ã™ã‚‹ã®ã‹ï¼Ÿ

- ã‚³ãƒ³ãƒ†ãƒŠã‚¨ãƒ³ã‚¸ãƒ³ã§ã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œã§ãã‚‹ã€‚
- ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ã‚ˆã‚Šã‚³ãƒ³ãƒ†ãƒŠã®ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’åŠ¹ç‡çš„ã«è¡Œã†ã€‚
- ã‚³ãƒ³ãƒ†ãƒŠã‚’ç”Ÿã‹ã—ã¦ãŠãã€‚
- ã‚³ãƒ³ãƒ†ãƒŠé–“ã®é€šä¿¡ã‚’å¯èƒ½ã«ã™ã‚‹ã€‚
- ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæŠ€è¡“ã‚’è¨±å¯ã™ã‚‹ã€‚
- æƒ…å ±ã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’å‡¦ç†ã™ã‚‹ã€‚

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

![](https://sickrov.github.io/media/Screenshot-68.jpg)

- **ãƒãƒ¼ãƒ‰**: ãƒãƒƒãƒ‰ã¾ãŸã¯ãƒãƒƒãƒ‰ã‚’æŒã¤ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã€‚
- **ãƒãƒƒãƒ‰**: ã‚³ãƒ³ãƒ†ãƒŠã¾ãŸã¯è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’åŒ…ã‚€ãƒ©ãƒƒãƒ‘ãƒ¼ã€‚ãƒãƒƒãƒ‰ã¯é€šå¸¸ã€1ã¤ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã¿ã‚’å«ã‚€ã¹ãã§ã‚ã‚‹ï¼ˆé€šå¸¸ã€ãƒãƒƒãƒ‰ã¯1ã¤ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œã™ã‚‹ï¼‰ã€‚ãƒãƒƒãƒ‰ã¯KubernetesãŒå®Ÿè¡Œã—ã¦ã„ã‚‹ã‚³ãƒ³ãƒ†ãƒŠæŠ€è¡“ã‚’æŠ½è±¡åŒ–ã™ã‚‹æ–¹æ³•ã§ã‚ã‚‹ã€‚
- **ã‚µãƒ¼ãƒ“ã‚¹**: å„ãƒãƒƒãƒ‰ã¯ãƒãƒ¼ãƒ‰ã®å†…éƒ¨ç¯„å›²ã‹ã‚‰1ã¤ã®å†…éƒ¨**IPã‚¢ãƒ‰ãƒ¬ã‚¹**ã‚’æŒã¤ã€‚ã—ã‹ã—ã€ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä»‹ã—ã¦å…¬é–‹ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã€‚**ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚‚IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒã‚ã‚Š**ã€ãã®ç›®çš„ã¯ãƒãƒƒãƒ‰é–“ã®é€šä¿¡ã‚’ç¶­æŒã™ã‚‹ã“ã¨ã§ã‚ã‚‹ã€‚ã—ãŸãŒã£ã¦ã€1ã¤ã®ãƒãƒƒãƒ‰ãŒæ­»ã‚“ã å ´åˆã€**æ–°ã—ã„ç½®ãæ›ãˆ**ï¼ˆç•°ãªã‚‹å†…éƒ¨IPã‚’æŒã¤ï¼‰**ãŒã‚µãƒ¼ãƒ“ã‚¹ã®åŒã˜IPã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ãªã‚‹**ã€‚å†…éƒ¨ã¾ãŸã¯å¤–éƒ¨ã¨ã—ã¦æ§‹æˆã§ãã‚‹ã€‚ã‚µãƒ¼ãƒ“ã‚¹ã¯ã¾ãŸã€**2ã¤ã®ãƒãƒƒãƒ‰ãŒåŒã˜ã‚µãƒ¼ãƒ“ã‚¹ã«æ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã¨ãã«ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã¨ã—ã¦æ©Ÿèƒ½ã™ã‚‹**ã€‚\
ã‚µãƒ¼ãƒ“ã‚¹ãŒ**ä½œæˆã•ã‚Œã‚‹ã¨**ã€`kubectl get endpoints`ã‚’å®Ÿè¡Œã—ã¦å„ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
- **Kubelet**: ãƒ—ãƒ©ã‚¤ãƒãƒªãƒãƒ¼ãƒ‰ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã€‚ãƒãƒ¼ãƒ‰ã¨kubectlé–“ã®é€šä¿¡ã‚’ç¢ºç«‹ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã‚ã‚Šã€ãƒãƒƒãƒ‰ã®ã¿ã‚’å®Ÿè¡Œã§ãã‚‹ï¼ˆAPIã‚µãƒ¼ãƒãƒ¼ã‚’ä»‹ã—ã¦ï¼‰ã€‚Kubeletã¯Kubernetesã«ã‚ˆã£ã¦ä½œæˆã•ã‚Œã¦ã„ãªã„ã‚³ãƒ³ãƒ†ãƒŠã‚’ç®¡ç†ã—ãªã„ã€‚
- **Kube-proxy**: apiserverã¨ãƒãƒ¼ãƒ‰é–“ã®é€šä¿¡ï¼ˆã‚µãƒ¼ãƒ“ã‚¹ï¼‰ã‚’æ‹…å½“ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã‚ã‚‹ã€‚ãƒãƒ¼ãƒ‰ã®ãŸã‚ã®IPtablesãŒåŸºæœ¬ã§ã‚ã‚‹ã€‚çµŒé¨“è±Šå¯Œãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€ä»–ã®ãƒ™ãƒ³ãƒ€ãƒ¼ã‹ã‚‰ã®ä»–ã®kube-proxiesã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
- **ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠ**: ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠã¯ã€ãƒãƒƒãƒ‰å†…ã®ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã¨ä¸€ç·’ã«å®Ÿè¡Œã•ã‚Œã‚‹ã¹ãã‚³ãƒ³ãƒ†ãƒŠã§ã‚ã‚‹ã€‚ã“ã®ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã€ç¾åœ¨ã®ã‚³ãƒ³ãƒ†ãƒŠã®æ©Ÿèƒ½ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãªãæ‹¡å¼µã—å¼·åŒ–ã™ã‚‹ã€‚ç¾åœ¨ã€ç§ãŸã¡ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒã©ã“ã§ã‚‚å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã¹ã¦ã®ä¾å­˜é–¢ä¿‚ã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹ãŸã‚ã«ã‚³ãƒ³ãƒ†ãƒŠæŠ€è¡“ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã“ã¨ã‚’çŸ¥ã£ã¦ã„ã‚‹ã€‚ã‚³ãƒ³ãƒ†ãƒŠã¯1ã¤ã®ã“ã¨ã ã‘ã‚’è¡Œã„ã€ãã®ã“ã¨ã‚’éå¸¸ã«ã†ã¾ãè¡Œã†ã€‚
- **ãƒã‚¹ã‚¿ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹:**
- **Api Server:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ãƒãƒƒãƒ‰ãŒãƒã‚¹ã‚¿ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã¨é€šä¿¡ã™ã‚‹ãŸã‚ã®æ–¹æ³•ã§ã‚ã‚‹ã€‚èªè¨¼ã•ã‚ŒãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã¿ãŒè¨±å¯ã•ã‚Œã‚‹ã¹ãã§ã‚ã‚‹ã€‚
- **ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©**: ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã¯ã€ãƒãƒƒãƒ‰ãŒãƒãƒ¼ãƒ‰ã«ãƒãƒƒãƒã™ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã‚’æŒ‡ã™ã€‚KubeletãŒãã‚Œã‚‰ã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚ã©ã®ãƒãƒ¼ãƒ‰ãŒã‚ˆã‚Šå¤šãã®ãƒªã‚½ãƒ¼ã‚¹ã‚’åˆ©ç”¨å¯èƒ½ã‹ã‚’æ±ºå®šã™ã‚‹ãŸã‚ã®ååˆ†ãªçŸ¥æ€§ã‚’æŒã£ã¦ãŠã‚Šã€æ–°ã—ã„ãƒãƒƒãƒ‰ã‚’ãã‚Œã«å‰²ã‚Šå½“ã¦ã‚‹ã€‚ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ã¯æ–°ã—ã„ãƒãƒƒãƒ‰ã‚’é–‹å§‹ã™ã‚‹ã®ã§ã¯ãªãã€ãƒãƒ¼ãƒ‰å†…ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹Kubeletãƒ—ãƒ­ã‚»ã‚¹ã¨é€šä¿¡ã—ã€æ–°ã—ã„ãƒãƒƒãƒ‰ã‚’èµ·å‹•ã™ã‚‹ã€‚
- **Kube Controller manager**: ãƒ¬ãƒ—ãƒªã‚«ã‚»ãƒƒãƒˆã‚„ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãªã©ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€ä¾‹ãˆã°ã€æ­£ã—ã„æ•°ã®ãƒãƒƒãƒ‰ã‚„ãƒãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ã€‚ãƒãƒƒãƒ‰ãŒæ¬ ã‘ã¦ã„ã‚‹å ´åˆã€æ–°ã—ã„ãƒãƒƒãƒ‰ã‚’é–‹å§‹ã™ã‚‹ãŸã‚ã«ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ã¨é€šä¿¡ã™ã‚‹ã€‚APIã¸ã®ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒˆãƒ¼ã‚¯ãƒ³ã€ãŠã‚ˆã³ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ¶å¾¡ã™ã‚‹ã€‚
- **etcd**: ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã€æ°¸ç¶šçš„ã€ä¸€è²«æ€§ãŒã‚ã‚Šã€åˆ†æ•£å‹ã€‚Kubernetesã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã‚ã‚Šã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®å®Œå…¨ãªçŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹ã‚­ãƒ¼-ãƒãƒªãƒ¥ãƒ¼ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆå„å¤‰æ›´ã¯ã“ã“ã«è¨˜éŒ²ã•ã‚Œã‚‹ï¼‰ã€‚ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ã‚„ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãªã©ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€ã©ã®å¤‰æ›´ãŒç™ºç”Ÿã—ãŸã‹ã‚’çŸ¥ã‚‹ãŸã‚ã«ã“ã®ãƒ‡ãƒ¼ã‚¿ã«ä¾å­˜ã™ã‚‹ï¼ˆãƒãƒ¼ãƒ‰ã®åˆ©ç”¨å¯èƒ½ãªãƒªã‚½ãƒ¼ã‚¹ã€å®Ÿè¡Œä¸­ã®ãƒãƒƒãƒ‰ã®æ•°...ï¼‰ã€‚
- **Cloud controller manager**: ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚ã®ç‰¹å®šã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã§ã‚ã‚‹ã€‚ã¤ã¾ã‚Šã€AWSã‚„OpenStackã«ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãŒã‚ã‚‹å ´åˆã€‚

ãƒãƒ¼ãƒ‰ãŒè¤‡æ•°ï¼ˆè¤‡æ•°ã®ãƒãƒƒãƒ‰ã‚’å®Ÿè¡Œï¼‰ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€Apiã‚µãƒ¼ãƒãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒè² è·åˆ†æ•£ã•ã‚Œã€etcdãŒåŒæœŸã•ã‚Œã‚‹è¤‡æ•°ã®ãƒã‚¹ã‚¿ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ãŒå­˜åœ¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

**ãƒœãƒªãƒ¥ãƒ¼ãƒ :**

ãƒãƒƒãƒ‰ãŒãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã€ãã‚ŒãŒãƒãƒƒãƒ‰ãŒæ¶ˆãˆã‚‹ã¨ãã«å¤±ã‚ã‚Œã‚‹ã¹ãã§ãªã„å ´åˆã€ãã‚Œã¯ç‰©ç†ãƒœãƒªãƒ¥ãƒ¼ãƒ ã«ä¿å­˜ã•ã‚Œã‚‹ã¹ãã§ã‚ã‚‹ã€‚**Kubernetesã¯ãƒ‡ãƒ¼ã‚¿ã‚’æ°¸ç¶šåŒ–ã™ã‚‹ãŸã‚ã«ãƒãƒƒãƒ‰ã«ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ã“ã¨ã‚’è¨±å¯ã™ã‚‹**ã€‚ãƒœãƒªãƒ¥ãƒ¼ãƒ ã¯ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ã¾ãŸã¯**ãƒªãƒ¢ãƒ¼ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**ã«å­˜åœ¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚ç•°ãªã‚‹ç‰©ç†ãƒãƒ¼ãƒ‰ã§ãƒãƒƒãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹å ´åˆã€ã™ã¹ã¦ã®ãƒãƒƒãƒ‰ãŒã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãƒªãƒ¢ãƒ¼ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ã¹ãã§ã‚ã‚‹ã€‚

**ãã®ä»–ã®æ§‹æˆ:**

- **ConfigMap**: ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®**URL**ã‚’æ§‹æˆã§ãã‚‹ã€‚ãƒãƒƒãƒ‰ã¯ã“ã“ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã€ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆãƒãƒƒãƒ‰ï¼‰ã¨é€šä¿¡ã™ã‚‹æ–¹æ³•ã‚’çŸ¥ã‚‹ã€‚ã“ã‚Œã¯è³‡æ ¼æƒ…å ±ã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã®æ¨å¥¨å ´æ‰€ã§ã¯ãªã„ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ï¼
- **Secret**: ã“ã‚Œã¯**ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€APIã‚­ãƒ¼...**ãªã©ã®ç§˜å¯†ãƒ‡ãƒ¼ã‚¿ã‚’B64ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã¦**ä¿å­˜ã™ã‚‹å ´æ‰€**ã§ã‚ã‚‹ã€‚ãƒãƒƒãƒ‰ã¯å¿…è¦ãªè³‡æ ¼æƒ…å ±ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«ã“ã®ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã€‚
- **Deployments**: ã“ã‚Œã¯Kubernetesã«ã‚ˆã£ã¦å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒç¤ºã•ã‚Œã‚‹å ´æ‰€ã§ã‚ã‚‹ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯é€šå¸¸ãƒãƒƒãƒ‰ã¨ç›´æ¥ä½œæ¥­ã—ãªã„ã€‚ãƒãƒƒãƒ‰ã¯**ReplicaSets**ï¼ˆè¤‡è£½ã•ã‚ŒãŸåŒã˜ãƒãƒƒãƒ‰ã®æ•°ï¼‰ã§æŠ½è±¡åŒ–ã•ã‚Œã€ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’ä»‹ã—ã¦å®Ÿè¡Œã•ã‚Œã‚‹ã€‚ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã¯**ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹**ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚ã®ã‚‚ã®ã§ã‚ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã®æœ€å°æ§‹æˆã¯ã€åå‰ã¨å®Ÿè¡Œã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã‚ã‚‹ã€‚
- **StatefulSet**: ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**ã®ã‚ˆã†ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å°‚ç”¨ã§ã‚ã‚Šã€**åŒã˜ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚‹**ã€‚
- **Ingress**: ã“ã‚Œã¯**ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’URLã§å…¬é–‹ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹æ§‹æˆ**ã§ã‚ã‚‹ã€‚ã“ã‚Œã¯å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ç”¨ã—ã¦ã‚‚è¡Œã†ã“ã¨ãŒã§ãã‚‹ãŒã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å…¬é–‹ã™ã‚‹ãŸã‚ã®æ­£ã—ã„æ–¹æ³•ã§ã‚ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
- Ingressã‚’å®Ÿè£…ã™ã‚‹å ´åˆã€**Ingress Controllers**ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚Ingressã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚Šã€ãƒã‚§ãƒƒã‚¯ã—ã€ã‚µãƒ¼ãƒ“ã‚¹ã«è² è·åˆ†æ•£ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ãªã‚‹**ãƒãƒƒãƒ‰**ã§ã‚ã‚‹ã€‚Ingressã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã¯**æ§‹æˆã•ã‚ŒãŸIngressãƒ«ãƒ¼ãƒ«ã«åŸºã¥ã„ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹**ã€‚Ingressãƒ«ãƒ¼ãƒ«ã¯ã€ç•°ãªã‚‹ãƒ‘ã‚¹ã‚„ç•°ãªã‚‹å†…éƒ¨Kubernetesã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’æŒ‡ã™ã“ã¨ãŒã§ãã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
- ã‚ˆã‚Šè‰¯ã„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¯ã€Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ã©ã®éƒ¨åˆ†ã‚‚å…¬é–‹ã—ãªã„ã‚ˆã†ã«ã€ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã¾ãŸã¯ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã‚ã‚‹ã€‚
- ã©ã®Ingressãƒ«ãƒ¼ãƒ«ã«ã‚‚ä¸€è‡´ã—ãªã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå—ä¿¡ã•ã‚Œã‚‹ã¨ã€Ingressã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã¯ãã‚Œã‚’ã€Œ**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**ã€ã«å‘ã‘ã‚‹ã€‚`describe`ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦Ingressã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ã“ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã§ãã‚‹ã€‚
- `minikube addons enable ingress`

### PKIã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ - è¨¼æ˜æ›¸æ©Ÿé–¢CA:

![](https://sickrov.github.io/media/Screenshot-66.jpg)

- CAã¯ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å†…ã®ã™ã¹ã¦ã®è¨¼æ˜æ›¸ã®ä¿¡é ¼ã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆã§ã‚ã‚‹ã€‚
- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒäº’ã„ã«æ¤œè¨¼ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚
- ã™ã¹ã¦ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼è¨¼æ˜æ›¸ã¯CAã«ã‚ˆã£ã¦ç½²åã•ã‚Œã‚‹ã€‚
- etcdã¯ç‹¬è‡ªã®è¨¼æ˜æ›¸ã‚’æŒã¤ã€‚
- ã‚¿ã‚¤ãƒ—:
- apiserverè¨¼æ˜æ›¸ã€‚
- kubeletè¨¼æ˜æ›¸ã€‚
- ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©è¨¼æ˜æ›¸ã€‚

## åŸºæœ¬çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### Minikube

**Minikube**ã¯ã€å®Œå…¨ãªKubernetesç’°å¢ƒã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ãªãã€Kubernetesä¸Šã§ã„ãã¤ã‹ã®**ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ**ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã‚‹ã€‚**ãƒã‚¹ã‚¿ãƒ¼ã¨ãƒãƒ¼ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ã‚’1å°ã®ãƒã‚·ãƒ³ã§å®Ÿè¡Œã™ã‚‹**ã€‚Minikubeã¯ãƒãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«VirtualBoxã‚’ä½¿ç”¨ã™ã‚‹ã€‚ [**ã“ã¡ã‚‰ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã‚’ç¢ºèªã—ã¦ãã ã•ã„**](https://minikube.sigs.k8s.io/docs/start/)ã€‚
```
$ minikube start
ğŸ˜„  minikube v1.19.0 on Ubuntu 20.04
âœ¨  Automatically selected the virtualbox driver. Other choices: none, ssh
ğŸ’¿  Downloading VM boot image ...
> minikube-v1.19.0.iso.sha256: 65 B / 65 B [-------------] 100.00% ? p/s 0s
> minikube-v1.19.0.iso: 244.49 MiB / 244.49 MiB  100.00% 1.78 MiB p/s 2m17.
ğŸ‘  Starting control plane node minikube in cluster minikube
ğŸ’¾  Downloading Kubernetes v1.20.2 preload ...
> preloaded-images-k8s-v10-v1...: 491.71 MiB / 491.71 MiB  100.00% 2.59 MiB
ğŸ”¥  Creating virtualbox VM (CPUs=2, Memory=3900MB, Disk=20000MB) ...
ğŸ³  Preparing Kubernetes v1.20.2 on Docker 20.10.4 ...
â–ª Generating certificates and keys ...
â–ª Booting up control plane ...
â–ª Configuring RBAC rules ...
ğŸ”  Verifying Kubernetes components...
â–ª Using image gcr.io/k8s-minikube/storage-provisioner:v5
ğŸŒŸ  Enabled addons: storage-provisioner, default-storageclass
ğŸ„  Done! kubectl is now configured to use "minikube" cluster and "default" namespace by defaul

$ minikube status
host: Running
kubelet: Running
apiserver: Running
kubeconfig: Configured

---- ONCE YOU HAVE A K8 SERVICE RUNNING WITH AN EXTERNAL SERVICE -----
$ minikube service mongo-express-service
(This will open your browser to access the service exposed port)

$ minikube delete
ğŸ”¥  Deleting "minikube" in virtualbox ...
ğŸ’€  Removed all traces of the "minikube" cluster
```
### Kubectlã®åŸºæœ¬

**`Kubectl`** ã¯ã€kubernetesã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ç”¨ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ã“ã‚Œã¯ã€kuberneteså†…ã§ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ãŸã‚Šãƒ‡ãƒ¼ã‚¿ã‚’è¦æ±‚ã—ãŸã‚Šã™ã‚‹ãŸã‚ã«ã€ãƒã‚¹ã‚¿ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã®Apiã‚µãƒ¼ãƒãƒ¼ã¨é€šä¿¡ã—ã¾ã™ã€‚
```bash
kubectl version #Get client and server version
kubectl get pod
kubectl get services
kubectl get deployment
kubectl get replicaset
kubectl get secret
kubectl get all
kubectl get ingress
kubectl get endpoints

#kubectl create deployment <deployment-name> --image=<docker image>
kubectl create deployment nginx-deployment --image=nginx
#Access the configuration of the deployment and modify it
#kubectl edit deployment <deployment-name>
kubectl edit deployment nginx-deployment
#Get the logs of the pod for debbugging (the output of the docker container running)
#kubectl logs <replicaset-id/pod-id>
kubectl logs nginx-deployment-84cd76b964
#kubectl describe pod <pod-id>
kubectl describe pod mongo-depl-5fd6b7d4b4-kkt9q
#kubectl exec -it <pod-id> -- bash
kubectl exec -it mongo-depl-5fd6b7d4b4-kkt9q -- bash
#kubectl describe service <service-name>
kubectl describe service mongodb-service
#kubectl delete deployment <deployment-name>
kubectl delete deployment mongo-depl
#Deploy from config file
kubectl apply -f deployment.yml
```
### Minikube ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€minikube ãŒä½•ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ã‹ã‚’ã‚ˆã‚Šç°¡å˜ã«ç¢ºèªã§ãã¾ã™ã€‚ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã® URL ã¯æ¬¡ã®å ´æ‰€ã«ã‚ã‚Šã¾ã™:
```
minikube dashboard --url


ğŸ”Œ  Enabling dashboard ...
â–ª Using image kubernetesui/dashboard:v2.3.1
â–ª Using image kubernetesui/metrics-scraper:v1.0.7
ğŸ¤”  Verifying dashboard health ...
ğŸš€  Launching proxy ...
ğŸ¤”  Verifying proxy health ...
http://127.0.0.1:50034/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/
```
### YAMLæ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾‹

å„æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯3ã¤ã®éƒ¨åˆ†ãŒã‚ã‚Šã¾ã™: **metadata**ã€**specification**ï¼ˆèµ·å‹•ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‚‚ã®ï¼‰ã€**status**ï¼ˆæœ›ã¾ã—ã„çŠ¶æ…‹ï¼‰ã€‚\
ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä»•æ§˜ã®ä¸­ã«ã¯ã€å®Ÿè¡Œã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å®šç¾©ã™ã‚‹æ–°ã—ã„æ§‹æˆæ§‹é€ ã§å®šç¾©ã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã‚ã‚Šã¾ã™:

**åŒã˜æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã§å®£è¨€ã•ã‚ŒãŸDeployment + Serviceã®ä¾‹ï¼ˆ** [**ã“ã¡ã‚‰**](https://gitlab.com/nanuchi/youtube-tutorial-series/-/blob/master/demo-kubernetes-components/mongo.yaml)**ï¼‰**

ã‚µãƒ¼ãƒ“ã‚¹ã¯é€šå¸¸1ã¤ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã«é–¢é€£ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹ãŸã‚ã€åŒã˜æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã§ä¸¡æ–¹ã‚’å®£è¨€ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ï¼ˆã“ã®æ§‹æˆã§å®£è¨€ã•ã‚ŒãŸã‚µãƒ¼ãƒ“ã‚¹ã¯å†…éƒ¨ã‹ã‚‰ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ï¼‰ï¼š
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
name: mongodb-deployment
labels:
app: mongodb
spec:
replicas: 1
selector:
matchLabels:
app: mongodb
template:
metadata:
labels:
app: mongodb
spec:
containers:
- name: mongodb
image: mongo
ports:
- containerPort: 27017
env:
- name: MONGO_INITDB_ROOT_USERNAME
valueFrom:
secretKeyRef:
name: mongodb-secret
key: mongo-root-username
- name: MONGO_INITDB_ROOT_PASSWORD
valueFrom:
secretKeyRef:
name: mongodb-secret
key: mongo-root-password
---
apiVersion: v1
kind: Service
metadata:
name: mongodb-service
spec:
selector:
app: mongodb
ports:
- protocol: TCP
port: 27017
targetPort: 27017
```
**å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹æ§‹æˆã®ä¾‹**

ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã¯å¤–éƒ¨ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ï¼ˆ`nodePort` ã¨ `type: LoadBlancer` å±æ€§ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼‰ï¼š
```yaml
---
apiVersion: v1
kind: Service
metadata:
name: mongo-express-service
spec:
selector:
app: mongo-express
type: LoadBalancer
ports:
- protocol: TCP
port: 8081
targetPort: 8081
nodePort: 30000
```
> [!NOTE]
> ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆã«å½¹ç«‹ã¡ã¾ã™ãŒã€æœ¬ç•ªç’°å¢ƒã§ã¯å†…éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã®ã¿ã‚’æŒã¡ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å…¬é–‹ã™ã‚‹ãŸã‚ã«Ingressã‚’ä½¿ç”¨ã™ã‚‹ã¹ãã§ã™ã€‚

**Ingressæ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾‹**

ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒ`http://dashboard.com`ã§å…¬é–‹ã•ã‚Œã¾ã™ã€‚
```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
name: dashboard-ingress
namespace: kubernetes-dashboard
spec:
rules:
- host: dashboard.com
http:
paths:
- backend:
serviceName: kubernetes-dashboard
servicePort: 80
```
**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾‹**

ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒB64ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ï¼ˆã“ã‚Œã¯å®‰å…¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ï¼‰
```yaml
apiVersion: v1
kind: Secret
metadata:
name: mongodb-secret
type: Opaque
data:
mongo-root-username: dXNlcm5hbWU=
mongo-root-password: cGFzc3dvcmQ=
```
**ConfigMapã®ä¾‹**

**ConfigMap**ã¯ã€ãƒãƒƒãƒ‰ã«æä¾›ã•ã‚Œã‚‹è¨­å®šã§ã‚ã‚Šã€ãƒãƒƒãƒ‰ãŒä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ã©ã®ã‚ˆã†ã«è¦‹ã¤ã‘ã¦ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã‹ã‚’çŸ¥ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚ã“ã®å ´åˆã€å„ãƒãƒƒãƒ‰ã¯ã€`mongodb-service`ã¨ã„ã†åå‰ãŒã€é€šä¿¡ã§ãã‚‹ãƒãƒƒãƒ‰ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã‚ã‚‹ã“ã¨ã‚’çŸ¥ã‚Šã¾ã™ï¼ˆã“ã®ãƒãƒƒãƒ‰ã¯mongodbã‚’å®Ÿè¡Œã—ã¾ã™ï¼‰ï¼š
```yaml
apiVersion: v1
kind: ConfigMap
metadata:
name: mongodb-configmap
data:
database_url: mongodb-service
```
æ¬¡ã«ã€**deployment config**å†…ã§ã€ã“ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯æ¬¡ã®ã‚ˆã†ã«æŒ‡å®šã§ãã€ãƒãƒƒãƒ‰ã®envå†…ã«ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ï¼š
```yaml
[...]
spec:
[...]
template:
[...]
spec:
containers:
- name: mongo-express
image: mongo-express
ports:
- containerPort: 8081
env:
- name: ME_CONFIG_MONGODB_SERVER
valueFrom:
configMapKeyRef:
name: mongodb-configmap
key: database_url
[...]
```
**ãƒœãƒªãƒ¥ãƒ¼ãƒ è¨­å®šã®ä¾‹**

ã•ã¾ã–ã¾ãªã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ§‹æˆã®yamlãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾‹ã¯ã€[https://gitlab.com/nanuchi/youtube-tutorial-series/-/tree/master/kubernetes-volumes](https://gitlab.com/nanuchi/youtube-tutorial-series/-/tree/master/kubernetes-volumes)ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\
**ãƒœãƒªãƒ¥ãƒ¼ãƒ ã¯åå‰ç©ºé–“ã®ä¸­ã«ã¯ã‚ã‚Šã¾ã›ã‚“**

### åå‰ç©ºé–“

Kubernetesã¯ã€åŒã˜ç‰©ç†ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã•ã‚ŒãŸ**è¤‡æ•°ã®ä»®æƒ³ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼**ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ä»®æƒ³ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¯**åå‰ç©ºé–“**ã¨å‘¼ã°ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€è¤‡æ•°ã®ãƒãƒ¼ãƒ ã‚„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¾ãŸãŒã‚‹å¤šãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã„ã‚‹ç’°å¢ƒã§ã®ä½¿ç”¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚æ•°äººã‹ã‚‰åæ•°äººã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã„ã‚‹ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã§ã¯ã€åå‰ç©ºé–“ã‚’ä½œæˆã—ãŸã‚Šè€ƒãˆãŸã‚Šã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚Kubernetesã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å„éƒ¨åˆ†ã‚’ã‚ˆã‚Šè‰¯ãåˆ¶å¾¡ã—ã€æ•´ç†ã™ã‚‹ãŸã‚ã«åå‰ç©ºé–“ã‚’ä½¿ç”¨ã—å§‹ã‚ã‚‹ã¹ãã§ã™ã€‚

åå‰ç©ºé–“ã¯åå‰ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’æä¾›ã—ã¾ã™ã€‚ãƒªã‚½ãƒ¼ã‚¹ã®åå‰ã¯åå‰ç©ºé–“å†…ã§ä¸€æ„ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€åå‰ç©ºé–“é–“ã§ã¯ä¸€æ„ã§ã‚ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚åå‰ç©ºé–“ã¯äº’ã„ã«ãƒã‚¹ãƒˆã™ã‚‹ã“ã¨ã¯ã§ããšã€**å„**Kubernetes **ãƒªã‚½ãƒ¼ã‚¹**ã¯**1ã¤ã®** **åå‰ç©ºé–“**ã®ä¸­ã«ã®ã¿å­˜åœ¨ã§ãã¾ã™ã€‚

minikubeã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§4ã¤ã®åå‰ç©ºé–“ãŒã‚ã‚Šã¾ã™ï¼š
```
kubectl get namespace
NAME              STATUS   AGE
default           Active   1d
kube-node-lease   Active   1d
kube-public       Active   1d
kube-system       Active   1d
```
- **kube-system**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½¿ç”¨ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã¯ãªãã€è§¦ã‚Œã‚‹ã¹ãã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒã‚¹ã‚¿ãƒ¼ã¨kubectlãƒ—ãƒ­ã‚»ã‚¹ã®ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚
- **kube-public**: å…¬é–‹ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ã€‚ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æƒ…å ±ã‚’å«ã‚€configmapãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚
- **kube-node-lease**: ãƒãƒ¼ãƒ‰ã®å¯ç”¨æ€§ã‚’æ±ºå®šã—ã¾ã™ã€‚
- **default**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹åå‰ç©ºé–“ã§ã™ã€‚
```bash
#Create namespace
kubectl create namespace my-namespace
```
> [!NOTE]
> æ³¨æ„ã™ã¹ãã¯ã€ã»ã¨ã‚“ã©ã®Kubernetesãƒªã‚½ãƒ¼ã‚¹ï¼ˆä¾‹ï¼šãƒãƒƒãƒ‰ã€ã‚µãƒ¼ãƒ“ã‚¹ã€ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãªã©ï¼‰ã¯ã€ã„ãã¤ã‹ã®ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã«å­˜åœ¨ã—ã¾ã™ã€‚ã—ã‹ã—ã€ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ãƒªã‚½ãƒ¼ã‚¹ã‚„ãƒãƒ¼ãƒ‰ã€persistentVolumesãªã©ã®ä½ãƒ¬ãƒ™ãƒ«ãƒªã‚½ãƒ¼ã‚¹ã¯ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã«å­˜åœ¨ã—ã¾ã›ã‚“ã€‚ã©ã®Kubernetesãƒªã‚½ãƒ¼ã‚¹ãŒãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã«ã‚ã‚Šã€ã©ã‚ŒãŒãªã„ã‹ã‚’ç¢ºèªã™ã‚‹ã«ã¯ï¼š
>
> ```bash
> kubectl api-resources --namespaced=true #ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹å†…
> kubectl api-resources --namespaced=false #ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹å¤–
> ```

ãã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå†…ã§ã€ã™ã¹ã¦ã®å¾Œç¶šã®kubectlã‚³ãƒãƒ³ãƒ‰ã®ãŸã‚ã«ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã‚’ä¿å­˜ã§ãã¾ã™ã€‚
```bash
kubectl config set-context --current --namespace=<insert-namespace-name-here>
```
### Helm

Helmã¯Kubernetesã®**ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼**ã§ã™ã€‚YAMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã—ã€å…¬é–‹ãŠã‚ˆã³ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã§é…å¸ƒã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯**Helm Charts**ã¨å‘¼ã°ã‚Œã¾ã™ã€‚
```
helm search <keyword>
```
Helmã¯ã€å¤‰æ•°ã‚’ä½¿ç”¨ã—ã¦è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã§ã‚‚ã‚ã‚Šã¾ã™ã€‚

## Kubernetesã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ

**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ**ã¯ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€ãƒˆãƒ¼ã‚¯ãƒ³ã€ã¾ãŸã¯ã‚­ãƒ¼ãªã©ã®**æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚€**ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚ã“ã®ã‚ˆã†ãªæƒ…å ±ã¯ã€Podä»•æ§˜ã‚„ã‚¤ãƒ¡ãƒ¼ã‚¸ã«è¨˜è¼‰ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½œæˆã§ãã€ã‚·ã‚¹ãƒ†ãƒ ã‚‚ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®åå‰ã¯ã€æœ‰åŠ¹ãª**DNSã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³å**ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚ã“ã¡ã‚‰ã§[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://kubernetes.io/docs/concepts/configuration/secret/)ã‚’ãŠèª­ã¿ãã ã•ã„ã€‚

ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚‚ã®ãŒã‚ã‚Šã¾ã™ï¼š

- APIã€SSHã‚­ãƒ¼ã€‚
- OAuthãƒˆãƒ¼ã‚¯ãƒ³ã€‚
- è³‡æ ¼æƒ…å ±ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¾ãŸã¯b64 + æš—å·åŒ–ï¼‰ã€‚
- æƒ…å ±ã‚„ã‚³ãƒ¡ãƒ³ãƒˆã€‚
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚³ãƒ¼ãƒ‰ã€æ–‡å­—åˆ—â€¦ ã€‚

Kubernetesã«ã¯ç•°ãªã‚‹ã‚¿ã‚¤ãƒ—ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒã‚ã‚Šã¾ã™ã€‚

| ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã‚¿ã‚¤ãƒ—                        | ä½¿ç”¨æ³•                                     |
| ----------------------------------- | ----------------------------------------- |
| **Opaque**                          | **ä»»æ„ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰** |
| kubernetes.io/service-account-token | ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒˆãƒ¼ã‚¯ãƒ³                     |
| kubernetes.io/dockercfg             | ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã•ã‚ŒãŸ\~/.dockercfgãƒ•ã‚¡ã‚¤ãƒ«             |
| kubernetes.io/dockerconfigjson      | ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã•ã‚ŒãŸ\~/.docker/config.jsonãƒ•ã‚¡ã‚¤ãƒ«    |
| kubernetes.io/basic-auth            | ãƒ™ãƒ¼ã‚·ãƒƒã‚¯èªè¨¼ã®ãŸã‚ã®è³‡æ ¼æƒ…å ±      |
| kubernetes.io/ssh-auth              | SSHèªè¨¼ã®ãŸã‚ã®è³‡æ ¼æƒ…å ±        |
| kubernetes.io/tls                   | TLSã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¾ãŸã¯ã‚µãƒ¼ãƒãƒ¼ã®ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿           |
| bootstrap.kubernetes.io/token       | ãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—ãƒˆãƒ¼ã‚¯ãƒ³ãƒ‡ãƒ¼ã‚¿                      |

> [!NOTE]
> **Opaqueã‚¿ã‚¤ãƒ—ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚ã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã£ã¦å®šç¾©ã•ã‚ŒãŸå…¸å‹çš„ãªã‚­ãƒ¼-ãƒãƒªãƒ¥ãƒ¼ãƒšã‚¢ã§ã™ã€‚**

**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®å‹•ä½œï¼š**

![](https://sickrov.github.io/media/Screenshot-164.jpg)

ä»¥ä¸‹ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€`mysecret`ã¨ã„ã†**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ**ã‚’å®šç¾©ã—ã€2ã¤ã®ã‚­ãƒ¼-ãƒãƒªãƒ¥ãƒ¼ãƒšã‚¢`username: YWRtaW4=`ã¨`password: MWYyZDFlMmU2N2Rm`ã‚’æŒã£ã¦ã„ã¾ã™ã€‚ã¾ãŸã€`mysecret`ã§å®šç¾©ã•ã‚ŒãŸ`username`ã¨`password`ãŒ**ç’°å¢ƒå¤‰æ•°**`SECRET_USERNAME` \_\_ ã¨ \_\_ `SECRET_PASSWOR`ã«å…¬é–‹ã•ã‚Œã‚‹`secretpod`ã¨ã„ã†**ãƒãƒƒãƒ‰**ã‚‚å®šç¾©ã—ã¦ã„ã¾ã™ã€‚ã•ã‚‰ã«ã€`mysecret`å†…ã®`username`ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’`/etc/foo/my-group/my-username`ã®ãƒ‘ã‚¹ã«`0640`ã®æ¨©é™ã§**ãƒã‚¦ãƒ³ãƒˆ**ã—ã¾ã™ã€‚
```yaml:secretpod.yaml
apiVersion: v1
kind: Secret
metadata:
name: mysecret
type: Opaque
data:
username: YWRtaW4=
password: MWYyZDFlMmU2N2Rm
---
apiVersion: v1
kind: Pod
metadata:
name: secretpod
spec:
containers:
- name: secretpod
image: nginx
env:
- name: SECRET_USERNAME
valueFrom:
secretKeyRef:
name: mysecret
key: username
- name: SECRET_PASSWORD
valueFrom:
secretKeyRef:
name: mysecret
key: password
volumeMounts:
- name: foo
mountPath: "/etc/foo"
restartPolicy: Never
volumes:
- name: foo
secret:
secretName: mysecret
items:
- key: username
path: my-group/my-username
mode: 0640
```

```bash
kubectl apply -f <secretpod.yaml>
kubectl get pods #Wait until the pod secretpod is running
kubectl exec -it  secretpod -- bash
env | grep SECRET && cat /etc/foo/my-group/my-username && echo
```
### Secrets in etcd <a href="#discover-secrets-in-etcd" id="discover-secrets-in-etcd"></a>

**etcd** ã¯ã€ã™ã¹ã¦ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®ãŸã‚ã® Kubernetes ãƒãƒƒã‚­ãƒ³ã‚°ã‚¹ãƒˆã‚¢ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã‚‹ã€ä¸€è²«æ€§ãŒã‚ã‚Šé«˜å¯ç”¨æ€§ã® **ã‚­ãƒ¼-ãƒãƒªãƒ¥ãƒ¼ã‚¹ãƒˆã‚¢** ã§ã™ã€‚etcd ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š
```bash
cat /etc/kubernetes/manifests/kube-apiserver.yaml | grep etcd
```
ã‚ãªãŸã¯ã€FSå†…ã«ã‚ã‚‹certsã€keysã€urlã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãã‚Œã‚’å–å¾—ã™ã‚‹ã¨ã€etcdã«æ¥ç¶šã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
```bash
#ETCDCTL_API=3 etcdctl --cert <path to client.crt> --key <path to client.ket> --cacert <path to CA.cert> endpoint=[<ip:port>] health

ETCDCTL_API=3 etcdctl --cert /etc/kubernetes/pki/apiserver-etcd-client.crt --key /etc/kubernetes/pki/apiserver-etcd-client.key --cacert /etc/kubernetes/pki/etcd/etcd/ca.cert endpoint=[127.0.0.1:1234] health
```
ä¸€åº¦é€šä¿¡ãŒç¢ºç«‹ã•ã‚Œã‚‹ã¨ã€ç§˜å¯†ã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š
```bash
#ETCDCTL_API=3 etcdctl --cert <path to client.crt> --key <path to client.ket> --cacert <path to CA.cert> endpoint=[<ip:port>] get <path/to/secret>

ETCDCTL_API=3 etcdctl --cert /etc/kubernetes/pki/apiserver-etcd-client.crt --key /etc/kubernetes/pki/apiserver-etcd-client.key --cacert /etc/kubernetes/pki/etcd/etcd/ca.cert endpoint=[127.0.0.1:1234] get /registry/secrets/default/secret_02
```
**ETCDã«æš—å·åŒ–ã‚’è¿½åŠ ã™ã‚‹**

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ã™ã¹ã¦ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯**ãƒ—ãƒ¬ãƒ¼ãƒ³**ãƒ†ã‚­ã‚¹ãƒˆã§etcdå†…ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚æš—å·åŒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’é©ç”¨ã—ãªã„é™ã‚Šã€‚ä»¥ä¸‹ã®ä¾‹ã¯[https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/](https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/)ã«åŸºã¥ã„ã¦ã„ã¾ã™ã€‚
```yaml:encryption.yaml
apiVersion: apiserver.config.k8s.io/v1
kind: EncryptionConfiguration
resources:
- resources:
- secrets
providers:
- aescbc:
keys:
- name: key1
secret: cjjPMcWpTPKhAdieVtd+KhG4NN+N6e3NmBPMXJvbfrY= #Any random key
- identity: {}
```
ãã®å¾Œã€ä½œæˆã—ãŸè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ã‚’æŒ‡ã™ã‚ˆã†ã«ã€`kube-apiserver`ã®`--encryption-provider-config`ãƒ•ãƒ©ã‚°ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚`/etc/kubernetes/manifest/kube-apiserver.yaml`ã‚’ä¿®æ­£ã—ã€ä»¥ä¸‹ã®è¡Œã‚’è¿½åŠ ã§ãã¾ã™ï¼š
```yaml
containers:
- command:
- kube-apiserver
- --encriyption-provider-config=/etc/kubernetes/etcd/<configFile.yaml>
```
ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒã‚¦ãƒ³ãƒˆå†…ã‚’ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ã—ã¾ã™:
```yaml
- mountPath: /etc/kubernetes/etcd
name: etcd
readOnly: true
```
volumeMountsã®hostPathã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¾ã™:
```yaml
- hostPath:
path: /etc/kubernetes/etcd
type: DirectoryOrCreate
name: etcd
```
**ãƒ‡ãƒ¼ã‚¿ãŒæš—å·åŒ–ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã®ç¢ºèª**

ãƒ‡ãƒ¼ã‚¿ã¯etcdã«æ›¸ãè¾¼ã¾ã‚Œã‚‹éš›ã«æš—å·åŒ–ã•ã‚Œã¾ã™ã€‚`kube-apiserver`ã‚’å†èµ·å‹•ã—ãŸå¾Œã€æ–°ã—ãä½œæˆã¾ãŸã¯æ›´æ–°ã•ã‚ŒãŸã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯ã€ä¿å­˜æ™‚ã«æš—å·åŒ–ã•ã‚Œã‚‹ã¹ãã§ã™ã€‚ç¢ºèªã™ã‚‹ã«ã¯ã€`etcdctl`ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½¿ç”¨ã—ã¦ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®å†…å®¹ã‚’å–å¾—ã§ãã¾ã™ã€‚

1.  `default`åå‰ç©ºé–“ã«`secret1`ã¨ã„ã†æ–°ã—ã„ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½œæˆã—ã¾ã™:

```
kubectl create secret generic secret1 -n default --from-literal=mykey=mydata
```

2.  etcdctlã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã€ãã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’etcdã‹ã‚‰èª­ã¿å–ã‚Šã¾ã™:

`ETCDCTL_API=3 etcdctl get /registry/secrets/default/secret1 [...] | hexdump -C`

ã“ã“ã§`[...]`ã¯etcdã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã™ã‚‹ãŸã‚ã®è¿½åŠ å¼•æ•°ã§ã™ã€‚

3.  ä¿å­˜ã•ã‚ŒãŸã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒ`k8s:enc:aescbc:v1:`ã§å§‹ã¾ã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚ã“ã‚Œã¯`aescbc`ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãŒçµæœã®ãƒ‡ãƒ¼ã‚¿ã‚’æš—å·åŒ–ã—ãŸã“ã¨ã‚’ç¤ºã—ã¾ã™ã€‚
4.  APIã‚’ä»‹ã—ã¦å–å¾—ã—ãŸã¨ãã«ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒæ­£ã—ãå¾©å·åŒ–ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™:

```
kubectl describe secret secret1 -n default
```

ã¯`mykey: bXlkYXRh`ã¨ä¸€è‡´ã™ã‚‹ã¹ãã§ã™ã€‚mydataã¯ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å®Œå…¨ã«å¾©å·åŒ–ã™ã‚‹ã«ã¯[ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®å¾©å·åŒ–](https://kubernetes.io/docs/concepts/configuration/secret#decoding-a-secret)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯æ›¸ãè¾¼ã¿æ™‚ã«æš—å·åŒ–ã•ã‚Œã‚‹ãŸã‚ã€ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®æ›´æ–°ã‚’è¡Œã†ã¨ãã®å†…å®¹ãŒæš—å·åŒ–ã•ã‚Œã¾ã™:**
```
kubectl get secrets --all-namespaces -o json | kubectl replace -f -
```
**æœ€çµ‚çš„ãªãƒ’ãƒ³ãƒˆ:**

- FSã«ç§˜å¯†ã‚’ä¿æŒã—ãªã„ã‚ˆã†ã«ã—ã€ä»–ã®å ´æ‰€ã‹ã‚‰å–å¾—ã—ã¦ãã ã•ã„ã€‚
- ã‚ãªãŸã®ç§˜å¯†ã«ã•ã‚‰ãªã‚‹ä¿è­·ã‚’è¿½åŠ ã™ã‚‹ãŸã‚ã«[https://www.vaultproject.io/](https://www.vaultproject.io)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
- [https://kubernetes.io/docs/concepts/configuration/secret/#risks](https://kubernetes.io/docs/concepts/configuration/secret/#risks)
- [https://docs.cyberark.com/Product-Doc/OnlineHelp/AAM-DAP/11.2/en/Content/Integrations/Kubernetes_deployApplicationsConjur-k8s-Secrets.htm](https://docs.cyberark.com/Product-Doc/OnlineHelp/AAM-DAP/11.2/en/Content/Integrations/Kubernetes_deployApplicationsConjur-k8s-Secrets.htm)

## å‚è€ƒæ–‡çŒ®

{{#ref}}
https://sickrov.github.io/
{{#endref}}

{{#ref}}
https://www.youtube.com/watch?v=X48VuDVv0do
{{#endref}}

{{#include ../../banners/hacktricks-training.md}}
