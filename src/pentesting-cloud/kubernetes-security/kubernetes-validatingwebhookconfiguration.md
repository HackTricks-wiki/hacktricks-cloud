# Kubernetes ValidatingWebhookConfiguration

**Bu sayfanın orijinal yazarı** [**Guillaume**](https://www.linkedin.com/in/guillaume-chapela-ab4b9a196)

## Tanım

ValidatingWebhookConfiguration, gelen Kubernetes API isteklerini önceden tanımlanmış bir dizi kural ve kısıtlamaya karşı doğrulayan sunucu tarafı bileşeni olan bir doğrulama webhook'unu tanımlayan bir Kubernetes kaynağıdır.

## Amaç

ValidatingWebhookConfiguration'ın amacı, gelen Kubernetes API istekleri üzerinde önceden tanımlanmış bir dizi kural ve kısıtlamayı uygulayacak bir doğrulama webhook'u tanımlamaktır. Webhook, istekleri yapılandırmada tanımlanan kurallara ve kısıtlamalara karşı doğrulayacak ve istek kurallara uymuyorsa bir hata döndürecektir.

**Örnek**

İşte bir ValidatingWebhookConfiguration örneği:
```yaml
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
name: example-validation-webhook
namespace: default
webhook:
name: example-validation-webhook
clientConfig:
url: https://example.com/webhook
serviceAccountName: example-service-account
rules:
- apiGroups:
- ""
apiVersions:
- "*"
operations:
- CREATE
- UPDATE
resources:
- pods
```
ValidatingWebhookConfiguration ile politikalar arasındaki ana fark :&#x20;

<figure><img src="../../images/Kyverno.png" alt=""><figcaption><p>Kyverno.png</p></figcaption></figure>

- **ValidatingWebhookConfiguration (VWC)** : Gelen Kubernetes API isteklerini önceden tanımlanmış bir dizi kural ve kısıtlamaya karşı doğrulayan, sunucu tarafı bileşeni olan bir doğrulama webhook'unu tanımlayan bir Kubernetes kaynağıdır.
- **Kyverno ClusterPolicy**: Podlar, dağıtımlar ve hizmetler gibi Kubernetes kaynaklarını doğrulamak ve uygulamak için bir dizi kural ve kısıtlama belirten bir politika tanımıdır.

## Enumeration
```
$ kubectl get ValidatingWebhookConfiguration
```
### Kyverno ve Gatekeeper VWC'yi Kötüye Kullanma

Gördüğümüz gibi, kurulu tüm operatörlerin en az bir ValidatingWebHookConfiguration (VWC) vardır.

**Kyverno** ve **Gatekeeper**, bir küme genelinde politikaları tanımlamak ve uygulamak için bir çerçeve sağlayan Kubernetes politika motorlarıdır.

İstisnalar, belirli kurallar veya koşulları ifade eder ve bu kurallar, bir politikanın belirli koşullar altında atlanmasına veya değiştirilmesine izin verir, ancak bu tek yol değildir!

**Kyverno** için, geçerli bir politika olduğunda, webhook `kyverno-resource-validating-webhook-cfg` doldurulur.

Gatekeeper için, `gatekeeper-validating-webhook-configuration` YAML dosyası vardır.

Her ikisi de varsayılan değerlerle gelir, ancak Yönetici ekipleri bu 2 dosyayı güncelleyebilir.

### Kullanım Durumu
```bash
$ kubectl get validatingwebhookconfiguration kyverno-resource-validating-webhook-cfg -o yaml
```
Şimdi aşağıdaki çıktıyı tanımlayın:
```yaml
namespaceSelector:
matchExpressions:
- key: kubernetes.io/metadata.name
operator: NotIn
values:
- default
- TEST
- YOYO
- kube-system
- MYAPP
```
Burada, `kubernetes.io/metadata.name` etiketi, namespace adını ifade eder. `values` listesindeki isimlere sahip namespace'ler politikadan hariç tutulacaktır:

Namespace'lerin varlığını kontrol edin. Bazen, otomasyon veya yanlış yapılandırma nedeniyle bazı namespace'ler oluşturulmamış olabilir. Namespace oluşturma izniniz varsa, `values` listesindeki bir isimle bir namespace oluşturabilir ve politikalar yeni namespace'inize uygulanmayacaktır.

Bu saldırının amacı, operatör kısıtlamalarını aşmak ve ardından diğer tekniklerle ayrıcalıklarınızı artırmak için VWC içindeki **yanlış yapılandırmayı** istismar etmektir.

{{#ref}}
abusing-roles-clusterroles-in-kubernetes/
{{#endref}}

## Referanslar

- [https://github.com/open-policy-agent/gatekeeper](https://github.com/open-policy-agent/gatekeeper)
- [https://kyverno.io/](https://kyverno.io/)
- [https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/](https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/)
