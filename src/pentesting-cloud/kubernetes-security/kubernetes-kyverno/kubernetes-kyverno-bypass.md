# Kubernetes Kyverno bypass

**O autor original desta página é** [**Guillaume**](https://www.linkedin.com/in/guillaume-chapela-ab4b9a196)

## Abusando da má configuração de políticas

### Enumerar regras

Ter uma visão geral pode ajudar a saber quais regras estão ativas, em qual modo e quem pode contorná-las.
```bash
$ kubectl get clusterpolicies
$ kubectl get policies
```
### Enumerate Excluded

Para cada ClusterPolicy e Policy, você pode especificar uma lista de entidades excluídas, incluindo:

- Grupos: `excludedGroups`
- Usuários: `excludedUsers`
- Contas de Serviço (SA): `excludedServiceAccounts`
- Funções: `excludedRoles`
- Funções de Cluster: `excludedClusterRoles`

Essas entidades excluídas estarão isentas dos requisitos da política, e o Kyverno não aplicará a política para elas.

## Example&#x20;

Vamos explorar um exemplo de clusterpolicy :&#x20;
```
$ kubectl get clusterpolicies MYPOLICY -o yaml
```
Procure as entidades excluídas :&#x20;
```yaml
exclude:
any:
- clusterRoles:
- cluster-admin
- subjects:
- kind: User
name: system:serviceaccount:DUMMYNAMESPACE:admin
- kind: User
name: system:serviceaccount:TEST:thisisatest
- kind: User
name: system:serviceaccount:AHAH:*
```
Dentro de um cluster, numerosos componentes, operadores e aplicações adicionados podem necessitar de exclusão de uma política de cluster. No entanto, isso pode ser explorado visando entidades privilegiadas. Em alguns casos, pode parecer que um namespace não existe ou que você não tem permissão para se passar por um usuário, o que pode ser um sinal de má configuração.

## Abusando ValidatingWebhookConfiguration

Outra maneira de contornar políticas é focar no recurso ValidatingWebhookConfiguration :&#x20;

{{#ref}}
../kubernetes-validatingwebhookconfiguration.md
{{#endref}}
