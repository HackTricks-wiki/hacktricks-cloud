# Kubernetes OPA Gatekeeper bypass

**Bu sayfanın orijinal yazarı** [**Guillaume**](https://www.linkedin.com/in/guillaume-chapela-ab4b9a196)

## Yanlış yapılandırmayı istismar etme

### Kuralları listeleme

Aktif olan kuralların, hangi modda olduklarının ve kimin bunları atlayabileceğini bilmek için bir genel bakışa sahip olmak faydalı olabilir.

#### CLI ile
```bash
$ kubectl api-resources | grep gatekeeper
k8smandatoryannotations                                                             constraints.gatekeeper.sh/v1beta1                  false        K8sMandatoryAnnotations
k8smandatorylabels                                                                  constraints.gatekeeper.sh/v1beta1                  false        K8sMandatoryLabel
constrainttemplates                                                                 templates.gatekeeper.sh/v1                         false        ConstraintTemplate
```
**ConstraintTemplate** ve **Constraint**, Kubernetes kaynakları üzerinde kuralları uygulamak için Open Policy Agent (OPA) Gatekeeper'da kullanılabilir.
```bash
$ kubectl get constrainttemplates
$ kubectl get k8smandatorylabels
```
#### GUI ile

**Gatekeeper Policy Manager** ile OPA kurallarına erişmek için bir Grafik Kullanıcı Arayüzü de mevcut olabilir. Bu, "Kubernetes Kümesi'ndeki OPA Gatekeeper politikalarının durumunu görüntülemek için basit bir _salt okunur_ web UI'dır."

<figure><img src="../../../images/05-constraints.png" alt=""><figcaption></figcaption></figure>

Açık hizmeti arayın:
```bash
$ kubectl get services -A | grep gatekeeper
$ kubectl get services -A | grep 'gatekeeper-policy-manager-system'
```
### Hariç tutulan ad alanları

Yukarıdaki resimde gösterildiği gibi, belirli kurallar tüm ad alanları veya kullanıcılar üzerinde evrensel olarak uygulanmayabilir. Bunun yerine, beyaz listeye dayalı olarak çalışırlar. Örneğin, `liveness-probe` kısıtlaması, belirtilen beş ad alanına uygulanmaktan hariç tutulmuştur.

### Bypass

Gatekeeper yapılandırmasının kapsamlı bir incelemesi ile, ayrıcalık kazanmak için istismar edilebilecek potansiyel yanlış yapılandırmalar belirlenebilir. Kuralın uygulanmadığı beyaz listeye alınmış veya hariç tutulmuş ad alanlarını arayın ve ardından saldırınızı burada gerçekleştirin.

{{#ref}}
../abusing-roles-clusterroles-in-kubernetes/
{{#endref}}

## ValidatingWebhookConfiguration'ı istismar etme

Kısıtlamaları aşmanın bir diğer yolu, ValidatingWebhookConfiguration kaynağına odaklanmaktır :&#x20;

{{#ref}}
../kubernetes-validatingwebhookconfiguration.md
{{#endref}}

## Referanslar

- [https://github.com/open-policy-agent/gatekeeper](https://github.com/open-policy-agent/gatekeeper)
- [https://github.com/sighupio/gatekeeper-policy-manager](https://github.com/sighupio/gatekeeper-policy-manager)
