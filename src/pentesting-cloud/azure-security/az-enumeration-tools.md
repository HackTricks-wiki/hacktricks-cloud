# Az - Narzędzia do enumeracji

{{#include ../../banners/hacktricks-training.md}}

## Zainstaluj PowerShell w Linuxie

> [!TIP]
> W Linuxie musisz zainstalować PowerShell Core:
>
> ```bash
> sudo apt-get update
> sudo apt-get install -y wget apt-transport-https software-properties-common
>
> # Ubuntu 20.04
> wget -q https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb
>
> # Zaktualizuj repozytoria
> sudo apt-get update
> sudo add-apt-repository universe
>
> # Zainstaluj i uruchom powershell
> sudo apt-get install -y powershell
> pwsh
>
> # Az cli
> curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
> ```

## Zainstaluj PowerShell w MacOS

Instrukcje z [**dokumentacji**](https://learn.microsoft.com/en-us/powershell/scripting/install/installing-powershell-on-macos?view=powershell-7.4):

1. Zainstaluj `brew`, jeśli jeszcze nie jest zainstalowane:
```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```
2. Zainstaluj najnowszą stabilną wersję PowerShell:
```sh
brew install powershell/tap/powershell
```
3. Uruchom PowerShell:
```sh
pwsh
```
4. Aktualizacja:
```sh
brew update
brew upgrade powershell
```
## Główne narzędzia do enumeracji

### az cli

[**Azure Command-Line Interface (CLI)**](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli) to narzędzie wieloplatformowe napisane w Pythonie do zarządzania i administrowania (większością) zasobów Azure i Entra ID. Łączy się z Azure i wykonuje polecenia administracyjne za pomocą wiersza poleceń lub skryptów.

Postępuj zgodnie z tym linkiem, aby uzyskać [**instrukcje instalacji¡**](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli#install).

Polecenia w Azure CLI są zbudowane według wzoru: `az <service> <action> <parameters>`

#### Debug | MitM az cli

Używając parametru **`--debug`**, możliwe jest zobaczenie wszystkich żądań, które narzędzie **`az`** wysyła:
```bash
az account management-group list --output table --debug
```
Aby przeprowadzić **MitM** na narzędziu i **ręcznie sprawdzić wszystkie żądania**, które wysyła, możesz zrobić: 

{{#tabs }}
{{#tab name="Bash" }}
```bash
export ADAL_PYTHON_SSL_NO_VERIFY=1
export AZURE_CLI_DISABLE_CONNECTION_VERIFICATION=1
export HTTPS_PROXY="http://127.0.0.1:8080"
export HTTP_PROXY="http://127.0.0.1:8080"

# If this is not enough
# Download the certificate from Burp and convert it into .pem format
# And export the following env variable
openssl x509 -in ~/Downloads/cacert.der -inform DER -out ~/Downloads/cacert.pem -outform PEM
export REQUESTS_CA_BUNDLE=/Users/user/Downloads/cacert.pem
```
{{#endtab }}

{{#tab name="PS" }}
```bash
$env:ADAL_PYTHON_SSL_NO_VERIFY=1
$env:AZURE_CLI_DISABLE_CONNECTION_VERIFICATION=1
$env:HTTPS_PROXY="http://127.0.0.1:8080"
$env:HTTP_PROXY="http://127.0.0.1:8080"
```
{{#endtab }}
{{#endtabs }}

### Az PowerShell

Azure PowerShell to moduł z cmdletami do zarządzania zasobami Azure bezpośrednio z linii poleceń PowerShell.

Follow this link for the [**installation instructions**](https://learn.microsoft.com/en-us/powershell/azure/install-azure-powershell).

Commands in Azure PowerShell AZ Module are structured like: `<Action>-Az<Service> <parameters>`

#### Debug | MitM Az PowerShell

Using the parameter **`-Debug`** it's possible to see all the requests the tool is sending:
```bash
Get-AzResourceGroup -Debug
```
Aby przeprowadzić **MitM** na narzędziu i **ręcznie sprawdzić wszystkie żądania**, które wysyła, możesz ustawić zmienne środowiskowe `HTTPS_PROXY` i `HTTP_PROXY` zgodnie z [**dokumentacją**](https://learn.microsoft.com/en-us/powershell/azure/az-powershell-proxy).

### Microsoft Graph PowerShell

Microsoft Graph PowerShell to wieloplatformowe SDK, które umożliwia dostęp do wszystkich interfejsów API Microsoft Graph, w tym usług takich jak SharePoint, Exchange i Outlook, za pomocą jednego punktu końcowego. Obsługuje PowerShell 7+, nowoczesne uwierzytelnianie za pomocą MSAL, tożsamości zewnętrzne i zaawansowane zapytania. Skupiając się na dostępie z minimalnymi uprawnieniami, zapewnia bezpieczne operacje i regularnie otrzymuje aktualizacje, aby dostosować się do najnowszych funkcji interfejsu API Microsoft Graph.

Postępuj zgodnie z tym linkiem, aby uzyskać [**instrukcje instalacji**](https://learn.microsoft.com/en-us/powershell/microsoftgraph/installation).

Polecenia w Microsoft Graph PowerShell są zbudowane w następujący sposób: `<Action>-Mg<Service> <parameters>`

#### Debugowanie Microsoft Graph PowerShell

Używając parametru **`-Debug`**, możliwe jest zobaczenie wszystkich żądań, które narzędzie wysyła:
```bash
Get-MgUser -Debug
```
### ~~**AzureAD Powershell**~~

Moduł Azure Active Directory (AD), obecnie **wycofany**, jest częścią Azure PowerShell do zarządzania zasobami Azure AD. Oferuje cmdlety do zadań takich jak zarządzanie użytkownikami, grupami i rejestracjami aplikacji w Entra ID.

> [!TIP]
> Został zastąpiony przez Microsoft Graph PowerShell

Follow this link for the [**installation instructions**](https://www.powershellgallery.com/packages/AzureAD).
