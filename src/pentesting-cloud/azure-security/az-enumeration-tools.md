# Az - Enumeration Tools

{{#include ../../banners/hacktricks-training.md}}

## Linux'te PowerShell Kurulumu

> [!TIP]
> Linux'ta PowerShell Core'u kurmanız gerekecek:
```bash
sudo apt-get update
sudo apt-get install -y wget apt-transport-https software-properties-common

# Ubuntu 20.04
wget -q https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb

# Update repos
sudo apt-get update
sudo add-apt-repository universe

# Install & start powershell
sudo apt-get install -y powershell
pwsh

# Az cli
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
```
## MacOS'ta PowerShell Kurulumu

[**belgeler**](https://learn.microsoft.com/en-us/powershell/scripting/install/installing-powershell-on-macos?view=powershell-7.4)den talimatlar:

1. Henüz kurulmadıysa `brew`'ü kurun:
```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```
2. En son kararlı PowerShell sürümünü yükleyin:
```sh
brew install powershell/tap/powershell
```
3. PowerShell'i Çalıştır:
```sh
pwsh
```
4. Güncelleme:
```sh
brew update
brew upgrade powershell
```
## Ana Enumeration Araçları

### az cli

[**Azure Komut Satırı Arayüzü (CLI)**](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli), Azure ve Entra ID kaynaklarını yönetmek ve idare etmek için Python ile yazılmış çok platformlu bir araçtır. Azure'a bağlanır ve komut satırı veya betikler aracılığıyla idari komutlar yürütür.

[**Kurulum talimatları için bu bağlantıyı**](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli#install) takip edin.

Azure CLI'deki komutlar, şu yapıyı kullanarak düzenlenmiştir: `az <hizmet> <hareket> <parametreler>`

#### Hata Ayıklama | MitM az cli

**`--debug`** parametresini kullanarak, aracın **`az`** gönderdiği tüm istekleri görmek mümkündür:
```bash
az account management-group list --output table --debug
```
Bir **MitM** gerçekleştirmek ve aracın manuel olarak gönderdiği **tüm istekleri** kontrol etmek için şunları yapabilirsiniz:

{{#tabs }}
{{#tab name="Bash" }}
```bash
export ADAL_PYTHON_SSL_NO_VERIFY=1
export AZURE_CLI_DISABLE_CONNECTION_VERIFICATION=1
export HTTPS_PROXY="http://127.0.0.1:8080"
export HTTP_PROXY="http://127.0.0.1:8080"

# If this is not enough
# Download the certificate from Burp and convert it into .pem format
# And export the following env variable
openssl x509 -in ~/Downloads/cacert.der -inform DER -out ~/Downloads/cacert.pem -outform PEM
export REQUESTS_CA_BUNDLE=/Users/user/Downloads/cacert.pem
```
{{#endtab }}

{{#tab name="PS" }}
```bash
$env:ADAL_PYTHON_SSL_NO_VERIFY=1
$env:AZURE_CLI_DISABLE_CONNECTION_VERIFICATION=1
$env:HTTPS_PROXY="http://127.0.0.1:8080"
$env:HTTP_PROXY="http://127.0.0.1:8080"
```
{{#endtab }}
{{#endtabs }}

### Az PowerShell

Azure PowerShell, PowerShell komut satırından Azure kaynaklarını yönetmek için cmdlet'ler içeren bir modüldür.

[**kurulum talimatları**](https://learn.microsoft.com/en-us/powershell/azure/install-azure-powershell) için bu bağlantıyı takip edin.

Azure PowerShell AZ Modülündeki komutlar şu şekilde yapılandırılmıştır: `<Action>-Az<Service> <parameters>`

#### Debug | MitM Az PowerShell

**`-Debug`** parametresini kullanarak, aracın gönderdiği tüm istekleri görmek mümkündür:
```bash
Get-AzResourceGroup -Debug
```
Bir **MitM** gerçekleştirmek ve aracın manuel olarak gönderdiği **tüm istekleri** kontrol etmek için `HTTPS_PROXY` ve `HTTP_PROXY` ortam değişkenlerini [**belgelere**](https://learn.microsoft.com/en-us/powershell/azure/az-powershell-proxy) göre ayarlayabilirsiniz.

### Microsoft Graph PowerShell

Microsoft Graph PowerShell, tek bir uç nokta kullanarak SharePoint, Exchange ve Outlook gibi hizmetler de dahil olmak üzere tüm Microsoft Graph API'lerine erişim sağlayan çok platformlu bir SDK'dır. PowerShell 7+ desteği, MSAL aracılığıyla modern kimlik doğrulama, dış kimlikler ve gelişmiş sorgular sunar. En az ayrıcalık erişimine odaklanarak güvenli işlemleri garanti eder ve en son Microsoft Graph API özellikleriyle uyumlu hale gelmek için düzenli güncellemeler alır.

[**kurulum talimatları**](https://learn.microsoft.com/en-us/powershell/microsoftgraph/installation) için bu bağlantıyı takip edin.

Microsoft Graph PowerShell'deki komutlar şu şekilde yapılandırılmıştır: `<Action>-Mg<Service> <parameters>`

#### Microsoft Graph PowerShell'ı Hata Ayıklama

**`-Debug`** parametresini kullanarak aracın gönderdiği tüm istekleri görmek mümkündür:
```bash
Get-MgUser -Debug
```
### ~~**AzureAD Powershell**~~

Azure Active Directory (AD) modülü, artık **kaldırılmıştır**, Azure AD kaynaklarını yönetmek için Azure PowerShell'in bir parçasıdır. Entra ID'de kullanıcıları, grupları ve uygulama kayıtlarını yönetmek gibi görevler için cmdlet'ler sağlar.

> [!TIP]
> Bu, Microsoft Graph PowerShell ile değiştirilmiştir.

Bu bağlantıyı takip ederek [**kurulum talimatlarına**](https://www.powershellgallery.com/packages/AzureAD) ulaşabilirsiniz.
