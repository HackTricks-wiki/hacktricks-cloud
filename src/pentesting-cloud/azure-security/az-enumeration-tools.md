# Az - Enumeration Tools

{{#include ../../banners/hacktricks-training.md}}

## Install PowerShell in Linux

> [!TIP]
> Katika linux utahitaji kufunga PowerShell Core:
```bash
sudo apt-get update
sudo apt-get install -y wget apt-transport-https software-properties-common

# Ubuntu 20.04
wget -q https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb

# Update repos
sudo apt-get update
sudo add-apt-repository universe

# Install & start powershell
sudo apt-get install -y powershell
pwsh

# Az cli
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
```
## Install PowerShell in MacOS

Maelekezo kutoka kwenye [**documentation**](https://learn.microsoft.com/en-us/powershell/scripting/install/installing-powershell-on-macos?view=powershell-7.4):

1. Install `brew` ikiwa haijaanzishwa bado:
```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```
2. Sakinisha toleo la hivi punde la PowerShell:
```sh
brew install powershell/tap/powershell
```
3. Kimbia PowerShell:
```sh
pwsh
```
4. Sasisho:
```sh
brew update
brew upgrade powershell
```
## Main Enumeration Tools

### az cli

[**Azure Command-Line Interface (CLI)**](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli) ni chombo cha kuvuka majukwaa kilichoandikwa kwa Python kwa ajili ya kusimamia na kuendesha (zaidi ya) rasilimali za Azure na Entra ID. Kinajihusisha na Azure na kutekeleza amri za usimamizi kupitia mstari wa amri au skripti.

Fuata kiungo hiki kwa [**maelekezo ya usakinishajiÂ¡**](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli#install).

Amri katika Azure CLI zimeundwa kwa kutumia muundo wa: `az <service> <action> <parameters>`

#### Debug | MitM az cli

Kwa kutumia parameter **`--debug`** inawezekana kuona maombi yote ambayo chombo **`az`** kinatuma:
```bash
az account management-group list --output table --debug
```
Ili kufanya **MitM** kwa chombo na **kuangalia maombi yote** yanayotumwa kwa mikono unaweza kufanya: 

{{#tabs }}
{{#tab name="Bash" }}
```bash
export ADAL_PYTHON_SSL_NO_VERIFY=1
export AZURE_CLI_DISABLE_CONNECTION_VERIFICATION=1
export HTTPS_PROXY="http://127.0.0.1:8080"
export HTTP_PROXY="http://127.0.0.1:8080"

# If this is not enough
# Download the certificate from Burp and convert it into .pem format
# And export the following env variable
openssl x509 -in ~/Downloads/cacert.der -inform DER -out ~/Downloads/cacert.pem -outform PEM
export REQUESTS_CA_BUNDLE=/Users/user/Downloads/cacert.pem
```
{{#endtab }}

{{#tab name="PS" }}
```bash
$env:ADAL_PYTHON_SSL_NO_VERIFY=1
$env:AZURE_CLI_DISABLE_CONNECTION_VERIFICATION=1
$env:HTTPS_PROXY="http://127.0.0.1:8080"
$env:HTTP_PROXY="http://127.0.0.1:8080"
```
{{#endtab }}
{{#endtabs }}

### Az PowerShell

Azure PowerShell ni moduli yenye cmdlets za kusimamia rasilimali za Azure moja kwa moja kutoka kwenye mstari wa amri wa PowerShell.

Fuata kiungo hiki kwa [**maelekezo ya usakinishaji**](https://learn.microsoft.com/en-us/powershell/azure/install-azure-powershell).

Amri katika Moduli ya Azure PowerShell AZ zimeundwa kama: `<Action>-Az<Service> <parameters>`

#### Debug | MitM Az PowerShell

Kwa kutumia parameter **`-Debug`** inawezekana kuona maombi yote ambayo chombo kinatuma:
```bash
Get-AzResourceGroup -Debug
```
Ili kufanya **MitM** kwa zana na **kuangalia maombi yote** inayopeleka kwa mikono unaweza kuweka mabadiliko ya mazingira `HTTPS_PROXY` na `HTTP_PROXY` kulingana na [**docs**](https://learn.microsoft.com/en-us/powershell/azure/az-powershell-proxy).

### Microsoft Graph PowerShell

Microsoft Graph PowerShell ni SDK ya jukwaa nyingi inayowezesha ufikiaji wa APIs zote za Microsoft Graph, ikiwa ni pamoja na huduma kama SharePoint, Exchange, na Outlook, kwa kutumia kiunganishi kimoja. Inasaidia PowerShell 7+, uthibitishaji wa kisasa kupitia MSAL, identiti za nje, na maswali ya hali ya juu. Kwa kuzingatia ufikiaji wa chini wa ruhusa, inahakikisha shughuli salama na inapata masasisho ya kawaida ili kuendana na vipengele vya hivi punde vya Microsoft Graph API.

Fuata kiungo hiki kwa [**maelekezo ya usakinishaji**](https://learn.microsoft.com/en-us/powershell/microsoftgraph/installation).

Amri katika Microsoft Graph PowerShell zimejengwa kama: `<Action>-Mg<Service> <parameters>`

#### Debug Microsoft Graph PowerShell

Kwa kutumia parameter **`-Debug`** inawezekana kuona maombi yote ambayo zana inatuma:
```bash
Get-MgUser -Debug
```
### ~~**AzureAD Powershell**~~

Moduli ya Azure Active Directory (AD), sasa **imeondolewa**, ni sehemu ya Azure PowerShell kwa ajili ya kusimamia rasilimali za Azure AD. Inatoa cmdlets kwa kazi kama kusimamia watumiaji, vikundi, na usajili wa programu katika Entra ID.

> [!TIP]
> Hii imebadilishwa na Microsoft Graph PowerShell

Fuata kiungo hiki kwa ajili ya [**maelekezo ya usakinishaji**](https://www.powershellgallery.com/packages/AzureAD).
