# Az - Enumeration Tools

{{#include ../../banners/hacktricks-training.md}}

## PowerShell in Linux installieren

> [!TIP]
> In Linux müssen Sie PowerShell Core installieren:
>
> ```bash
> sudo apt-get update
> sudo apt-get install -y wget apt-transport-https software-properties-common
>
> # Ubuntu 20.04
> wget -q https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb
>
> # Repos aktualisieren
> sudo apt-get update
> sudo add-apt-repository universe
>
> # PowerShell installieren & starten
> sudo apt-get install -y powershell
> pwsh
>
> # Az cli
> curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
> ```

## PowerShell in MacOS installieren

Anweisungen aus der [**Dokumentation**](https://learn.microsoft.com/en-us/powershell/scripting/install/installing-powershell-on-macos?view=powershell-7.4):

1. Installieren Sie `brew`, falls noch nicht installiert:
```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```
2. Installieren Sie die neueste stabile Version von PowerShell:
```sh
brew install powershell/tap/powershell
```
3. PowerShell ausführen:
```sh
pwsh
```
4. Aktualisierung:
```sh
brew update
brew upgrade powershell
```
## Hauptenumerationstools

### az cli

[**Azure-Befehlszeilenschnittstelle (CLI)**](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli) ist ein plattformübergreifendes Tool, das in Python geschrieben wurde, um (die meisten) Azure- und Entra ID-Ressourcen zu verwalten und zu administrieren. Es verbindet sich mit Azure und führt administrative Befehle über die Befehlszeile oder Skripte aus.

Folgen Sie diesem Link für die [**Installationsanweisungen¡**](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli#install).

Befehle in Azure CLI sind nach folgendem Muster strukturiert: `az <service> <action> <parameters>`

#### Debug | MitM az cli

Mit dem Parameter **`--debug`** ist es möglich, alle Anfragen zu sehen, die das Tool **`az`** sendet:
```bash
az account management-group list --output table --debug
```
Um ein **MitM** auf das Tool durchzuführen und **alle Anfragen**, die es manuell sendet, zu überprüfen, kannst du Folgendes tun:

{{#tabs }}
{{#tab name="Bash" }}
```bash
export ADAL_PYTHON_SSL_NO_VERIFY=1
export AZURE_CLI_DISABLE_CONNECTION_VERIFICATION=1
export HTTPS_PROXY="http://127.0.0.1:8080"
export HTTP_PROXY="http://127.0.0.1:8080"

# If this is not enough
# Download the certificate from Burp and convert it into .pem format
# And export the following env variable
openssl x509 -in ~/Downloads/cacert.der -inform DER -out ~/Downloads/cacert.pem -outform PEM
export REQUESTS_CA_BUNDLE=/Users/user/Downloads/cacert.pem
```
{{#endtab }}

{{#tab name="PS" }}
```bash
$env:ADAL_PYTHON_SSL_NO_VERIFY=1
$env:AZURE_CLI_DISABLE_CONNECTION_VERIFICATION=1
$env:HTTPS_PROXY="http://127.0.0.1:8080"
$env:HTTP_PROXY="http://127.0.0.1:8080"
```
{{#endtab }}
{{#endtabs }}

### Az PowerShell

Azure PowerShell ist ein Modul mit Cmdlets zur Verwaltung von Azure-Ressourcen direkt über die PowerShell-Befehlszeile.

Folgen Sie diesem Link für die [**Installationsanweisungen**](https://learn.microsoft.com/en-us/powershell/azure/install-azure-powershell).

Befehle im Azure PowerShell AZ-Modul sind strukturiert wie: `<Action>-Az<Service> <parameters>`

#### Debug | MitM Az PowerShell

Mit dem Parameter **`-Debug`** ist es möglich, alle Anfragen zu sehen, die das Tool sendet:
```bash
Get-AzResourceGroup -Debug
```
Um ein **MitM** auf das Tool durchzuführen und **alle Anfragen**, die es manuell sendet, zu überprüfen, können Sie die Umgebungsvariablen `HTTPS_PROXY` und `HTTP_PROXY` gemäß den [**Dokumenten**](https://learn.microsoft.com/en-us/powershell/azure/az-powershell-proxy) festlegen.

### Microsoft Graph PowerShell

Microsoft Graph PowerShell ist ein plattformübergreifendes SDK, das den Zugriff auf alle Microsoft Graph APIs ermöglicht, einschließlich Dienste wie SharePoint, Exchange und Outlook, über einen einzigen Endpunkt. Es unterstützt PowerShell 7+, moderne Authentifizierung über MSAL, externe Identitäten und erweiterte Abfragen. Mit einem Fokus auf den minimalen Zugriff gewährleistet es sichere Operationen und erhält regelmäßige Updates, um mit den neuesten Funktionen der Microsoft Graph API in Einklang zu stehen.

Folgen Sie diesem Link für die [**Installationsanweisungen**](https://learn.microsoft.com/en-us/powershell/microsoftgraph/installation).

Befehle in Microsoft Graph PowerShell sind strukturiert wie: `<Action>-Mg<Service> <parameters>`

#### Debug Microsoft Graph PowerShell

Mit dem Parameter **`-Debug`** ist es möglich, alle Anfragen zu sehen, die das Tool sendet:
```bash
Get-MgUser -Debug
```
### ~~**AzureAD Powershell**~~

Das Azure Active Directory (AD) Modul, jetzt **veraltet**, ist Teil von Azure PowerShell zur Verwaltung von Azure AD-Ressourcen. Es bietet Cmdlets für Aufgaben wie die Verwaltung von Benutzern, Gruppen und Anwendungsregistrierungen in Entra ID.

> [!TIP]
> Dies wird durch Microsoft Graph PowerShell ersetzt

Folgen Sie diesem Link für die [**Installationsanweisungen**](https://www.powershellgallery.com/packages/AzureAD).
