# Az - Enumeration Tools

{{#include ../../banners/hacktricks-training.md}}

## Εγκατάσταση PowerShell σε Linux

> [!TIP]
> Σε linux θα χρειαστεί να εγκαταστήσετε το PowerShell Core:
```bash
sudo apt-get update
sudo apt-get install -y wget apt-transport-https software-properties-common

# Ubuntu 20.04
wget -q https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb

# Update repos
sudo apt-get update
sudo add-apt-repository universe

# Install & start powershell
sudo apt-get install -y powershell
pwsh

# Az cli
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
```
## Εγκατάσταση PowerShell σε MacOS

Οδηγίες από την [**τεκμηρίωση**](https://learn.microsoft.com/en-us/powershell/scripting/install/installing-powershell-on-macos?view=powershell-7.4):

1. Εγκαταστήστε το `brew` αν δεν έχει εγκατασταθεί ακόμα:
```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```
2. Εγκαταστήστε την τελευταία σταθερή έκδοση του PowerShell:
```sh
brew install powershell/tap/powershell
```
3. Εκτελέστε το PowerShell:
```sh
pwsh
```
4. Ενημέρωση:
```sh
brew update
brew upgrade powershell
```
## Κύρια Εργαλεία Αρίθμησης

### az cli

[**Azure Command-Line Interface (CLI)**](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli) είναι ένα διαλειτουργικό εργαλείο γραμμένο σε Python για τη διαχείριση και διοίκηση (των περισσότερων) πόρων Azure και Entra ID. Συνδέεται με το Azure και εκτελεί διοικητικές εντολές μέσω της γραμμής εντολών ή σεναρίων.

Ακολουθήστε αυτόν τον σύνδεσμο για τις [**οδηγίες εγκατάστασης¡**](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli#install).

Οι εντολές στο Azure CLI είναι δομημένες χρησιμοποιώντας ένα μοτίβο: `az <service> <action> <parameters>`

#### Debug | MitM az cli

Χρησιμοποιώντας την παράμετρο **`--debug`** είναι δυνατόν να δείτε όλα τα αιτήματα που στέλνει το εργαλείο **`az`**:
```bash
az account management-group list --output table --debug
```
Για να κάνετε ένα **MitM** στο εργαλείο και να **ελέγξετε όλα τα αιτήματα** που στέλνει χειροκίνητα, μπορείτε να κάνετε:

{{#tabs }}
{{#tab name="Bash" }}
```bash
export ADAL_PYTHON_SSL_NO_VERIFY=1
export AZURE_CLI_DISABLE_CONNECTION_VERIFICATION=1
export HTTPS_PROXY="http://127.0.0.1:8080"
export HTTP_PROXY="http://127.0.0.1:8080"

# If this is not enough
# Download the certificate from Burp and convert it into .pem format
# And export the following env variable
openssl x509 -in ~/Downloads/cacert.der -inform DER -out ~/Downloads/cacert.pem -outform PEM
export REQUESTS_CA_BUNDLE=/Users/user/Downloads/cacert.pem
```
{{#endtab }}

{{#tab name="PS" }}
```bash
$env:ADAL_PYTHON_SSL_NO_VERIFY=1
$env:AZURE_CLI_DISABLE_CONNECTION_VERIFICATION=1
$env:HTTPS_PROXY="http://127.0.0.1:8080"
$env:HTTP_PROXY="http://127.0.0.1:8080"
```
{{#endtab }}
{{#endtabs }}

### Az PowerShell

Το Azure PowerShell είναι ένα module με cmdlets για τη διαχείριση πόρων Azure απευθείας από τη γραμμή εντολών PowerShell.

Ακολουθήστε αυτόν τον σύνδεσμο για τις [**οδηγίες εγκατάστασης**](https://learn.microsoft.com/en-us/powershell/azure/install-azure-powershell).

Οι εντολές στο Azure PowerShell AZ Module είναι δομημένες ως εξής: `<Action>-Az<Service> <parameters>`

#### Debug | MitM Az PowerShell

Χρησιμοποιώντας την παράμετρο **`-Debug`** είναι δυνατόν να δείτε όλα τα αιτήματα που στέλνει το εργαλείο:
```bash
Get-AzResourceGroup -Debug
```
Για να κάνετε **MitM** στο εργαλείο και να **ελέγξετε όλα τα αιτήματα** που στέλνει χειροκίνητα, μπορείτε να ρυθμίσετε τις μεταβλητές περιβάλλοντος `HTTPS_PROXY` και `HTTP_PROXY` σύμφωνα με τα [**docs**](https://learn.microsoft.com/en-us/powershell/azure/az-powershell-proxy).

### Microsoft Graph PowerShell

Το Microsoft Graph PowerShell είναι ένα SDK πολλαπλών πλατφορμών που επιτρέπει την πρόσβαση σε όλα τα Microsoft Graph APIs, συμπεριλαμβανομένων υπηρεσιών όπως το SharePoint, το Exchange και το Outlook, χρησιμοποιώντας ένα μόνο endpoint. Υποστηρίζει PowerShell 7+, σύγχρονη αυθεντικοποίηση μέσω MSAL, εξωτερικές ταυτότητες και προηγμένα ερωτήματα. Με έμφαση στην πρόσβαση με ελάχιστα δικαιώματα, διασφαλίζει ασφαλείς λειτουργίες και λαμβάνει τακτικές ενημερώσεις για να ευθυγραμμίζεται με τα τελευταία χαρακτηριστικά του Microsoft Graph API.

Ακολουθήστε αυτόν τον σύνδεσμο για τις [**οδηγίες εγκατάστασης**](https://learn.microsoft.com/en-us/powershell/microsoftgraph/installation).

Οι εντολές στο Microsoft Graph PowerShell είναι δομημένες ως εξής: `<Action>-Mg<Service> <parameters>`

#### Debug Microsoft Graph PowerShell

Χρησιμοποιώντας την παράμετρο **`-Debug`** είναι δυνατόν να δείτε όλα τα αιτήματα που στέλνει το εργαλείο:
```bash
Get-MgUser -Debug
```
### ~~**AzureAD Powershell**~~

Το Azure Active Directory (AD) module, τώρα **παρωχημένο**, είναι μέρος του Azure PowerShell για τη διαχείριση πόρων Azure AD. Παρέχει cmdlets για εργασίες όπως η διαχείριση χρηστών, ομάδων και εγγραφών εφαρμογών στο Entra ID.

> [!TIP]
> Αυτό έχει αντικατασταθεί από το Microsoft Graph PowerShell

Ακολουθήστε αυτόν τον σύνδεσμο για τις [**οδηγίες εγκατάστασης**](https://www.powershellgallery.com/packages/AzureAD).

{{#include ../../banners/hacktricks-training.md}}
