# Az - Queue Storage Privesc

{{#include ../../../banners/hacktricks-training.md}}

## Queue

Kwa maelezo zaidi angalia:

{{#ref}}
../az-services/az-queue-enum.md
{{#endref}}

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/read`

Mshambuliaji mwenye ruhusa hii anaweza kuangalia ujumbe kutoka kwa Azure Storage Queue. Hii inamruhusu mshambuliaji kuona maudhui ya ujumbe bila kuashiria kuwa umeshughulikiwa au kubadilisha hali yao. Hii inaweza kusababisha ufikiaji usioidhinishwa wa taarifa nyeti, ikiruhusu uhamasishaji wa data au kukusanya taarifa kwa mashambulizi zaidi.
```bash
az storage message peek --queue-name <queue_name> --account-name <storage_account>
```
**Madhara Yanayoweza Kutokea**: Ufikiaji usioidhinishwa wa foleni, kufichuliwa kwa ujumbe, au upotoshaji wa foleni na watumiaji au huduma zisizoidhinishwa.

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/process/action`

Kwa ruhusa hii, mshambuliaji anaweza kupata na kushughulikia ujumbe kutoka kwa Azure Storage Queue. Hii inamaanisha wanaweza kusoma maudhui ya ujumbe na kuashiria kama umeshughulikiwa, kwa ufanisi wakificha kutoka kwa mifumo halali. Hii inaweza kusababisha kufichuliwa kwa data nyeti, usumbufu katika jinsi ujumbe unavyoshughulikiwa, au hata kusitisha michakato muhimu kwa kufanya ujumbe usipatikane kwa watumiaji wao waliokusudiwa.
```bash
az storage message get --queue-name <queue_name> --account-name <storage_account>
```
### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/add/action`

Kwa ruhusa hii, mshambuliaji anaweza kuongeza ujumbe mpya kwenye Azure Storage Queue. Hii inawaruhusu kuingiza data mbaya au isiyoidhinishwa kwenye foleni, ambayo inaweza kusababisha kuchochea vitendo visivyokusudiwa au kuharibu huduma zinazoshughulikia ujumbe.
```bash
az storage message put --queue-name <queue-name> --content "Injected malicious message" --account-name <storage-account>
```
### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/write`

Ruhusa hii inaruhusu mshambuliaji kuongeza ujumbe mpya au kuboresha wale waliopo katika Azure Storage Queue. Kwa kutumia hii, wanaweza kuingiza maudhui mabaya au kubadilisha ujumbe waliopo, ambayo yanaweza kupelekea upotoshaji wa programu au kusababisha tabia zisizohitajika katika mifumo inayotegemea foleni.
```bash
az storage message put --queue-name <queue-name> --content "Injected malicious message" --account-name <storage-account>

#Update the message
az storage message update --queue-name <queue-name> \
--id <message-id> \
--pop-receipt <pop-receipt> \
--content "Updated message content" \
--visibility-timeout <timeout-in-seconds> \
--account-name <storage-account>
```
### Action: `Microsoft.Storage/storageAccounts/queueServices/queues/write`

Ruhusa hii inaruhusu mshambuliaji kuunda au kubadilisha foleni na mali zao ndani ya akaunti ya hifadhi. Inaweza kutumika kuunda foleni zisizoidhinishwa, kubadilisha metadata, au kubadilisha orodha za udhibiti wa ufikiaji (ACLs) ili kutoa au kupunguza ufikiaji. Uwezo huu unaweza kuharibu michakato ya kazi, kuingiza data mbaya, kuhamasisha taarifa nyeti, au kubadilisha mipangilio ya foleni ili kuwezesha mashambulizi zaidi.
```bash
az storage queue create --name <new-queue-name> --account-name <storage-account>

az storage queue metadata update --name <queue-name> --metadata key1=value1 key2=value2 --account-name <storage-account>

az storage queue policy set --name <queue-name> --permissions rwd --expiry 2024-12-31T23:59:59Z --account-name <storage-account>
```
## Marejeo

- [https://learn.microsoft.com/en-us/azure/storage/queues/storage-powershell-how-to-use-queues](https://learn.microsoft.com/en-us/azure/storage/queues/storage-powershell-how-to-use-queues)
- [https://learn.microsoft.com/en-us/rest/api/storageservices/queue-service-rest-api](https://learn.microsoft.com/en-us/rest/api/storageservices/queue-service-rest-api)
- [https://learn.microsoft.com/en-us/azure/storage/queues/queues-auth-abac-attributes](https://learn.microsoft.com/en-us/azure/storage/queues/queues-auth-abac-attributes)

{{#include ../../../banners/hacktricks-training.md}}
