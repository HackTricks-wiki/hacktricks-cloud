# Az - PostgreSQL Privesc

{{#include ../../../banners/hacktricks-training.md}}

## PostgreSQL Privesc
SQL Veritabanı hakkında daha fazla bilgi için kontrol edin:

{% content-ref url="../az-services/az-postgresql.md" %}
[az-postgresql.md](../az-services/az-postgresql.md)
{% endcontent-ref %}

### "Microsoft.DBforPostgreSQL/flexibleServers/read" && "Microsoft.DBforPostgreSQL/flexibleServers/write"

Bu izinle, Azure'da PostgreSQL Flexible Server örnekleri oluşturabilir, güncelleyebilir veya silebilirsiniz. Bu, yeni sunucuların sağlanmasını, mevcut sunucu yapılandırmalarının değiştirilmesini veya sunucuların devre dışı bırakılmasını içerir.

{% code overflow="wrap" %}
```bash
az postgres flexible-server create \
--name <ServerName> \
--resource-group <ResourceGroupName> \
--location <Location> \
--admin-user <AdminUsername> \
--admin-password <AdminPassword> \
--sku-name <SkuName> \
--storage-size <StorageSizeInGB> \
--tier <PricingTier> \
--version <PostgreSQLVersion>
```
{% endcode %}

Örneğin, bu izinler PostgreSQL şifresini değiştirmeye izin verir, bu da PostgreSQL kimlik doğrulaması etkinleştirildiğinde elbette faydalıdır.

{% code overflow="wrap" %}
```bash
az postgres flexible-server update \
--resource-group <resource_group_name> \
--name <server_name> \
--admin-password <password_to_update>
```
{% endcode %}

Ayrıca, özel bir uç noktadan erişmek istemiyorsanız, genel erişimin etkinleştirilmesi gereklidir. Bunu etkinleştirmek için:

{% code overflow="wrap" %}
```bash
az postgres flexible-server update --resource-group <resource_group_name> --server-name <server_name> --public-access Enabled
```
{% endcode %}

### "Microsoft.DBforPostgreSQL/flexibleServers/read", "Microsoft.DBforPostgreSQL/flexibleServers/write", "Microsoft.ManagedIdentity/userAssignedIdentities/assign/action", "Microsoft.DBforPostgreSQL/flexibleServers/administrators/write" && "Microsoft.DBforPostgreSQL/flexibleServers/administrators/read"

Bu izinle, bir PostgreSQL Flexible Server için Azure Active Directory (AD) yöneticilerini yapılandırabilirsiniz. Bu, kendinizi veya başka bir hesabı AD yöneticisi olarak ayarlayarak PostgreSQL sunucusu üzerinde tam yönetim kontrolü sağlamak için istismar edilebilir. Mevcut bir ilkenin güncellenmesi henüz desteklenmiyor, bu nedenle bir tane oluşturulmuşsa önce silmeniz gerekir.

Flexible-server'ın kullanılmak üzere atanmış yönetilen kimliklere sahip olması önemlidir.

{% code overflow="wrap" %}
```bash
az postgres flexible-server ad-admin create \
--resource-group <ResourceGroupName> \
--server-name <ServerName> \
--display-name <ADAdminDisplayName> \
--identity <IdentityNameOrID> \
--object-id <ObjectID>
```
{% endcode %}

{{#include ../../../banners/hacktricks-training.md}}
