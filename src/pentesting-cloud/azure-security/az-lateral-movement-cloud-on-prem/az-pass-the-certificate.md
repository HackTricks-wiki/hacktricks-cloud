# Az - Sertifikayı Geç

{{#include ../../../banners/hacktricks-training.md}}

## Sertifikayı Geç (Azure)

Azure'a bağlı makinelerde, her iki makine de **NegoEx** kimlik doğrulama mekanizmasını destekliyorsa, bir makineden diğerine kimlik doğrulamak için **Entra ID CA** tarafından gerekli kullanıcı (konu olarak) için verilmiş sertifikalar kullanılabilir.

Aşırı basitleştirilmiş terimlerle:

- Bağlantıyı başlatan makine (istemci) **bir kullanıcı için Entra ID'den bir sertifika** gerektirir.
- İstemci, PRT ve diğer ayrıntıları içeren bir JSON Web Token (JWT) başlığı oluşturur, bunu Türev anahtarı ile imzalar (oturum anahtarı ve güvenlik bağlamını kullanarak) ve **Entra ID'ye gönderir**.
- Entra ID, istemci oturum anahtarı ve güvenlik bağlamını kullanarak JWT imzasını doğrular, PRT'nin geçerliliğini kontrol eder ve **sertifika** ile **yanıtlar**.

Bu senaryoda ve [**PRT'yi Geç**](az-primary-refresh-token-prt.md) saldırısı için gerekli tüm bilgileri topladıktan sonra:

- Kullanıcı adı
- Kiracı ID
- PRT
- Güvenlik bağlamı
- Türev Anahtar

Kullanıcı için **P2P sertifikası** talep etmek mümkündür, araç [**PrtToCert**](https://github.com/morRubin/PrtToCert)**:**
```bash
RequestCert.py [-h] --tenantId TENANTID --prt PRT --userName USERNAME --hexCtx HEXCTX --hexDerivedKey HEXDERIVEDKEY [--passPhrase PASSPHRASE]
```
Sertifikalar, PRT ile aynı süre boyunca geçerli olacaktır. Sertifikayı kullanmak için, uzaktaki makineye **kimlik doğrulaması** yapacak, **PSEXEC** çalıştıracak ve kurban makinede **CMD** açacak python aracı [**AzureADJoinedMachinePTC**](https://github.com/morRubin/AzureADJoinedMachinePTC) kullanabilirsiniz. Bu, başka bir kullanıcının PRT'sini almak için Mimikatz'ı tekrar kullanmamıza olanak tanıyacaktır.
```bash
Main.py [-h] --usercert USERCERT --certpass CERTPASS --remoteip REMOTEIP
```
## Referanslar

- Pass the Certificate'ın nasıl çalıştığı hakkında daha fazla bilgi için orijinal gönderiyi kontrol edin [https://medium.com/@mor2464/azure-ad-pass-the-certificate-d0c5de624597](https://medium.com/@mor2464/azure-ad-pass-the-certificate-d0c5de624597)

{{#include ../../../banners/hacktricks-training.md}}
