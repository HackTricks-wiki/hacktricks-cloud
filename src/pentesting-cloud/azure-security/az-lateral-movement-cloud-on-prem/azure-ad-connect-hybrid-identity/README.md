# Az AD Connect - Hybrid Identity

{{#include ../../../../banners/hacktricks-training.md}}

## 기본 정보

**온프레미스 Active Directory (AD)**와 **Azure AD** 간의 통합은 **Azure AD Connect**에 의해 촉진되며, **Single Sign-on (SSO)**을 지원하는 다양한 방법을 제공합니다. 각 방법은 유용하지만, 클라우드 또는 온프레미스 환경을 손상시킬 수 있는 잠재적인 보안 취약점을 제공합니다:

- **Pass-Through Authentication (PTA)**:
- 온프레미스 AD의 에이전트가 손상될 가능성, Azure 연결(온프레미스에서 클라우드로)의 사용자 비밀번호 검증을 허용합니다.
- 새로운 위치(클라우드에서 온프레미스로)에서 인증을 검증하기 위해 새로운 에이전트를 등록할 가능성.

{{#ref}}
pta-pass-through-authentication.md
{{#endref}}

- **Password Hash Sync (PHS)**:
- AD에서 특권 사용자의 평문 비밀번호를 추출할 가능성, 고급 권한의 자동 생성된 AzureAD 사용자의 자격 증명을 포함합니다.

{{#ref}}
phs-password-hash-sync.md
{{#endref}}

- **Federation**:
- SAML 서명을 위한 개인 키 도난, 온프레미스 및 클라우드 신원을 가장할 수 있게 합니다.

{{#ref}}
federation.md
{{#endref}}

- **Seamless SSO:**
- Kerberos 실버 티켓 서명에 사용되는 `AZUREADSSOACC` 사용자의 비밀번호 도난, 모든 클라우드 사용자를 가장할 수 있게 합니다.

{{#ref}}
seamless-sso.md
{{#endref}}

- **Cloud Kerberos Trust**:
- AzureAD 사용자 이름과 SID를 조작하고 AzureAD에서 TGT를 요청하여 Global Admin에서 온프레미스 Domain Admin으로 상승할 가능성.

{{#ref}}
az-cloud-kerberos-trust.md
{{#endref}}

- **Default Applications**:
- 애플리케이션 관리자 계정 또는 온프레미스 동기화 계정이 손상되면 디렉토리 설정, 그룹 구성원, 사용자 계정, SharePoint 사이트 및 OneDrive 파일을 수정할 수 있습니다.

{{#ref}}
az-default-applications.md
{{#endref}}

각 통합 방법에 대해 사용자 동기화가 수행되며, 온프레미스 AD에 `MSOL_<installationidentifier>` 계정이 생성됩니다. 특히, **PHS** 및 **PTA** 방법은 **Seamless SSO**를 촉진하여 온프레미스 도메인에 가입된 Azure AD 컴퓨터의 자동 로그인을 가능하게 합니다.

**Azure AD Connect**의 설치를 확인하기 위해, 기본적으로 Azure AD Connect와 함께 설치된 **AzureADConnectHealthSync** 모듈을 사용하는 다음 PowerShell 명령을 사용할 수 있습니다:
```bash
Get-ADSyncConnector
```
{{#include ../../../../banners/hacktricks-training.md}}
