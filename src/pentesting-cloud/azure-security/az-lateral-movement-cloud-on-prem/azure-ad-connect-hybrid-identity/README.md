# Az AD Connect - ハイブリッドアイデンティティ

{{#include ../../../../banners/hacktricks-training.md}}

## 基本情報

**オンプレミスのActive Directory (AD)** と **Azure AD** の統合は、**Azure AD Connect** によって促進され、**シングルサインオン (SSO)** をサポートするさまざまな方法が提供されています。各方法は有用ですが、クラウドまたはオンプレミス環境を危険にさらす可能性のあるセキュリティ脆弱性を提示します：

- **パススルー認証 (PTA)**:
- オンプレミスADのエージェントが侵害される可能性があり、Azure接続のためのユーザーパスワードの検証が可能になります（オンプレからクラウドへ）。
- 新しい場所（クラウドからオンプレ）で認証を検証するために新しいエージェントを登録する可能性。

{{#ref}}
pta-pass-through-authentication.md
{{#endref}}

- **パスワードハッシュ同期 (PHS)**:
- 高特権の自動生成されたAzureADユーザーの資格情報を含む、ADから特権ユーザーの平文パスワードを抽出する可能性。

{{#ref}}
phs-password-hash-sync.md
{{#endref}}

- **フェデレーション**:
- SAML署名に使用される秘密鍵の盗難により、オンプレおよびクラウドのアイデンティティのなりすましが可能になります。

{{#ref}}
federation.md
{{#endref}}

- **シームレスSSO:**
- Kerberosシルバーチケットの署名に使用される `AZUREADSSOACC` ユーザーのパスワードの盗難により、任意のクラウドユーザーのなりすましが可能になります。

{{#ref}}
seamless-sso.md
{{#endref}}

- **クラウドKerberos信頼**:
- AzureADユーザー名とSIDを操作し、AzureADからTGTを要求することにより、グローバル管理者からオンプレミスドメイン管理者への昇格の可能性。

{{#ref}}
az-cloud-kerberos-trust.md
{{#endref}}

- **デフォルトアプリケーション**:
- アプリケーション管理者アカウントまたはオンプレミスの同期アカウントが侵害されると、ディレクトリ設定、グループメンバーシップ、ユーザーアカウント、SharePointサイト、およびOneDriveファイルの変更が可能になります。

{{#ref}}
az-default-applications.md
{{#endref}}

各統合方法について、ユーザーの同期が行われ、オンプレADに `MSOL_<installationidentifier>` アカウントが作成されます。特に、**PHS** と **PTA** の両方の方法は **シームレスSSO** を促進し、オンプレドメインに参加しているAzure ADコンピュータの自動サインインを可能にします。

**Azure AD Connect** のインストールを確認するには、以下のPowerShellコマンドを使用できます。このコマンドは、**AzureADConnectHealthSync** モジュール（Azure AD Connectと共にデフォルトでインストールされる）を利用します：
```powershell
Get-ADSyncConnector
```
{{#include ../../../../banners/hacktricks-training.md}}
