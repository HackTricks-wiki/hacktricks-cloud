# Az AD Connect - Hybrid Identity

{{#include ../../../../banners/hacktricks-training.md}}

## Basiese Inligting

Integrasie tussen **On-premises Active Directory (AD)** en **Azure AD** word gefasiliteer deur **Azure AD Connect**, wat verskeie metodes bied wat **Single Sign-on (SSO)** ondersteun. Elke metode, terwyl nuttig, bied potensiële sekuriteitskwesies wat benut kan word om cloud- of on-premises omgewings te kompromitteer:

- **Pass-Through Authentication (PTA)**:
- Moglike kompromie van die agent op die on-prem AD, wat validasie van gebruikerswagwoorde vir Azure verbindings (on-prem na Cloud) toelaat.
- Feasibiliteit om 'n nuwe agent te registreer om authentikasies in 'n nuwe ligging (Cloud na on-prem) te valideer.

{{#ref}}
pta-pass-through-authentication.md
{{#endref}}

- **Password Hash Sync (PHS)**:
- Potensiële onttrekking van duidelike teks wagwoorde van bevoorregte gebruikers uit die AD, insluitend geloofsbriewe van 'n hoogs bevoorregte, outomaties gegenereerde AzureAD gebruiker.

{{#ref}}
phs-password-hash-sync.md
{{#endref}}

- **Federation**:
- Diefstal van die private sleutel wat gebruik word vir SAML ondertekening, wat impersonasie van on-prem en cloud identiteite moontlik maak.

{{#ref}}
federation.md
{{#endref}}

- **Seamless SSO:**
- Diefstal van die `AZUREADSSOACC` gebruiker se wagwoord, wat gebruik word vir die ondertekening van Kerberos silwer kaartjies, wat impersonasie van enige cloud gebruiker toelaat.

{{#ref}}
seamless-sso.md
{{#endref}}

- **Cloud Kerberos Trust**:
- Moglikheid om van Global Admin na on-prem Domain Admin te eskaleer deur AzureAD gebruiker gebruikersname en SIDs te manipuleer en TGT's van AzureAD aan te vra.

{{#ref}}
az-cloud-kerberos-trust.md
{{#endref}}

- **Default Applications**:
- Kompromitering van 'n Application Administrator rekening of die on-premise Sync Account laat die aanpassing van gidsinstellings, groep lidmaatskappe, gebruikersrekeninge, SharePoint webwerwe, en OneDrive lêers toe.

{{#ref}}
az-default-applications.md
{{#endref}}

Vir elke integrasiemetode word gebruikerssynchronisasie uitgevoer, en 'n `MSOL_<installationidentifier>` rekening word in die on-prem AD geskep. Opmerklik is dat beide **PHS** en **PTA** metodes **Seamless SSO** fasiliteer, wat outomatiese aanmelding vir Azure AD rekenaars wat by die on-prem domein aangesluit is, moontlik maak.

Om die installasie van **Azure AD Connect** te verifieer, kan die volgende PowerShell-opdrag, wat die **AzureADConnectHealthSync** module gebruik (standaard geïnstalleer met Azure AD Connect), gebruik word:
```bash
Get-ADSyncConnector
```
{{#include ../../../../banners/hacktricks-training.md}}
