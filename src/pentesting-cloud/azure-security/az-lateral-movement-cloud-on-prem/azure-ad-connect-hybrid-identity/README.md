# Az AD Connect - ハイブリッドアイデンティティ

{{#include ../../../../banners/hacktricks-training.md}}

## 基本情報

**オンプレミス Active Directory (AD)** と **Azure AD** の統合は **Azure AD Connect** によって促進され、**シングルサインオン (SSO)** をサポートするさまざまな方法が提供されています。各方法は有用ですが、クラウドまたはオンプレミス環境を危険にさらす可能性のあるセキュリティ脆弱性を提示します：

- **パススルー認証 (PTA)**:
- オンプレミス AD のエージェントが侵害される可能性があり、Azure 接続のためのユーザーパスワードの検証が可能になります（オンプレからクラウドへ）。
- 新しい場所（クラウドからオンプレ）で認証を検証するために新しいエージェントを登録する可能性。

{{#ref}}
pta-pass-through-authentication.md
{{#endref}}

- **パスワードハッシュ同期 (PHS)**:
- AD から特権ユーザーの平文パスワードを抽出する可能性があり、高特権の自動生成された AzureAD ユーザーの資格情報を含みます。

{{#ref}}
phs-password-hash-sync.md
{{#endref}}

- **フェデレーション**:
- SAML 署名に使用される秘密鍵の盗難により、オンプレおよびクラウドのアイデンティティのなりすましが可能になります。

{{#ref}}
federation.md
{{#endref}}

- **シームレス SSO:**
- Kerberos シルバーチケットの署名に使用される `AZUREADSSOACC` ユーザーのパスワードの盗難により、任意のクラウドユーザーのなりすましが可能になります。

{{#ref}}
seamless-sso.md
{{#endref}}

- **クラウド Kerberos トラスト**:
- AzureAD ユーザー名と SID を操作し、AzureAD から TGT を要求することにより、グローバル管理者からオンプレドメイン管理者への昇格の可能性。

{{#ref}}
az-cloud-kerberos-trust.md
{{#endref}}

- **デフォルトアプリケーション**:
- アプリケーション管理者アカウントまたはオンプレミス同期アカウントを侵害することで、ディレクトリ設定、グループメンバーシップ、ユーザーアカウント、SharePoint サイト、および OneDrive ファイルの変更が可能になります。

{{#ref}}
az-default-applications.md
{{#endref}}

各統合方法に対して、ユーザーの同期が行われ、オンプレ AD に `MSOL_<installationidentifier>` アカウントが作成されます。特に、**PHS** と **PTA** の両方の方法は **シームレス SSO** を促進し、オンプレドメインに参加している Azure AD コンピューターの自動サインインを可能にします。

**Azure AD Connect** のインストールを確認するには、以下の PowerShell コマンドを使用できます。このコマンドは **AzureADConnectHealthSync** モジュールを利用しており（Azure AD Connect にデフォルトでインストールされています）、次のようになります：
```powershell
Get-ADSyncConnector
```
{{#include ../../../../banners/hacktricks-training.md}}
