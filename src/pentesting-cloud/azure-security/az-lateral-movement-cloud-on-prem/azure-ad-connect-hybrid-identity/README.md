# Az AD Connect - Υβριδική Ταυτότητα

{{#include ../../../../banners/hacktricks-training.md}}

## Βασικές Πληροφορίες

Η ενσωμάτωση μεταξύ του **On-premises Active Directory (AD)** και του **Azure AD** διευκολύνεται από το **Azure AD Connect**, προσφέροντας διάφορες μεθόδους που υποστηρίζουν το **Single Sign-on (SSO)**. Κάθε μέθοδος, αν και χρήσιμη, παρουσιάζει πιθανά κενά ασφαλείας που θα μπορούσαν να εκμεταλλευτούν για να παραβιάσουν τα περιβάλλοντα cloud ή on-premises:

- **Pass-Through Authentication (PTA)**:
- Πιθανή παραβίαση του πράκτορα στο on-prem AD, επιτρέποντας την επικύρωση των κωδικών πρόσβασης χρηστών για συνδέσεις Azure (on-prem to Cloud).
- Δυνατότητα καταχώρησης ενός νέου πράκτορα για την επικύρωση των αυθεντικοποιήσεων σε μια νέα τοποθεσία (Cloud to on-prem).

{{#ref}}
pta-pass-through-authentication.md
{{#endref}}

- **Password Hash Sync (PHS)**:
- Πιθανή εξαγωγή κωδικών πρόσβασης σε καθαρό κείμενο από προνομιούχους χρήστες από το AD, συμπεριλαμβανομένων των διαπιστευτηρίων ενός υψηλά προνομιούχου, αυτόματα παραγόμενου χρήστη AzureAD.

{{#ref}}
phs-password-hash-sync.md
{{#endref}}

- **Federation**:
- Κλοπή του ιδιωτικού κλειδιού που χρησιμοποιείται για την υπογραφή SAML, επιτρέποντας την προσποίηση ταυτοτήτων on-prem και cloud.

{{#ref}}
federation.md
{{#endref}}

- **Seamless SSO:**
- Κλοπή του κωδικού πρόσβασης του χρήστη `AZUREADSSOACC`, που χρησιμοποιείται για την υπογραφή των ασημένιων εισιτηρίων Kerberos, επιτρέποντας την προσποίηση οποιουδήποτε χρήστη cloud.

{{#ref}}
seamless-sso.md
{{#endref}}

- **Cloud Kerberos Trust**:
- Δυνατότητα αναβάθμισης από Global Admin σε on-prem Domain Admin με την παραποίηση των ονομάτων χρηστών AzureAD και SIDs και την αίτηση TGTs από AzureAD.

{{#ref}}
az-cloud-kerberos-trust.md
{{#endref}}

- **Default Applications**:
- Η παραβίαση ενός λογαριασμού Διαχειριστή Εφαρμογής ή του on-premise Sync Account επιτρέπει την τροποποίηση ρυθμίσεων καταλόγου, μελών ομάδας, λογαριασμών χρηστών, ιστότοπων SharePoint και αρχείων OneDrive.

{{#ref}}
az-default-applications.md
{{#endref}}

Για κάθε μέθοδο ενσωμάτωσης, πραγματοποιείται συγχρονισμός χρηστών και δημιουργείται ένας λογαριασμός `MSOL_<installationidentifier>` στο on-prem AD. Σημειώνεται ότι και οι μέθοδοι **PHS** και **PTA** διευκολύνουν το **Seamless SSO**, επιτρέποντας αυτόματη σύνδεση για υπολογιστές Azure AD που έχουν συνδεθεί στο on-prem domain.

Για να επαληθεύσετε την εγκατάσταση του **Azure AD Connect**, μπορείτε να χρησιμοποιήσετε την παρακάτω εντολή PowerShell, χρησιμοποιώντας το module **AzureADConnectHealthSync** (εγκατεστημένο από προεπιλογή με το Azure AD Connect):
```powershell
Get-ADSyncConnector
```
{{#include ../../../../banners/hacktricks-training.md}}
