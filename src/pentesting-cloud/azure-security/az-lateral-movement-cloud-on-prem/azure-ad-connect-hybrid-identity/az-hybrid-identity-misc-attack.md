# ハイブリッドアイデンティティの雑多な攻撃

{{#include ../../../../banners/hacktricks-training.md}}


## Entra ID ユーザーをオンプレミスに強制的に同期させる

[https://www.youtube.com/watch?v=JEIR5oGCwdg](https://www.youtube.com/watch?v=JEIR5oGCwdg) で述べられているように、オンプレミスの AD ユーザー内の **`ProxyAddress`** の値を変更し、Entra ID 管理者ユーザーのメールアドレスを追加し、AD と Entra ID のユーザーの UPN が一致することを確認することが可能でした（これが再び Entra ID です）、例えば **`SMTP:admin@domain.onmicrosoft.com`** のように。この操作により、**このユーザーの同期を Entra ID からオンプレミス AD に強制する**ことができるため、ユーザーのパスワードが知られていれば、Entra ID の管理者に**アクセスするために使用できる**可能性があります。

Entra ID からオンプレミス AD に新しいユーザーを同期させるための要件は以下の通りです。唯一の要件は：

- オンプレミス AD 内のユーザーの属性を制御する（または新しいユーザーを作成する権限を持つ）
- Entra ID からオンプレミス AD に同期するためのユーザーがクラウド専用であることを知っている
- **ハードマッチ**を行うために、Entra ID ユーザーの immutableID 属性をオンプレミス AD ユーザーに変更できる必要があるかもしれません。


> [!CAUTION]
> Entra ID はもはや Entra ID からオンプレミス AD に管理者を同期させることを許可していません。
> また、これは **MFA をバイパスすることはありません**。



## 参考文献

- [https://www.youtube.com/watch?v=JEIR5oGCwdg](https://www.youtube.com/watch?v=JEIR5oGCwdg)
- [https://activedirectorypro.com/sync-on-prem-ad-with-existing-azure-ad-users/](https://activedirectorypro.com/sync-on-prem-ad-with-existing-azure-ad-users/)
- [https://www.orbid365.be/manually-match-on-premise-ad-user-to-existing-office365-user/](https://www.orbid365.be/manually-match-on-premise-ad-user-to-existing-office365-user/)

{{#include ../../../../banners/hacktricks-training.md}}
