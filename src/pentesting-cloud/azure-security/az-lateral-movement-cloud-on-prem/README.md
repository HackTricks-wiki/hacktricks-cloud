# Az - Lateral Movement (Cloud - On-Prem)

## Az - Lateral Movement (Cloud - On-Prem)

{{#include ../../../banners/hacktricks-training.md}}

### On-Prem मशीनें जो क्लाउड से जुड़ी हैं

एक मशीन को क्लाउड से जोड़ने के विभिन्न तरीके हैं:

#### Azure AD से जुड़ी

<figure><img src="../../../images/image (259).png" alt=""><figcaption></figcaption></figure>

#### कार्यस्थल से जुड़ी

<figure><img src="../../../images/image (222).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### हाइब्रिड से जुड़ी

<figure><img src="../../../images/image (178).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### AADJ या हाइब्रिड पर कार्यस्थल से जुड़ी

<figure><img src="../../../images/image (252).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large</a></p></figcaption></figure>

### टोकन और सीमाएँ <a href="#tokens-and-limitations" id="tokens-and-limitations"></a>

Azure AD में, विशिष्ट सीमाओं के साथ विभिन्न प्रकार के टोकन होते हैं:

- **एक्सेस टोकन**: APIs और Microsoft Graph जैसे संसाधनों तक पहुँचने के लिए उपयोग किया जाता है। ये एक विशिष्ट क्लाइंट और संसाधन से जुड़े होते हैं।
- **रीफ्रेश टोकन**: नए एक्सेस टोकन प्राप्त करने के लिए अनुप्रयोगों को जारी किए जाते हैं। इन्हें केवल उसी अनुप्रयोग द्वारा या अनुप्रयोगों के समूह द्वारा उपयोग किया जा सकता है, जिन्हें जारी किया गया था।
- **प्राइमरी रीफ्रेश टोकन (PRT)**: Azure AD से जुड़े, पंजीकृत, या हाइब्रिड जुड़े उपकरणों पर सिंगल साइन-ऑन के लिए उपयोग किया जाता है। इन्हें ब्राउज़र साइन-इन प्रवाह में और उपकरण पर मोबाइल और डेस्कटॉप अनुप्रयोगों में साइन इन करने के लिए उपयोग किया जा सकता है।
- **Windows Hello for Business कुंजी (WHFB)**: पासवर्ड रहित प्रमाणीकरण के लिए उपयोग किया जाता है। इसका उपयोग प्राइमरी रीफ्रेश टोकन प्राप्त करने के लिए किया जाता है।

टोकन का सबसे दिलचस्प प्रकार प्राइमरी रीफ्रेश टोकन (PRT) है।

{{#ref}}
az-primary-refresh-token-prt.md
{{#endref}}

### पिवोटिंग तकनीकें

**समझौता की गई मशीन से क्लाउड तक**:

- [**पास द कुकी**](az-pass-the-cookie.md): ब्राउज़र से Azure कुकीज़ चुराएं और लॉगिन करने के लिए उनका उपयोग करें
- [**प्रक्रियाओं के एक्सेस टोकन डंप करें**](az-processes-memory-access-token.md): क्लाउड के साथ समन्वयित स्थानीय प्रक्रियाओं की मेमोरी को डंप करें (जैसे एक्सेल, Teams...) और स्पष्ट पाठ में एक्सेस टोकन खोजें।
- [**प्राइमरी रीफ्रेश टोकन फ़िशिंग**](az-phishing-primary-refresh-token-microsoft-entra.md)**:** इसका दुरुपयोग करने के लिए PRT को फ़िश करें
- [**PRT पास करें**](pass-the-prt.md): Azure तक पहुँचने के लिए डिवाइस PRT चुराएं।
- [**प्रमाणपत्र पास करें**](az-pass-the-certificate.md)**:** एक मशीन से दूसरी मशीन पर लॉगिन करने के लिए PRT के आधार पर एक प्रमाणपत्र उत्पन्न करें

**AD से समझौता करने से लेकर क्लाउड से समझौता करने और क्लाउड से AD से समझौता करने तक**:

- [**Azure AD कनेक्ट**](azure-ad-connect-hybrid-identity/)
- **क्लाउड से ऑन-प्रेम पर पिवोट करने का एक और तरीका है** [**Intune का दुरुपयोग करना**](../az-services/intune.md)

#### [Roadtx](https://github.com/dirkjanm/ROADtools)

यह उपकरण कई क्रियाएँ करने की अनुमति देता है जैसे Azure AD में एक मशीन को पंजीकृत करना ताकि PRT प्राप्त किया जा सके, और विभिन्न तरीकों से संसाधनों तक पहुँचने के लिए PRTs (वैध या चुराए गए) का उपयोग करना। ये सीधे हमले नहीं हैं, लेकिन यह विभिन्न तरीकों से संसाधनों तक पहुँचने के लिए PRTs के उपयोग को सुविधाजनक बनाता है। अधिक जानकारी के लिए देखें [https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/](https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/)

## संदर्भ

- [https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/](https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/)

{{#include ../../../banners/hacktricks-training.md}}
