# Hybrid Identity Miscellaneous Attacks

{{#include ../../../banners/hacktricks-training.md}}


## 强制将 Entra ID 用户同步到本地

如 [https://www.youtube.com/watch?v=JEIR5oGCwdg](https://www.youtube.com/watch?v=JEIR5oGCwdg) 中所述，可以通过在本地 AD 中更改 **`ProxyAddress`** 的值，将 Entra ID 管理员用户的电子邮件添加进去，并确保 AD 中用户的 UPN 与 Entra ID 中的匹配（这又是 Entra ID），例如 **`SMTP:admin@domain.onmicrosoft.com`**。这将 **强制将该用户从 Entra ID 同步到本地 AD**，因此如果知道该用户的密码，可以用来 **访问 Entra ID 中的管理员**。

为了将新用户从 Entra ID 同步到本地 AD，唯一的要求是：

- 控制本地 AD 中用户的属性（或有权限创建新用户）
- 知道用户的云端信息，以便从 Entra ID 同步到本地 AD
- 你可能还需要能够将 Entra ID 用户的 immutableID 属性更改为本地 AD 用户，以进行 **硬匹配**。


> [!CAUTION]
> Entra ID 不再允许将管理员从 Entra ID 同步到本地 AD。
> 此外，这 **不会绕过 MFA**。



## 参考文献

- [https://www.youtube.com/watch?v=JEIR5oGCwdg](https://www.youtube.com/watch?v=JEIR5oGCwdg)
- [https://activedirectorypro.com/sync-on-prem-ad-with-existing-azure-ad-users/](https://activedirectorypro.com/sync-on-prem-ad-with-existing-azure-ad-users/)
- [https://www.orbid365.be/manually-match-on-premise-ad-user-to-existing-office365-user/](https://www.orbid365.be/manually-match-on-premise-ad-user-to-existing-office365-user/)

{{#include ../../../banners/hacktricks-training.md}}
