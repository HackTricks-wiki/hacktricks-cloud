# Ataques Diversos de Identidade Híbrida

{{#include ../../../../banners/hacktricks-training.md}}


## Forçando a Sincronização de Usuários do Entra ID para o on-prem

Como mencionado em [https://www.youtube.com/watch?v=JEIR5oGCwdg](https://www.youtube.com/watch?v=JEIR5oGCwdg), era possível alterar o valor de **`ProxyAddress`** dentro de um usuário do AD no on-prem adicionando o e-mail de um usuário administrador do Entra ID e também garantindo que o UPN do usuário no AD e no Entra ID correspondesse (este é o Entra ID novamente), como **`SMTP:admin@domain.onmicrosoft.com`**. E isso **forçaria a sincronização deste usuário** do Entra ID para o AD on-prem, então se a senha do usuário fosse conhecida, poderia ser usada para **acessar o administrador usado no Entra ID.**

Para sincronizar um novo usuário do Entra ID para o AD on-prem, os requisitos são:

- Controlar os atributos de um usuário no AD on-prem (ou ter permissões para criar novos usuários)
- Conhecer o usuário apenas na nuvem para sincronizar do Entra ID para o AD on-prem
- Você também pode precisar ser capaz de alterar o atributo immutableID do usuário do Entra ID para o usuário do AD on-prem para fazer uma **correspondência exata**.


> [!CAUTION]
> O Entra ID não permite mais sincronizar administradores do Entra ID para o AD on-prem.
> Além disso, isso **não contornará o MFA**.



## Referências

- [https://www.youtube.com/watch?v=JEIR5oGCwdg](https://www.youtube.com/watch?v=JEIR5oGCwdg)
- [https://activedirectorypro.com/sync-on-prem-ad-with-existing-azure-ad-users/](https://activedirectorypro.com/sync-on-prem-ad-with-existing-azure-ad-users/)
- [https://www.orbid365.be/manually-match-on-premise-ad-user-to-existing-office365-user/](https://www.orbid365.be/manually-match-on-premise-ad-user-to-existing-office365-user/)

{{#include ../../../../banners/hacktricks-training.md}}
