# ハイブリッドアイデンティティの雑多な攻撃

{{#include ../../../banners/hacktricks-training.md}}


## Entra ID ユーザーのオンプレミスへの同期強制

[https://www.youtube.com/watch?v=JEIR5oGCwdg](https://www.youtube.com/watch?v=JEIR5oGCwdg)で述べられているように、オンプレミスのAD内のADユーザーの**`ProxyAddress`**の値を変更し、Entra ID管理者ユーザーのメールアドレスを追加し、ADとEntra IDのユーザーのUPNが一致することを確認することが可能でした（これが再びEntra IDです）、例えば**`SMTP:admin@domain.onmicrosoft.com`**のように。そして、これにより**このユーザーの同期を強制**することができ、ユーザーのパスワードが知られていれば、Entra IDで使用されている管理者に**アクセスする**ことができました。

Entra IDからオンプレミスADに新しいユーザーを同期させるための要件は以下の通りです：

- オンプレミスAD内のユーザーの属性を制御する（または新しいユーザーを作成する権限を持つ）
- Entra IDからオンプレミスADに同期するためのユーザーがクラウド専用であることを知っている
- **ハードマッチ**を行うために、Entra IDユーザーからオンプレミスADユーザーへのimmutableID属性を変更できる必要があるかもしれません。


> [!CAUTION]
> Entra IDはもはやEntra IDからオンプレミスADへの管理者の同期を許可していません。
> また、これは**MFAをバイパスしません**。



## 参考文献

- [https://www.youtube.com/watch?v=JEIR5oGCwdg](https://www.youtube.com/watch?v=JEIR5oGCwdg)
- [https://activedirectorypro.com/sync-on-prem-ad-with-existing-azure-ad-users/](https://activedirectorypro.com/sync-on-prem-ad-with-existing-azure-ad-users/)
- [https://www.orbid365.be/manually-match-on-premise-ad-user-to-existing-office365-user/](https://www.orbid365.be/manually-match-on-premise-ad-user-to-existing-office365-user/)

{{#include ../../../banners/hacktricks-training.md}}
