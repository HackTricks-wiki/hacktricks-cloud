# Az - Local Cloud Credentials

{{#include ../../../banners/hacktricks-training.md}}

## ローカルトークンストレージとセキュリティ考慮事項

### Azure CLI (コマンドラインインターフェース)

トークンと機密データはAzure CLIによってローカルに保存されており、セキュリティ上の懸念があります：

1. **アクセストークン**: `C:\Users\<username>\.Azure`にある`accessTokens.json`にプレーンテキストで保存されています。
2. **サブスクリプション情報**: 同じディレクトリにある`azureProfile.json`にはサブスクリプションの詳細が含まれています。
3. **ログファイル**: `.azure`内の`ErrorRecords`フォルダーには、埋め込まれた資格情報を含む実行されたコマンドや、トークンを使用してアクセスされたURLなど、露出した資格情報を含むログが含まれている可能性があります。

### Azure PowerShell

Azure PowerShellもトークンと機密データを保存しており、ローカルでアクセス可能です：

1. **アクセストークン**: `C:\Users\<username>\.Azure`にある`TokenCache.dat`にプレーンテキストで保存されています。
2. **サービスプリンシパルシークレット**: これらは`AzureRmContext.json`に暗号化されずに保存されています。
3. **トークン保存機能**: ユーザーは`Save-AzContext`コマンドを使用してトークンを永続化することができますが、不正アクセスを防ぐために注意して使用する必要があります。

## 自動ツールでの発見

- [**Winpeas**](https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS/winPEASexe)
- [**Get-AzurePasswords.ps1**](https://github.com/NetSPI/MicroBurst/blob/master/AzureRM/Get-AzurePasswords.ps1)

## セキュリティ推奨事項

機密データがプレーンテキストで保存されていることを考慮し、これらのファイルとディレクトリを保護することが重要です：

- これらのファイルへのアクセス権を制限する。
- 不正アクセスや予期しない変更のために、これらのディレクトリを定期的に監視および監査する。
- 可能な限り機密ファイルに対して暗号化を使用する。
- ユーザーに対して、こうした機密情報の取り扱いに関するリスクとベストプラクティスについて教育する。

{{#include ../../../banners/hacktricks-training.md}}
