# Az - Pass the Cookie

{{#include ../../../banners/hacktricks-training.md}}

## Neden Çerezler?

Tarayıcı **çerezleri**, **kimlik doğrulama ve MFA**'yı **bypass** etmek için harika bir mekanizmadır. Kullanıcı uygulamada zaten kimlik doğrulaması yapmış olduğundan, oturum **çerezi** bu kullanıcı olarak **verilere erişmek** için kullanılabilir, yeniden kimlik doğrulaması yapmaya gerek kalmaz.

**Tarayıcı çerezlerinin nerede bulunduğunu** görebilirsiniz:

{{#ref}}
https://book.hacktricks.wiki/en/generic-methodologies-and-resources/basic-forensic-methodology/specific-software-file-type-tricks/browser-artifacts.html#google-chrome
{{#endref}}

## Saldırı

Zorlayıcı kısım, bu **çerezlerin** Microsoft Veri Koruma API'si (**DPAPI**) aracılığıyla **kullanıcı** için şifrelenmiş olmasıdır. Bu, çerezlerin ait olduğu kullanıcıya bağlı [şifreleme anahtarları](https://book.hacktricks.wiki/en/windows-hardening/windows-local-privilege-escalation/dpapi-extracting-passwords.html) kullanılarak şifrelenir. Bununla ilgili daha fazla bilgi bulabilirsiniz:

{{#ref}}
https://book.hacktricks.wiki/en/windows-hardening/windows-local-privilege-escalation/dpapi-extracting-passwords.html
{{#endref}}

Mimikatz elimdeyken, bu komutla **bir kullanıcının çerezlerini** şifrelenmiş olsalar bile **çıkartabilirim**:
```bash
mimikatz.exe privilege::debug log "dpapi::chrome /in:%localappdata%\google\chrome\USERDA~1\default\cookies /unprotect" exit
```
Azure için, **`ESTSAUTH`**, **`ESTSAUTHPERSISTENT`** ve **`ESTSAUTHLIGHT`** dahil olmak üzere kimlik doğrulama çerezlerine önem veriyoruz. Bunlar, kullanıcının son zamanlarda Azure'da aktif olmasından dolayı bulunmaktadır.

Sadece login.microsoftonline.com adresine gidin ve **`ESTSAUTHPERSISTENT`** çerezini ( “Stay Signed In” seçeneği ile oluşturulan) veya **`ESTSAUTH`** çerezini ekleyin. Ve kimlik doğrulamanız yapılacaktır.

## References

- [https://stealthbits.com/blog/bypassing-mfa-with-pass-the-cookie/](https://stealthbits.com/blog/bypassing-mfa-with-pass-the-cookie/)

{{#include ../../../banners/hacktricks-training.md}}
