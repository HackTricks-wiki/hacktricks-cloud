# Az - Automation Accounts Persistence

{{#include ../../../banners/hacktricks-training.md}}

## ストレージ特権昇格

Automation Accountsに関する詳細情報は、以下を参照してください:

{{#ref}}
../az-services/az-automation-accounts.md
{{#endref}}

### 既存のランブックにバックドアを追加

攻撃者が自動化アカウントにアクセスできる場合、**バックドアを追加**して既存のランブックを**持続性を維持**し、ランブックが実行されるたびにトークンなどの**データを抽出**することができます。

### スケジュールとウェブフック

既存のランブックを作成または変更し、スケジュールまたはウェブフックを追加します。これにより、攻撃者は**環境へのアクセスが失われた場合でも持続性を維持**し、特定の時間にMIからトークンを漏洩させるバックドアを実行したり、ウェブフックにリクエストを送信していつでも実行することができます。

### ハイブリッドワーカーグループで使用されるVM内のマルウェア

VMがハイブリッドワーカーグループとして使用されている場合、攻撃者はVM内に**マルウェアをインストール**して**持続性を維持**し、VMおよび自動化アカウントに与えられた管理IDのトークンなどの**データを抽出**することができます。

### カスタム環境パッケージ

自動化アカウントがカスタム環境でカスタムパッケージを使用している場合、攻撃者は**パッケージを変更**して**持続性を維持**し、トークンなどの**データを抽出**することができます。これは、手動でアップロードされたカスタムパッケージが悪意のあるコードのチェックをほとんど受けないため、隠密な持続性の方法にもなります。

### 外部リポジトリの妥協

自動化アカウントがGithubのような外部リポジトリを使用してコードを保存している場合、攻撃者は**リポジトリを妥協**して**持続性を維持**し、トークンなどの**データを抽出**することができます。これは、コードの最新バージョンが自動的にランブックと同期される場合に特に興味深いです。

{{#include ../../../banners/hacktricks-training.md}}
