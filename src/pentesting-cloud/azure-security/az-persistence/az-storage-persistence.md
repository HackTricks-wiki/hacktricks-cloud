# Az - Almacenamiento de Persistencia

{{#include ../../../banners/hacktricks-training.md}}

## Privesc de Almacenamiento

Para más información sobre almacenamiento, consulta:

{{#ref}}
../az-services/az-storage.md
{{#endref}}

### Trucos Comunes

- Mantener las claves de acceso
- Generar SAS
- Los usuarios delegados tienen un máximo de 7 días

### Microsoft.Storage/storageAccounts/blobServices/containers/update && Microsoft.Storage/storageAccounts/blobServices/deletePolicy/write

Estos permisos permiten al usuario modificar las propiedades del servicio de blobs para la función de retención de eliminación de contenedores, que habilita o configura el período de retención para contenedores eliminados. Estos permisos se pueden utilizar para mantener la persistencia y proporcionar una ventana de oportunidad para que el atacante recupere o manipule contenedores eliminados que deberían haber sido eliminados permanentemente y acceder a información sensible.
```bash
az storage account blob-service-properties update \
--account-name <STORAGE_ACCOUNT_NAME> \
--enable-container-delete-retention true \
--container-delete-retention-days 100
```
### Microsoft.Storage/storageAccounts/read && Microsoft.Storage/storageAccounts/listKeys/action

Estos permisos pueden permitir al atacante modificar las políticas de retención, restaurar datos eliminados y acceder a información sensible.
```bash
az storage blob service-properties delete-policy update \
--account-name <STORAGE_ACCOUNT_NAME> \
--enable true \
--days-retained 100
```
{{#include ../../../banners/hacktricks-training.md}}
