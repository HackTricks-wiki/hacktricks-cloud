# Az - Storage Persistence

{{#include ../../../banners/hacktricks-training.md}}

## ストレージの権限昇格

ストレージに関する詳細情報は、以下を確認してください：

{{#ref}}
../az-services/az-storage.md
{{#endref}}

### 一般的なトリック

- アクセスキーを保持する
- SASを生成する
- ユーザー委任は最大7日間

### Microsoft.Storage/storageAccounts/blobServices/containers/update && Microsoft.Storage/storageAccounts/blobServices/deletePolicy/write

これらの権限は、削除されたコンテナの保持期間を有効にまたは構成するためのコンテナ削除保持機能のために、ユーザーがblobサービスのプロパティを変更することを許可します。これらの権限は、攻撃者が永久に削除されるべき削除されたコンテナを回復または操作するための機会を提供するために、持続性を維持するために使用できます。
```bash
az storage account blob-service-properties update \
--account-name <STORAGE_ACCOUNT_NAME> \
--enable-container-delete-retention true \
--container-delete-retention-days 100
```
### Microsoft.Storage/storageAccounts/read && Microsoft.Storage/storageAccounts/listKeys/action

これらの権限は、攻撃者が保持ポリシーを変更し、削除されたデータを復元し、機密情報にアクセスすることを可能にします。
```bash
az storage blob service-properties delete-policy update \
--account-name <STORAGE_ACCOUNT_NAME> \
--enable true \
--days-retained 100
```
{{#include ../../../banners/hacktricks-training.md}}
