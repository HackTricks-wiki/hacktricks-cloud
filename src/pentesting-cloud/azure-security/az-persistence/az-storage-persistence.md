# Az - Storage Persistence

{{#include ../../../banners/hacktricks-training.md}}

## Storage Privesc

Para mais informações sobre armazenamento, consulte:

{{#ref}}
../az-services/az-storage.md
{{#endref}}

### Truques comuns

- Mantenha as chaves de acesso
- Gere SAS
- Usuário delegado tem um máximo de 7 dias

### Microsoft.Storage/storageAccounts/blobServices/containers/update && Microsoft.Storage/storageAccounts/blobServices/deletePolicy/write

Essas permissões permitem que o usuário modifique as propriedades do serviço de blob para o recurso de retenção de exclusão de contêiner, que habilita ou configura o período de retenção para contêineres excluídos. Essas permissões podem ser usadas para manter a persistência e fornecer uma janela de oportunidade para o atacante recuperar ou manipular contêineres excluídos que deveriam ter sido removidos permanentemente e acessar informações sensíveis.
```bash
az storage account blob-service-properties update \
--account-name <STORAGE_ACCOUNT_NAME> \
--enable-container-delete-retention true \
--container-delete-retention-days 100
```
### Microsoft.Storage/storageAccounts/read && Microsoft.Storage/storageAccounts/listKeys/action

Essas permissões podem levar o atacante a modificar as políticas de retenção, restaurar dados excluídos e acessar informações sensíveis.
```bash
az storage blob service-properties delete-policy update \
--account-name <STORAGE_ACCOUNT_NAME> \
--enable true \
--days-retained 100
```
{{#include ../../../banners/hacktricks-training.md}}
