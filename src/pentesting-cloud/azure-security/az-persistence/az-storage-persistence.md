# Az - Storage Persistence

{{#include ../../../banners/hacktricks-training.md}}

## Storage Privesc

Для отримання додаткової інформації про зберігання дивіться:

{{#ref}}
../az-services/az-storage.md
{{#endref}}

### Загальні трюки

- Зберігайте ключі доступу
- Генеруйте SAS
- Делеговані користувачі - максимум 7 днів

### Microsoft.Storage/storageAccounts/blobServices/containers/update && Microsoft.Storage/storageAccounts/blobServices/deletePolicy/write

Ці дозволи дозволяють користувачу змінювати властивості служби блобів для функції збереження видалення контейнерів, яка дозволяє або налаштовує період збереження для видалених контейнерів. Ці дозволи можуть бути використані для підтримки стійкості, щоб надати можливість зловмиснику відновити або маніпулювати видаленими контейнерами, які повинні були бути назавжди видалені, та отримувати доступ до чутливої інформації.
```bash
az storage account blob-service-properties update \
--account-name <STORAGE_ACCOUNT_NAME> \
--enable-container-delete-retention true \
--container-delete-retention-days 100
```
### Microsoft.Storage/storageAccounts/read && Microsoft.Storage/storageAccounts/listKeys/action

Ці дозволи можуть призвести до того, що зловмисник змінить політики зберігання, відновить видалені дані та отримає доступ до чутливої інформації.
```bash
az storage blob service-properties delete-policy update \
--account-name <STORAGE_ACCOUNT_NAME> \
--enable true \
--days-retained 100
```
{{#include ../../../banners/hacktricks-training.md}}
