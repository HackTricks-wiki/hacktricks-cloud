# Az - Storage Persistence

{{#include ../../../banners/hacktricks-training.md}}

## Storage Privesc

Aby uzyskać więcej informacji na temat przechowywania, sprawdź:

{{#ref}}
../az-services/az-storage.md
{{#endref}}

### Common tricks

- Zachowaj klucze dostępu
- Wygeneruj SAS
- Użytkownik delegowany ma maksymalnie 7 dni

### Microsoft.Storage/storageAccounts/blobServices/containers/update && Microsoft.Storage/storageAccounts/blobServices/deletePolicy/write

Te uprawnienia pozwalają użytkownikowi modyfikować właściwości usługi blob dla funkcji retencji usuwania kontenerów, która umożliwia lub konfiguruje okres retencji dla usuniętych kontenerów. Te uprawnienia mogą być używane do utrzymywania trwałości, aby zapewnić możliwość dla atakującego na odzyskanie lub manipulację usuniętymi kontenerami, które powinny zostać trwale usunięte oraz dostęp do wrażliwych informacji.
```bash
az storage account blob-service-properties update \
--account-name <STORAGE_ACCOUNT_NAME> \
--enable-container-delete-retention true \
--container-delete-retention-days 100
```
### Microsoft.Storage/storageAccounts/read && Microsoft.Storage/storageAccounts/listKeys/action

Te uprawnienia mogą prowadzić do tego, że atakujący zmodyfikuje polityki przechowywania, przywróci usunięte dane i uzyska dostęp do wrażliwych informacji.
```bash
az storage blob service-properties delete-policy update \
--account-name <STORAGE_ACCOUNT_NAME> \
--enable true \
--days-retained 100
```
{{#include ../../../banners/hacktricks-training.md}}
