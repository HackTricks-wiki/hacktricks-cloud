# Az - Storage Persistence

{{#include ../../../banners/hacktricks-training.md}}

## Storage Privesc

Für weitere Informationen über Storage siehe:

{{#ref}}
../az-services/az-storage.md
{{#endref}}

### Häufige Tricks

- Halte die Zugriffsschlüssel
- Generiere SAS
- Benutzerdelegierungen sind maximal 7 Tage

### Microsoft.Storage/storageAccounts/blobServices/containers/update && Microsoft.Storage/storageAccounts/blobServices/deletePolicy/write

Diese Berechtigungen ermöglichen es dem Benutzer, die Eigenschaften des Blob-Dienstes für die Löschaufbewahrungsfunktion des Containers zu ändern, die den Aufbewahrungszeitraum für gelöschte Container aktiviert oder konfiguriert. Diese Berechtigungen können verwendet werden, um die Persistenz aufrechtzuerhalten und dem Angreifer ein Zeitfenster zu bieten, um gelöschte Container, die dauerhaft entfernt werden sollten, wiederherzustellen oder zu manipulieren und auf sensible Informationen zuzugreifen.
```bash
az storage account blob-service-properties update \
--account-name <STORAGE_ACCOUNT_NAME> \
--enable-container-delete-retention true \
--container-delete-retention-days 100
```
### Microsoft.Storage/storageAccounts/read && Microsoft.Storage/storageAccounts/listKeys/action

Diese Berechtigungen können es dem Angreifer ermöglichen, die Aufbewahrungsrichtlinien zu ändern, gelöschte Daten wiederherzustellen und auf sensible Informationen zuzugreifen.
```bash
az storage blob service-properties delete-policy update \
--account-name <STORAGE_ACCOUNT_NAME> \
--enable true \
--days-retained 100
```
{{#include ../../../banners/hacktricks-training.md}}
