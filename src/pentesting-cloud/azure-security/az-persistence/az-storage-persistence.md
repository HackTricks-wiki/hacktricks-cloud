# Az - Storage Persistence

{{#include ../../../banners/hacktricks-training.md}}

## Storage Privesc

저장소에 대한 자세한 정보는 다음을 확인하세요:

{{#ref}}
../az-services/az-storage.md
{{#endref}}

### 일반적인 요령

- 액세스 키 유지
- SAS 생성
- 사용자 위임은 최대 7일

### Microsoft.Storage/storageAccounts/blobServices/containers/update && Microsoft.Storage/storageAccounts/blobServices/deletePolicy/write

이 권한은 사용자가 삭제된 컨테이너에 대한 보존 기간을 활성화하거나 구성하는 컨테이너 삭제 보존 기능을 위해 blob 서비스 속성을 수정할 수 있도록 허용합니다. 이러한 권한은 공격자가 영구적으로 제거되어야 하는 삭제된 컨테이너를 복구하거나 조작할 수 있는 기회를 제공하기 위해 지속성을 유지하는 데 사용될 수 있습니다.
```bash
az storage account blob-service-properties update \
--account-name <STORAGE_ACCOUNT_NAME> \
--enable-container-delete-retention true \
--container-delete-retention-days 100
```
### Microsoft.Storage/storageAccounts/read && Microsoft.Storage/storageAccounts/listKeys/action

이 권한은 공격자가 보존 정책을 수정하고, 삭제된 데이터를 복원하며, 민감한 정보에 접근할 수 있게 할 수 있습니다.
```bash
az storage blob service-properties delete-policy update \
--account-name <STORAGE_ACCOUNT_NAME> \
--enable true \
--days-retained 100
```
{{#include ../../../banners/hacktricks-training.md}}
