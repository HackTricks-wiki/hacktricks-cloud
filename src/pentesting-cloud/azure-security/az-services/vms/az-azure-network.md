# Az - Azure Network

{{#include ../../../../banners/hacktricks-training.md}}

## Temel Bilgiler

Azure, kullanıcıların Azure bulutunda **izole** **ağlar** oluşturmasına olanak tanıyan **sanaldan ağlar (VNet)** sağlar. Bu VNets içinde, sanal makineler, uygulamalar, veritabanları gibi kaynaklar güvenli bir şekilde barındırılabilir ve yönetilebilir. Azure'daki ağ, hem bulut içindeki iletişimi (Azure hizmetleri arasında) hem de dış ağlar ve internetle bağlantıyı destekler.\
Ayrıca, VNets'in diğer VNets ve yerel ağlarla **bağlanması** mümkündür.

## Sanal Ağ (VNET) ve Alt Ağlar

Azure Sanal Ağı (VNet), bulutta kendi ağınızın bir temsilidir ve aboneliğinize ayrılmış Azure ortamında **mantıksal izolasyon** sağlar. VNets, Azure'da sanal özel ağlar (VPN'ler) oluşturmanıza ve yönetmenize olanak tanır ve Sanal Makineler (VM'ler), veritabanları ve uygulama hizmetleri gibi kaynakları barındırır. **Ağ ayarları üzerinde tam kontrol** sunar, IP adresi aralıkları, alt ağ oluşturma, yönlendirme tabloları ve ağ geçitleri dahil.

**Alt ağlar**, belirli **IP adresi aralıkları** ile tanımlanan bir VNet içindeki alt bölümlerdir. Bir VNet'i birden fazla alt ağa bölerek, kaynakları ağ mimarinize göre organize edebilir ve güvence altına alabilirsiniz.\
Varsayılan olarak, aynı Azure Sanal Ağı (VNet) içindeki tüm alt ağlar **birbirleriyle iletişim kurabilir** ve herhangi bir kısıtlama olmaksızın çalışabilir.

**Örnek:**

- `MyVNet` IP adresi aralığı 10.0.0.0/16.
- **Alt Ağ-1:** 10.0.0.0/24 web sunucuları için.
- **Alt Ağ-2:** 10.0.1.0/24 veritabanı sunucuları için.

### Sayım

Azure hesabındaki tüm VNets ve alt ağları listelemek için Azure Komut Satırı Arayüzü (CLI) kullanabilirsiniz. İşte adımlar:

{{#tabs }}
{{#tab name="az cli" }}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}"

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{{#endtab }}
{{#tab name="PowerShell" }}
```powershell
# List VNets
Get-AzVirtualNetwork | Select-Object Name, Location, @{Name="AddressSpace"; Expression={$_.AddressSpace.AddressPrefixes}}

# List subnets of a VNet
Get-AzVirtualNetwork -ResourceGroupName <ResourceGroupName> -Name <VNetName> |
Select-Object -ExpandProperty Subnets |
Select-Object Name, AddressPrefix
```
{{#endtab }}
{{#endtabs }}

## Ağ Güvenlik Grupları (NSG)

Bir **Ağ Güvenlik Grubu (NSG)**, Azure Sanal Ağı (VNet) içindeki Azure kaynaklarına giden ve gelen ağ trafiğini filtreler. **Güvenlik kuralları** setini barındırır ve bu kurallar, kaynak portu, kaynak IP, port hedefi ile **gelen ve giden trafik için hangi portların açılacağını** belirtebilir ve bir öncelik atamak mümkündür (öncelik numarası ne kadar düşükse, öncelik o kadar yüksektir).

NSG'ler **alt ağlar ve NIC'ler** ile ilişkilendirilebilir.

**Kural örneği:**

- Herhangi bir kaynaktan web sunucularınıza HTTP trafiğine (port 80) izin veren bir gelen kural.
- Belirli bir hedef IP adresi aralığına yalnızca SQL trafiğine (port 1433) izin veren bir giden kural.

### Sayım

{{#tabs }}
{{#tab name="az cli" }}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table
az network nsg show --name <nsg-name>

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table

# Get NICs and subnets using this NSG
az network nsg show --name MyLowCostVM-nsg --resource-group Resource_Group_1 --query "{subnets: subnets, networkInterfaces: networkInterfaces}"
```
{{#endtab }}
{{#tab name="PowerShell" }}
```powershell
# List NSGs
Get-AzNetworkSecurityGroup | Select-Object Name, Location
Get-AzNetworkSecurityGroup -Name <NSGName> -ResourceGroupName <ResourceGroupName>

# Get NSG rules
(Get-AzNetworkSecurityGroup -ResourceGroupName <NSGName> -Name <ResourceGroupName>).SecurityRules

# Get NICs and subnets using this NSG
(Get-AzNetworkSecurityGroup -Name <NSGName> -ResourceGroupName <ResourceGroupName>).Subnets
```
{{#endtab }}
{{#endtabs }}

## Azure Firewall

Azure Firewall, bulut kaynaklarını trafiği denetleyerek ve inceleyerek koruyan **yönetilen bir ağ güvenlik hizmetidir**. **Durum bilgisi olan bir güvenlik duvarıdır** ve 3 ile 7. katmanlar arasındaki kurallara göre trafiği filtreler, hem **Azure içinde** (doğu-batı trafiği) hem de **dış ağlara/ dış ağlardan** (kuzey-güney trafiği) iletişimi destekler. **Sanal Ağ (VNet) düzeyinde** dağıtılır ve VNet'teki tüm alt ağlar için merkezi koruma sağlar. Azure Firewall, trafik taleplerini karşılamak için otomatik olarak ölçeklenir ve manuel kurulum gerektirmeden yüksek kullanılabilirlik sağlar.

Üç SKU'da mevcuttur—**Basic**, **Standard** ve **Premium**, her biri belirli müşteri ihtiyaçlarına göre özelleştirilmiştir:

| **Tavsiye Edilen Kullanım Durumu** | Sınırlı ihtiyaçlara sahip Küçük/Orta Ölçekli İşletmeler (SMB'ler) | Genel kurumsal kullanım, Katman 3–7 filtreleme | Son derece hassas ortamlar (örneğin, ödeme işleme)  |
| ----------------------------------- | --------------------------------------------------------------- | ------------------------------------------------ | --------------------------------------------------- |
| **Performans**                      | 250 Mbps'ye kadar verim                                       | 30 Gbps'ye kadar verim                            | 100 Gbps'ye kadar verim                             |
| **Tehdit İstihbaratı**             | Sadece uyarılar                                              | Uyarılar ve engelleme (kötü niyetli IP'ler/alan adları) | Uyarılar ve engelleme (gelişmiş tehdit istihbaratı) |
| **L3–L7 Filtreleme**               | Temel filtreleme                                             | Protokoller arasında durum bilgisi olan filtreleme | Gelişmiş inceleme ile durum bilgisi olan filtreleme  |
| **Gelişmiş Tehdit Koruması**       | Mevcut değil                                                | Tehdit istihbaratına dayalı filtreleme           | Saldırı Tespit ve Önleme Sistemi (IDPS) içerir      |
| **TLS İncelemesi**                 | Mevcut değil                                                | Mevcut değil                                      | Gelen/giden TLS sonlandırmasını destekler            |
| **Kullanılabilirlik**               | Sabit arka uç (2 VM)                                       | Otomatik ölçeklendirme                            | Otomatik ölçeklendirme                               |
| **Yönetim Kolaylığı**               | Temel kontroller                                            | Güvenlik Duvarı Yöneticisi aracılığıyla yönetilir | Güvenlik Duvarı Yöneticisi aracılığıyla yönetilir    |

### Enumeration

{{#tabs }}
{{#tab name="az cli" }}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{{#endtab }}
{{#tab name="PowerShell" }}
```powershell
# List Azure Firewalls
Get-AzFirewall

# Get network rules of a firewall
(Get-AzFirewall -Name <FirewallName> -ResourceGroupName <ResourceGroupName>).NetworkRuleCollections

# Get application rules of a firewall
(Get-AzFirewall -Name <FirewallName> -ResourceGroupName <ResourceGroupName>).ApplicationRuleCollections

# Get nat rules of a firewall
(Get-AzFirewall -Name <FirewallName> -ResourceGroupName <ResourceGroupName>).NatRuleCollections
```
{{#endtab }}
{{#endtabs }}

## Azure Yönlendirme Tabloları

Azure **Yönlendirme Tabloları**, bir alt ağ içindeki ağ trafiğinin yönlendirilmesini kontrol etmek için kullanılır. Paketlerin nasıl yönlendirilmesi gerektiğini belirten kuralları tanımlar; bu, Azure kaynaklarına, internete veya bir Sanal Cihaz veya Azure Güvenlik Duvarı gibi belirli bir sonraki adrese olabilir. Bir yönlendirme tablosunu bir **alt ağ** ile ilişkilendirebilirsiniz ve o alt ağ içindeki tüm kaynaklar tablodaki yönlendirmeleri takip eder.

**Örnek:** Eğer bir alt ağ, dışa doğru trafiği inceleme için bir Ağ Sanal Cihazı (NVA) üzerinden yönlendirmesi gereken kaynakları barındırıyorsa, tüm trafiği (örneğin, `0.0.0.0/0`) NVA'nın özel IP adresine yönlendirmek için bir yönlendirme tablosunda bir **yönlendirme** oluşturabilirsiniz.

### **Numaralandırma**

{{#tabs }}
{{#tab name="az cli" }}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List routes for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{{#endtab }}
{{#tab name="PowerShell" }}
```powershell
# List Route Tables
Get-AzRouteTable

# List routes for a table
(Get-AzRouteTable -Name <RouteTableName> -ResourceGroupName <ResourceGroupName>).Routes
```
{{#endtab }}
{{#endtabs }}

## Azure Özel Bağlantı

Azure Özel Bağlantı, **Azure hizmetlerine özel erişim sağlamayı** mümkün kılan bir hizmettir ve **Azure sanal ağınız (VNet) ile hizmet arasındaki trafiğin tamamen Microsoft'un Azure omurga ağı içinde seyahat etmesini sağlar**. Bu, hizmeti VNet'inize getirir. Bu yapılandırma, verileri genel internete maruz bırakmadığı için güvenliği artırır.

Özel Bağlantı, Azure Depolama, Azure SQL Veritabanı ve Özel Bağlantı aracılığıyla paylaşılan özel hizmetler gibi çeşitli Azure hizmetleri ile kullanılabilir. Kendi VNet'inizden veya farklı Azure aboneliklerinden hizmetleri güvenli bir şekilde tüketmenin bir yolunu sunar.

> [!CAUTION]
> NSG'ler özel uç noktalar için geçerli değildir, bu da bir NSG'yi Özel Bağlantıyı içeren bir alt ağa ilişkilendirmenin hiçbir etkisi olmayacağı anlamına gelir.

**Örnek:**

VNet'inizden güvenli bir şekilde erişmek istediğiniz bir **Azure SQL Veritabanı** senaryosunu düşünün. Normalde, bu genel internet üzerinden geçiş yapmayı gerektirebilir. Özel Bağlantı ile, Azure SQL Veritabanı hizmetine doğrudan bağlanan **VNet'inizde bir özel uç nokta oluşturabilirsiniz**. Bu uç nokta, veritabanını kendi VNet'inizin bir parçasıymış gibi gösterir ve özel bir IP adresi aracılığıyla erişilebilir hale getirir, böylece güvenli ve özel erişim sağlanır.

### **Sayımlama**

{{#tabs }}
{{#tab name="az cli" }}
```bash
# List Private Link Services
az network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{{#endtab }}
{{#tab name="PowerShell" }}
```powershell
# List Private Link Services
Get-AzPrivateLinkService | Select-Object Name, Location, ResourceGroupName

# List Private Endpoints
Get-AzPrivateEndpoint | Select-Object Name, Location, ResourceGroupName, PrivateEndpointConnections
```
{{#endtab }}
{{#endtabs }}

## Azure Servis Uç Noktaları

Azure Servis Uç Noktaları, sanal ağınızın özel adres alanını ve VNet'inizin kimliğini doğrudan bir bağlantı üzerinden Azure hizmetlerine uzatır. Servis uç noktalarını etkinleştirerek, **VNet'inizdeki kaynaklar Azure hizmetlerine güvenli bir şekilde bağlanabilir**, örneğin Azure Storage ve Azure SQL Database, Azure'ın omurga ağı kullanılarak. Bu, **VNet'ten Azure hizmetine giden trafiğin Azure ağı içinde kalmasını sağlar**, daha güvenli ve güvenilir bir yol sunar.

**Örnek:**

Örneğin, bir **Azure Storage** hesabı varsayılan olarak genel internet üzerinden erişilebilir. **VNet'iniz içinde Azure Storage için bir servis uç noktası etkinleştirerek**, yalnızca VNet'inizden gelen trafiğin depolama hesabına erişmesini sağlayabilirsiniz. Depolama hesabı güvenlik duvarı, yalnızca VNet'inizden gelen trafiği kabul edecek şekilde yapılandırılabilir.

### **Numaralandırma**

{{#tabs }}
{{#tab name="az cli" }}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{{#endtab }}
{{#tab name="PowerShell" }}
```powershell
# List Virtual Networks with Service Endpoints
Get-AzVirtualNetwork

# List Subnets with Service Endpoints
(Get-AzVirtualNetwork -ResourceGroupName <ResourceGroupName> -Name <VNetName>).Subnets
```
{{#endtab }}
{{#endtabs }}

### Servis Uç Noktaları ve Özel Bağlantılar Arasındaki Farklar

Microsoft, [**belgelerde**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints) Özel Bağlantıların kullanılmasını önermektedir:

<figure><img src="../../../../images/image (25).png" alt=""><figcaption></figcaption></figure>

**Servis Uç Noktaları:**

- VNet'inizden Azure hizmetine giden trafik, kamu internetini atlayarak Microsoft Azure omurga ağı üzerinden geçer.
- Uç nokta, Azure hizmetine doğrudan bir bağlantıdır ve VNet içinde hizmet için özel bir IP sağlamaz.
- Hizmet, VNet'inizden dışarıda, hizmet güvenlik duvarını bu tür trafiği engelleyecek şekilde yapılandırmadığınız sürece, genel uç noktası aracılığıyla hala erişilebilir.
- Alt ağ ile Azure hizmeti arasında bire bir ilişki vardır.
- Özel Bağlantılardan daha az maliyetlidir.

**Özel Bağlantılar:**

- Özel Bağlantı, Azure hizmetlerini VNet'inize özel bir uç nokta aracılığıyla haritalar; bu, VNet'iniz içinde özel bir IP adresine sahip bir ağ arayüzüdür.
- Azure hizmetine bu özel IP adresi kullanılarak erişilir, bu da onu ağınızın bir parçası gibi gösterir.
- Özel Bağlantı aracılığıyla bağlanan hizmetlere yalnızca VNet'inizden veya bağlı ağlardan erişilebilir; hizmete kamu internet erişimi yoktur.
- Azure hizmetlerine veya Azure'da barındırılan kendi hizmetlerinize güvenli bir bağlantı sağlar ve başkaları tarafından paylaşılan hizmetlere de bağlantı sunar.
- VNet'inizde özel bir uç nokta aracılığıyla daha ayrıntılı erişim kontrolü sağlar; bu, servis uç noktaları ile alt ağ düzeyinde daha geniş erişim kontrolüne kıyasla daha özelleşmiş bir kontrol sunar.

Özetle, hem Servis Uç Noktaları hem de Özel Bağlantılar Azure hizmetlerine güvenli bağlantı sağlarken, **Özel Bağlantılar, hizmetlerin kamu internetine maruz kalmadan özel olarak erişilmesini sağlayarak daha yüksek bir izolasyon ve güvenlik seviyesi sunar**. Öte yandan, Servis Uç Noktaları, VNet içinde özel bir IP gerektirmeden Azure hizmetlerine basit, güvenli erişim gereken genel durumlar için daha kolay bir şekilde kurulabilir.

## Azure Front Door (AFD) & AFD WAF

**Azure Front Door**, **küresel web uygulamalarınızın hızlı teslimatı** için ölçeklenebilir ve güvenli bir giriş noktasıdır. **Küresel yük dengeleme, site hızlandırma, SSL yük dengelemesi ve Web Uygulama Güvenlik Duvarı (WAF)** yetenekleri gibi çeşitli hizmetleri tek bir hizmette **birleştirir**. Azure Front Door, **kullanıcıya en yakın kenar konumuna** dayalı akıllı yönlendirme sağlar, böylece optimal performans ve güvenilirlik sunar. Ayrıca, URL tabanlı yönlendirme, çoklu site barındırma, oturum bağlılığı ve uygulama katmanı güvenliği sunar.

**Azure Front Door WAF**, **web tabanlı saldırılardan web uygulamalarını korumak** için tasarlanmıştır ve arka uç kodunda değişiklik gerektirmez. SQL enjeksiyonu, çapraz site betikleme ve diğer yaygın saldırılar gibi tehditlere karşı korumak için özel kurallar ve yönetilen kural setleri içerir.

**Örnek:**

Dünyanın dört bir yanında kullanıcıları olan küresel bir dağıtım uygulamanız olduğunu hayal edin. Azure Front Door'u kullanarak **kullanıcı isteklerini uygulamanızı barındıran en yakın bölgesel veri merkezine yönlendirebilirsiniz**, böylece gecikmeyi azaltır, kullanıcı deneyimini iyileştirir ve **WAF yetenekleri ile web saldırılarına karşı savunursunuz**. Belirli bir bölge kesinti yaşarsa, Azure Front Door trafiği otomatik olarak bir sonraki en iyi konuma yönlendirebilir, böylece yüksek kullanılabilirlik sağlar.

### Sayım

{{#tabs }}
{{#tab name="az cli" }}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{{#endtab }}
{{#tab name="PowerShell" }}
```powershell
# List Azure Front Door Instances
Get-AzFrontDoor

# List Front Door WAF Policies
Get-AzFrontDoorWafPolicy -Name <policyName> -ResourceGroupName <resourceGroupName>
```
{{#endtab }}
{{#endtabs }}

## Azure Uygulama Geçidi ve Azure Uygulama Geçidi WAF

Azure Uygulama Geçidi, **web trafiği yük dengeleyici** olup, **web** uygulamalarınıza trafik yönetimi sağlar. **Katman 7 yük dengeleme, SSL sonlandırma ve web uygulama güvenlik duvarı (WAF) yetenekleri** sunar. Ana özellikler arasında URL tabanlı yönlendirme, çerez tabanlı oturum bağlılığı ve güvenli soket katmanı (SSL) yük dengelemesi bulunur; bu özellikler, küresel yönlendirme ve yol tabanlı yönlendirme gibi karmaşık yük dengeleme yetenekleri gerektiren uygulamalar için kritik öneme sahiptir.

**Örnek:**

Bir e-ticaret web siteniz olduğunu düşünün; bu site, kullanıcı hesapları ve ödeme işlemleri gibi farklı işlevler için birden fazla alt alan adı içeriyor. Azure Uygulama Geçidi, **URL yoluna göre uygun web sunucularına trafiği yönlendirebilir**. Örneğin, `example.com/accounts` adresine gelen trafik kullanıcı hesapları hizmetine, `example.com/pay` adresine gelen trafik ise ödeme işleme hizmetine yönlendirilebilir.\
Ve **WAF yeteneklerini kullanarak web sitenizi saldırılardan koruyabilirsiniz.**

### **Enumeration**

{{#tabs }}
{{#tab name="az cli" }}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{{#endtab }}
{{#tab name="PowerShell" }}
```powershell
# List the Web Application Firewall configurations for your Application Gateways
(Get-AzApplicationGateway -Name <AppGatewayName> -ResourceGroupName <ResourceGroupName>).WebApplicationFirewallConfiguration
```
{{#endtab }}
{{#endtabs }}

## Azure Hub, Spoke & VNet Peering

**VNet Peering**, Azure'da **farklı Sanal Ağların (VNet) doğrudan ve kesintisiz bir şekilde bağlanmasını sağlayan** bir ağ özelliğidir. VNet peering aracılığıyla, bir VNet'teki kaynaklar, **sanki aynı ağdaymış gibi** başka bir VNet'teki kaynaklarla özel IP adresleri kullanarak iletişim kurabilir.\
**VNet Peering, yerel ağlarla da kullanılabilir**; bir site-to-site VPN veya Azure ExpressRoute kurarak.

**Azure Hub ve Spoke**, Azure'da ağ trafiğini yönetmek ve organize etmek için kullanılan bir ağ topolojisidir. **"Hub", farklı "spokelar" arasındaki trafiği kontrol eden ve yönlendiren merkezi bir noktadır**. Hub genellikle ağ sanal cihazları (NVA'lar), Azure VPN Gateway, Azure Firewall veya Azure Bastion gibi paylaşılan hizmetleri içerir. **"Spokelar", iş yüklerini barındıran ve VNet peering kullanarak huba bağlanan VNets'tir**, bu da onların hub içindeki paylaşılan hizmetlerden yararlanmalarını sağlar. Bu model, farklı VNets arasında birden fazla iş yükünün kullanabileceği ortak hizmetleri merkezileştirerek karmaşıklığı azaltarak temiz bir ağ düzenini teşvik eder.

> [!CAUTION] > **VNET eşleştirmesi Azure'da geçişli değildir**, bu da demektir ki, eğer spoke 1, spoke 2'ye bağlıysa ve spoke 2, spoke 3'e bağlıysa, spoke 1 doğrudan spoke 3 ile iletişim kuramaz.

**Örnek:**

Satış, İK ve Geliştirme gibi ayrı departmanlara sahip bir şirketi hayal edin, **her birinin kendi VNet'i (spokelar)** vardır. Bu VNets, **merkezi bir veritabanı, bir güvenlik duvarı ve bir internet geçidi gibi paylaşılan kaynaklara erişim gerektirir**, bunların hepsi **başka bir VNet'te (hub)** bulunmaktadır. Hub ve Spoke modelini kullanarak, her departman **bu paylaşılan kaynaklara, o kaynakları kamu internetine maruz bırakmadan veya çok sayıda bağlantı ile karmaşık bir ağ yapısı oluşturmadan hub VNet aracılığıyla güvenli bir şekilde bağlanabilir**.

### Enumeration

{{#tabs }}
{{#tab name="az cli" }}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{{#endtab }}
{{#tab name="PowerShell" }}
```powershell
# List all VNets in your subscription
Get-AzVirtualNetwork

# List VNet peering connections for a given VNet
(Get-AzVirtualNetwork -ResourceGroupName <ResourceGroupName> -Name <VNetName>).VirtualNetworkPeerings

# List Shared Resources (e.g., Azure Firewall) in the Hub
Get-AzFirewall
```
{{#endtab }}
{{#endtabs }}

## Site-to-Site VPN

Azure'daki Site-to-Site VPN, **yerel ağınızı Azure Sanal Ağı (VNet) ile bağlamanıza** olanak tanır ve Azure içindeki VM'ler gibi kaynakların yerel ağınızda varmış gibi görünmesini sağlar. Bu bağlantı, iki ağ arasındaki trafiği **şifreleyen bir VPN geçidi aracılığıyla** kurulur.

**Örnek:**

Ana ofisi New York'ta bulunan bir işletmenin, Azure'daki VNet'ine güvenli bir şekilde bağlanması gereken yerel bir veri merkezi vardır; bu VNet, sanallaştırılmış iş yüklerini barındırmaktadır. **Site-to-Site VPN kurarak, şirket yerel sunucular ile Azure VM'leri arasında şifreli bir bağlantı sağlayabilir**, böylece kaynaklara her iki ortamda da sanki aynı yerel ağdaymış gibi güvenli bir şekilde erişilebilir. 

### **Enumeration**

{{#tabs }}
{{#tab name="az cli" }}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{{#endtab }}
{{#tab name="PowerShell" }}
```powershell
# List VPN Gateways
Get-AzVirtualNetworkGateway -ResourceGroupName <ResourceGroupName>

# List VPN Connections
Get-AzVirtualNetworkGatewayConnection -ResourceGroupName <ResourceGroupName>
```
{{#endtab }}
{{#endtabs }}

## Azure ExpressRoute

Azure ExpressRoute, **yerel altyapınız ile Azure veri merkezleri arasında özel, ayrılmış, yüksek hızlı bir bağlantı sağlayan bir hizmettir**. Bu bağlantı, kamu internetini atlayarak bir bağlantı sağlayıcısı aracılığıyla yapılır ve tipik internet bağlantılarından daha fazla güvenilirlik, daha hızlı hızlar, daha düşük gecikmeler ve daha yüksek güvenlik sunar.

**Örnek:**

Bir çok uluslu şirket, **yüksek veri hacmi ve yüksek veri akışı ihtiyacı nedeniyle Azure hizmetlerine tutarlı ve güvenilir bir bağlantı gerektirir**. Şirket, yerel veri merkezini doğrudan Azure'a bağlamak için Azure ExpressRoute'u tercih eder, bu da günlük yedeklemeler ve gerçek zamanlı veri analitiği gibi büyük ölçekli veri transferlerini artırılmış gizlilik ve hız ile kolaylaştırır.

### **Enumeration**

{{#tabs }}
{{#tab name="az cli" }}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{{#endtab }}
{{#tab name="PowerShell" }}
```powershell
# List ExpressRoute Circuits
Get-AzExpressRouteCircuit
```
{{#endtab }}
{{#endtabs }}

{{#include ../../../../banners/hacktricks-training.md}}
