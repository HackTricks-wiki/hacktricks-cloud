# Az - MySQL Databases

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Azure MySQL
Azure Database for MySQLã¯ã€MySQL Community Editionã«åŸºã¥ã„ãŸå®Œå…¨ç®¡ç†å‹ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚µãƒ¼ãƒ“ã‚¹ã§ã‚ã‚Šã€ã•ã¾ã–ã¾ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‹ãƒ¼ã‚ºã«å¯¾ã—ã¦ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã€æŸ”è»Ÿæ€§ã‚’æä¾›ã™ã‚‹ã‚ˆã†ã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚2ã¤ã®ç•°ãªã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒ¢ãƒ‡ãƒ«ãŒã‚ã‚Šã¾ã™ï¼š

* **Single Server** (å¼•é€€ã®é“ã‚’æ­©ã‚“ã§ã„ã¾ã™):
- ã‚³ã‚¹ãƒˆåŠ¹ç‡ãŒé«˜ãã€ç®¡ç†ãŒå®¹æ˜“ãªMySQLãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã«æœ€é©åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚
- è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã€é«˜å¯ç”¨æ€§ã€åŸºæœ¬çš„ãªç›£è¦–æ©Ÿèƒ½ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚
- äºˆæ¸¬å¯èƒ½ãªãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã‚’æŒã¤ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«æœ€é©ã§ã™ã€‚
* **Flexible Server**:
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ã¨æ§‹æˆã«å¯¾ã™ã‚‹ã‚ˆã‚Šå¤šãã®åˆ¶å¾¡ã‚’æä¾›ã—ã¾ã™ã€‚
- é«˜å¯ç”¨æ€§ï¼ˆåŒã‚¾ãƒ¼ãƒ³ãŠã‚ˆã³ã‚¾ãƒ¼ãƒ³å†—é•·ï¼‰ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚
- å¼¾åŠ›çš„ãªã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã€ãƒ‘ãƒƒãƒç®¡ç†ã€ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰æœ€é©åŒ–ã®æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚
- ã‚³ã‚¹ãƒˆå‰Šæ¸›ã®ãŸã‚ã®åœæ­¢/é–‹å§‹æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚

### Key Features
* **Server Management**: **ad-admin**æ©Ÿèƒ½ã¯ã€MySQLã‚µãƒ¼ãƒãƒ¼ã®Azure Active Directory (AAD)ç®¡ç†è€…ã‚’ç®¡ç†ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã€AADè³‡æ ¼æƒ…å ±ã‚’ä»‹ã—ã¦ç®¡ç†ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶å¾¡ã—ã¾ã™ã€‚ä¸€æ–¹ã€**identity**æ©Ÿèƒ½ã¯ã€Azure Managed Identitiesã®å‰²ã‚Šå½“ã¦ã¨ç®¡ç†ã‚’å¯èƒ½ã«ã—ã€Azureãƒªã‚½ãƒ¼ã‚¹ã¸ã®å®‰å…¨ãªè³‡æ ¼æƒ…å ±ãªã—ã®èªè¨¼ã‚’æä¾›ã—ã¾ã™ã€‚
* **Lifecycle Management**: ã‚µãƒ¼ãƒãƒ¼ã®é–‹å§‹ã¾ãŸã¯åœæ­¢ã€ãƒ•ãƒ¬ã‚­ã‚·ãƒ–ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å‰Šé™¤ã€æ§‹æˆå¤‰æ›´ã‚’è¿…é€Ÿã«é©ç”¨ã™ã‚‹ãŸã‚ã®ã‚µãƒ¼ãƒãƒ¼ã®å†èµ·å‹•ã€ã‚ªãƒ¼ãƒˆãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’é€²ã‚ã‚‹å‰ã«ç‰¹å®šã®æ¡ä»¶ã‚’æº€ãŸã™ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã®å¾…æ©Ÿã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™ã€‚
* **Security and Networking**: ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ã®ãŸã‚ã®ã‚µãƒ¼ãƒãƒ¼ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ãƒ«ãƒ¼ãƒ«ã‚’ç®¡ç†ã—ã€å¿…è¦ã«å¿œã˜ã¦ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆã‚’åˆ‡ã‚Šé›¢ã™ã“ã¨ãŒã§ãã¾ã™ã€‚
* **Data Protection and Backup**: ãƒ‡ãƒ¼ã‚¿å›å¾©ã®ãŸã‚ã®ãƒ•ãƒ¬ã‚­ã‚·ãƒ–ãƒ«ã‚µãƒ¼ãƒãƒ¼ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ç®¡ç†ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ç•°ãªã‚‹ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§ã‚µãƒ¼ãƒãƒ¼ã‚’å›å¾©ã™ã‚‹ãŸã‚ã®ã‚¸ã‚ªãƒªã‚¹ãƒˆã‚¢ã€å¤–éƒ¨ä½¿ç”¨ã®ãŸã‚ã®ã‚µãƒ¼ãƒãƒ¼ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸­ï¼‰ã€ç‰¹å®šã®æ™‚ç‚¹ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰ã‚µãƒ¼ãƒãƒ¼ã‚’å¾©å…ƒã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

### Enumeration

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List all flexible-servers
az mysql flexible-server db list --resource-group <resource-group-name>
# List databases in a flexible-server
az mysql flexible-server db list --resource-group <resource-group-name> --server-name <server_name>
# Show specific details of a MySQL database
az mysql flexible-server db show --resource-group <resource-group-name> --server-name <server_name> --database-name <database_name>

# List firewall rules of the a server
az mysql flexible-server firewall-rule list --resource-group <resource-group-name> --name <server_name>

# List all ad-admin in a server
az mysql flexible-server ad-admin list --resource-group <resource-group-name> --server-name <server_name>
# List all user assigned managed identities from the server
az mysql flexible-server identity list --resource-group <resource-group-name> --server-name <server_name>

# List the server backups
az mysql flexible-server backup list --resource-group <resource-group-name> --name <server_name>
# List all read replicas for a given server
az mysql flexible-server replica list --resource-group <resource-group-name> --name <server_name>

# Get the server's advanced threat protection setting
az mysql flexible-server advanced-threat-protection-setting show --resource-group <resource-group-name> --name <server_name>
# List all of the maintenances of a flexible server
az mysql flexible-server maintenance list --resource-group <resource-group-name> --server-name <server_name>
# List log files for a server.
az mysql flexible-server server-logs list --resource-group <resource-group-name> --server-name <server_name>

```
{% endcode %}
{% endtab %}

{% tab title="Az PowerShell" %}
{% code overflow="wrap" %}
```powershell
Get-Command -Module Az.MySql

# Get all flexible servers in a resource group
Get-AzMySqlFlexibleServer -ResourceGroupName <resource-group-name>

# List databases in a specific flexible server
Get-AzMySqlFlexibleServerDatabase -ResourceGroupName <resource-group-name> -ServerName <server_name>

# Get details of a specific database in a flexible server
Get-AzMySqlFlexibleServerDatabase -ResourceGroupName <resource-group-name> -ServerName <server_name> -DatabaseName <database_name>

# List all firewall rules for a flexible server
Get-AzMySqlFlexibleServerFirewallRule -ResourceGroupName <resource-group-name> -ServerName <server_name>

# Get the identity information of a flexible server
Get-AzMySqlFlexibleServerIdentity -ResourceGroupName <resource-group-name> -ServerName <server_name>

# Get the server's advanced threat protection setting
Get-AzMySqlFlexibleServerAdvancedThreatProtection -ResourceGroupName <resource-group-name> -ServerName <server_name>

# List configuration settings of a flexible server
Get-AzMySqlFlexibleServerConfiguration -ResourceGroupName <resource-group-name> -ServerName <server_name>
# Get the connection string for a flexible server
Get-AzMySqlFlexibleServerConnectionString -ResourceGroupName <resource-group-name> -ServerName <server_name> -Client <client>

# List all read replicas for a given server
Get-AzMySqlFlexibleServerReplica -ResourceGroupName <resource-group-name> -ServerName <server_name>

# Get the maintenance window details for a flexible server
Get-AzMySqlFlexibleServerMaintenanceWindow -ResourceGroupName <resource-group-name> -ServerName <server_name>

# List log files for a server
Get-AzMySqlFlexibleServerLog -ResourceGroupName <resource-group-name> -ServerName <server_name>
```
{% endcode %}
{% endtab %}
{% endtabs %}

### æ¥ç¶š

æ‹¡å¼µæ©Ÿèƒ½ rdbms-connect ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ï¼š

{% code overflow="wrap" %}
```bash
az mysql flexible-server connect -n <server-name> -u <username> -p <password> --interactive

#or execute commands
az mysql flexible-server execute \
-n <server-name> \
-u <username> \
-p "<password>" \
-d <database-name> \
--querytext "SELECT * FROM <table-name>;"

```
{% endcode %}

ã¾ãŸã¯ MySQL ãƒã‚¤ãƒ†ã‚£ãƒ–æ‹¡å¼µãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ç”¨ã—ã¦
{% code overflow="wrap" %}
```bash
mysql -h <server-name>.mysql.database.azure.com -P 3306 -u <username> -p
```
{% endcode %}

ã¾ãŸã€GitHubã‚’ä½¿ç”¨ã—ã¦ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ãŒã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚‚å¿…è¦ã§ã™ã€‚å®Ÿè¡Œã™ã‚‹ã‚¯ã‚¨ãƒªã‚’å«ã‚€SQLãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã®å¾Œï¼š
{% code overflow="wrap" %}
```bash
# Setup
az mysql flexible-server deploy setup \
-s <server-name> \
-g <resource-group> \
-u <admin-user> \
-p "<admin-password>" \
--sql-file <path-to-sql-file> \
--repo <github-username/repository-name> \
--branch <branch-name> \
--action-name <action-name> \
--allow-push

# Run it
az mysql flexible-server deploy run \
--action-name <action-name> \
--branch <branch-name>
```
{% endcode %}

## æ¨©é™æ˜‡æ ¼

{% content-ref url="../az-privilege-escalation/az-mysql-privesc.md" %}
[az-mysql-privesc.md](../az-privilege-escalation/az-mysql-privesc.md)
{% endcontent-ref %}

## ãƒã‚¹ãƒˆã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆ

{% content-ref url="../az-post-exploitation/az-mysql-post-exploitation.md" %}
[az-sql-mysql-exploitation.md](../az-post-exploitation/az-mysql-post-exploitation.md)
{% endcontent-ref %}

## ToDo

* mysql flexible-server ad-admin ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€æ¨©é™æ˜‡æ ¼ã®æ–¹æ³•ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹æ–¹æ³•ã‚’æ¢ã™



{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„!
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
