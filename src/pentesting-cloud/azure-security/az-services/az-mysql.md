# Az - Bazy danych MySQL

{{#include ../../../banners/hacktricks-training.md}}

## Azure MySQL
Azure Database for MySQL to w pełni zarządzana usługa relacyjnej bazy danych oparta na edycji społeczności MySQL, zaprojektowana w celu zapewnienia skalowalności, bezpieczeństwa i elastyczności dla różnych potrzeb aplikacji. Posiada dwa różne modele wdrożenia:

* **Single Server** (jest na ścieżce wycofania):
- Optymalizowane pod kątem opłacalnych i łatwych w zarządzaniu wdrożeń MySQL.
- Funkcje obejmują automatyczne kopie zapasowe, wysoką dostępność i podstawowe monitorowanie.
- Idealne dla aplikacji o przewidywalnych obciążeniach.
* **Flexible Server**:
- Zapewnia większą kontrolę nad zarządzaniem bazą danych i konfiguracją.
- Obsługuje wysoką dostępność (w tej samej strefie i redundantną strefę).
- Funkcje obejmują elastyczne skalowanie, zarządzanie poprawkami i optymalizację obciążenia.
- Oferuje funkcjonalność zatrzymywania/uruchamiania w celu oszczędności kosztów.

### Kluczowe funkcje
* **Zarządzanie serwerem**: Funkcja **ad-admin** umożliwia zarządzanie administratorami Azure Entra ID dla serwerów MySQL, zapewniając kontrolę nad dostępem administracyjnym za pomocą poświadczeń Entra ID. Mysql obsługuje User Managed Identities, używane do uwierzytelniania bez potrzeby posiadania poświadczeń, i mogą być używane przez inne usługi.
* **Zarządzanie cyklem życia**: opcje uruchamiania lub zatrzymywania serwera, usuwania instancji elastycznego serwera, ponownego uruchamiania serwera w celu szybkiego zastosowania zmian konfiguracyjnych oraz czekania, aby upewnić się, że serwer spełnia określone warunki przed kontynuowaniem skryptów automatyzacji.
* **Bezpieczeństwo i sieci**: Zabezpiecz swój serwer, ograniczając połączenia za pomocą reguł zapory, które pozwalają tylko na określone publiczne adresy IP, lub korzystając z prywatnych punktów końcowych, które integrują twój serwer w wirtualnej sieci. Wszystkie połączenia są chronione szyfrowaniem TLS 1.2. Bazy danych, kopie zapasowe i logi są domyślnie szyfrowane w spoczynku przy użyciu kluczy zarządzanych przez usługę lub kluczy niestandardowych.
* **Ochrona danych i kopie zapasowe**: obejmuje opcje zarządzania kopiami zapasowymi elastycznego serwera w celu odzyskiwania danych, przeprowadzania geo-odtworzenia w celu odzyskania serwera w innym regionie, eksportowania kopii zapasowych serwera do użytku zewnętrznego (w wersji podglądowej) oraz przywracania serwera z kopii zapasowej do określonego punktu w czasie.

### Enumeracja

{{#tabs }}
{{#tab name="az cli" }}
```bash
# List all flexible-servers
az mysql flexible-server db list --resource-group <resource-group-name>
# List databases in a flexible-server
az mysql flexible-server db list --resource-group <resource-group-name> --server-name <server_name>
# Show specific details of a MySQL database
az mysql flexible-server db show --resource-group <resource-group-name> --server-name <server_name> --database-name <database_name>

# List firewall rules of the a server
az mysql flexible-server firewall-rule list --resource-group <resource-group-name> --name <server_name>

# List all ad-admin in a server
az mysql flexible-server ad-admin list --resource-group <resource-group-name> --server-name <server_name>
# List all user assigned managed identities from the server
az mysql flexible-server identity list --resource-group <resource-group-name> --server-name <server_name>

# List the server backups
az mysql flexible-server backup list --resource-group <resource-group-name> --name <server_name>
# List all read replicas for a given server
az mysql flexible-server replica list --resource-group <resource-group-name> --name <server_name>

# Get the server's advanced threat protection setting
az mysql flexible-server advanced-threat-protection-setting show --resource-group <resource-group-name> --name <server_name>
# List all of the maintenances of a flexible server
az mysql flexible-server maintenance list --resource-group <resource-group-name> --server-name <server_name>
# List log files for a server.
az mysql flexible-server server-logs list --resource-group <resource-group-name> --server-name <server_name>

```
{{#endtab }}

{{#tab name="Az Powershell" }}
```bash
Get-Command -Module Az.MySql

# Get all flexible servers in a resource group
Get-AzMySqlFlexibleServer -ResourceGroupName <resource-group-name>

# List databases in a specific flexible server
Get-AzMySqlFlexibleServerDatabase -ResourceGroupName <resource-group-name> -ServerName <server_name>

# Get details of a specific database in a flexible server
Get-AzMySqlFlexibleServerDatabase -ResourceGroupName <resource-group-name> -ServerName <server_name> -DatabaseName <database_name>

# List all firewall rules for a flexible server
Get-AzMySqlFlexibleServerFirewallRule -ResourceGroupName <resource-group-name> -ServerName <server_name>

# Get the identity information of a flexible server
Get-AzMySqlFlexibleServerIdentity -ResourceGroupName <resource-group-name> -ServerName <server_name>

# Get the server's advanced threat protection setting
Get-AzMySqlFlexibleServerAdvancedThreatProtection -ResourceGroupName <resource-group-name> -ServerName <server_name>

# List configuration settings of a flexible server
Get-AzMySqlFlexibleServerConfiguration -ResourceGroupName <resource-group-name> -ServerName <server_name>
# Get the connection string for a flexible server
Get-AzMySqlFlexibleServerConnectionString -ResourceGroupName <resource-group-name> -ServerName <server_name> -Client <client>

# List all read replicas for a given server
Get-AzMySqlFlexibleServerReplica -ResourceGroupName <resource-group-name> -ServerName <server_name>

# Get the maintenance window details for a flexible server
Get-AzMySqlFlexibleServerMaintenanceWindow -ResourceGroupName <resource-group-name> -ServerName <server_name>

# List log files for a server
Get-AzMySqlFlexibleServerLog -ResourceGroupName <resource-group-name> -ServerName <server_name>
```
{{#endtab }}
{{#endtabs }}

### Połączenie

Za pomocą rozszerzenia rdbms-connect możesz uzyskać dostęp do bazy danych za pomocą:
```bash
az mysql flexible-server connect -n <server-name> -u <username> -p <password> --interactive

#or execute commands
az mysql flexible-server execute \
-n <server-name> \
-u <username> \
-p "<password>" \
-d <database-name> \
--querytext "SELECT * FROM <table-name>;"

```
Lub za pomocą wtyczki natywnej rozszerzenia MySQL
```bash
mysql -h <server-name>.mysql.database.azure.com -P 3306 -u <username> -p
```
Możesz również wykonywać zapytania za pomocą github, ale potrzebne są również hasło i użytkownik. Musisz utworzyć plik sql z zapytaniem do uruchomienia, a następnie:
```bash
# Setup
az mysql flexible-server deploy setup \
-s <server-name> \
-g <resource-group> \
-u <admin-user> \
-p "<admin-password>" \
--sql-file <path-to-sql-file> \
--repo <github-username/repository-name> \
--branch <branch-name> \
--action-name <action-name> \
--allow-push

# Run it
az mysql flexible-server deploy run \
--action-name <action-name> \
--branch <branch-name>
```
## Eskalacja Uprawnień

{{#ref}}
../az-privilege-escalation/az-mysql-privesc.md
{{#endref}}

## Po Eksploatacji

{{#ref}}
../az-post-exploitation/az-mysql-post-exploitation.md
{{#endref}}

## Do Zrobienia

* Znaleźć sposób na dostęp do mysql flexible-server ad-admin, aby zweryfikować, czy to metoda eskalacji uprawnień



{{#include ../../../banners/hacktricks-training.md}}
