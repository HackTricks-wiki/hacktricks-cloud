# Az - MySQL Veritabanları

{{#include ../../../banners/hacktricks-training.md}}

## Azure MySQL
Azure Database for MySQL, MySQL Community Edition'a dayanan tamamen yönetilen bir ilişkisel veritabanı hizmetidir ve çeşitli uygulama ihtiyaçları için ölçeklenebilirlik, güvenlik ve esneklik sağlamak üzere tasarlanmıştır. İki farklı dağıtım modeli vardır:

* **Tek Sunucu** (emeklilik yolunda):
- Maliyet etkin ve yönetimi kolay MySQL dağıtımları için optimize edilmiştir.
- Özellikler arasında otomatik yedeklemeler, yüksek kullanılabilirlik ve temel izleme bulunmaktadır.
- Tahmin edilebilir iş yüklerine sahip uygulamalar için idealdir.
* **Esnek Sunucu**:
- Veritabanı yönetimi ve yapılandırması üzerinde daha fazla kontrol sağlar.
- Yüksek kullanılabilirliği destekler (aynı bölge ve bölge yedekli).
- Elastik ölçekleme, yamanın yönetimi ve iş yükü optimizasyonu gibi özellikler sunar.
- Maliyet tasarrufu için durdurma/başlatma işlevselliği sunar.

### Ana Özellikler
* **Sunucu Yönetimi**: **ad-admin** özelliği, MySQL sunucuları için Azure Active Directory (AAD) yöneticilerini yönetmeyi sağlar ve AAD kimlik bilgileri aracılığıyla yönetim erişimi üzerinde kontrol sunar; **kimlik** özelliği ise Azure Yönetilen Kimliklerinin atanması ve yönetimini sağlar, bu da Azure kaynaklarına erişim için güvenli, kimlik bilgisi gerektirmeyen kimlik doğrulama sunar.
* **Yaşam Döngüsü Yönetimi**: bir sunucuyu başlatma veya durdurma, esnek bir sunucu örneğini silme, yapılandırma değişikliklerini hızlı bir şekilde uygulamak için bir sunucuyu yeniden başlatma ve otomasyon betikleri ile devam etmeden önce bir sunucunun belirli koşulları karşıladığından emin olmak için bekleme seçenekleri.
* **Güvenlik ve Ağ**: güvenli veritabanı erişimi için sunucu güvenlik duvarı kurallarını yönetebilir ve gerektiğinde sanal ağ yapılandırmalarını ayırabilir.
* **Veri Koruma ve Yedekleme**: veri kurtarma için esnek sunucu yedeklemelerini yönetme, farklı bir bölgede bir sunucuyu kurtarmak için coğrafi geri yükleme yapma, dış kullanım için sunucu yedeklerini dışa aktarma (Önizleme aşamasında) ve bir sunucuyu yedekten belirli bir zamana geri yükleme seçeneklerini içerir.

### Sayım

{{#tabs }}
{{#tab name="az cli" }}
```bash
# List all flexible-servers
az mysql flexible-server db list --resource-group <resource-group-name>
# List databases in a flexible-server
az mysql flexible-server db list --resource-group <resource-group-name> --server-name <server_name>
# Show specific details of a MySQL database
az mysql flexible-server db show --resource-group <resource-group-name> --server-name <server_name> --database-name <database_name>

# List firewall rules of the a server
az mysql flexible-server firewall-rule list --resource-group <resource-group-name> --name <server_name>

# List all ad-admin in a server
az mysql flexible-server ad-admin list --resource-group <resource-group-name> --server-name <server_name>
# List all user assigned managed identities from the server
az mysql flexible-server identity list --resource-group <resource-group-name> --server-name <server_name>

# List the server backups
az mysql flexible-server backup list --resource-group <resource-group-name> --name <server_name>
# List all read replicas for a given server
az mysql flexible-server replica list --resource-group <resource-group-name> --name <server_name>

# Get the server's advanced threat protection setting
az mysql flexible-server advanced-threat-protection-setting show --resource-group <resource-group-name> --name <server_name>
# List all of the maintenances of a flexible server
az mysql flexible-server maintenance list --resource-group <resource-group-name> --server-name <server_name>
# List log files for a server.
az mysql flexible-server server-logs list --resource-group <resource-group-name> --server-name <server_name>

```
{{#endtab }}

{{#tab name="Az Powershell" }}
```bash
Get-Command -Module Az.MySql

# Get all flexible servers in a resource group
Get-AzMySqlFlexibleServer -ResourceGroupName <resource-group-name>

# List databases in a specific flexible server
Get-AzMySqlFlexibleServerDatabase -ResourceGroupName <resource-group-name> -ServerName <server_name>

# Get details of a specific database in a flexible server
Get-AzMySqlFlexibleServerDatabase -ResourceGroupName <resource-group-name> -ServerName <server_name> -DatabaseName <database_name>

# List all firewall rules for a flexible server
Get-AzMySqlFlexibleServerFirewallRule -ResourceGroupName <resource-group-name> -ServerName <server_name>

# Get the identity information of a flexible server
Get-AzMySqlFlexibleServerIdentity -ResourceGroupName <resource-group-name> -ServerName <server_name>

# Get the server's advanced threat protection setting
Get-AzMySqlFlexibleServerAdvancedThreatProtection -ResourceGroupName <resource-group-name> -ServerName <server_name>

# List configuration settings of a flexible server
Get-AzMySqlFlexibleServerConfiguration -ResourceGroupName <resource-group-name> -ServerName <server_name>
# Get the connection string for a flexible server
Get-AzMySqlFlexibleServerConnectionString -ResourceGroupName <resource-group-name> -ServerName <server_name> -Client <client>

# List all read replicas for a given server
Get-AzMySqlFlexibleServerReplica -ResourceGroupName <resource-group-name> -ServerName <server_name>

# Get the maintenance window details for a flexible server
Get-AzMySqlFlexibleServerMaintenanceWindow -ResourceGroupName <resource-group-name> -ServerName <server_name>

# List log files for a server
Get-AzMySqlFlexibleServerLog -ResourceGroupName <resource-group-name> -ServerName <server_name>
```
{{#endtab }}
{{#endtabs }}

### Bağlantı

rdbms-connect uzantısıyla veritabanına erişebilirsiniz:
```bash
az mysql flexible-server connect -n <server-name> -u <username> -p <password> --interactive

#or execute commands
az mysql flexible-server execute \
-n <server-name> \
-u <username> \
-p "<password>" \
-d <database-name> \
--querytext "SELECT * FROM <table-name>;"

```
MySQL yerel uzantı eklentisi ile de
```bash
mysql -h <server-name>.mysql.database.azure.com -P 3306 -u <username> -p
```
Ayrıca, sorguları github ile de çalıştırabilirsiniz, ancak şifre ve kullanıcı adı da gereklidir. Çalıştırılacak sorgu ile bir sql dosyası oluşturmanız ve ardından:
```bash
# Setup
az mysql flexible-server deploy setup \
-s <server-name> \
-g <resource-group> \
-u <admin-user> \
-p "<admin-password>" \
--sql-file <path-to-sql-file> \
--repo <github-username/repository-name> \
--branch <branch-name> \
--action-name <action-name> \
--allow-push

# Run it
az mysql flexible-server deploy run \
--action-name <action-name> \
--branch <branch-name>
```
## Yetki Yükseltme

{{#ref}}
../az-privilege-escalation/az-mysql-privesc.md
{{#endref}}

## Sonrası İstismar

{{#ref}}
../az-post-exploitation/az-mysql-post-exploitation.md
{{#endref}}

## Yapılacaklar

* Yetki yükseltme yöntemi olduğunu doğrulamak için mysql flexible-server ad-admin ile erişim yolu arayın



{{#include ../../../banners/hacktricks-training.md}}
