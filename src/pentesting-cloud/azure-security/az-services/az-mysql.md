# Az - MySQL æ•°æ®åº“

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## Azure MySQL
Azure Database for MySQL æ˜¯ä¸€ä¸ªå®Œå…¨æ‰˜ç®¡çš„å…³ç³»æ•°æ®åº“æœåŠ¡ï¼ŒåŸºäº MySQL Community Editionï¼Œæ—¨åœ¨ä¸ºå„ç§åº”ç”¨éœ€æ±‚æä¾›å¯æ‰©å±•æ€§ã€å®‰å…¨æ€§å’Œçµæ´»æ€§ã€‚å®ƒæœ‰ä¸¤ç§ä¸åŒçš„éƒ¨ç½²æ¨¡å‹ï¼š

* **å•æœåŠ¡å™¨**ï¼ˆæ­£åœ¨é€€å½¹ä¸­ï¼‰ï¼š
- é’ˆå¯¹ç»æµé«˜æ•ˆä¸”æ˜“äºç®¡ç†çš„ MySQL éƒ¨ç½²è¿›è¡Œäº†ä¼˜åŒ–ã€‚
- åŠŸèƒ½åŒ…æ‹¬è‡ªåŠ¨å¤‡ä»½ã€é«˜å¯ç”¨æ€§å’ŒåŸºæœ¬ç›‘æ§ã€‚
- é€‚åˆå…·æœ‰å¯é¢„æµ‹å·¥ä½œè´Ÿè½½çš„åº”ç”¨ç¨‹åºã€‚
* **çµæ´»æœåŠ¡å™¨**ï¼š
- æä¾›å¯¹æ•°æ®åº“ç®¡ç†å’Œé…ç½®çš„æ›´å¤šæ§åˆ¶ã€‚
- æ”¯æŒé«˜å¯ç”¨æ€§ï¼ˆåŒä¸€åŒºåŸŸå’ŒåŒºåŸŸå†—ä½™ï¼‰ã€‚
- å…·æœ‰å¼¹æ€§æ‰©å±•ã€è¡¥ä¸ç®¡ç†å’Œå·¥ä½œè´Ÿè½½ä¼˜åŒ–åŠŸèƒ½ã€‚
- æä¾›åœæ­¢/å¯åŠ¨åŠŸèƒ½ä»¥èŠ‚çœæˆæœ¬ã€‚

### å…³é”®ç‰¹æ€§
* **æœåŠ¡å™¨ç®¡ç†**ï¼š**ad-admin** åŠŸèƒ½å…è®¸ç®¡ç† Azure Active Directory (AAD) ç®¡ç†å‘˜ï¼Œæä¾›é€šè¿‡ AAD å‡­æ®æ§åˆ¶ç®¡ç†è®¿é—®çš„èƒ½åŠ›ï¼Œè€Œ **identity** åŠŸèƒ½åˆ™æ”¯æŒ Azure æ‰˜ç®¡èº«ä»½çš„åˆ†é…å’Œç®¡ç†ï¼Œæä¾›å®‰å…¨çš„æ— å‡­æ®èº«ä»½éªŒè¯ä»¥è®¿é—® Azure èµ„æºã€‚
* **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šé€‰é¡¹åŒ…æ‹¬å¯åŠ¨æˆ–åœæ­¢æœåŠ¡å™¨ã€åˆ é™¤çµæ´»æœåŠ¡å™¨å®ä¾‹ã€é‡å¯æœåŠ¡å™¨ä»¥å¿«é€Ÿåº”ç”¨é…ç½®æ›´æ”¹ï¼Œä»¥åŠç­‰å¾…ç¡®ä¿æœåŠ¡å™¨æ»¡è¶³ç‰¹å®šæ¡ä»¶åå†ç»§ç»­æ‰§è¡Œè‡ªåŠ¨åŒ–è„šæœ¬ã€‚
* **å®‰å…¨æ€§å’Œç½‘ç»œ**ï¼šå¯ä»¥ç®¡ç†æœåŠ¡å™¨é˜²ç«å¢™è§„åˆ™ä»¥ç¡®ä¿æ•°æ®åº“è®¿é—®å®‰å…¨ï¼Œå¹¶æ ¹æ®éœ€è¦åˆ†ç¦»è™šæ‹Ÿç½‘ç»œé…ç½®ã€‚
* **æ•°æ®ä¿æŠ¤å’Œå¤‡ä»½**ï¼šåŒ…æ‹¬ç®¡ç†çµæ´»æœåŠ¡å™¨å¤‡ä»½ä»¥è¿›è¡Œæ•°æ®æ¢å¤çš„é€‰é¡¹ï¼Œæ‰§è¡Œåœ°ç†æ¢å¤ä»¥åœ¨ä¸åŒåŒºåŸŸæ¢å¤æœåŠ¡å™¨ï¼Œå¯¼å‡ºæœåŠ¡å™¨å¤‡ä»½ä»¥ä¾›å¤–éƒ¨ä½¿ç”¨ï¼ˆé¢„è§ˆä¸­ï¼‰ï¼Œä»¥åŠä»å¤‡ä»½æ¢å¤æœåŠ¡å™¨åˆ°ç‰¹å®šæ—¶é—´ç‚¹ã€‚

### æšä¸¾

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List all flexible-servers
az mysql flexible-server db list --resource-group <resource-group-name>
# List databases in a flexible-server
az mysql flexible-server db list --resource-group <resource-group-name> --server-name <server_name>
# Show specific details of a MySQL database
az mysql flexible-server db show --resource-group <resource-group-name> --server-name <server_name> --database-name <database_name>

# List firewall rules of the a server
az mysql flexible-server firewall-rule list --resource-group <resource-group-name> --name <server_name>

# List all ad-admin in a server
az mysql flexible-server ad-admin list --resource-group <resource-group-name> --server-name <server_name>
# List all user assigned managed identities from the server
az mysql flexible-server identity list --resource-group <resource-group-name> --server-name <server_name>

# List the server backups
az mysql flexible-server backup list --resource-group <resource-group-name> --name <server_name>
# List all read replicas for a given server
az mysql flexible-server replica list --resource-group <resource-group-name> --name <server_name>

# Get the server's advanced threat protection setting
az mysql flexible-server advanced-threat-protection-setting show --resource-group <resource-group-name> --name <server_name>
# List all of the maintenances of a flexible server
az mysql flexible-server maintenance list --resource-group <resource-group-name> --server-name <server_name>
# List log files for a server.
az mysql flexible-server server-logs list --resource-group <resource-group-name> --server-name <server_name>

```
{% endcode %}
{% endtab %}

{% tab title="Az PowerShell" %}
{% code overflow="wrap" %}
```powershell
Get-Command -Module Az.MySql

# Get all flexible servers in a resource group
Get-AzMySqlFlexibleServer -ResourceGroupName <resource-group-name>

# List databases in a specific flexible server
Get-AzMySqlFlexibleServerDatabase -ResourceGroupName <resource-group-name> -ServerName <server_name>

# Get details of a specific database in a flexible server
Get-AzMySqlFlexibleServerDatabase -ResourceGroupName <resource-group-name> -ServerName <server_name> -DatabaseName <database_name>

# List all firewall rules for a flexible server
Get-AzMySqlFlexibleServerFirewallRule -ResourceGroupName <resource-group-name> -ServerName <server_name>

# Get the identity information of a flexible server
Get-AzMySqlFlexibleServerIdentity -ResourceGroupName <resource-group-name> -ServerName <server_name>

# Get the server's advanced threat protection setting
Get-AzMySqlFlexibleServerAdvancedThreatProtection -ResourceGroupName <resource-group-name> -ServerName <server_name>

# List configuration settings of a flexible server
Get-AzMySqlFlexibleServerConfiguration -ResourceGroupName <resource-group-name> -ServerName <server_name>
# Get the connection string for a flexible server
Get-AzMySqlFlexibleServerConnectionString -ResourceGroupName <resource-group-name> -ServerName <server_name> -Client <client>

# List all read replicas for a given server
Get-AzMySqlFlexibleServerReplica -ResourceGroupName <resource-group-name> -ServerName <server_name>

# Get the maintenance window details for a flexible server
Get-AzMySqlFlexibleServerMaintenanceWindow -ResourceGroupName <resource-group-name> -ServerName <server_name>

# List log files for a server
Get-AzMySqlFlexibleServerLog -ResourceGroupName <resource-group-name> -ServerName <server_name>
```
{% endcode %}
{% endtab %}
{% endtabs %}

### è¿æ¥

ä½¿ç”¨æ‰©å±• rdbms-connectï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®æ•°æ®åº“ï¼š

{% code overflow="wrap" %}
```bash
az mysql flexible-server connect -n <server-name> -u <username> -p <password> --interactive

#or execute commands
az mysql flexible-server execute \
-n <server-name> \
-u <username> \
-p "<password>" \
-d <database-name> \
--querytext "SELECT * FROM <table-name>;"

```
{% endcode %}

æˆ–è€…ä½¿ç”¨ MySQL åŸç”Ÿæ‰©å±•æ’ä»¶
{% code overflow="wrap" %}
```bash
mysql -h <server-name>.mysql.database.azure.com -P 3306 -u <username> -p
```
{% endcode %}

æ­¤å¤–ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨ github æ‰§è¡ŒæŸ¥è¯¢ï¼Œä½†ä¹Ÿéœ€è¦å¯†ç å’Œç”¨æˆ·ã€‚æ‚¨éœ€è¦è®¾ç½®ä¸€ä¸ªåŒ…å«è¦è¿è¡Œçš„æŸ¥è¯¢çš„ sql æ–‡ä»¶ï¼Œç„¶åï¼š
{% code overflow="wrap" %}
```bash
# Setup
az mysql flexible-server deploy setup \
-s <server-name> \
-g <resource-group> \
-u <admin-user> \
-p "<admin-password>" \
--sql-file <path-to-sql-file> \
--repo <github-username/repository-name> \
--branch <branch-name> \
--action-name <action-name> \
--allow-push

# Run it
az mysql flexible-server deploy run \
--action-name <action-name> \
--branch <branch-name>
```
{% endcode %}

## æƒé™æå‡

{% content-ref url="../az-privilege-escalation/az-mysql-privesc.md" %}
[az-mysql-privesc.md](../az-privilege-escalation/az-mysql-privesc.md)
{% endcontent-ref %}

## åæœŸåˆ©ç”¨

{% content-ref url="../az-post-exploitation/az-mysql-post-exploitation.md" %}
[az-sql-mysql-exploitation.md](../az-post-exploitation/az-mysql-post-exploitation.md)
{% endcontent-ref %}

## å¾…åŠäº‹é¡¹

* å¯»æ‰¾ä¸€ç§æ–¹æ³•ï¼Œé€šè¿‡ mysql flexible-server ad-admin è®¿é—®ä»¥éªŒè¯å…¶æ˜¯å¦ä¸ºæƒé™æå‡æ–¹æ³•



{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ **ä¸Šå…³æ³¨æˆ‘ä»¬** [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
