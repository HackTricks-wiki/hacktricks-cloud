# Az - CosmosDB

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Azure CosmosDB

**Azure Cosmos DB**ëŠ” ë‹¨ì¼ ë°€ë¦¬ì´ˆ ì‘ë‹µ ì‹œê°„, ìë™ í™•ì¥ì„± ë° ê¸°ì—… ìˆ˜ì¤€ì˜ ë³´ì•ˆì´ ë³´ì¥ëœ SLA ê¸°ë°˜ ê°€ìš©ì„±ì„ ì œê³µí•˜ëŠ” ì™„ì „ ê´€ë¦¬í˜• **NoSQL, ê´€ê³„í˜• ë° ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤**ì…ë‹ˆë‹¤. ì´ëŠ” ë‹¤ì¤‘ ì§€ì—­ ë°ì´í„° ë¶„ë°°, ì˜¤í”ˆ ì†ŒìŠ¤ API, ì¸ê¸° ìˆëŠ” ì–¸ì–´ë¥¼ ìœ„í•œ SDK ë° í†µí•© ë²¡í„° ì§€ì›ê³¼ ì›í™œí•œ Azure AI í†µí•©ê³¼ ê°™ì€ AI ë°ì´í„°ë² ì´ìŠ¤ ê¸°ëŠ¥ì„ í†µí•´ ë” ë¹ ë¥¸ ì•± ê°œë°œì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.

Azure Cosmos DBëŠ” ë¬¸ì„œ, ê´€ê³„í˜•, í‚¤-ê°’, ê·¸ë˜í”„ ë° ì—´ íŒ¨ë°€ë¦¬ ë°ì´í„° ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ ì‹¤ì œ ë°ì´í„°ë¥¼ ëª¨ë¸ë§í•˜ê¸° ìœ„í•œ ì—¬ëŸ¬ ë°ì´í„°ë² ì´ìŠ¤ APIë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì´ APIëŠ” NoSQL, MongoDB, PostgreSQL, Cassandra, Gremlin ë° Tableì…ë‹ˆë‹¤.

CosmosDBì˜ ì£¼ìš” ì¸¡ë©´ ì¤‘ í•˜ë‚˜ëŠ” Azure Cosmos Accountì…ë‹ˆë‹¤. **Azure Cosmos Account**ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— ëŒ€í•œ ì§„ì…ì  ì—­í• ì„ í•©ë‹ˆë‹¤. ê³„ì •ì€ ê¸€ë¡œë²Œ ë¶„ë°°, ì¼ê´€ì„± ìˆ˜ì¤€ ë° ì‚¬ìš©í•  íŠ¹ì • API(ì˜ˆ: NoSQL)ì™€ ê°™ì€ ì£¼ìš” ì„¤ì •ì„ ê²°ì •í•©ë‹ˆë‹¤. ê³„ì •ì„ í†µí•´ ì—¬ëŸ¬ ì§€ì—­ì—ì„œ ë°ì´í„°ì— ëŒ€í•œ ì €ì§€ì—° ì•¡ì„¸ìŠ¤ë¥¼ ë³´ì¥í•˜ê¸° ìœ„í•´ ê¸€ë¡œë²Œ ë³µì œë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ì„±ëŠ¥ê³¼ ë°ì´í„° ì •í™•ì„± ê°„ì˜ ê· í˜•ì„ ë§ì¶”ëŠ” ì¼ê´€ì„± ìˆ˜ì¤€ì„ ì„ íƒí•  ìˆ˜ ìˆìœ¼ë©°, ê°•ë ¥í•œ ì¼ê´€ì„±ì—ì„œ ìµœì¢… ì¼ê´€ì„±ê¹Œì§€ì˜ ì˜µì…˜ì´ ìˆìŠµë‹ˆë‹¤.

### NoSQL (sql)
Azure Cosmos DB NoSQL APIëŠ” JSONì„ ë°ì´í„° í˜•ì‹ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ë¬¸ì„œ ê¸°ë°˜ APIì…ë‹ˆë‹¤. JSON ê°ì²´ë¥¼ ì¿¼ë¦¬í•˜ê¸° ìœ„í•œ SQL ìœ ì‚¬ ì¿¼ë¦¬ êµ¬ë¬¸ì„ ì œê³µí•˜ì—¬ êµ¬ì¡°í™”ëœ ë°ì´í„° ë° ë°˜êµ¬ì¡°í™”ëœ ë°ì´í„° ì‘ì—…ì— ì í•©í•©ë‹ˆë‹¤. ì„œë¹„ìŠ¤ì˜ ì—”ë“œí¬ì¸íŠ¸ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

{% code overflow="wrap" %}
```bash
https://<Account-Name>.documents.azure.com:443/
```
{% endcode %}

#### ë°ì´í„°ë² ì´ìŠ¤
ê³„ì • ë‚´ì—ì„œ í•˜ë‚˜ ì´ìƒì˜ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ì»¨í…Œì´ë„ˆì˜ ë…¼ë¦¬ì  ê·¸ë£¹ìœ¼ë¡œ ì‘ìš©í•©ë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ëŠ” ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ ë° ì‚¬ìš©ì ê¶Œí•œì˜ ê²½ê³„ ì—­í• ì„ í•©ë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì»¨í…Œì´ë„ˆ ê°„ì— í”„ë¡œë¹„ì €ë‹ëœ ì²˜ë¦¬ëŸ‰ì„ ê³µìœ í•˜ê±°ë‚˜ ê°œë³„ ì»¨í…Œì´ë„ˆì— ì „ìš© ì²˜ë¦¬ëŸ‰ì„ í• ë‹¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### ì»¨í…Œì´ë„ˆ
ë°ì´í„° ì €ì¥ì˜ í•µì‹¬ ë‹¨ìœ„ëŠ” ì»¨í…Œì´ë„ˆë¡œ, JSON ë¬¸ì„œë¥¼ ë³´ìœ í•˜ê³  ìˆìœ¼ë©° íš¨ìœ¨ì ì¸ ì¿¼ë¦¬ë¥¼ ìœ„í•´ ìë™ìœ¼ë¡œ ì¸ë±ì‹±ë©ë‹ˆë‹¤. ì»¨í…Œì´ë„ˆëŠ” íƒ„ë ¥ì ìœ¼ë¡œ í™•ì¥ ê°€ëŠ¥í•˜ë©°, ì‚¬ìš©ì ì •ì˜ íŒŒí‹°ì…˜ í‚¤ì— ì˜í•´ ê²°ì •ëœ íŒŒí‹°ì…˜ì— ë¶„ì‚°ë©ë‹ˆë‹¤. íŒŒí‹°ì…˜ í‚¤ëŠ” ìµœì ì˜ ì„±ëŠ¥ê³¼ ê³ ë¥¸ ë°ì´í„° ë¶„í¬ë¥¼ ë³´ì¥í•˜ëŠ” ë° ì¤‘ìš”í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì»¨í…Œì´ë„ˆëŠ” ê³ ê° ë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ ìˆìœ¼ë©°, "customerId"ê°€ íŒŒí‹°ì…˜ í‚¤ë¡œ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### ì—´ê±°

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# CosmoDB Account
## List Azure Cosmos DB database accounts.
az cosmosdb list --resource-group <ResourceGroupName>
az cosmosdb show --resource-group <ResourceGroupName> --name <AccountName>

## Lists the virtual network accounts associated with a Cosmos DB account
az cosmosdb network-rule list --resource-group <ResourceGroupName> --name <AccountName>
## List the access keys or connection strings for a Azure Cosmos DB
az cosmosdb keys list --name <AccountName> --resource-group <ResourceGroupName>
## List all the database accounts that can be restored.
az cosmosdb restorable-database-account list --account-name <AccountName>
## Show the identities for a Azure Cosmos DB database account.
az cosmosdb identity show --resource-group <ResourceGroupName> --name <AccountName>


# CosmoDB (NoSQL)
## List the SQL databases under an Azure Cosmos DB account.
az cosmosdb sql database list --resource-group <ResourceGroupName> --account-name <AccountName>
## List the SQL containers under an Azure Cosmos DB SQL database.
az cosmosdb sql container list --account-name <AccountName> --database-name <DatabaseName> --resource-group <ResourceGroupName>

## List all SQL role assignments under an Azure Cosmos DB
az cosmosdb sql role assignment list --resource-group <ResourceGroupName> --account-name <AccountName>
## List all SQL role definitions under an Azure Cosmos DB
az cosmosdb sql role definition list --resource-group <ResourceGroupName> --account-name <AccountName>

## List the SQL stored procedures under an Azure Cosmos DB
az cosmosdb sql stored-procedure list --account-name <AccountName> --container-name <ContainerName> --database-name <DatabaseName> --resource-group <ResourceGroupName>
## List the SQL triggers under an Azure Cosmos DB SQL container.
az cosmosdb sql trigger list --account-name <AccountName> --container-name <ContainerName> --database-name <DatabaseName> --resource-group <ResourceGroupName>
## List the SQL user defined functions under an Azure Cosmos DB SQL container
az cosmosdb sql user-defined-function list --account-name <AccountName> --container-name <ContainerName> --database-name <DatabaseName> --resource-group <ResourceGroupName>

```
{% endcode %}
{% endtab %}

{% tab title="Az PowerShell" %}
{% code overflow="wrap" %}
```powershell
Get-Command -Module Az.CosmosD

# List all Cosmos DB accounts in a specified resource group.
Get-AzCosmosDBAccount -ResourceGroupName "<ResourceGroupName>"

# Get the access keys for a specific Cosmos DB account.
Get-AzCosmosDBAccountKey -ResourceGroupName "<ResourceGroupName>" -Name "<AccountName>"

# Retrieve the client encryption keys for a specific Cosmos DB account.
Get-AzCosmosDbClientEncryptionKey -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -DatabaseName "<DatabaseName>"

# List all SQL containers in a specific Cosmos DB SQL database.
Get-AzCosmosDBSqlContainer -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -DatabaseName "<DatabaseName>"

# Get backup information for a specific Cosmos DB SQL container.
Get-AzCosmosDBSqlContainerBackupInformation -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -DatabaseName "<DatabaseName>" -Name "<ContainerName>" -Location "<location>"

# Get the throughput (RU/s) settings for a specific Cosmos DB SQL container.
Get-AzCosmosDBSqlContainerThroughput -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -DatabaseName "<DatabaseName>" -Name "<ContainerName>"

# List all SQL databases under a specific Cosmos DB account.
Get-AzCosmosDBSqlDatabase -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>"

# Get the throughput (RU/s) settings for a specific Cosmos DB SQL database.
Get-AzCosmosDBSqlDatabaseThroughput -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -Name "<DatabaseName>"

# List all SQL role assignments for a specific Cosmos DB account.
Get-AzCosmosDBSqlRoleAssignment -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>"

# List all SQL role definitions for a specific Cosmos DB account.
Get-AzCosmosDBSqlRoleDefinition -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>"

# List all stored procedures in a specific Cosmos DB SQL container.
Get-AzCosmosDBSqlStoredProcedure -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -DatabaseName "<DatabaseName>" -ContainerName "<ContainerName>"

# List all triggers in a specific Cosmos DB SQL container.
Get-AzCosmosDBSqlTrigger -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -DatabaseName "<DatabaseName>" -ContainerName "<ContainerName>"

# List all user-defined functions (UDFs) in a specific Cosmos DB SQL container.
Get-AzCosmosDBSqlUserDefinedFunction -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -DatabaseName "<DatabaseName>" -ContainerName "<ContainerName>"
```
{% endcode %}
{% endtab %}
{% endtabs %}

#### ì—°ê²°

azure-cosmosDBì— ì—°ê²°í•˜ë ¤ë©´ (pip install azure-cosmos) ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤. ë˜í•œ ì—”ë“œí¬ì¸íŠ¸ì™€ í‚¤ëŠ” ì—°ê²°ì„ ë§Œë“œëŠ” ë° ì¤‘ìš”í•œ êµ¬ì„± ìš”ì†Œì…ë‹ˆë‹¤.
{% code overflow="wrap" %}
```python
from azure.cosmos import CosmosClient, PartitionKey

# Connection details
endpoint = "<your-account-endpoint>"
key = "<your-account-key>"

# Initialize Cosmos Client
client = CosmosClient(endpoint, key)

# Access existing database and container
database_name = '<SampleDB>'
container_name = '<SampleContainer>'
database = client.get_database_client(database_name)
container = database.get_container_client(container_name)

# Insert multiple documents
items_to_insert = [
{"id": "1", "name": "Sample Item", "description": "This is a sample document."},
{"id": "2", "name": "Another Sample Item", "description": "This is another sample document."},
{"id": "3", "name": "Sample Item", "description": "This is a duplicate name sample document."},
]

for item in items_to_insert:
container.upsert_item(item)

# Query all documents
query = "SELECT * FROM c"
all_items = list(container.query_items(
query=query,
enable_cross_partition_query=True
))

# Print all queried items
print("All items in the container:")
for item in all_items:
print(item)
```
{% endcode %}

ì—°ê²°ì„ ì„¤ì •í•˜ëŠ” ë˜ ë‹¤ë¥¸ ë°©ë²•ì€ **DefaultAzureCredential()**ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ê¶Œí•œì´ ìˆëŠ” ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸(az login)í•˜ê³  ì‹¤í–‰í•˜ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤. ì´ ê²½ìš° í•„ìš”í•œ ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ” ì—­í•  í• ë‹¹ì´ ì´ë£¨ì–´ì ¸ì•¼ í•©ë‹ˆë‹¤(ìì„¸í•œ ë‚´ìš©ì€ ì°¸ì¡°). 

{% code overflow="wrap" %}
```python
from azure.identity import DefaultAzureCredential
from azure.cosmos import CosmosClient

# Use Azure AD for authentication
credential = DefaultAzureCredential()
endpoint = "<your-account-endpoint>"
client = CosmosClient(endpoint, credential)

# Access database and container
database_name = "<mydatabase>"
container_name = "<mycontainer>"
database = client.get_database_client(database_name)
container = database.get_container_client(container_name)

# Insert a document
item = {
"id": "1",
"name": "Sample Item",
"description": "This is a test item."
}
container.create_item(item)
print("Document inserted.")
```
{% endcode %}

### MongoDB
MongoDB NoSQL APIëŠ” JSONê³¼ ìœ ì‚¬í•œ BSON(ì´ì§„ JSON)ì„ ë°ì´í„° í˜•ì‹ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ë¬¸ì„œ ê¸°ë°˜ APIì…ë‹ˆë‹¤. ì´ëŠ” ì§‘ê³„ ê¸°ëŠ¥ì„ ê°–ì¶˜ ì¿¼ë¦¬ ì–¸ì–´ë¥¼ ì œê³µí•˜ì—¬ êµ¬ì¡°í™”ëœ, ë°˜êµ¬ì¡°í™”ëœ ë° ë¹„êµ¬ì¡°í™”ëœ ë°ì´í„° ì‘ì—…ì— ì í•©í•©ë‹ˆë‹¤. ì„œë¹„ìŠ¤ì˜ ì—”ë“œí¬ì¸íŠ¸ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ë‹¤ìŒ í˜•ì‹ì„ ë”°ë¦…ë‹ˆë‹¤:

{% code overflow="wrap" %}
```bash
mongodb://<hostname>:<port>/<database>
```
{% endcode %}

#### ë°ì´í„°ë² ì´ìŠ¤
MongoDBì—ì„œëŠ” ì¸ìŠ¤í„´ìŠ¤ ë‚´ì— í•˜ë‚˜ ì´ìƒì˜ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê° ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì»¬ë ‰ì…˜ì˜ ë…¼ë¦¬ì  ê·¸ë£¹ìœ¼ë¡œ ì‘ìš©í•˜ë©°, ë¦¬ì†ŒìŠ¤ ì¡°ì§ ë° ê´€ë¦¬ë¥¼ ìœ„í•œ ê²½ê³„ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì„œë¡œ ë‹¤ë¥¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë‚˜ í”„ë¡œì íŠ¸ë¥¼ ìœ„í•´ ë°ì´í„°ë¥¼ ë…¼ë¦¬ì ìœ¼ë¡œ ë¶„ë¦¬í•˜ê³  ê´€ë¦¬í•˜ëŠ” ë° ë„ì›€ì„ ì¤ë‹ˆë‹¤.

#### ì»¬ë ‰ì…˜
MongoDBì—ì„œ ë°ì´í„° ì €ì¥ì˜ í•µì‹¬ ë‹¨ìœ„ëŠ” ì»¬ë ‰ì…˜ìœ¼ë¡œ, ë¬¸ì„œë¥¼ ë³´ìœ í•˜ë©° íš¨ìœ¨ì ì¸ ì¿¼ë¦¬ ë° ìœ ì—°í•œ ìŠ¤í‚¤ë§ˆ ì„¤ê³„ë¥¼ ìœ„í•´ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. ì»¬ë ‰ì…˜ì€ íƒ„ë ¥ì ìœ¼ë¡œ í™•ì¥ ê°€ëŠ¥í•˜ë©°, ë¶„ì‚° ì„¤ì •ì—ì„œ ì—¬ëŸ¬ ë…¸ë“œì— ê±¸ì³ ë†’ì€ ì²˜ë¦¬ëŸ‰ ì‘ì—…ì„ ì§€ì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### ì—´ê±°

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# CosmoDB Account
## List Azure Cosmos DB database accounts.
az cosmosdb list --resource-group <ResourceGroupName>
az cosmosdb show --resource-group <ResourceGroupName> --name <AccountName>

## Lists the virtual network accounts associated with a Cosmos DB account
az cosmosdb network-rule list --resource-group <ResourceGroupName> --name <AccountName>
## List the access keys or connection strings for a Azure Cosmos DB
az cosmosdb keys list --name <AccountName> --resource-group <ResourceGroupName>
## List all the database accounts that can be restored.
az cosmosdb restorable-database-account list --account-name <AccountName>
## Show the identities for a Azure Cosmos DB database account.
az cosmosdb identity show --resource-group <ResourceGroupName> --name <AccountName>

```
{% endcode %}
{% endtab %}

{% tab title="Az PowerShell" %}
{% code overflow="wrap" %}
```powershell
Get-Command -Module Az.CosmosDB

# List all Cosmos DB accounts in a specified resource group.
Get-AzCosmosDBAccount -ResourceGroupName "<ResourceGroupName>"

# Get the access keys for a specific Cosmos DB account.
Get-AzCosmosDBAccountKey -ResourceGroupName "<ResourceGroupName>" -Name "<AccountName>"

# Retrieve the client encryption keys for a specific Cosmos DB account.
Get-AzCosmosDbClientEncryptionKey -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -DatabaseName "<DatabaseName>"

# List all MongoDB collections in a specific database.
Get-AzCosmosDBMongoDBCollection -AccountName <account-name> -ResourceGroupName <resource-group-name> -DatabaseName <database-name>

# Retrieve backup information for a specific MongoDB collection in a database.
Get-AzCosmosDBMongoDBCollectionBackupInformation -AccountName <account-name> -ResourceGroupName <resource-group-name> -DatabaseName <database-name> -Name <collection-name> -Location <Location>

# Get the throughput (RU/s) of a specific MongoDB collection in a database.
Get-AzCosmosDBMongoDBCollectionThroughput -AccountName <account-name> -ResourceGroupName <resource-group-name> -DatabaseName <database-name> -Name <collection-name>

# List all MongoDB databases in a specified Cosmos DB account.
Get-AzCosmosDBMongoDBDatabase -AccountName <account-name> -ResourceGroupName <resource-group-name>

# Get the throughput (RU/s) of a specific MongoDB database.
Get-AzCosmosDBMongoDBDatabaseThroughput -AccountName <account-name> -ResourceGroupName <resource-group-name> -DatabaseName <database-name>

# Retrieve the role definitions for MongoDB users in a specified Cosmos DB account.
Get-AzCosmosDBMongoDBRoleDefinition -AccountName <account-name> -ResourceGroupName <resource-group-name>

```
{% endcode %}
{% endtab %}
{% endtabs %}

#### ì—°ê²°

ì—¬ê¸°ì—ì„œ ë¹„ë°€ë²ˆí˜¸ëŠ” í‚¤ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ privesc ì„¹ì…˜ì— ì„¤ëª…ëœ ë°©ë²•ìœ¼ë¡œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% code overflow="wrap" %}
```python
from pymongo import MongoClient

# Updated connection string with retryWrites=false
connection_string = "mongodb://<account-name>.mongo.cosmos.azure.com:10255/?ssl=true&replicaSet=globaldb&retryWrites=false"

# Create the client
client = MongoClient(connection_string, username="<username>", password="<password>")

# Access the database
db = client['<database>']

# Access a collection
collection = db['<collection>']

# Insert a single document
document = {
"name": "John Doe",
"email": "johndoe@example.com",
"age": 30,
"address": {
"street": "123 Main St",
"city": "Somewhere",
"state": "CA",
"zip": "90210"
}
}

# Insert document
result = collection.insert_one(document)
print(f"Inserted document with ID: {result.inserted_id}")
```
{% endcode %}

## References

* [https://learn.microsoft.com/en-us/azure/cosmos-db/choose-api](https://learn.microsoft.com/en-us/azure/cosmos-db/choose-api)
* [https://learn.microsoft.com/en-us/azure/cosmos-db/](https://learn.microsoft.com/en-us/azure/cosmos-db/)
* [https://learn.microsoft.com/en-us/azure/cosmos-db/introduction](https://learn.microsoft.com/en-us/azure/cosmos-db/introduction)
* [https://learn.microsoft.com/en-us/azure/cosmos-db/nosql/security/how-to-grant-data-plane-role-based-access?tabs=built-in-definition%2Ccsharp&pivots=azure-interface-cli](https://learn.microsoft.com/en-us/azure/cosmos-db/nosql/security/how-to-grant-data-plane-role-based-access?tabs=built-in-definition%2Ccsharp&pivots=azure-interface-cli)

## Privilege Escalation

{% content-ref url="../az-privilege-escalation/az-cosmosDB-privesc.md" %}
[az-cosmosDB-privesc.md](../az-privilege-escalation/az-cosmosDB-privesc.md)
{% endcontent-ref %}

## Post Exploitation

{% content-ref url="../az-post-exploitation/az-cosmosDB-post-exploitation.md" %}
[az-cosmosDB-post-exploitation.md](../az-post-exploitation/az-sql-post-exploitation.md)
{% endcontent-ref %}

## ToDo

* ì—¬ê¸° DBì˜ ë‚˜ë¨¸ì§€, í…Œì´ë¸”, ì¹´ì‚°ë“œë¼, ê·¸ë ˜ë¦°...
* í¬ìŠ¤íŠ¸ ìµìŠ¤í”Œë¡œì‡ "Microsoft.DocumentDB/databaseAccounts/mongodbUserDefinitions/write" && "Microsoft.DocumentDB/databaseAccounts/mongodbUserDefinitions/read" ë° ì—­í•  ì •ì˜ë¥¼ ì‚´í´ë³´ì„¸ìš”. ì—¬ê¸°ì„œ ê¶Œí•œ ìƒìŠ¹ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ë³µì› ì‚¬í•­ì„ ì‚´í´ë³´ì„¸ìš”.



{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê³  ì—°ìŠµí•˜ê¸°:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê³  ì—°ìŠµí•˜ê¸°: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**ë””ìŠ¤ì½”ë“œ ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
