# Az - CosmosDB

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Azure CosmosDB

**Azure Cosmos DB** ã¯ã€å˜ä¸€æ¡ãƒŸãƒªç§’ã®å¿œç­”æ™‚é–“ã€è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã€ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚°ãƒ¬ãƒ¼ãƒ‰ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å‚™ãˆãŸ SLA ã«è£æ‰“ã¡ã•ã‚ŒãŸå¯ç”¨æ€§ã‚’æä¾›ã™ã‚‹å®Œå…¨ã« **ç®¡ç†ã•ã‚ŒãŸ NoSQLã€ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ã€ãƒ™ã‚¯ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹** ã§ã™ã€‚ã“ã‚Œã¯ã€ã‚¿ãƒ¼ãƒ³ã‚­ãƒ¼ã®ãƒãƒ«ãƒãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿é…ä¿¡ã€ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã® APIã€äººæ°—ã®ã‚ã‚‹è¨€èªç”¨ã® SDKã€çµ±åˆãƒ™ã‚¯ã‚¿ãƒ¼ã‚µãƒãƒ¼ãƒˆã‚„ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãª Azure AI çµ±åˆãªã©ã® AI ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ©Ÿèƒ½ã‚’é€šã˜ã¦ã€ã‚¢ãƒ—ãƒªé–‹ç™ºã‚’åŠ é€Ÿã—ã¾ã™ã€‚

Azure Cosmos DB ã¯ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ã€ã‚­ãƒ¼-ãƒãƒªãƒ¥ãƒ¼ã€ã‚°ãƒ©ãƒ•ã€ã‚«ãƒ©ãƒ ãƒ•ã‚¡ãƒŸãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã—ã¦ç¾å®Ÿã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ¢ãƒ‡ãƒ«åŒ–ã™ã‚‹ãŸã‚ã®è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ API ã‚’æä¾›ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã® API ã¯ NoSQLã€MongoDBã€PostgreSQLã€Cassandraã€Gremlinã€Table ã§ã™ã€‚

CosmosDB ã®é‡è¦ãªå´é¢ã® 1 ã¤ã¯ Azure Cosmos ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã™ã€‚**Azure Cosmos ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ** ã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚ã“ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«é…ä¿¡ã€ä¸€è²«æ€§ãƒ¬ãƒ™ãƒ«ã€ä½¿ç”¨ã™ã‚‹ç‰¹å®šã® APIï¼ˆNoSQL ãªã©ï¼‰ãªã©ã®ä¸»è¦ãªè¨­å®šã‚’æ±ºå®šã—ã¾ã™ã€‚ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’é€šã˜ã¦ã€ãƒ‡ãƒ¼ã‚¿ãŒè¤‡æ•°ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§åˆ©ç”¨å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’ä¿è¨¼ã™ã‚‹ãŸã‚ã«ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹æˆã§ãã¾ã™ã€‚ã•ã‚‰ã«ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨ãƒ‡ãƒ¼ã‚¿ã®æ­£ç¢ºæ€§ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚‹ä¸€è²«æ€§ãƒ¬ãƒ™ãƒ«ã‚’é¸æŠã§ãã€å¼·ã„ä¸€è²«æ€§ã‹ã‚‰æœ€çµ‚çš„ãªä¸€è²«æ€§ã¾ã§ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™ã€‚

### NoSQL (sql)
Azure Cosmos DB NoSQL API ã¯ã€JSON ã‚’ãƒ‡ãƒ¼ã‚¿å½¢å¼ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ã® API ã§ã™ã€‚ã“ã‚Œã¯ã€JSON ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¯ã‚¨ãƒªã™ã‚‹ãŸã‚ã® SQL ã«ä¼¼ãŸã‚¯ã‚¨ãƒªæ§‹æ–‡ã‚’æä¾›ã—ã€æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ãŠã‚ˆã³åŠæ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã®æ“ä½œã«é©ã—ã¦ã„ã¾ã™ã€‚ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ï¼š

{% code overflow="wrap" %}
```bash
https://<Account-Name>.documents.azure.com:443/
```
{% endcode %}

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã§ã¯ã€1ã¤ä»¥ä¸Šã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã§ãã€ã“ã‚Œã‚‰ã¯ã‚³ãƒ³ãƒ†ãƒŠã®è«–ç†çš„ãªã‚°ãƒ«ãƒ¼ãƒ—ã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯ã€ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ã®å¢ƒç•Œã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠé–“ã§ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã•ã‚ŒãŸã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã‚’å…±æœ‰ã™ã‚‹ã‹ã€å€‹ã€…ã®ã‚³ãƒ³ãƒ†ãƒŠã«å°‚ç”¨ã®ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã‚’å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

#### ã‚³ãƒ³ãƒ†ãƒŠ
ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ã‚³ã‚¢ãƒ¦ãƒ‹ãƒƒãƒˆã¯ã‚³ãƒ³ãƒ†ãƒŠã§ã‚ã‚Šã€JSONãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä¿æŒã—ã€åŠ¹ç‡çš„ãªã‚¯ã‚¨ãƒªã®ãŸã‚ã«è‡ªå‹•çš„ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒä»˜ã‘ã‚‰ã‚Œã¾ã™ã€‚ã‚³ãƒ³ãƒ†ãƒŠã¯å¼¾åŠ›çš„ã«ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã«ã‚ˆã£ã¦æ±ºå®šã•ã‚Œã‚‹ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã«åˆ†æ•£ã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã¯ã€æœ€é©ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨å‡ç­‰ãªãƒ‡ãƒ¼ã‚¿åˆ†é…ã‚’ç¢ºä¿ã™ã‚‹ãŸã‚ã«é‡è¦ã§ã™ã€‚ãŸã¨ãˆã°ã€ã‚³ãƒ³ãƒ†ãƒŠã¯é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã€ã€ŒcustomerIdã€ã‚’ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

#### åˆ—æŒ™

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# CosmoDB Account
## List Azure Cosmos DB database accounts.
az cosmosdb list --resource-group <ResourceGroupName>
az cosmosdb show --resource-group <ResourceGroupName> --name <AccountName>

## Lists the virtual network accounts associated with a Cosmos DB account
az cosmosdb network-rule list --resource-group <ResourceGroupName> --name <AccountName>
## List the access keys or connection strings for a Azure Cosmos DB
az cosmosdb keys list --name <AccountName> --resource-group <ResourceGroupName>
## List all the database accounts that can be restored.
az cosmosdb restorable-database-account list --account-name <AccountName>
## Show the identities for a Azure Cosmos DB database account.
az cosmosdb identity show --resource-group <ResourceGroupName> --name <AccountName>


# CosmoDB (NoSQL)
## List the SQL databases under an Azure Cosmos DB account.
az cosmosdb sql database list --resource-group <ResourceGroupName> --account-name <AccountName>
## List the SQL containers under an Azure Cosmos DB SQL database.
az cosmosdb sql container list --account-name <AccountName> --database-name <DatabaseName> --resource-group <ResourceGroupName>

## List all SQL role assignments under an Azure Cosmos DB
az cosmosdb sql role assignment list --resource-group <ResourceGroupName> --account-name <AccountName>
## List all SQL role definitions under an Azure Cosmos DB
az cosmosdb sql role definition list --resource-group <ResourceGroupName> --account-name <AccountName>

## List the SQL stored procedures under an Azure Cosmos DB
az cosmosdb sql stored-procedure list --account-name <AccountName> --container-name <ContainerName> --database-name <DatabaseName> --resource-group <ResourceGroupName>
## List the SQL triggers under an Azure Cosmos DB SQL container.
az cosmosdb sql trigger list --account-name <AccountName> --container-name <ContainerName> --database-name <DatabaseName> --resource-group <ResourceGroupName>
## List the SQL user defined functions under an Azure Cosmos DB SQL container
az cosmosdb sql user-defined-function list --account-name <AccountName> --container-name <ContainerName> --database-name <DatabaseName> --resource-group <ResourceGroupName>

```
{% endcode %}
{% endtab %}

{% tab title="Az PowerShell" %}
{% code overflow="wrap" %}
```bash
Get-Command -Module Az.CosmosD

# List all Cosmos DB accounts in a specified resource group.
Get-AzCosmosDBAccount -ResourceGroupName "<ResourceGroupName>"

# Get the access keys for a specific Cosmos DB account.
Get-AzCosmosDBAccountKey -ResourceGroupName "<ResourceGroupName>" -Name "<AccountName>"

# Retrieve the client encryption keys for a specific Cosmos DB account.
Get-AzCosmosDbClientEncryptionKey -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -DatabaseName "<DatabaseName>"

# List all SQL containers in a specific Cosmos DB SQL database.
Get-AzCosmosDBSqlContainer -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -DatabaseName "<DatabaseName>"

# Get backup information for a specific Cosmos DB SQL container.
Get-AzCosmosDBSqlContainerBackupInformation -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -DatabaseName "<DatabaseName>" -Name "<ContainerName>" -Location "<location>"

# Get the throughput (RU/s) settings for a specific Cosmos DB SQL container.
Get-AzCosmosDBSqlContainerThroughput -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -DatabaseName "<DatabaseName>" -Name "<ContainerName>"

# List all SQL databases under a specific Cosmos DB account.
Get-AzCosmosDBSqlDatabase -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>"

# Get the throughput (RU/s) settings for a specific Cosmos DB SQL database.
Get-AzCosmosDBSqlDatabaseThroughput -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -Name "<DatabaseName>"

# List all SQL role assignments for a specific Cosmos DB account.
Get-AzCosmosDBSqlRoleAssignment -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>"

# List all SQL role definitions for a specific Cosmos DB account.
Get-AzCosmosDBSqlRoleDefinition -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>"

# List all stored procedures in a specific Cosmos DB SQL container.
Get-AzCosmosDBSqlStoredProcedure -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -DatabaseName "<DatabaseName>" -ContainerName "<ContainerName>"

# List all triggers in a specific Cosmos DB SQL container.
Get-AzCosmosDBSqlTrigger -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -DatabaseName "<DatabaseName>" -ContainerName "<ContainerName>"

# List all user-defined functions (UDFs) in a specific Cosmos DB SQL container.
Get-AzCosmosDBSqlUserDefinedFunction -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -DatabaseName "<DatabaseName>" -ContainerName "<ContainerName>"
```
{% endcode %}
{% endtab %}
{% endtabs %}

#### æ¥ç¶š

azure-cosmosDBï¼ˆpip install azure-cosmosï¼‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå¿…è¦ã§ã™ã€‚ã•ã‚‰ã«ã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ã‚­ãƒ¼ã¯æ¥ç¶šã‚’ç¢ºç«‹ã™ã‚‹ãŸã‚ã®é‡è¦ãªè¦ç´ ã§ã™ã€‚
{% code overflow="wrap" %}
```python
from azure.cosmos import CosmosClient, PartitionKey

# Connection details
endpoint = "<your-account-endpoint>"
key = "<your-account-key>"

# Initialize Cosmos Client
client = CosmosClient(endpoint, key)

# Access existing database and container
database_name = '<SampleDB>'
container_name = '<SampleContainer>'
database = client.get_database_client(database_name)
container = database.get_container_client(container_name)

# Insert multiple documents
items_to_insert = [
{"id": "1", "name": "Sample Item", "description": "This is a sample document."},
{"id": "2", "name": "Another Sample Item", "description": "This is another sample document."},
{"id": "3", "name": "Sample Item", "description": "This is a duplicate name sample document."},
]

for item in items_to_insert:
container.upsert_item(item)

# Query all documents
query = "SELECT * FROM c"
all_items = list(container.query_items(
query=query,
enable_cross_partition_query=True
))

# Print all queried items
print("All items in the container:")
for item in all_items:
print(item)
```
{% endcode %}

æ¥ç¶šã‚’ç¢ºç«‹ã™ã‚‹åˆ¥ã®æ–¹æ³•ã¯ã€**DefaultAzureCredential()**ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã™ã€‚æ¨©é™ã‚’æŒã¤ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆaz loginï¼‰ã—ã€ãã‚Œã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ã§ã™ã€‚ã“ã®å ´åˆã€å¿…è¦ãªæ¨©é™ã‚’ä¸ãˆã‚‹å½¹å‰²ã®å‰²ã‚Šå½“ã¦ã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆè©³ç´°ã«ã¤ã„ã¦ã¯å‚ç…§ï¼‰ã€‚ 

{% code overflow="wrap" %}
```python
from azure.identity import DefaultAzureCredential
from azure.cosmos import CosmosClient

# Use Azure AD for authentication
credential = DefaultAzureCredential()
endpoint = "<your-account-endpoint>"
client = CosmosClient(endpoint, credential)

# Access database and container
database_name = "<mydatabase>"
container_name = "<mycontainer>"
database = client.get_database_client(database_name)
container = database.get_container_client(container_name)

# Insert a document
item = {
"id": "1",
"name": "Sample Item",
"description": "This is a test item."
}
container.create_item(item)
print("Document inserted.")
```
{% endcode %}

### MongoDB
MongoDB NoSQL APIã¯ã€ãƒ‡ãƒ¼ã‚¿å½¢å¼ã¨ã—ã¦JSONã«ä¼¼ãŸBSONï¼ˆBinary JSONï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ã®APIã§ã™ã€‚ã“ã‚Œã¯ã€é›†ç´„æ©Ÿèƒ½ã‚’æŒã¤ã‚¯ã‚¨ãƒªè¨€èªã‚’æä¾›ã—ã€æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã€åŠæ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã€ãŠã‚ˆã³éæ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†ã«é©ã—ã¦ã„ã¾ã™ã€‚ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯é€šå¸¸ã€æ¬¡ã®å½¢å¼ã«å¾“ã„ã¾ã™ï¼š

{% code overflow="wrap" %}
```bash
mongodb://<hostname>:<port>/<database>
```
{% endcode %}

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
MongoDBã§ã¯ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å†…ã«1ã¤ä»¥ä¸Šã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã§ãã¾ã™ã€‚å„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®è«–ç†çš„ãªã‚°ãƒ«ãƒ¼ãƒ—ã¨ã—ã¦æ©Ÿèƒ½ã—ã€ãƒªã‚½ãƒ¼ã‚¹ã®çµ„ç¹”ã¨ç®¡ç†ã®å¢ƒç•Œã‚’æä¾›ã—ã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯ã€ç•°ãªã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãŸã‚ã«ãƒ‡ãƒ¼ã‚¿ã‚’è«–ç†çš„ã«åˆ†é›¢ã—ã€ç®¡ç†ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

#### ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
MongoDBã«ãŠã‘ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ã‚³ã‚¢ãƒ¦ãƒ‹ãƒƒãƒˆã¯ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚ã‚Šã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä¿æŒã—ã€åŠ¹ç‡çš„ãªã‚¯ã‚¨ãƒªã¨æŸ”è»Ÿãªã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆã®ãŸã‚ã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã¯å¼¾åŠ›çš„ã«ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ã§ã€åˆ†æ•£ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å†…ã®è¤‡æ•°ã®ãƒãƒ¼ãƒ‰ã«ã‚ãŸã£ã¦é«˜ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã®æ“ä½œã‚’ã‚µãƒãƒ¼ãƒˆã§ãã¾ã™ã€‚

#### åˆ—æŒ™

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# CosmoDB Account
## List Azure Cosmos DB database accounts.
az cosmosdb list --resource-group <ResourceGroupName>
az cosmosdb show --resource-group <ResourceGroupName> --name <AccountName>

## Lists the virtual network accounts associated with a Cosmos DB account
az cosmosdb network-rule list --resource-group <ResourceGroupName> --name <AccountName>
## List the access keys or connection strings for a Azure Cosmos DB
az cosmosdb keys list --name <AccountName> --resource-group <ResourceGroupName>
## List all the database accounts that can be restored.
az cosmosdb restorable-database-account list --account-name <AccountName>
## Show the identities for a Azure Cosmos DB database account.
az cosmosdb identity show --resource-group <ResourceGroupName> --name <AccountName>

## MongoDB
# List all MongoDB databases in a specified Azure Cosmos DB account
az cosmosdb mongodb database list --account-name <AccountName> --resource-group <ResourceGroupName>
# List all collections in a specific MongoDB database within an Azure Cosmos DB account
az cosmosdb mongodb collection list --account-name <AccountName> --database-name <DatabaseName> --resource-group <ResourceGroupName>

# List all role definitions for MongoDB within an Azure Cosmos DB account
az cosmosdb mongodb role definition list --account-name <AccountName> --resource-group <ResourceGroupName>
# List all user definitions for MongoDB within an Azure Cosmos DB account
az cosmosdb mongodb user definition list --account-name <AccountName> --resource-group <ResourceGroupName>
```
{% endcode %}
{% endtab %}

{% tab title="Az PowerShell" %}
{% code overflow="wrap" %}
```bash
Get-Command -Module Az.CosmosDB

# List all Cosmos DB accounts in a specified resource group.
Get-AzCosmosDBAccount -ResourceGroupName "<ResourceGroupName>"

# Get the access keys for a specific Cosmos DB account.
Get-AzCosmosDBAccountKey -ResourceGroupName "<ResourceGroupName>" -Name "<AccountName>"

# Retrieve the client encryption keys for a specific Cosmos DB account.
Get-AzCosmosDbClientEncryptionKey -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -DatabaseName "<DatabaseName>"

# List all MongoDB collections in a specific database.
Get-AzCosmosDBMongoDBCollection -AccountName <account-name> -ResourceGroupName <resource-group-name> -DatabaseName <database-name>

# Retrieve backup information for a specific MongoDB collection in a database.
Get-AzCosmosDBMongoDBCollectionBackupInformation -AccountName <account-name> -ResourceGroupName <resource-group-name> -DatabaseName <database-name> -Name <collection-name> -Location <Location>

# Get the throughput (RU/s) of a specific MongoDB collection in a database.
Get-AzCosmosDBMongoDBCollectionThroughput -AccountName <account-name> -ResourceGroupName <resource-group-name> -DatabaseName <database-name> -Name <collection-name>

# List all MongoDB databases in a specified Cosmos DB account.
Get-AzCosmosDBMongoDBDatabase -AccountName <account-name> -ResourceGroupName <resource-group-name>

# Get the throughput (RU/s) of a specific MongoDB database.
Get-AzCosmosDBMongoDBDatabaseThroughput -AccountName <account-name> -ResourceGroupName <resource-group-name> -DatabaseName <database-name>

# Retrieve the role definitions for MongoDB users in a specified Cosmos DB account.
Get-AzCosmosDBMongoDBRoleDefinition -AccountName <account-name> -ResourceGroupName <resource-group-name>

```
{% endcode %}
{% endtab %}
{% endtabs %}

#### æ¥ç¶š

ã“ã“ã§ã¯ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚­ãƒ¼ã¾ãŸã¯ç‰¹æ¨©æ˜‡æ ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§èª¬æ˜ã•ã‚Œã¦ã„ã‚‹æ–¹æ³•ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
{% code overflow="wrap" %}
```python
from pymongo import MongoClient

# Updated connection string with retryWrites=false
connection_string = "mongodb://<account-name>.mongo.cosmos.azure.com:10255/?ssl=true&replicaSet=globaldb&retryWrites=false"

# Create the client
client = MongoClient(connection_string, username="<username>", password="<password>")

# Access the database
db = client['<database>']

# Access a collection
collection = db['<collection>']

# Insert a single document
document = {
"name": "John Doe",
"email": "johndoe@example.com",
"age": 30,
"address": {
"street": "123 Main St",
"city": "Somewhere",
"state": "CA",
"zip": "90210"
}
}

# Insert document
result = collection.insert_one(document)
print(f"Inserted document with ID: {result.inserted_id}")
```
{% endcode %}

## å‚è€ƒæ–‡çŒ®

* [https://learn.microsoft.com/en-us/azure/cosmos-db/choose-api](https://learn.microsoft.com/en-us/azure/cosmos-db/choose-api)
* [https://learn.microsoft.com/en-us/azure/cosmos-db/](https://learn.microsoft.com/en-us/azure/cosmos-db/)
* [https://learn.microsoft.com/en-us/azure/cosmos-db/introduction](https://learn.microsoft.com/en-us/azure/cosmos-db/introduction)
* [https://learn.microsoft.com/en-us/azure/cosmos-db/nosql/security/how-to-grant-data-plane-role-based-access?tabs=built-in-definition%2Ccsharp&pivots=azure-interface-cli](https://learn.microsoft.com/en-us/azure/cosmos-db/nosql/security/how-to-grant-data-plane-role-based-access?tabs=built-in-definition%2Ccsharp&pivots=azure-interface-cli)

## æ¨©é™æ˜‡æ ¼

{% content-ref url="../az-privilege-escalation/az-cosmosDB-privesc.md" %}
[az-cosmosDB-privesc.md](../az-privilege-escalation/az-cosmosDB-privesc.md)
{% endcontent-ref %}

## ãƒã‚¹ãƒˆã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆ

{% content-ref url="../az-post-exploitation/az-cosmosDB-post-exploitation.md" %}
[az-cosmosDB-post-exploitation.md](../az-post-exploitation/az-sql-post-exploitation.md)
{% endcontent-ref %}

## ToDo

* ã“ã“ã«æ®‹ã‚Šã®DBã€ãƒ†ãƒ¼ãƒ–ãƒ«ã€Cassandraã€Gremlin...
* ãƒã‚¹ãƒˆã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã® "Microsoft.DocumentDB/databaseAccounts/mongodbUserDefinitions/write" ã¨ "Microsoft.DocumentDB/databaseAccounts/mongodbUserDefinitions/read" ãŠã‚ˆã³ãƒ­ãƒ¼ãƒ«å®šç¾©ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ã“ã“ã«ã¯æ¨©é™æ˜‡æ ¼ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
* å¾©å…ƒã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚



{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
