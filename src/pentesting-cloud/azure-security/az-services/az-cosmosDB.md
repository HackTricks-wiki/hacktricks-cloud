# Az - CosmosDB

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Azure CosmosDB

**Azure Cosmos DB** - —Ü–µ –ø–æ–≤–Ω—ñ—Å—Ç—é **–∫–µ—Ä–æ–≤–∞–Ω–∞ NoSQL, —Ä–µ–ª—è—Ü—ñ–π–Ω–∞ —Ç–∞ –≤–µ–∫—Ç–æ—Ä–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö**, —è–∫–∞ –∑–∞–±–µ–∑–ø–µ—á—É—î —á–∞—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤ –æ–¥–∏–Ω–∏—á–Ω—ñ –º—ñ–ª—ñ—Å–µ–∫—É–Ω–¥–∏, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—É –º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å —Ç–∞ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å, —â–æ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è SLA, –∑ –±–µ–∑–ø–µ–∫–æ—é –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è. –í–æ–Ω–∞ –¥–æ–∑–≤–æ–ª—è—î —à–≤–∏–¥—à–µ —Ä–æ–∑—Ä–æ–±–ª—è—Ç–∏ –¥–æ–¥–∞—Ç–∫–∏ –∑–∞–≤–¥—è–∫–∏ –≥–æ—Ç–æ–≤—ñ–π –±–∞–≥–∞—Ç–æ—Ä–µ–≥—ñ–æ–Ω–∞–ª—å–Ω—ñ–π —Ä–æ–∑–ø–æ–¥—ñ–ª—å–Ω—ñ–π —Å–∏—Å—Ç–µ–º—ñ –¥–∞–Ω–∏—Ö, –≤—ñ–¥–∫—Ä–∏—Ç–∏–º API, SDK –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω–∏—Ö –º–æ–≤ —Ç–∞ —Ñ—É–Ω–∫—Ü—ñ—è–º –±–∞–∑–∏ –¥–∞–Ω–∏—Ö AI, —Ç–∞–∫–∏–º —è–∫ —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ –≤–µ–∫—Ç–æ—Ä—ñ–≤ —Ç–∞ –±–µ–∑—à–æ–≤–Ω–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Azure AI.

Azure Cosmos DB –Ω–∞–¥–∞—î –∫—ñ–ª—å–∫–∞ API –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –¥–ª—è –º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è —Ä–µ–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏, —Ä–µ–ª—è—Ü—ñ–π–Ω—ñ, –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–Ω—è, –≥—Ä–∞—Ñ–æ–≤—ñ —Ç–∞ –∫–æ–ª–æ–Ω–æ–≤—ñ —Å—ñ–º–µ–π–Ω—ñ –º–æ–¥–µ–ª—ñ –¥–∞–Ω–∏—Ö, —Å–µ—Ä–µ–¥ —è–∫–∏—Ö NoSQL, MongoDB, PostgreSQL, Cassandra, Gremlin —Ç–∞ Table.

–û–¥–Ω–∏–º –∑ –∫–ª—é—á–æ–≤–∏—Ö –∞—Å–ø–µ–∫—Ç—ñ–≤ CosmosDB —î Azure Cosmos Account. **Azure Cosmos Account** —î —Ç–æ—á–∫–æ—é –≤—Ö–æ–¥—É –¥–æ –±–∞–∑ –¥–∞–Ω–∏—Ö. –û–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å –≤–∏–∑–Ω–∞—á–∞—î –∫–ª—é—á–æ–≤—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è, —Ç–∞–∫—ñ —è–∫ –≥–ª–æ–±–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª, —Ä—ñ–≤–Ω—ñ —É–∑–≥–æ–¥–∂–µ–Ω–æ—Å—Ç—ñ —Ç–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π API, —è–∫–∏–π –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, NoSQL. –ß–µ—Ä–µ–∑ –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å –≤–∏ –º–æ–∂–µ—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –≥–ª–æ–±–∞–ª—å–Ω—É —Ä–µ–ø–ª—ñ–∫–∞—Ü—ñ—é, —â–æ–± –∑–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö —É –∫—ñ–ª—å–∫–æ—Ö —Ä–µ–≥—ñ–æ–Ω–∞—Ö –¥–ª—è –∑–Ω–∏–∂–µ–Ω–Ω—è –∑–∞—Ç—Ä–∏–º–∫–∏. –ö—Ä—ñ–º —Ç–æ–≥–æ, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–±—Ä–∞—Ç–∏ —Ä—ñ–≤–µ–Ω—å —É–∑–≥–æ–¥–∂–µ–Ω–æ—Å—Ç—ñ, —è–∫–∏–π –±–∞–ª–∞–Ω—Å—É—î –º—ñ–∂ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—é —Ç–∞ —Ç–æ—á–Ω—ñ—Å—Ç—é –¥–∞–Ω–∏—Ö, –∑ –≤–∞—Ä—ñ–∞–Ω—Ç–∞–º–∏ –≤—ñ–¥ —Å–∏–ª—å–Ω–æ—ó –¥–æ –æ—Å—Ç–∞—Ç–æ—á–Ω–æ—ó —É–∑–≥–æ–¥–∂–µ–Ω–æ—Å—Ç—ñ.

### NoSQL (sql)
API NoSQL Azure Cosmos DB —î –¥–æ–∫—É–º–µ–Ω—Ç–Ω–æ-–æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω–∏–º API, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î JSON —è–∫ —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–∏—Ö. –í—ñ–Ω –Ω–∞–¥–∞—î —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∑–∞–ø–∏—Ç—ñ–≤, –ø–æ–¥—ñ–±–Ω–∏–π –¥–æ SQL, –¥–ª—è –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ –æ–±'—î–∫—Ç—ñ–≤ JSON, —â–æ —Ä–æ–±–∏—Ç—å –π–æ–≥–æ –ø—Ä–∏–¥–∞—Ç–Ω–∏–º –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–º–∏ —Ç–∞ –Ω–∞–ø—ñ–≤—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏. –¢–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø—É —Å–µ—Ä–≤—ñ—Å—É:

{% code overflow="wrap" %}
```bash
https://<Account-Name>.documents.azure.com:443/
```
{% endcode %}

#### –ë–∞–∑–∏ –¥–∞–Ω–∏—Ö
–£ –º–µ–∂–∞—Ö –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É –≤–∏ –º–æ–∂–µ—Ç–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –æ–¥–Ω—É –∞–±–æ –∫—ñ–ª—å–∫–∞ –±–∞–∑ –¥–∞–Ω–∏—Ö, —è–∫—ñ —Å–ª—É–≥—É—é—Ç—å –ª–æ–≥—ñ—á–Ω–∏–º–∏ –≥—Ä—É–ø–∞–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤. –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö –¥—ñ—î —è–∫ –º–µ–∂–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å–∞–º–∏ —Ç–∞ –ø—Ä–∞–≤–∞–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤. –ë–∞–∑–∏ –¥–∞–Ω–∏—Ö –º–æ–∂—É—Ç—å –∞–±–æ –¥—ñ–ª–∏—Ç–∏ –≤–∏–¥—ñ–ª–µ–Ω—É –ø—Ä–æ–ø—É—Å–∫–Ω—É –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å –º—ñ–∂ —Å–≤–æ—ó–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏, –∞–±–æ –≤–∏–¥—ñ–ª—è—Ç–∏ –æ–∫—Ä–µ–º—É –ø—Ä–æ–ø—É—Å–∫–Ω—É –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å –¥–ª—è —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤.

#### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏
–û—Å–Ω–æ–≤–Ω–æ—é –æ–¥–∏–Ω–∏—Ü–µ—é –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö —î –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, —è–∫–∏–π –º—ñ—Å—Ç–∏—Ç—å JSON-–¥–æ–∫—É–º–µ–Ω—Ç–∏ —ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —ñ–Ω–¥–µ–∫—Å—É—î—Ç—å—Å—è –¥–ª—è –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ –µ–ª–∞—Å—Ç–∏—á–Ω–æ –º–∞—Å—à—Ç–∞–±—É—é—Ç—å—Å—è —ñ —Ä–æ–∑–ø–æ–¥—ñ–ª—è—é—Ç—å—Å—è –ø–æ —Ä–æ–∑–¥—ñ–ª–∞—Ö, —è–∫—ñ –≤–∏–∑–Ω–∞—á–∞—é—Ç—å—Å—è –∫–ª—é—á–µ–º —Ä–æ–∑–¥—ñ–ª—É, –∑–∞–¥–∞–Ω–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º. –ö–ª—é—á —Ä–æ–∑–¥—ñ–ª—É —î –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–∏–º –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ—ó –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Ç–∞ —Ä—ñ–≤–Ω–æ–º—ñ—Ä–Ω–æ–≥–æ —Ä–æ–∑–ø–æ–¥—ñ–ª—É –¥–∞–Ω–∏—Ö. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –¥–∞–Ω—ñ –∫–ª—ñ—î–Ω—Ç—ñ–≤, –∑ "customerId" —è–∫ –∫–ª—é—á–µ–º —Ä–æ–∑–¥—ñ–ª—É.

#### –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞–Ω–Ω—è

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# CosmoDB Account
## List Azure Cosmos DB database accounts.
az cosmosdb list --resource-group <ResourceGroupName>
az cosmosdb show --resource-group <ResourceGroupName> --name <AccountName>

## Lists the virtual network accounts associated with a Cosmos DB account
az cosmosdb network-rule list --resource-group <ResourceGroupName> --name <AccountName>
## List the access keys or connection strings for a Azure Cosmos DB
az cosmosdb keys list --name <AccountName> --resource-group <ResourceGroupName>
## List all the database accounts that can be restored.
az cosmosdb restorable-database-account list --account-name <AccountName>
## Show the identities for a Azure Cosmos DB database account.
az cosmosdb identity show --resource-group <ResourceGroupName> --name <AccountName>


# CosmoDB (NoSQL)
## List the SQL databases under an Azure Cosmos DB account.
az cosmosdb sql database list --resource-group <ResourceGroupName> --account-name <AccountName>
## List the SQL containers under an Azure Cosmos DB SQL database.
az cosmosdb sql container list --account-name <AccountName> --database-name <DatabaseName> --resource-group <ResourceGroupName>

## List all SQL role assignments under an Azure Cosmos DB
az cosmosdb sql role assignment list --resource-group <ResourceGroupName> --account-name <AccountName>
## List all SQL role definitions under an Azure Cosmos DB
az cosmosdb sql role definition list --resource-group <ResourceGroupName> --account-name <AccountName>

## List the SQL stored procedures under an Azure Cosmos DB
az cosmosdb sql stored-procedure list --account-name <AccountName> --container-name <ContainerName> --database-name <DatabaseName> --resource-group <ResourceGroupName>
## List the SQL triggers under an Azure Cosmos DB SQL container.
az cosmosdb sql trigger list --account-name <AccountName> --container-name <ContainerName> --database-name <DatabaseName> --resource-group <ResourceGroupName>
## List the SQL user defined functions under an Azure Cosmos DB SQL container
az cosmosdb sql user-defined-function list --account-name <AccountName> --container-name <ContainerName> --database-name <DatabaseName> --resource-group <ResourceGroupName>

```
{% endcode %}
{% endtab %}

{% tab title="Az PowerShell" %}
{% code overflow="wrap" %}
```bash
Get-Command -Module Az.CosmosD

# List all Cosmos DB accounts in a specified resource group.
Get-AzCosmosDBAccount -ResourceGroupName "<ResourceGroupName>"

# Get the access keys for a specific Cosmos DB account.
Get-AzCosmosDBAccountKey -ResourceGroupName "<ResourceGroupName>" -Name "<AccountName>"

# Retrieve the client encryption keys for a specific Cosmos DB account.
Get-AzCosmosDbClientEncryptionKey -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -DatabaseName "<DatabaseName>"

# List all SQL containers in a specific Cosmos DB SQL database.
Get-AzCosmosDBSqlContainer -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -DatabaseName "<DatabaseName>"

# Get backup information for a specific Cosmos DB SQL container.
Get-AzCosmosDBSqlContainerBackupInformation -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -DatabaseName "<DatabaseName>" -Name "<ContainerName>" -Location "<location>"

# Get the throughput (RU/s) settings for a specific Cosmos DB SQL container.
Get-AzCosmosDBSqlContainerThroughput -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -DatabaseName "<DatabaseName>" -Name "<ContainerName>"

# List all SQL databases under a specific Cosmos DB account.
Get-AzCosmosDBSqlDatabase -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>"

# Get the throughput (RU/s) settings for a specific Cosmos DB SQL database.
Get-AzCosmosDBSqlDatabaseThroughput -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -Name "<DatabaseName>"

# List all SQL role assignments for a specific Cosmos DB account.
Get-AzCosmosDBSqlRoleAssignment -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>"

# List all SQL role definitions for a specific Cosmos DB account.
Get-AzCosmosDBSqlRoleDefinition -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>"

# List all stored procedures in a specific Cosmos DB SQL container.
Get-AzCosmosDBSqlStoredProcedure -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -DatabaseName "<DatabaseName>" -ContainerName "<ContainerName>"

# List all triggers in a specific Cosmos DB SQL container.
Get-AzCosmosDBSqlTrigger -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -DatabaseName "<DatabaseName>" -ContainerName "<ContainerName>"

# List all user-defined functions (UDFs) in a specific Cosmos DB SQL container.
Get-AzCosmosDBSqlUserDefinedFunction -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -DatabaseName "<DatabaseName>" -ContainerName "<ContainerName>"
```
{% endcode %}
{% endtab %}
{% endtabs %}

#### –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

–î–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ø–æ—Ç—Ä—ñ–±–Ω–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ azure-cosmosDB (pip install azure-cosmos). –ö—Ä—ñ–º —Ç–æ–≥–æ, –∫—ñ–Ω—Ü–µ–≤–∞ —Ç–æ—á–∫–∞ —Ç–∞ –∫–ª—é—á —î –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ –¥–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑'—î–¥–Ω–∞–Ω–Ω—è.
{% code overflow="wrap" %}
```python
from azure.cosmos import CosmosClient, PartitionKey

# Connection details
endpoint = "<your-account-endpoint>"
key = "<your-account-key>"

# Initialize Cosmos Client
client = CosmosClient(endpoint, key)

# Access existing database and container
database_name = '<SampleDB>'
container_name = '<SampleContainer>'
database = client.get_database_client(database_name)
container = database.get_container_client(container_name)

# Insert multiple documents
items_to_insert = [
{"id": "1", "name": "Sample Item", "description": "This is a sample document."},
{"id": "2", "name": "Another Sample Item", "description": "This is another sample document."},
{"id": "3", "name": "Sample Item", "description": "This is a duplicate name sample document."},
]

for item in items_to_insert:
container.upsert_item(item)

# Query all documents
query = "SELECT * FROM c"
all_items = list(container.query_items(
query=query,
enable_cross_partition_query=True
))

# Print all queried items
print("All items in the container:")
for item in all_items:
print(item)
```
{% endcode %}

–Ü–Ω—à–∏–π —Å–ø–æ—Å—ñ–± –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑'—î–¥–Ω–∞–Ω–Ω—è - —Ü–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è **DefaultAzureCredential()**. –ü—Ä–æ—Å—Ç–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ —É–≤—ñ–π—Ç–∏ (az login) –∑ –æ–±–ª—ñ–∫–æ–≤–∏–º –∑–∞–ø–∏—Å–æ–º, —è–∫–∏–π –º–∞—î –¥–æ–∑–≤–æ–ª–∏, —ñ –≤–∏–∫–æ–Ω–∞—Ç–∏ –π–æ–≥–æ. –£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä–æ–ª—ñ, –Ω–∞–¥–∞–≤—à–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –¥–æ–∑–≤–æ–ª–∏ (–¥–∏–≤. –¥–ª—è –±—ñ–ª—å—à–µ)

{% code overflow="wrap" %}
```python
from azure.identity import DefaultAzureCredential
from azure.cosmos import CosmosClient

# Use Azure AD for authentication
credential = DefaultAzureCredential()
endpoint = "<your-account-endpoint>"
client = CosmosClient(endpoint, credential)

# Access database and container
database_name = "<mydatabase>"
container_name = "<mycontainer>"
database = client.get_database_client(database_name)
container = database.get_container_client(container_name)

# Insert a document
item = {
"id": "1",
"name": "Sample Item",
"description": "This is a test item."
}
container.create_item(item)
print("Document inserted.")
```
{% endcode %}

### MongoDB
API MongoDB NoSQL —î –¥–æ–∫—É–º–µ–Ω—Ç–Ω–æ-–æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω–∏–º API, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–∏—Ö, —Å—Ö–æ–∂–∏–π –Ω–∞ JSON, BSON (Binary JSON). –í—ñ–Ω –Ω–∞–¥–∞—î –º–æ–≤—É –∑–∞–ø–∏—Ç—ñ–≤ –∑ –º–æ–∂–ª–∏–≤–æ—Å—Ç—è–º–∏ –∞–≥—Ä–µ–≥–∞—Ü—ñ—ó, —â–æ —Ä–æ–±–∏—Ç—å –π–æ–≥–æ –ø—Ä–∏–¥–∞—Ç–Ω–∏–º –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–º–∏, –Ω–∞–ø—ñ–≤—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–º–∏ —Ç–∞ –Ω–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏. –ö—ñ–Ω—Ü–µ–≤–∞ —Ç–æ—á–∫–∞ —Å–µ—Ä–≤—ñ—Å—É –∑–∞–∑–≤–∏—á–∞–π –º–∞—î —Ç–∞–∫–∏–π —Ñ–æ—Ä–º–∞—Ç:

{% code overflow="wrap" %}
```bash
mongodb://<hostname>:<port>/<database>
```
{% endcode %}

#### –ë–∞–∑–∏ –¥–∞–Ω–∏—Ö
–£ MongoDB –≤–∏ –º–æ–∂–µ—Ç–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –æ–¥–Ω—É –∞–±–æ –∫—ñ–ª—å–∫–∞ –±–∞–∑ –¥–∞–Ω–∏—Ö –≤ –º–µ–∂–∞—Ö –µ–∫–∑–µ–º–ø–ª—è—Ä–∞. –ö–æ–∂–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö —Å–ª—É–≥—É—î –ª–æ–≥—ñ—á–Ω–æ—é –≥—Ä—É–ø–æ—é –∫–æ–ª–µ–∫—Ü—ñ–π —ñ –∑–∞–±–µ–∑–ø–µ—á—É—î –º–µ–∂—É –¥–ª—è –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó —Ç–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å–∞–º–∏. –ë–∞–∑–∏ –¥–∞–Ω–∏—Ö –¥–æ–ø–æ–º–∞–≥–∞—é—Ç—å –ª–æ–≥—ñ—á–Ω–æ —Ä–æ–∑–¥—ñ–ª—è—Ç–∏ —Ç–∞ —É–ø—Ä–∞–≤–ª—è—Ç–∏ –¥–∞–Ω–∏–º–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –¥–æ–¥–∞—Ç–∫—ñ–≤ –∞–±–æ –ø—Ä–æ–µ–∫—Ç—ñ–≤.

#### –ö–æ–ª–µ–∫—Ü—ñ—ó
–û—Å–Ω–æ–≤–Ω–æ—é –æ–¥–∏–Ω–∏—Ü–µ—é –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö —É MongoDB —î –∫–æ–ª–µ–∫—Ü—ñ—è, —è–∫–∞ –º—ñ—Å—Ç–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∏ —ñ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –≥–Ω—É—á–∫–æ–≥–æ –ø—Ä–æ–µ–∫—Ç—É–≤–∞–Ω–Ω—è —Å—Ö–µ–º–∏. –ö–æ–ª–µ–∫—Ü—ñ—ó –µ–ª–∞—Å—Ç–∏—á–Ω–æ –º–∞—Å—à—Ç–∞–±—É—é—Ç—å—Å—è —ñ –º–æ–∂—É—Ç—å –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑ –≤–∏—Å–æ–∫–æ—é –ø—Ä–æ–ø—É—Å–∫–Ω–æ—é –∑–¥–∞—Ç–Ω—ñ—Å—Ç—é –Ω–∞ –∫—ñ–ª—å–∫–æ—Ö –≤—É–∑–ª–∞—Ö —É —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω—ñ–π —Å–∏—Å—Ç–µ–º—ñ.

#### –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞–Ω–Ω—è

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# CosmoDB Account
## List Azure Cosmos DB database accounts.
az cosmosdb list --resource-group <ResourceGroupName>
az cosmosdb show --resource-group <ResourceGroupName> --name <AccountName>

## Lists the virtual network accounts associated with a Cosmos DB account
az cosmosdb network-rule list --resource-group <ResourceGroupName> --name <AccountName>
## List the access keys or connection strings for a Azure Cosmos DB
az cosmosdb keys list --name <AccountName> --resource-group <ResourceGroupName>
## List all the database accounts that can be restored.
az cosmosdb restorable-database-account list --account-name <AccountName>
## Show the identities for a Azure Cosmos DB database account.
az cosmosdb identity show --resource-group <ResourceGroupName> --name <AccountName>

## MongoDB
# List all MongoDB databases in a specified Azure Cosmos DB account
az cosmosdb mongodb database list --account-name <AccountName> --resource-group <ResourceGroupName>
# List all collections in a specific MongoDB database within an Azure Cosmos DB account
az cosmosdb mongodb collection list --account-name <AccountName> --database-name <DatabaseName> --resource-group <ResourceGroupName>

# List all role definitions for MongoDB within an Azure Cosmos DB account
az cosmosdb mongodb role definition list --account-name <AccountName> --resource-group <ResourceGroupName>
# List all user definitions for MongoDB within an Azure Cosmos DB account
az cosmosdb mongodb user definition list --account-name <AccountName> --resource-group <ResourceGroupName>

```
{% endcode %}
{% endtab %}

{% tab title="Az PowerShell" %}
{% code overflow="wrap" %}
```bash
Get-Command -Module Az.CosmosDB

# List all Cosmos DB accounts in a specified resource group.
Get-AzCosmosDBAccount -ResourceGroupName "<ResourceGroupName>"

# Get the access keys for a specific Cosmos DB account.
Get-AzCosmosDBAccountKey -ResourceGroupName "<ResourceGroupName>" -Name "<AccountName>"

# Retrieve the client encryption keys for a specific Cosmos DB account.
Get-AzCosmosDbClientEncryptionKey -ResourceGroupName "<ResourceGroupName>" -AccountName "<AccountName>" -DatabaseName "<DatabaseName>"

# List all MongoDB collections in a specific database.
Get-AzCosmosDBMongoDBCollection -AccountName <account-name> -ResourceGroupName <resource-group-name> -DatabaseName <database-name>

# Retrieve backup information for a specific MongoDB collection in a database.
Get-AzCosmosDBMongoDBCollectionBackupInformation -AccountName <account-name> -ResourceGroupName <resource-group-name> -DatabaseName <database-name> -Name <collection-name> -Location <Location>

# Get the throughput (RU/s) of a specific MongoDB collection in a database.
Get-AzCosmosDBMongoDBCollectionThroughput -AccountName <account-name> -ResourceGroupName <resource-group-name> -DatabaseName <database-name> -Name <collection-name>

# List all MongoDB databases in a specified Cosmos DB account.
Get-AzCosmosDBMongoDBDatabase -AccountName <account-name> -ResourceGroupName <resource-group-name>

# Get the throughput (RU/s) of a specific MongoDB database.
Get-AzCosmosDBMongoDBDatabaseThroughput -AccountName <account-name> -ResourceGroupName <resource-group-name> -DatabaseName <database-name>

# Retrieve the role definitions for MongoDB users in a specified Cosmos DB account.
Get-AzCosmosDBMongoDBRoleDefinition -AccountName <account-name> -ResourceGroupName <resource-group-name>

```
{% endcode %}
{% endtab %}
{% endtabs %}

#### –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

–¢—É—Ç –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –ø–∞—Ä–æ–ª—å –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–ª—é—á—ñ–≤ –∞–±–æ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –º–µ—Ç–æ–¥—É, –æ–ø–∏—Å–∞–Ω–æ–≥–æ –≤ —Ä–æ–∑–¥—ñ–ª—ñ privesc.
{% code overflow="wrap" %}
```python
from pymongo import MongoClient

# Updated connection string with retryWrites=false
connection_string = "mongodb://<account-name>.mongo.cosmos.azure.com:10255/?ssl=true&replicaSet=globaldb&retryWrites=false"

# Create the client
client = MongoClient(connection_string, username="<username>", password="<password>")

# Access the database
db = client['<database>']

# Access a collection
collection = db['<collection>']

# Insert a single document
document = {
"name": "John Doe",
"email": "johndoe@example.com",
"age": 30,
"address": {
"street": "123 Main St",
"city": "Somewhere",
"state": "CA",
"zip": "90210"
}
}

# Insert document
result = collection.insert_one(document)
print(f"Inserted document with ID: {result.inserted_id}")
```
{% endcode %}

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://learn.microsoft.com/en-us/azure/cosmos-db/choose-api](https://learn.microsoft.com/en-us/azure/cosmos-db/choose-api)
* [https://learn.microsoft.com/en-us/azure/cosmos-db/](https://learn.microsoft.com/en-us/azure/cosmos-db/)
* [https://learn.microsoft.com/en-us/azure/cosmos-db/introduction](https://learn.microsoft.com/en-us/azure/cosmos-db/introduction)
* [https://learn.microsoft.com/en-us/azure/cosmos-db/nosql/security/how-to-grant-data-plane-role-based-access?tabs=built-in-definition%2Ccsharp&pivots=azure-interface-cli](https://learn.microsoft.com/en-us/azure/cosmos-db/nosql/security/how-to-grant-data-plane-role-based-access?tabs=built-in-definition%2Ccsharp&pivots=azure-interface-cli)

## –ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤

{% content-ref url="../az-privilege-escalation/az-cosmosDB-privesc.md" %}
[az-cosmosDB-privesc.md](../az-privilege-escalation/az-cosmosDB-privesc.md)
{% endcontent-ref %}

## –ü–æ—Å—Ç–µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è

{% content-ref url="../az-post-exploitation/az-cosmosDB-post-exploitation.md" %}
[az-cosmosDB-post-exploitation.md](../az-post-exploitation/az-sql-post-exploitation.md)
{% endcontent-ref %}

## ToDo

* –†–µ—à—Ç–∞ –ë–î —Ç—É—Ç, —Ç–∞–±–ª–∏—Ü—ñ, cassandra, gremlin...
* –û–∑–Ω–∞–π–æ–º—Ç–µ—Å—è –∑ –ø–æ—Å—Ç–µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—î—é "Microsoft.DocumentDB/databaseAccounts/mongodbUserDefinitions/write" && "Microsoft.DocumentDB/databaseAccounts/mongodbUserDefinitions/read" —Ç–∞ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ —Ä–æ–ª–µ–π, –æ—Å–∫—ñ–ª—å–∫–∏ —Ç—É—Ç –º–æ–∂–µ –±—É—Ç–∏ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤
* –û–∑–Ω–∞–π–æ–º—Ç–µ—Å—è –∑ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è–º–∏



{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ GCP Hacking: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ github.

</details>
{% endhint %}
