# Az - API Management

{{#include ../../../banners/hacktricks-training.md}}

## बुनियादी जानकारी

Azure API Management (APIM) एक पूर्ण रूप से प्रबंधित सेवा है जो API प्रकाशित करने, सुरक्षित करने, रूपांतरित करने, प्रबंधित करने और मॉनिटर करने के लिए एक **एकीकृत प्लेटफ़ॉर्म** प्रदान करती है। यह संगठनों को उनकी API रणनीति को केंद्रीकृत करने और सभी सेवाओं में संगत गवर्नेंस, प्रदर्शन और सुरक्षा सुनिश्चित करने में सक्षम बनाती है। बैकएंड सेवाओं और API उपभोक्ताओं के बीच एक अभिसरण परत के रूप में कार्य करके, APIM एकीकरण को सरल बनाता है और रखरखाव में सुधार करता है जबकि आवश्यक संचालन और सुरक्षा क्षमताएँ प्रदान करता है।

## मुख्य अवधारणाएँ

**The API Gateway** सभी API ट्रैफिक के लिए एकल प्रवेश बिंदु के रूप में कार्य करती है, जो बैकएंड सेवाओं को अनुरोध रूट करने, दर सीमाओं को लागू करने, प्रतिक्रियाओं को कैश करने, और प्रमाणीकरण और अधिकरण का प्रबंधन करने जैसे कार्यों को संभालती है। यह gateway Azure द्वारा पूरी तरह होस्ट और प्रबंधित की जाती है, जिससे उच्च उपलब्धता और स्केलेबिलिटी सुनिश्चित होती है।

**The Developer Portal** एक self-service वातावरण प्रदान करता है जहाँ API उपभोक्ता उपलब्ध APIs खोज सकते हैं, दस्तावेज़ पढ़ सकते हैं, और endpoints का परीक्षण कर सकते हैं। यह इंटरएक्टिव टूल और सब्सक्रिप्शन जानकारी के एक्सेस के माध्यम से ऑनबोर्डिंग को सरल करता है।

**The Management Portal (Management Plane)** प्रशासकों द्वारा APIM सेवा को कॉन्फ़िगर और बनाए रखने के लिए उपयोग किया जाता है। यहाँ से उपयोगकर्ता APIs और operations परिभाषित कर सकते हैं, access control कॉन्फ़िगर कर सकते हैं, policies लागू कर सकते हैं, users का प्रबंधन कर सकते हैं, और APIs को products में व्यवस्थित कर सकते हैं। यह पोर्टल प्रशासन को केंद्रीकृत करता है और API गवर्नेंस में निरंतरता सुनिश्चित करता है।

## Authentication and Authorization

Azure API Management कई **authentication mechanisms** को समर्थन देता है ताकि API एक्सेस सुरक्षित रहे। इनमें **subscription keys**, **OAuth 2.0 tokens**, और **client certificates** शामिल हैं। APIM मूल रूप से **Microsoft Entra ID** के साथ एकीकृत होता है, जिससे enterprise-level identity management और APIs तथा backend सेवाओं के लिए सुरक्षित पहुंच सक्षम होती है।

## Policies

APIM में policies प्रशासकों को विभिन्न granularities पर **request और response processing** को अनुकूलित करने की अनुमति देती हैं, जिनमें **service**, **API**, **operation**, या **product** स्तर शामिल हैं। Policies के माध्यम से, JWT token validation लागू करना, XML या JSON payloads को transform करना, rate limiting लागू करना, IP address द्वारा कॉल्स को प्रतिबंधित करना, या managed identities का उपयोग करके backend सेवाओं के खिलाफ authenticate करना संभव है। Policies अत्यधिक लचीली होती हैं और API Management प्लेटफ़ॉर्म की मुख्य ताकतों में से एक हैं, जो backend कोड में बदलाव किए बिना runtime व्यवहार पर सूक्ष्म नियंत्रण सक्षम करती हैं।

## Named Values

यह सेवा **Named Values** नामक एक तंत्र प्रदान करती है, जो policies द्वारा आवश्यक configuration जानकारी जैसे secrets, API keys, या अन्य मानों को स्टोर करने की अनुमति देता है।

ये मान सीधे APIM में संग्रहीत किए जा सकते हैं या सुरक्षित रूप से **Azure Key Vault** से संदर्भित किए जा सकते हैं। Named Values सुरक्षित और केंद्रीकृत प्रबंधन को बढ़ावा देते हैं और हार्डकोडेड मानों के बजाय पुन: उपयोग योग्य संदर्भों की अनुमति देकर policy लेखन को सरल बनाते हैं।

## Networking and Security Integration

Azure API Management सहजता से **virtual network environments** के साथ एकीकृत होता है, जिससे backend सिस्टम्स के लिए निजी और सुरक्षित कनेक्टिविटी संभव होती है।

जब इसे एक **Virtual Network (VNet)** के अंदर तैनात किया जाता है, तो APIM आंतरिक सेवाओं तक सार्वजनिक रूप से उजागर किए बिना पहुंच सकता है। यह सेवा backend सेवाओं के साथ mutual TLS authentication का समर्थन करने के लिए custom certificates को कॉन्फ़िगर करने की अनुमति भी देती है, जो ऐसे परिदृश्यों में सुरक्षा को बढ़ाती है जहाँ मजबूत identity validation की आवश्यकता होती है।

ये नेटवर्किंग सुविधाएँ APIM को cloud-native और hybrid architectures दोनों के लिए उपयुक्त बनाती हैं।

### सूचीबद्ध करना

API management सेवा को सूचीबद्ध करने के लिए:
```bash
# Lists all Named Values configured in the Azure API Management instance
az apim nv list --resource-group <resource-group> --service-name <service-name>

# Retrieves all policies applied at the API level in raw XML format
az rest --method GET \
--uri "https://management.azure.com/subscriptions/<subscription-id>/resourceGroups/<resource-group>/providers/Microsoft.ApiManagement/service/<service-name>/apis/<api-id>/policies/?api-version=2024-05-01&format=rawxml"

# Retrieves the effective policy for a specific API in raw XML format
az rest --method GET \
--uri "https://management.azure.com/subscriptions/<subscription-id>/resourceGroups/<resource-group>/providers/Microsoft.ApiManagement/service/<service-name>/apis/<api-id>/policies/policy?api-version=2024-05-01&format=rawxml"

# Gets the configuration details of the APIM service instance
az rest --method GET \
--uri "https://management.azure.com/subscriptions/<subscription-id>/resourceGroups/<resource-group>/providers/Microsoft.ApiManagement/service/<apim>?api-version=2024-05-01"

# Lists all backend services registered in the APIM instance
az rest --method GET \
--uri "https://management.azure.com/subscriptions/<subscription-id>/resourceGroups/<resource-group>/providers/Microsoft.ApiManagement/service/<service-name>/backends?api-version=2024-05-01"

# Retrieves details of a specific backend service
az rest --method GET \
--uri "https://management.azure.com/subscriptions/<subscription-id>/resourceGroups/<resource-group>/providers/Microsoft.ApiManagement/service/<service-name>/backends/<backend-id>?api-version=2024-05-01"

# Gets general information about the APIM service
az rest --method GET \
--uri "https://management.azure.com/subscriptions/<subscription-id>/resourceGroups/<resource-group>/providers/Microsoft.ApiManagement/service/<service-name>?api-version=2024-05-01"

# Calls an exposed API endpoint through the APIM gateway
curl https://<apim>.azure-api.net/<api-path>

```
{{#include ../../../banners/hacktricks-training.md}}
