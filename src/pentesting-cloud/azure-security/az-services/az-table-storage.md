# Az - Table Storage

{{#include ../../../banners/hacktricks-training.md}}

## 기본 정보

**Azure Table Storage**는 대량의 구조화된 비관계형 데이터를 저장하기 위해 설계된 NoSQL 키-값 저장소입니다. 높은 가용성, 낮은 대기 시간 및 대규모 데이터 세트를 효율적으로 처리할 수 있는 확장성을 제공합니다. 데이터는 테이블로 구성되며, 각 엔터티는 파티션 키와 행 키로 식별되어 빠른 조회를 가능하게 합니다. 데이터는 안전하고 관리되는 저장소에 적합한 다양한 애플리케이션을 위해 휴지 상태에서의 암호화, 역할 기반 액세스 제어 및 공유 액세스 서명과 같은 기능을 지원합니다.

테이블 저장소에 대한 **내장 백업 메커니즘은 없습니다**.

### 키

#### **PartitionKey**

- **PartitionKey는 엔터티를 논리적 파티션으로 그룹화합니다**. 동일한 PartitionKey를 가진 엔터티는 함께 저장되어 쿼리 성능과 확장성을 향상시킵니다.
- 예: 직원 데이터를 저장하는 테이블에서 `PartitionKey`는 부서를 나타낼 수 있습니다, 예: `"HR"` 또는 `"IT"`.

#### **RowKey**

- **RowKey는 파티션 내에서 엔터티의 고유 식별자입니다**. PartitionKey와 결합될 때, 테이블의 각 엔터티가 전 세계적으로 고유한 식별자를 갖도록 보장합니다.
- 예: `"HR"` 파티션의 경우, `RowKey`는 직원 ID일 수 있습니다, 예: `"12345"`.

#### **기타 속성 (사용자 정의 속성)**

- PartitionKey와 RowKey 외에도, 엔터티는 데이터를 저장하기 위한 추가 **사용자 정의 속성을 가질 수 있습니다**. 이는 사용자 정의이며 전통적인 데이터베이스의 열처럼 작용합니다.
- 속성은 **키-값 쌍**으로 저장됩니다.
- 예: `Name`, `Age`, `Title`은 직원에 대한 사용자 정의 속성이 될 수 있습니다.

## 열거

{{#tabs}}
{{#tab name="az cli"}}
```bash
# Get storage accounts
az storage account list

# List tables
az storage table list --account-name <name>

# Read table
az storage entity query \
--account-name <name> \
--table-name <t-name> \
--top 10

# Write table
az storage entity insert \
--account-name <STORAGE_ACCOUNT_NAME> \
--table-name <TABLE_NAME> \
--entity PartitionKey=<PARTITION_KEY> RowKey=<ROW_KEY> <PROPERTY_KEY>=<PROPERTY_VALUE>

# Write example
az storage entity insert \
--account-name mystorageaccount \
--table-name mytable \
--entity PartitionKey=HR RowKey=12345 Name="John Doe" Age=30 Title="Manager"

# Update row
az storage entity merge \
--account-name mystorageaccount \
--table-name mytable \
--entity PartitionKey=pk1 RowKey=rk1 Age=31
```
{{#endtab}}
{{#tab name="PowerShell"}}
```bash
# Get storage accounts
Get-AzStorageAccount

# List tables
Get-AzStorageTable -Context (Get-AzStorageAccount -Name <mystorageaccount> -ResourceGroupName <ResourceGroupName>).Context

Get-AzStorageTableStoredAccessPolicy -Table <Table> -Context (Get-AzStorageAccount -Name <mystorageaccount -ResourceGroupName <ResourceGroupName>).Context
```
{{#endtab}}
{{#endtabs}}

> [!NOTE]
> 기본적으로 `az` cli는 계정 키를 사용하여 키에 서명하고 작업을 수행합니다. Entra ID 주체 권한을 사용하려면 `--auth-mode login` 매개변수를 사용하십시오.

> [!TIP]
> 사용할 계정 키를 나타내려면 `--account-key` 매개변수를 사용하십시오.\
> SAS 토큰을 통해 액세스하려면 SAS 토큰과 함께 `--sas-token` 매개변수를 사용하십시오.

## Privilege Escalation

저장소 권한 상승과 동일합니다:

{{#ref}}
../az-privilege-escalation/az-storage-privesc.md
{{#endref}}

## Post Exploitation

{{#ref}}
../az-post-exploitation/az-table-storage-post-exploitation.md
{{#endref}}

## Persistence

저장소 지속성과 동일합니다:

{{#ref}}
../az-persistence/az-storage-persistence.md
{{#endref}}

{{#include ../../../banners/hacktricks-training.md}}
