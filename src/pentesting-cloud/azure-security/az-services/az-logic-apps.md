# Az - Logic Apps

{{#include ../../../banners/hacktricks-training.md}}

## åŸºæœ¬ä¿¡æ¯

Azure Logic Apps æ˜¯å¾®è½¯ Azure æä¾›çš„äº‘æœåŠ¡ï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿ **åˆ›å»ºå’Œè¿è¡Œé›†æˆå„ç§æœåŠ¡ã€æ•°æ®æºå’Œåº”ç”¨ç¨‹åºçš„å·¥ä½œæµ**ã€‚è¿™äº›å·¥ä½œæµæ—¨åœ¨ **è‡ªåŠ¨åŒ–ä¸šåŠ¡æµç¨‹**ã€åè°ƒä»»åŠ¡å¹¶åœ¨ä¸åŒå¹³å°ä¹‹é—´æ‰§è¡Œæ•°æ®é›†æˆã€‚

Logic Apps æä¾›äº†ä¸€ä¸ªå¯è§†åŒ–è®¾è®¡å™¨ï¼Œå¯ä»¥ä½¿ç”¨ **å¹¿æ³›çš„é¢„æ„å»ºè¿æ¥å™¨** åˆ›å»ºå·¥ä½œæµï¼Œè¿™ä½¿å¾—è¿æ¥å’Œä¸å„ç§æœåŠ¡ï¼ˆå¦‚ Office 365ã€Dynamics CRMã€Salesforce ç­‰ï¼‰è¿›è¡Œäº¤äº’å˜å¾—ç®€å•ã€‚æ‚¨è¿˜å¯ä»¥æ ¹æ®ç‰¹å®šéœ€æ±‚åˆ›å»ºè‡ªå®šä¹‰è¿æ¥å™¨ã€‚

### ç¤ºä¾‹

- **è‡ªåŠ¨åŒ–æ•°æ®ç®¡é“**ï¼šLogic Apps å¯ä»¥ä¸ Azure Data Factory ç»“åˆè‡ªåŠ¨åŒ– **æ•°æ®ä¼ è¾“å’Œè½¬æ¢è¿‡ç¨‹**ã€‚è¿™å¯¹äºåˆ›å»ºå¯æ‰©å±•å’Œå¯é çš„æ•°æ®ç®¡é“éå¸¸æœ‰ç”¨ï¼Œè¿™äº›ç®¡é“åœ¨å„ç§æ•°æ®å­˜å‚¨ä¹‹é—´ç§»åŠ¨å’Œè½¬æ¢æ•°æ®ï¼Œå¦‚ Azure SQL æ•°æ®åº“å’Œ Azure Blob å­˜å‚¨ï¼Œå¸®åŠ©è¿›è¡Œåˆ†æå’Œå•†ä¸šæ™ºèƒ½æ“ä½œã€‚
- **ä¸ Azure Functions é›†æˆ**ï¼šLogic Apps å¯ä»¥ä¸ Azure Functions ä¸€èµ·å·¥ä½œï¼Œå¼€å‘ **å¤æ‚çš„äº‹ä»¶é©±åŠ¨åº”ç”¨ç¨‹åºï¼ŒæŒ‰éœ€æ‰©å±•**ï¼Œå¹¶ä¸å…¶ä»– Azure æœåŠ¡æ— ç¼é›†æˆã€‚ä¸€ä¸ªç¤ºä¾‹ç”¨ä¾‹æ˜¯ä½¿ç”¨ Logic App åœ¨å“åº”æŸäº›äº‹ä»¶ï¼ˆå¦‚ Azure å­˜å‚¨å¸æˆ·ä¸­çš„æ›´æ”¹ï¼‰æ—¶è§¦å‘ Azure Functionï¼Œä»è€Œå®ç°åŠ¨æ€æ•°æ®å¤„ç†ã€‚

### å¯è§†åŒ– LogicAPP

å¯ä»¥é€šè¿‡å›¾å½¢æŸ¥çœ‹ LogicAppï¼š

<figure><img src="../../../images/image (197).png" alt=""><figcaption></figcaption></figure>

æˆ–åœ¨ "**Logic app code view**" éƒ¨åˆ†æ£€æŸ¥ä»£ç ã€‚

### SSRF ä¿æŠ¤

å³ä½¿æ‚¨å‘ç° **Logic App å¯¹ SSRF æ¼æ´**ï¼Œä¹Ÿæ— æ³•ä»å…ƒæ•°æ®ä¸­è®¿é—®å‡­æ®ï¼Œå› ä¸º Logic Apps ä¸å…è®¸è¿™æ ·åšã€‚

ä¾‹å¦‚ï¼Œç±»ä¼¼è¿™æ ·çš„è¯·æ±‚å°†ä¸ä¼šè¿”å›ä»¤ç‰Œï¼š
```bash
# The URL belongs to a Logic App vulenrable to SSRF
curl -XPOST 'https://prod-44.westus.logic.azure.com:443/workflows/2d8de4be6e974123adf0b98159966644/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=_8_oqqsCXc0u2c7hNjtSZmT0uM4Xi3hktw6Uze0O34s' -d '{"url": "http://169.254.169.254/metadata/identity/oauth2/token?api-version=2018-02-01&resource=https://management.azure.com/"}' -H "Content-type: application/json" -v
```
### æ‰˜ç®¡é€‰é¡¹

æœ‰å‡ ç§æ‰˜ç®¡é€‰é¡¹ï¼š

* **æ¶ˆè´¹**
- **å¤šç§Ÿæˆ·**ï¼šæä¾›å…±äº«è®¡ç®—èµ„æºï¼Œè¿è¡Œåœ¨å…¬å…±äº‘ä¸­ï¼Œå¹¶éµå¾ªæŒ‰æ“ä½œè®¡è´¹çš„å®šä»·æ¨¡å‹ã€‚è¿™éå¸¸é€‚åˆè½»é‡çº§å’Œå…·æœ‰æˆæœ¬æ•ˆç›Šçš„å·¥ä½œè´Ÿè½½ã€‚
* **æ ‡å‡†**
- **å·¥ä½œæµæœåŠ¡è®¡åˆ’**ï¼šä¸“ç”¨è®¡ç®—èµ„æºï¼Œå…·æœ‰ VNET é›†æˆç”¨äºç½‘ç»œï¼Œå¹¶æŒ‰å·¥ä½œæµæœåŠ¡è®¡åˆ’å®ä¾‹æ”¶è´¹ã€‚é€‚åˆéœ€è¦æ›´å¤§æ§åˆ¶çš„æ›´é«˜è¦æ±‚çš„å·¥ä½œè´Ÿè½½ã€‚
- **åº”ç”¨æœåŠ¡ç¯å¢ƒ V3** ä¸“ç”¨è®¡ç®—èµ„æºï¼Œå…·æœ‰å®Œå…¨éš”ç¦»å’Œå¯æ‰©å±•æ€§ã€‚å®ƒè¿˜ä¸ VNET é›†æˆç”¨äºç½‘ç»œï¼Œå¹¶ä½¿ç”¨åŸºäºç¯å¢ƒä¸­åº”ç”¨æœåŠ¡å®ä¾‹çš„å®šä»·æ¨¡å‹ã€‚è¿™éå¸¸é€‚åˆéœ€è¦é«˜éš”ç¦»çš„ä¼ä¸šçº§åº”ç”¨ç¨‹åºã€‚
- **æ··åˆ** è®¾è®¡ç”¨äºæœ¬åœ°å¤„ç†å’Œå¤šäº‘æ”¯æŒã€‚å®ƒå…è®¸å®¢æˆ·ç®¡ç†çš„è®¡ç®—èµ„æºå…·æœ‰æœ¬åœ°ç½‘ç»œè®¿é—®ï¼Œå¹¶åˆ©ç”¨ Kubernetes äº‹ä»¶é©±åŠ¨çš„è‡ªåŠ¨æ‰©å±•ï¼ˆKEDAï¼‰ã€‚

### æšä¸¾

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List
az logic workflow list --resource-group <ResourceGroupName>
# Get info
az logic workflow show --name <LogicAppName> --resource-group <ResourceGroupName>

# Get details of a specific Logic App workflow, including its connections and parameters
az rest \
--method GET \
--uri "https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Logic/workflows/{workflowName}?api-version=2016-10-01&$expand=connections.json,parameters.json" \
--headers "Content-Type=application/json"

# Get details about triggers for a specific Logic App
az rest --method GET \
--uri "https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Logic/workflows/{logicAppName}/triggers?api-version=2016-06-01"

# Get the callback URL for a specific trigger in a Logic App
az rest --method POST \
--uri "https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Logic/workflows/{logicAppName}/triggers/{triggerName}/listCallbackUrl?api-version=2016-06-01"

# Get the history of a specific trigger in a Logic App
az rest --method GET \
--uri "https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Logic/workflows/{logicAppName}/triggers/{triggerName}/histories?api-version=2016-06-01"

# List all runs of a specific Logic App workflow
az rest \
--method GET \
--uri "https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Logic/workflows/{workflowName}/runs?api-version=2016-06-01" \
--headers "Content-Type=application/json"

# Get all actions within a specific run of a Logic App workflow
az rest \
--method GET \
--uri "https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Logic/workflows/{workflowName}/runs/{runName}/actions?api-version=2016-06-01" \
--headers "Content-Type=application/json"

# List all versions of a specific Logic App workflow
az rest \
--method GET \
--uri "https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Logic/workflows/{workflowName}/versions?api-version=2016-06-01" \
--headers "Content-Type=application/json"

# Get details of a specific version of a Logic App workflow
az rest \
--method GET \
--uri "https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Logic/workflows/{workflowName}/versions/{versionName}?api-version=2016-06-01" \
--headers "Content-Type=application/json"

az rest \
--method GET \
--uri "https://examplelogicapp1994.scm.azurewebsites.net/api/functions/admin/download?includeCsproj=true&includeAppSettings=true" \
--headers "Content-Type=application/json"

# List all Logic Apps in the specified resource group
az logicapp list --resource-group <ResourceGroupName>

# Show detailed information about a specific Logic App
az logicapp show --name <LogicAppName> --resource-group <ResourceGroupName>

# List all application settings for a specific Logic App
az logicapp config appsettings list --name <LogicAppName> --resource-group <ResourceGroupName>
```
{% endcode %}
{% endtab %}

{% tab title="Az PowerShell" %}
{% code overflow="wrap" %}
```bash
Get-Command -Module Az.LogicApp

# List
Get-AzLogicApp -ResourceGroupName <ResourceGroupName>
# Get info
Get-AzLogicApp -ResourceGroupName <ResourceGroupName> -Name <LogicAppName>

# Get details of a specific Logic App workflow run action
Get-AzLogicAppRunAction -ResourceGroupName "<ResourceGroupName>" -Name "<LogicAppName>" -RunName "<RunName>"

# Get the run history for a specific Logic App
Get-AzLogicAppRunHistory -ResourceGroupName "<ResourceGroupName>" -Name "<LogicAppName>"

# Get details about triggers for a specific Logic App
Get-AzLogicAppTrigger -ResourceGroupName "<ResourceGroupName>" -Name "<LogicAppName>"

# Get the callback URL for a specific trigger in a Logic App
Get-AzLogicAppTriggerCallbackUrl -ResourceGroupName "<ResourceGroupName>" -LName "<LogicAppName>" -TriggerName "<TriggerName>"

# Get the history of a specific trigger in a Logic App
Get-AzLogicAppTriggerHistory -ResourceGroupName "<ResourceGroupName>" -Name "<LogicAppName>" -TriggerName "<TriggerName>"

```
{% endcode %}
{% endtab %}
{% endtabs %}



### é›†æˆè´¦æˆ·
**é›†æˆè´¦æˆ·**æ˜¯ Azure Logic Apps çš„ä¸€ä¸ªåŠŸèƒ½ã€‚é›†æˆè´¦æˆ·ç”¨äºé€šè¿‡å¯ç”¨é«˜çº§ B2B åŠŸèƒ½ï¼ˆå¦‚ EDIã€AS2 å’Œ XML æ¶æ„ç®¡ç†ï¼‰æ¥ä¿ƒè¿›ä¼ä¸šçº§é›†æˆã€‚é›†æˆè´¦æˆ·æ˜¯ Azure ä¸­çš„ä¸€ä¸ªå®¹å™¨ï¼Œç”¨äºå­˜å‚¨ Logic Apps ä½¿ç”¨çš„ä»¥ä¸‹å·¥ä»¶ï¼š

* æ¶æ„ï¼šç®¡ç† XML æ¶æ„ä»¥éªŒè¯å’Œå¤„ç†é›†æˆè´¦æˆ·ä¸­çš„æ¶ˆæ¯ã€‚
* æ˜ å°„ï¼šé…ç½®åŸºäº XSLT çš„è½¬æ¢ï¼Œä»¥åœ¨é›†æˆå·¥ä½œæµä¸­è½¬æ¢æ•°æ®æ ¼å¼ã€‚
* ç¨‹åºé›†ï¼šç®¡ç†é›†æˆè´¦æˆ·ç¨‹åºé›†ï¼Œä»¥ç®€åŒ–é€»è¾‘å’Œæ•°æ®å¤„ç†ã€‚
* è¯ä¹¦ï¼šå¤„ç†ç”¨äºåŠ å¯†å’Œç­¾åæ¶ˆæ¯çš„è¯ä¹¦ï¼Œç¡®ä¿å®‰å…¨é€šä¿¡ã€‚
* ä¼™ä¼´ï¼šç®¡ç† B2B äº¤æ˜“çš„äº¤æ˜“ä¼™ä¼´ä¿¡æ¯ï¼Œå®ç°æ— ç¼é›†æˆã€‚
* åè®®ï¼šé…ç½®ä¸äº¤æ˜“ä¼™ä¼´äº¤æ¢æ•°æ®çš„è§„åˆ™å’Œè®¾ç½®ï¼ˆä¾‹å¦‚ï¼ŒEDIã€AS2ï¼‰ã€‚
* æ‰¹å¤„ç†é…ç½®ï¼šç®¡ç†æ‰¹å¤„ç†é…ç½®ï¼Œä»¥é«˜æ•ˆåœ°åˆ†ç»„å’Œå¤„ç†æ¶ˆæ¯ã€‚
* RosettaNet PIPï¼šé…ç½® RosettaNet ä¼™ä¼´æ¥å£æµç¨‹ï¼ˆPIPsï¼‰ï¼Œä»¥æ ‡å‡†åŒ– B2B é€šä¿¡ã€‚

#### æšä¸¾

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# Integration account
az logic integration-account list --resource-group <resource-group-name>
az logic integration-account show --resource-group <resource-group-name> --name <integration-account-name>
az logic integration-account list-callback-url --resource-group <resource-group-name> --integration-account-name <integration-account-name>

# Batch-configuration
az logic integration-account batch-configuration list \
--resource-group <resource-group-name> \
--integration-account-name <integration-account-name>

az logic integration-account batch-configuration show \
--resource-group <resource-group-name> \
--integration-account-name <integration-account-name> \
--batch-configuration-name <batch-configuration-name>

# Map
az logic integration-account map list \
--resource-group <resource-group-name> \
--integration-account <integration-account-name>

az logic integration-account map show \
--resource-group <resource-group-name> \
--integration-account <integration-account-name> \
--map-name <map-name>

# Partner
az logic integration-account partner list \
--resource-group <resource-group-name> \
--integration-account <integration-account-name>

az logic integration-account partner show \
--resource-group <resource-group-name> \
--integration-account <integration-account-name> \
--name <partner-name>

# Session
az logic integration-account session list \
--resource-group <resource-group-name> \
--integration-account <integration-account-name>

az logic integration-account session show \
--resource-group <resource-group-name> \
--integration-account <integration-account-name> \
--name <session-name>

# Assembly
# Session
az logic integration-account assembly list \
--resource-group <resource-group-name> \
--integration-account <integration-account-name>

az logic integration-account assembly show \
--resource-group <resource-group-name> \
--integration-account <integration-account-name> \
--assembly-artifact-name <assembly-name>


```
{% endcode %}
{% endtab %}

{% tab title="Az PowerShell" %}
{% code overflow="wrap" %}
```powershell
Get-Command -Module Az.LogicApp

# Retrieve details of an integration account
Get-AzIntegrationAccount -ResourceGroupName <resource-group-name> -Name <integration-account-name>

# Retrieve the callback URL of an integration account
Get-AzIntegrationAccountCallbackUrl -ResourceGroupName <resource-group-name> -IntegrationAccountName <integration-account-name>

# Retrieve details of a specific agreement in an integration account
Get-AzIntegrationAccountAgreement -ResourceGroupName <resource-group-name> -IntegrationAccountName <integration-account-name> -Name <agreement-name>

# Retrieve details of a specific assembly in an integration account
Get-AzIntegrationAccountAssembly -ResourceGroupName <resource-group-name> -IntegrationAccountName <integration-account-name> -Name <assembly-name>

# Retrieve details of a specific batch configuration in an integration account
Get-AzIntegrationAccountBatchConfiguration -ResourceGroupName <resource-group-name> -IntegrationAccountName <integration-account-name> -Name <batch-configuration-name>

# Retrieve details of a specific certificate in an integration account
Get-AzIntegrationAccountCertificate -ResourceGroupName <resource-group-name> -IntegrationAccountName <integration-account-name> -Name <certificate-name>

# Retrieve details of a specific map in an integration account
Get-AzIntegrationAccountMap -ResourceGroupName <resource-group-name> -IntegrationAccountName <integration-account-name> -Name <map-name>

# Retrieve details of a specific partner in an integration account
Get-AzIntegrationAccountPartner -ResourceGroupName <resource-group-name> -IntegrationAccountName <integration-account-name> -Name <partner-name>

# Retrieve details of a specific schema in an integration account
Get-AzIntegrationAccountSchema -ResourceGroupName <resource-group-name> -IntegrationAccountName <integration-account-name> -Name <schema-name>
```
{% endcode %}
{% endtab %}
{% endtabs %}


## æƒé™æå‡

ä¸é€»è¾‘åº”ç”¨æƒé™æå‡ç›¸åŒï¼š

{% content-ref url="../az-privilege-escalation/az-logic-apps-privesc.md" %}
[az-logic-apps-privesc.md](../az-privilege-escalation/az-logic-apps-privesc.md)
{% endcontent-ref %}

## åæœŸåˆ©ç”¨

{% content-ref url="../az-post-exploitation/az-logic-apps-post-exploitation.md" %}
[az-logic-apps-post-exploitation.md](../az-post-exploitation/az-logic-apps-post-exploitation.md)
{% endcontent-ref %}

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨ Twitter ä¸Šå…³æ³¨** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
