# Az - Container Instances

{{#include ../../../banners/hacktricks-training.md}}

## 基本信息

Azure Container Instances (ACI) 提供了一种 **无服务器、按需** 的方式在 Azure 云中运行 **容器**。您可以在一个组中 **部署** 单个或多个容器，具有 **可扩展计算**、**网络选项**，以及连接到 **其他 Azure 服务**（如存储、虚拟网络或容器注册表）的灵活性。

由于它们是 **短暂** 的工作负载，您无需管理底层的 VM 基础设施 — Azure 会为您处理这一切。然而，从 **攻击安全的角度** 来看，了解 **权限**、**身份**、**网络配置** 和 **日志** 如何揭示攻击面和潜在的配置错误是至关重要的。

### 配置

- 为了创建一个容器，可以使用公共镜像、来自 Azure 容器注册表的容器镜像或外部存储库，这可能 **需要配置密码** 以访问它。
- 关于网络，它也可以具有 **公共 IP** 或 **私有端点**。
- 还可以配置常见的 Docker 设置，如：
- **环境变量**
- **卷**（甚至来自 Azure Files）
- **端口**
- **CPU 和内存限制**
- **重启策略**
- **以特权模式运行**
- **要运行的命令行**
- ...

## 枚举

> [!WARNING]
> 在枚举 ACI 时，您可能会揭示敏感配置，如 **环境变量**、**网络细节** 或 **托管身份**。请小心记录或显示它们。
```bash
# List all container instances in the subscription
az container list

# Show detailed information about a specific container instance
az container show --name <container-name> --resource-group <res-group>

# Fetch logs from a container
az container logs --name <container-name> --resource-group <res-group>

# Execute a command in a running container and get the output
az container exec --name <container-name> --resource-group <res-group> --exec-command "ls"

# Get yaml configuration of the container group
az container export  --name <container-name> --resource-group <res-group>
```

