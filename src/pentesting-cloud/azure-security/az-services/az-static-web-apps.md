# Az - Static Web Apps

{{#include ../../../banners/hacktricks-training.md}}

## Static Web Apps Basic Information

Azure Static Web Apps는 **GitHub와 같은 리포지토리에서 자동 CI/CD를 통해 정적 웹 앱을 호스팅하는 클라우드 서비스**입니다. 전 세계 콘텐츠 전송, 서버리스 백엔드 및 내장 HTTPS를 제공하여 안전하고 확장 가능합니다. 그러나 잘못 구성된 CORS, 불충분한 인증 및 콘텐츠 변조와 같은 위험이 있으며, 이를 적절히 관리하지 않으면 XSS 및 데이터 유출과 같은 공격에 노출될 수 있습니다.

> [!TIP]
> Static App이 생성될 때 **배포 인증 정책**을 **배포 토큰**과 **GitHub Actions 워크플로** 중에서 선택할 수 있습니다.


### Web App Authentication

웹 앱에 접근하기 위해 **비밀번호를 구성**하는 것이 가능합니다. 웹 콘솔을 통해 스테이징 환경만 보호하거나 스테이징과 프로덕션 환경 모두를 보호하도록 구성할 수 있습니다.

작성 시점에서 비밀번호로 보호된 웹 앱은 다음과 같습니다:

<figure><img src="../../../images/azure_static_password.png" alt=""><figcaption></figcaption></figure>


**어떤 비밀번호가 사용되고 있는지** 및 어떤 환경이 보호되고 있는지 확인할 수 있습니다:
```bash
az rest --method GET \
--url "/subscriptions/<subscription-id>/resourceGroups/Resource_Group_1/providers/Microsoft.Web/staticSites/<app-name>/config/basicAuth?api-version=2024-04-01"
```
그러나, 이것은 **비밀번호를 일반 텍스트로 표시하지 않습니다**, 단지 다음과 같은 형태로 표시됩니다: `"password": "**********************"`.

### 경로

경로는 **정적 웹 앱 내에서 수신 HTTP 요청이 처리되는 방법**을 정의합니다. **`staticwebapp.config.json`** 파일에 구성되어 있으며, URL 재작성, 리디렉션, 접근 제한 및 역할 기반 권한 부여를 제어하여 적절한 리소스 처리 및 보안을 보장합니다.

몇 가지 예:
```json
{
"routes": [
{
"route": "/",
"rewrite": "/index.html"
},
{
"route": "/about",
"rewrite": "/about.html"
},
{
"route": "/api/*",
"allowedRoles": ["authenticated"]
},
{
"route": "/admin",
"redirect": "/login",
"statusCode": 302
}
],
"navigationFallback": {
"rewrite": "/index.html",
"exclude": ["/api/*", "/assets/*"]
}
}
```
## 열거
```bash
# List Static Webapps
az staticwebapp list --output table

# Get Static Webapp details
az staticwebapp show --name <name> --resource-group <res-group> --output table

# Get appsettings
az staticwebapp appsettings list --name <name>

# Get env information
az staticwebapp environment list --name <name>
az staticwebapp environment functions --name <name>

# Get API key
az staticwebapp secrets list --name <name>

# Get invited users
az staticwebapp users list --name <name>

# Get database connections
az rest --method GET \
--url "https://management.azure.com/subscriptions/<subscription-id>/resourceGroups/<res-group>/providers/Microsoft.Web/staticSites/<app-name>/databaseConnections?api-version=2021-03-01"

## Once you have the database connection name ("default" by default) you can get the connection string with the credentials
az rest --method POST \
--url "https://management.azure.com/subscriptions/<subscription-id>/resourceGroups/<res-group>/providers/Microsoft.Web/staticSites/<app-name>/databaseConnections/default/show?api-version=2021-03-01"
```
## 웹 앱 생성 예제

웹 앱을 생성하는 좋은 예제를 다음 링크에서 찾을 수 있습니다: [https://learn.microsoft.com/en-us/azure/static-web-apps/get-started-portal?tabs=react&pivots=github](https://learn.microsoft.com/en-us/azure/static-web-apps/get-started-portal?tabs=react&pivots=github)

1. https://github.com/staticwebdev/react-basic/generate 리포지토리를 포크하여 GitHub 계정에 `my-first-static-web-app`이라는 이름으로 저장합니다.
2. Azure 포털에서 GitHub 액세스를 구성하고 이전에 포크한 새 리포지토리를 선택하여 Static Web App을 생성합니다.
3. 생성한 후 몇 분 기다리고 새 페이지를 확인하세요!

## 포스트 익스플로잇

{{#ref}}
../az-privilege-escalation/az-static-web-apps-post-exploitation.md
{{#endref}}

## 참고자료

- [https://learn.microsoft.com/en-in/azure/app-service/overview](https://learn.microsoft.com/en-in/azure/app-service/overview)
- [https://learn.microsoft.com/en-us/azure/app-service/overview-hosting-plans](https://learn.microsoft.com/en-us/azure/app-service/overview-hosting-plans)

{{#include ../../../banners/hacktricks-training.md}}
