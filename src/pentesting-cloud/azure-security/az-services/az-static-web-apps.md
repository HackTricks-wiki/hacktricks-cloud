# Az - Static Web Apps

{{#include ../../../banners/hacktricks-training.md}}

## Static Web Apps Basic Information

Azure Static Web Apps είναι μια υπηρεσία cloud για τη φιλοξενία **στατικών εφαρμογών ιστού με αυτόματη CI/CD από αποθετήρια όπως το GitHub**. Προσφέρει παγκόσμια παράδοση περιεχομένου, serverless backends και ενσωματωμένο HTTPS, καθιστώντας την ασφαλή και κλιμακούμενη. Ωστόσο, οι κίνδυνοι περιλαμβάνουν κακή ρύθμιση CORS, ανεπαρκή αυθεντικοποίηση και παραποίηση περιεχομένου, που μπορεί να εκθέσουν τις εφαρμογές σε επιθέσεις όπως XSS και διαρροή δεδομένων αν δεν διαχειριστούν σωστά.

> [!TIP]
> Όταν δημιουργείται μια Στατική Εφαρμογή, μπορείτε να επιλέξετε την **πολιτική εξουσιοδότησης ανάπτυξης** μεταξύ **Deployment token** και **GitHub Actions workflow**.


### Web App Authentication

Είναι δυνατόν να **ρυθμίσετε έναν κωδικό πρόσβασης** για την πρόσβαση στην Εφαρμογή Ιστού. Η διαδικτυακή κονσόλα επιτρέπει τη ρύθμιση ώστε να προστατεύει μόνο τα περιβάλλοντα staging ή και τα δύο, staging και παραγωγής.

Αυτή είναι η εμφάνιση μιας προστατευμένης με κωδικό πρόσβασης εφαρμογής ιστού τη στιγμή που γράφεται το κείμενο:

<figure><img src="../../../images/azure_static_password.png" alt=""><figcaption></figcaption></figure>


Είναι δυνατόν να δείτε **αν χρησιμοποιείται κάποιος κωδικός πρόσβασης** και ποια περιβάλλοντα είναι προστατευμένα με:
```bash
az rest --method GET \
--url "/subscriptions/<subscription-id>/resourceGroups/Resource_Group_1/providers/Microsoft.Web/staticSites/<app-name>/config/basicAuth?api-version=2024-04-01"
```
Ωστόσο, αυτό **δεν θα εμφανίσει τον κωδικό πρόσβασης σε καθαρό κείμενο**, μόνο κάτι σαν: `"password": "**********************"`.

### Διαδρομές

Οι διαδρομές καθορίζουν **πώς διαχειρίζονται τα εισερχόμενα HTTP αιτήματα** μέσα σε μια στατική εφαρμογή ιστού. Ρυθμισμένες στο **`staticwebapp.config.json`** αρχείο, ελέγχουν την ανακατεύθυνση URL, τις ανακατευθύνσεις, τους περιορισμούς πρόσβασης και την εξουσιοδότηση βάσει ρόλων, διασφαλίζοντας τη σωστή διαχείριση πόρων και ασφάλεια.

Ορισμένα παραδείγματα:
```json
{
"routes": [
{
"route": "/",
"rewrite": "/index.html"
},
{
"route": "/about",
"rewrite": "/about.html"
},
{
"route": "/api/*",
"allowedRoles": ["authenticated"]
},
{
"route": "/admin",
"redirect": "/login",
"statusCode": 302
}
],
"navigationFallback": {
"rewrite": "/index.html",
"exclude": ["/api/*", "/assets/*"]
}
}
```
## Καταμέτρηση
```bash
# List Static Webapps
az staticwebapp list --output table

# Get Static Webapp details
az staticwebapp show --name <name> --resource-group <res-group> --output table

# Get appsettings
az staticwebapp appsettings list --name <name>

# Get env information
az staticwebapp environment list --name <name>
az staticwebapp environment functions --name <name>

# Get API key
az staticwebapp secrets list --name <name>

# Get invited users
az staticwebapp users list --name <name>

# Get database connections
az rest --method GET \
--url "https://management.azure.com/subscriptions/<subscription-id>/resourceGroups/<res-group>/providers/Microsoft.Web/staticSites/<app-name>/databaseConnections?api-version=2021-03-01"

## Once you have the database connection name ("default" by default) you can get the connection string with the credentials
az rest --method POST \
--url "https://management.azure.com/subscriptions/<subscription-id>/resourceGroups/<res-group>/providers/Microsoft.Web/staticSites/<app-name>/databaseConnections/default/show?api-version=2021-03-01"
```
## Παραδείγματα για τη δημιουργία Ιστοσελίδων

Μπορείτε να βρείτε ένα ωραίο παράδειγμα για τη δημιουργία μιας ιστοσελίδας στον παρακάτω σύνδεσμο: [https://learn.microsoft.com/en-us/azure/static-web-apps/get-started-portal?tabs=react&pivots=github](https://learn.microsoft.com/en-us/azure/static-web-apps/get-started-portal?tabs=react&pivots=github)

1. Fork το αποθετήριο https://github.com/staticwebdev/react-basic/generate στον λογαριασμό σας στο GitHub και ονομάστε το `my-first-static-web-app`
2. Στο Azure portal δημιουργήστε μια Static Web App ρυθμίζοντας την πρόσβαση στο Github και επιλέγοντας το προηγουμένως forked νέο αποθετήριο
3. Δημιουργήστε το, περιμένετε μερικά λεπτά και ελέγξτε τη νέα σας σελίδα!

## Post Exploitation

{{#ref}}
../az-privilege-escalation/az-static-web-apps-post-exploitation.md
{{#endref}}

## Αναφορές

- [https://learn.microsoft.com/en-in/azure/app-service/overview](https://learn.microsoft.com/en-in/azure/app-service/overview)
- [https://learn.microsoft.com/en-us/azure/app-service/overview-hosting-plans](https://learn.microsoft.com/en-us/azure/app-service/overview-hosting-plans)

{{#include ../../../banners/hacktricks-training.md}}
