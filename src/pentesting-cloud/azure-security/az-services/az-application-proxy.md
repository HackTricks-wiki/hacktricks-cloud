# Az - Application Proxy

{{#include ../../../banners/hacktricks-training.md}}

## Temel Bilgiler

[Belgelerden:](https://learn.microsoft.com/en-us/entra/identity/app-proxy/application-proxy)

Azure Active Directory'nin Application Proxy'si **yerel web uygulamalarına güvenli uzaktan erişim** sağlar. **Azure AD'ye tek oturum açma** işleminden sonra, kullanıcılar hem **bulut** hem de **yerel uygulamalara** bir **harici URL** veya bir iç uygulama portalı aracılığıyla erişebilir.

Şöyle çalışır:

<figure><img src="../../../images/image (186).png" alt=""><figcaption></figcaption></figure>

1. Kullanıcı bir uç nokta aracılığıyla uygulamaya eriştikten sonra, kullanıcı **Azure AD oturum açma sayfasına** yönlendirilir.
2. **Başarılı bir oturum açma** işleminden sonra, Azure AD kullanıcı cihazına bir **token** gönderir.
3. İstemci, token'ı **Application Proxy hizmetine** gönderir; bu hizmet token'dan kullanıcı ilkesinin adını (UPN) ve güvenlik ilkesinin adını (SPN) alır. **Application Proxy daha sonra isteği Application Proxy bağlayıcısına gönderir**.
4. Eğer tek oturum açma yapılandırdıysanız, bağlayıcı kullanıcının adına gerekli olan herhangi bir **ek kimlik doğrulama** işlemini gerçekleştirir.
5. Bağlayıcı isteği **yerel uygulamaya** gönderir.
6. **Yanıt**, bağlayıcı ve Application Proxy hizmeti aracılığıyla **kullanıcıya** gönderilir.

## Enumeration
```bash
# Enumerate applications with application proxy configured
Get-AzureADApplication | %{try{Get-AzureADApplicationProxyApplication -ObjectId $_.ObjectID;$_.DisplayName;$_.ObjectID}catch{}}

# Get applications service principal
Get-AzureADServicePrincipal -All $true | ?{$_.DisplayName -eq "Name"}

# Use the following ps1 script from https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/scripts/powershell-display-users-group-of-app
# to find users and groups assigned to the application. Pass the ObjectID of the Service Principal to it
Get-ApplicationProxyAssignedUsersAndGroups -ObjectId <object-id>
```
## Referanslar

- [https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/application-proxy](https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/application-proxy)

{{#include ../../../banners/hacktricks-training.md}}
