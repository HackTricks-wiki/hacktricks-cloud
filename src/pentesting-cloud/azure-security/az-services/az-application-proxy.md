# Az - Application Proxy

{{#include ../../../banners/hacktricks-training.md}}

## Información Básica

[De la documentación:](https://learn.microsoft.com/en-us/entra/identity/app-proxy/application-proxy)

El Application Proxy de Azure Active Directory proporciona **acceso remoto seguro a aplicaciones web locales**. Después de un **inicio de sesión único en Azure AD**, los usuarios pueden acceder tanto a **aplicaciones en la nube** como a **aplicaciones locales** a través de una **URL externa** o un portal de aplicaciones interno.

Funciona de la siguiente manera:

<figure><img src="../../../images/image (186).png" alt=""><figcaption></figcaption></figure>

1. Después de que el usuario haya accedido a la aplicación a través de un punto final, el usuario es dirigido a la **página de inicio de sesión de Azure AD**.
2. Después de un **inicio de sesión exitoso**, Azure AD envía un **token** al dispositivo cliente del usuario.
3. El cliente envía el token al **servicio de Application Proxy**, que recupera el nombre principal del usuario (UPN) y el nombre principal de seguridad (SPN) del token. **Application Proxy luego envía la solicitud al conector de Application Proxy**.
4. Si ha configurado el inicio de sesión único, el conector realiza cualquier **autenticación adicional** requerida en nombre del usuario.
5. El conector envía la solicitud a la **aplicación local**.
6. La **respuesta** se envía a través del conector y el servicio de Application Proxy **al usuario**.

## Enumeración
```bash
# Enumerate applications with application proxy configured
Get-AzureADApplication | %{try{Get-AzureADApplicationProxyApplication -ObjectId $_.ObjectID;$_.DisplayName;$_.ObjectID}catch{}}

# Get applications service principal
Get-AzureADServicePrincipal -All $true | ?{$_.DisplayName -eq "Name"}

# Use the following ps1 script from https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/scripts/powershell-display-users-group-of-app
# to find users and groups assigned to the application. Pass the ObjectID of the Service Principal to it
Get-ApplicationProxyAssignedUsersAndGroups -ObjectId <object-id>
```
## Referencias

- [https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/application-proxy](https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/application-proxy)

{{#include ../../../banners/hacktricks-training.md}}
