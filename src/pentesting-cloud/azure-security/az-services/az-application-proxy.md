# Az - Application Proxy

{{#include ../../../banners/hacktricks-training.md}}

## Основна інформація

[З документації:](https://learn.microsoft.com/en-us/entra/identity/app-proxy/application-proxy)

Azure Active Directory's Application Proxy надає **безпечний віддалений доступ до локальних веб-додатків**. Після **єдиного входу в Azure AD** користувачі можуть отримати доступ як до **хмарних**, так і до **локальних додатків** через **зовнішню URL-адресу** або внутрішній портал додатків.

Це працює так:

<figure><img src="../../../images/image (186).png" alt=""><figcaption></figcaption></figure>

1. Після того, як користувач отримав доступ до додатку через кінцеву точку, користувач перенаправляється на **сторінку входу Azure AD**.
2. Після **успішного входу** Azure AD надсилає **токен** на пристрій користувача.
3. Клієнт надсилає токен до **сервісу Application Proxy**, який отримує ім'я основного користувача (UPN) та ім'я безпеки (SPN) з токена. **Application Proxy потім надсилає запит до з'єднувача Application Proxy**.
4. Якщо ви налаштували єдиний вхід, з'єднувач виконує будь-яку **додаткову аутентифікацію**, необхідну від імені користувача.
5. З'єднувач надсилає запит до **локального додатку**.
6. **Відповідь** надсилається через з'єднувач і сервіс Application Proxy **користувачу**.

## Перерахування
```bash
# Enumerate applications with application proxy configured
Get-AzureADApplication | %{try{Get-AzureADApplicationProxyApplication -ObjectId $_.ObjectID;$_.DisplayName;$_.ObjectID}catch{}}

# Get applications service principal
Get-AzureADServicePrincipal -All $true | ?{$_.DisplayName -eq "Name"}

# Use the following ps1 script from https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/scripts/powershell-display-users-group-of-app
# to find users and groups assigned to the application. Pass the ObjectID of the Service Principal to it
Get-ApplicationProxyAssignedUsersAndGroups -ObjectId <object-id>
```
## Посилання

- [https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/application-proxy](https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/application-proxy)

{{#include ../../../banners/hacktricks-training.md}}
