# Az - Application Proxy

{{#include ../../../banners/hacktricks-training.md}}

## Informações Básicas

[Dos documentos:](https://learn.microsoft.com/en-us/entra/identity/app-proxy/application-proxy)

O Application Proxy do Azure Active Directory fornece **acesso remoto seguro a aplicativos web locais**. Após um **login único no Azure AD**, os usuários podem acessar tanto **aplicativos em nuvem** quanto **aplicativos locais** através de uma **URL externa** ou um portal de aplicativos interno.

Funciona assim:

<figure><img src="../../../images/image (186).png" alt=""><figcaption></figcaption></figure>

1. Após o usuário acessar o aplicativo através de um endpoint, o usuário é direcionado para a **página de login do Azure AD**.
2. Após um **login bem-sucedido**, o Azure AD envia um **token** para o dispositivo cliente do usuário.
3. O cliente envia o token para o **serviço Application Proxy**, que recupera o nome principal do usuário (UPN) e o nome principal de segurança (SPN) do token. **O Application Proxy então envia a solicitação para o conector do Application Proxy**.
4. Se você configurou o login único, o conector realiza qualquer **autenticação adicional** necessária em nome do usuário.
5. O conector envia a solicitação para o **aplicativo local**.
6. A **resposta** é enviada através do conector e do serviço Application Proxy **para o usuário**.

## Enumeração
```bash
# Enumerate applications with application proxy configured
Get-AzureADApplication | %{try{Get-AzureADApplicationProxyApplication -ObjectId $_.ObjectID;$_.DisplayName;$_.ObjectID}catch{}}

# Get applications service principal
Get-AzureADServicePrincipal -All $true | ?{$_.DisplayName -eq "Name"}

# Use the following ps1 script from https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/scripts/powershell-display-users-group-of-app
# to find users and groups assigned to the application. Pass the ObjectID of the Service Principal to it
Get-ApplicationProxyAssignedUsersAndGroups -ObjectId <object-id>
```
## Referências

- [https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/application-proxy](https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/application-proxy)

{{#include ../../../banners/hacktricks-training.md}}
