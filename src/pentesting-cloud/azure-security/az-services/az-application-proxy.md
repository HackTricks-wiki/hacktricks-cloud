# Az - Application Proxy

{{#include ../../../banners/hacktricks-training.md}}

## Grundlegende Informationen

[Aus den Dokumenten:](https://learn.microsoft.com/en-us/entra/identity/app-proxy/application-proxy)

Der Application Proxy von Azure Active Directory bietet **sicheren Remote-Zugriff auf lokale Webanwendungen**. Nach einer **Einmalanmeldung bei Azure AD** können Benutzer sowohl **Cloud-** als auch **lokale Anwendungen** über eine **externe URL** oder ein internes Anwendungsportal zugreifen.

So funktioniert es:

<figure><img src="../../../images/image (186).png" alt=""><figcaption></figcaption></figure>

1. Nachdem der Benutzer die Anwendung über einen Endpunkt aufgerufen hat, wird der Benutzer zur **Azure AD-Anmeldeseite** geleitet.
2. Nach einer **erfolgreichen Anmeldung** sendet Azure AD ein **Token** an das Client-Gerät des Benutzers.
3. Der Client sendet das Token an den **Application Proxy-Dienst**, der den Benutzerprinzipalnamen (UPN) und den Sicherheitsprinzipalnamen (SPN) aus dem Token abruft. **Der Application Proxy sendet dann die Anfrage an den Application Proxy-Connector**.
4. Wenn Sie die Einmalanmeldung konfiguriert haben, führt der Connector die erforderliche **zusätzliche Authentifizierung** im Namen des Benutzers durch.
5. Der Connector sendet die Anfrage an die **lokale Anwendung**.
6. Die **Antwort** wird über den Connector und den Application Proxy-Dienst **an den Benutzer** gesendet.

## Enumeration
```bash
# Enumerate applications with application proxy configured
Get-AzureADApplication | %{try{Get-AzureADApplicationProxyApplication -ObjectId $_.ObjectID;$_.DisplayName;$_.ObjectID}catch{}}

# Get applications service principal
Get-AzureADServicePrincipal -All $true | ?{$_.DisplayName -eq "Name"}

# Use the following ps1 script from https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/scripts/powershell-display-users-group-of-app
# to find users and groups assigned to the application. Pass the ObjectID of the Service Principal to it
Get-ApplicationProxyAssignedUsersAndGroups -ObjectId <object-id>
```
## Referenzen

- [https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/application-proxy](https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/application-proxy)

{{#include ../../../banners/hacktricks-training.md}}
