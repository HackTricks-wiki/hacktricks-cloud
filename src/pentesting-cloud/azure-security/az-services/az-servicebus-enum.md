# Az - Service Bus Enum

{{#include ../../../banners/hacktricks-training.md}}

## Service Bus

Azure Service Bus is 'n wolk-gebaseerde **boodskapdiens** wat ontwerp is om betroubare **kommunikasie tussen verskillende dele van 'n toepassing of geskeide toepassings** moontlik te maak. Dit dien as 'n veilige tussenganger, wat verseker dat boodskappe veilig afgelewer word, selfs al werk die sender en ontvanger nie gelyktydig nie. Deur stelsels te ontkoppel, laat dit toepassings toe om onafhanklik te werk terwyl hulle steeds data of instruksies uitruil. Dit is veral nuttig vir scenario's wat laaibelasting oor verskeie werkers vereis, betroubare boodskapaflewering, of komplekse koördinering, soos om take in volgorde te verwerk of toegang veilig te bestuur.

### Sleutelkonsepte

1. **Queues:** die doel is om boodskappe te stoor totdat die ontvanger gereed is.
- Boodskappe is georden, tydstempel, en duursaam gestoor.
- Afgelewer in trekmodus (op aanvraag).
- Ondersteun punt-tot-punt kommunikasie.
2. **Topics:** Publiseer-subscribe boodskapdiens vir uitsaai.
- Meerdere onafhanklike intekeninge ontvang kopieë van boodskappe.
- Intekene kan reëls/filters hê om aflewering te beheer of metadata by te voeg.
- Ondersteun baie-tot-baie kommunikasie.
3. **Namespaces:** 'n Houer vir alle boodskapkomponente, queues en topics, is soos jou eie skyfie van 'n kragtige Azure-kluster, wat toegewyde kapasiteit bied en opsioneel oor drie beskikbaarheidsone strek.

### Gevorderde Kenmerke

Sommige gevorderde kenmerke is:

- **Message Sessions**: Verseker FIFO-verwerking en ondersteun versoek-antwoorde patrone.
- **Auto-Forwarding**: Oordra boodskappe tussen queues of topics in dieselfde namespace.
- **Dead-Lettering**: Vang onaflewerbare boodskappe vir hersiening.
- **Scheduled Delivery**: Vertraag boodskapverwerking vir toekomstige take.
- **Message Deferral**: Stel boodskaponttrekking uit totdat gereed.
- **Transactions**: Groepeer operasies in atomiese uitvoering.
- **Filters & Actions**: Pas reëls toe om boodskappe te filter of te annotasie.
- **Auto-Delete on Idle**: Verwyder queues na inaktiwiteit (min: 5 minute).
- **Duplicate Detection**: Verwyder duplikaat boodskappe tydens herstuur.
- **Batch Deletion**: Groepsverwydering van vervalde of onnodige boodskappe.

### Authorization-Rule / SAS Policy

SAS-beleide definieer die toegangstoestemmings vir Azure Service Bus entiteite namespace (Die Belangrikste Een), queues en topics. Elke beleid het die volgende komponente:

- **Permissions**: Aankruisvakke om toegangsvlakke te spesifiseer:
- Bestuur: Gee volle beheer oor die entiteit, insluitend konfigurasie en toestemmingbestuur.
- Stuur: Laat toe om boodskappe na die entiteit te stuur.
- Luister: Laat toe om boodskappe van die entiteit te ontvang.
- **Primary and Secondary Keys**: Dit is kriptografiese sleutels wat gebruik word om veilige tokens te genereer vir die outentisering van toegang.
- **Primary and Secondary Connection Strings**: Vooraf-gekonfigureerde verbindingsstringe wat die eindpunt en sleutel insluit vir maklike gebruik in toepassings.
- **SAS Policy ARM ID**: Die Azure Resource Manager (ARM) pad na die beleid vir programmatiese identifikasie.

### NameSpace

sku, outorisasie reël,

### Enumeration
```bash
# Queue Enumeration
az servicebus queue list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus queue show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyQueue>

# Topic Enumeration
az servicebus topic list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus topic show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyTopic>

# Susbscription Enumeration
az servicebus topic subscription list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic>
az servicebus topic subscription show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic> --name <MySubscription>

# Namespace Enumeration
az servicebus namespace list
az servicebus namespace network-rule-set list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace show --resource-group <MyResourceGroup> --name <MyNamespace>
az servicebus namespace network-rule-set show --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace private-endpoint-connection list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace exists --name ProposedNamespace

# Authorization Rule Enumeration
az servicebus namespace authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus queue authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --queue-name <MyQueue>
az servicebus topic authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic>
az servicebus namespace authorization-rule keys list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyAuthRule>
```
### Privilege Escalation

{{#ref}}
../az-privilege-escalation/az-servicebus-privesc.md
{{#endref}}

### Post Exploitation

{{#ref}}
../az-post-exploitation/az-servicebus-post-exploitation.md
{{#endref}}

## References

- https://learn.microsoft.com/en-us/powershell/module/az.servicebus/?view=azps-13.0.0
- https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-messaging-overview
- https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quickstart-cli

{{#include ../../../banners/hacktricks-training.md}}
