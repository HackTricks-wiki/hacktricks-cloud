# Az - PostgreSQL æ•°æ®åº“

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## Azure PostgreSQL
**Azure Database for PostgreSQL** æ˜¯ä¸€ä¸ªå®Œå…¨æ‰˜ç®¡çš„ **åŸºäº PostgreSQL** ç¤¾åŒºç‰ˆçš„ **å…³ç³»æ•°æ®åº“æœåŠ¡**ã€‚å®ƒæ—¨åœ¨ä¸ºå¤šæ ·åŒ–çš„åº”ç”¨éœ€æ±‚æä¾›å¯æ‰©å±•æ€§ã€å®‰å…¨æ€§å’Œçµæ´»æ€§ã€‚ä¸ Azure MySQL ç±»ä¼¼ï¼ŒPostgreSQL æä¾›ä¸¤ç§éƒ¨ç½²æ¨¡å‹ï¼š

* **å•æœåŠ¡å™¨**ï¼ˆåœ¨é€€å½¹è·¯å¾„ä¸Šï¼‰ï¼š
- é’ˆå¯¹ç®€å•ã€ç»æµé«˜æ•ˆçš„ PostgreSQL éƒ¨ç½²è¿›è¡Œäº†ä¼˜åŒ–ã€‚
- å…·æœ‰è‡ªåŠ¨å¤‡ä»½ã€åŸºæœ¬ç›‘æ§å’Œé«˜å¯ç”¨æ€§åŠŸèƒ½ã€‚
- é€‚åˆå…·æœ‰å¯é¢„æµ‹å·¥ä½œè´Ÿè½½çš„åº”ç”¨ç¨‹åºã€‚
* **çµæ´»æœåŠ¡å™¨**ï¼š
- æä¾›æ›´å¤§çš„æ•°æ®åº“ç®¡ç†å’Œé…ç½®æ§åˆ¶ã€‚
- æ”¯æŒåŒä¸€åŒºåŸŸå’Œè·¨åŒºåŸŸçš„é«˜å¯ç”¨æ€§ã€‚
- å…·æœ‰å¼¹æ€§æ‰©å±•ã€è‡ªåŠ¨ç»´æŠ¤å’ŒèŠ‚çœæˆæœ¬çš„åŠŸèƒ½ã€‚
- å…è®¸å¯åŠ¨å’Œåœæ­¢æœåŠ¡å™¨ä»¥ä¼˜åŒ–æˆæœ¬ã€‚

### ä¸»è¦ç‰¹æ€§

* **è‡ªå®šä¹‰ç»´æŠ¤çª—å£**ï¼šå®‰æ’æ›´æ–°ä»¥æœ€å°åŒ–å¹²æ‰°ã€‚
* **ä¸»åŠ¨ç›‘æ§**ï¼šè®¿é—®è¯¦ç»†çš„æŒ‡æ ‡å’Œæ—¥å¿—ä»¥è·Ÿè¸ªå’Œæ”¹å–„æ•°æ®åº“æ€§èƒ½ã€‚
* **åœæ­¢/å¯åŠ¨æœåŠ¡å™¨**ï¼šç”¨æˆ·å¯ä»¥åœæ­¢å’Œå¯åŠ¨æœåŠ¡å™¨ã€‚
* **è‡ªåŠ¨å¤‡ä»½**ï¼šå†…ç½®æ¯æ—¥å¤‡ä»½ï¼Œä¿ç•™æœŸå¯é…ç½®æœ€é•¿è¾¾ 35 å¤©ã€‚
* **åŸºäºè§’è‰²çš„è®¿é—®**ï¼šé€šè¿‡ Azure Active Directory æ§åˆ¶ç”¨æˆ·æƒé™å’Œç®¡ç†è®¿é—®ã€‚
* **å®‰å…¨æ€§å’Œç½‘ç»œ**ï¼šå¯ä»¥ç®¡ç†æœåŠ¡å™¨é˜²ç«å¢™è§„åˆ™ä»¥ç¡®ä¿å®‰å…¨çš„æ•°æ®åº“è®¿é—®ï¼Œå¹¶æ ¹æ®éœ€è¦åˆ†ç¦»è™šæ‹Ÿç½‘ç»œé…ç½®ã€‚

### æšä¸¾

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List servers in a resource group
az postgres flexible-server list --resource-group <resource-group-name>
# List databases in a flexible-server
az postgres flexible-server db list --resource-group <resource-group-name> --server-name <server_name>
# Show specific details of a Postgre database
az postgres flexible-server db show --resource-group <resource-group-name> --server-name <server_name> --database-name <database_name>

# List firewall rules of the a server
az postgres flexible-server firewall-rule list --resource-group <resource-group-name> --name <server_name>
# List parameter values for a felxible server
az postgres flexible-server parameter list --resource-group <resource-group-name> --server-name <server_name>
# List private link
az postgres flexible-server private-link-resource list --resource-group <resource-group-name> --server-name <server_name>

# List all ad-admin in a server
az postgres flexible-server ad-admin list --resource-group <resource-group-name> --server-name <server_name>
# List all user assigned managed identities from the server
az postgres flexible-server identity list --resource-group <resource-group-name> --server-name <server_name>

# List the server backups
az postgres flexible-server backup list --resource-group <resource-group-name> --name <server_name>
# List all read replicas for a given server
az postgres flexible-server replica list --resource-group <resource-group-name> --name <server_name>
# List migrations
az postgres flexible-server migration list --resource-group <resource-group-name> --name <server_name>

# Get the server's advanced threat protection setting
az postgres flexible-server advanced-threat-protection-setting show --resource-group <resource-group-name> --name <server_name>
# List all of the maintenances of a flexible server
az postgres flexible-server maintenance list --resource-group <resource-group-name> --server-name <server_name>
# List log files for a server.
az postgres flexible-server server-logs list --resource-group <resource-group-name> --server-name <server_name>

```
{% endcode %}
{% endtab %}

{% tab title="Az PowerShell" %}
{% code overflow="wrap" %}
```powershell
Get-Command -Module Az.PostgreSql

# List flexible-servers in a resource group
Get-AzPostgreSqlFlexibleServer -ResourceGroupName <resource-group-name>
# List databases in a flexible-server
Get-AzPostgreSqlFlexibleServerDatabase -ResourceGroupName <resource-group-name> -ServerName <server_name>

# List firewall rules of the a flexible-server
Get-AzPostgreSqlFlexibleServerFirewallRule -ResourceGroupName <resource-group-name> -ServerName <server_name>

# List configuration settings of a flexible server
Get-AzPostgreSqlFlexibleServerConfiguration -ResourceGroupName <resource-group-name> -ServerName <server_name>
# Get the connection string for a flexible server
Get-AzPostgreSqlFlexibleServerConnectionString -ResourceGroupName <resource-group-name> -ServerName <server_name> -Client <client>

Get-AzPostgreSqlFlexibleServerLocationBasedCapability -Location <location>

# List servers in a resource group
Get-AzPostgreSqlServer -ResourceGroupName <resource-group-name>

```
{% endcode %}
{% endtab %}
{% endtabs %}

### è¿æ¥

ä½¿ç”¨æ‰©å±• rdbms-connectï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®æ•°æ®åº“ï¼š

{% code overflow="wrap" %}
```bash
az postgres flexible-server connect -n <server-name> -u <username> -p <password> --interactive

#or execute commands
az postgres flexible-server execute \
-n <server-name> \
-u <username> \
-p "<password>" \
-d <database-name> \
--querytext "SELECT * FROM <table-name>;"

```
{% endcode %}

æˆ–
{% code overflow="wrap" %}
```bash
psql -h testpostgresserver1994.postgres.database.azure.com -p 5432 -U adminuser <database-name>
```
{% endcode %}

## å‚è€ƒ

* [https://learn.microsoft.com/en-us/azure/postgresql/](https://learn.microsoft.com/en-us/azure/postgresql/)
* [https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/service-overview](https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/service-overview)
* [https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/overview](https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/overview)

## æƒé™æå‡

{% content-ref url="../az-privilege-escalation/az-postgresql-privesc.md" %}
[az-postgresql-privesc.md](../az-privilege-escalation/az-postgresql-privesc.md)
{% endcontent-ref %}

## åæœŸåˆ©ç”¨

{% content-ref url="../az-post-exploitation/az-postgresql-post-exploitation.md" %}
[az-postgresql-post-exploitation.md](../az-post-exploitation/az-postgresql-post-exploitation.md)
{% endcontent-ref %}

## å¾…åŠäº‹é¡¹

* å¯»æ‰¾ä¸€ç§æ–¹æ³•ä»¥ ad-admin è®¿é—®ä»¥éªŒè¯å…¶æ˜¯å¦ä¸ºæƒé™æå‡æ–¹æ³•


{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨ Twitter ä¸Šå…³æ³¨** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
