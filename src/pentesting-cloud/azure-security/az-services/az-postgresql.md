# Az - PostgreSQL Databases

{% hint style="success" %}
AWS í•´í‚¹ì„ ë°°ìš°ê³  ì—°ìŠµí•˜ì„¸ìš”:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
GCP í•´í‚¹ì„ ë°°ìš°ê³  ì—°ìŠµí•˜ì„¸ìš”: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}

## Azure PostgreSQL
**Azure Database for PostgreSQL**ëŠ” **PostgreSQL** ì»¤ë®¤ë‹ˆí‹° ì—ë””ì…˜ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ ì™„ì „ ê´€ë¦¬í˜• **ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ ì„œë¹„ìŠ¤**ì…ë‹ˆë‹¤. ë‹¤ì–‘í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ ìš”êµ¬ì— ëŒ€í•œ í™•ì¥ì„±, ë³´ì•ˆ ë° ìœ ì—°ì„±ì„ ì œê³µí•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. Azure MySQLê³¼ ìœ ì‚¬í•˜ê²Œ PostgreSQLì€ ë‘ ê°€ì§€ ë°°í¬ ëª¨ë¸ì„ ì œê³µí•©ë‹ˆë‹¤:

* **ë‹¨ì¼ ì„œë²„** (í‡´ì—­ ê²½ë¡œì— ìˆìŒ):
- ê°„ë‹¨í•˜ê³  ë¹„ìš© íš¨ìœ¨ì ì¸ PostgreSQL ë°°í¬ë¥¼ ìœ„í•´ ìµœì í™”ë¨.
- ìë™ ë°±ì—…, ê¸°ë³¸ ëª¨ë‹ˆí„°ë§ ë° ê³ ê°€ìš©ì„± ê¸°ëŠ¥ì„ ê°–ì¶¤.
- ì˜ˆì¸¡ ê°€ëŠ¥í•œ ì‘ì—… ë¶€í•˜ë¥¼ ê°€ì§„ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì í•©.
* **ìœ ì—°í•œ ì„œë²„**:
- ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ ë° êµ¬ì„±ì— ëŒ€í•œ ë” í° ì œì–´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
- ë™ì¼í•œ ì˜ì—­ ë° ì˜ì—­ ê°„ì˜ ê³ ê°€ìš©ì„±ì„ ì§€ì›í•©ë‹ˆë‹¤.
- íƒ„ë ¥ì  í™•ì¥, ìë™ ìœ ì§€ ê´€ë¦¬ ë° ë¹„ìš© ì ˆê° ê¸°ëŠ¥ì„ ê°–ì¶¤.
- ë¹„ìš© ìµœì í™”ë¥¼ ìœ„í•´ ì„œë²„ë¥¼ ì‹œì‘í•˜ê³  ì¤‘ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì£¼ìš” ê¸°ëŠ¥

* **ì‚¬ìš©ì ì •ì˜ ìœ ì§€ ê´€ë¦¬ ì°½**: ì¤‘ë‹¨ì„ ìµœì†Œí™”í•˜ê¸° ìœ„í•´ ì—…ë°ì´íŠ¸ë¥¼ ì˜ˆì•½í•©ë‹ˆë‹¤.
* **í™œì„± ëª¨ë‹ˆí„°ë§**: ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥ì„ ì¶”ì í•˜ê³  ê°œì„ í•˜ê¸° ìœ„í•œ ìƒì„¸í•œ ë©”íŠ¸ë¦­ ë° ë¡œê·¸ì— ì ‘ê·¼í•©ë‹ˆë‹¤.
* **ì„œë²„ ì¤‘ì§€/ì‹œì‘**: ì‚¬ìš©ìê°€ ì„œë²„ë¥¼ ì¤‘ì§€í•˜ê³  ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ìë™ ë°±ì—…**: ìµœëŒ€ 35ì¼ ë™ì•ˆ êµ¬ì„± ê°€ëŠ¥í•œ ë³´ì¡´ ê¸°ê°„ì„ ê°€ì§„ ë‚´ì¥ëœ ì¼ì¼ ë°±ì—….
* **ì—­í•  ê¸°ë°˜ ì ‘ê·¼**: Azure Active Directoryë¥¼ í†µí•´ ì‚¬ìš©ì ê¶Œí•œ ë° ê´€ë¦¬ ì ‘ê·¼ì„ ì œì–´í•©ë‹ˆë‹¤.
* **ë³´ì•ˆ ë° ë„¤íŠ¸ì›Œí‚¹**: ì•ˆì „í•œ ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ì„ ìœ„í•œ ì„œë²„ ë°©í™”ë²½ ê·œì¹™ì„ ê´€ë¦¬í•˜ê³  í•„ìš”ì— ë”°ë¼ ê°€ìƒ ë„¤íŠ¸ì›Œí¬ êµ¬ì„±ì„ ë¶„ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì—´ê±°

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List servers in a resource group
az postgres flexible-server list --resource-group <resource-group-name>
# List databases in a flexible-server
az postgres flexible-server db list --resource-group <resource-group-name> --server-name <server_name>
# Show specific details of a Postgre database
az postgres flexible-server db show --resource-group <resource-group-name> --server-name <server_name> --database-name <database_name>

# List firewall rules of the a server
az postgres flexible-server firewall-rule list --resource-group <resource-group-name> --name <server_name>
# List parameter values for a felxible server
az postgres flexible-server parameter list --resource-group <resource-group-name> --server-name <server_name>
# List private link
az postgres flexible-server private-link-resource list --resource-group <resource-group-name> --server-name <server_name>

# List all ad-admin in a server
az postgres flexible-server ad-admin list --resource-group <resource-group-name> --server-name <server_name>
# List all user assigned managed identities from the server
az postgres flexible-server identity list --resource-group <resource-group-name> --server-name <server_name>

# List the server backups
az postgres flexible-server backup list --resource-group <resource-group-name> --name <server_name>
# List all read replicas for a given server
az postgres flexible-server replica list --resource-group <resource-group-name> --name <server_name>
# List migrations
az postgres flexible-server migration list --resource-group <resource-group-name> --name <server_name>

# Get the server's advanced threat protection setting
az postgres flexible-server advanced-threat-protection-setting show --resource-group <resource-group-name> --name <server_name>
# List all of the maintenances of a flexible server
az postgres flexible-server maintenance list --resource-group <resource-group-name> --server-name <server_name>
# List log files for a server.
az postgres flexible-server server-logs list --resource-group <resource-group-name> --server-name <server_name>

```
{% endcode %}
{% endtab %}

{% tab title="Az PowerShell" %}
{% code overflow="wrap" %}
```bash
Get-Command -Module Az.PostgreSql

# List flexible-servers in a resource group
Get-AzPostgreSqlFlexibleServer -ResourceGroupName <resource-group-name>
# List databases in a flexible-server
Get-AzPostgreSqlFlexibleServerDatabase -ResourceGroupName <resource-group-name> -ServerName <server_name>

# List firewall rules of the a flexible-server
Get-AzPostgreSqlFlexibleServerFirewallRule -ResourceGroupName <resource-group-name> -ServerName <server_name>

# List configuration settings of a flexible server
Get-AzPostgreSqlFlexibleServerConfiguration -ResourceGroupName <resource-group-name> -ServerName <server_name>
# Get the connection string for a flexible server
Get-AzPostgreSqlFlexibleServerConnectionString -ResourceGroupName <resource-group-name> -ServerName <server_name> -Client <client>

Get-AzPostgreSqlFlexibleServerLocationBasedCapability -Location <location>

# List servers in a resource group
Get-AzPostgreSqlServer -ResourceGroupName <resource-group-name>

```
{% endcode %}
{% endtab %}
{% endtabs %}

### ì—°ê²°

rdbms-connect í™•ì¥ì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% code overflow="wrap" %}
```bash
az postgres flexible-server connect -n <server-name> -u <username> -p <password> --interactive

#or execute commands
az postgres flexible-server execute \
-n <server-name> \
-u <username> \
-p "<password>" \
-d <database-name> \
--querytext "SELECT * FROM <table-name>;"

```
{% endcode %}

ë˜ëŠ”
{% code overflow="wrap" %}
```bash
psql -h testpostgresserver1994.postgres.database.azure.com -p 5432 -U adminuser <database-name>
```
{% endcode %}

## References

* [https://learn.microsoft.com/en-us/azure/postgresql/](https://learn.microsoft.com/en-us/azure/postgresql/)
* [https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/service-overview](https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/service-overview)
* [https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/overview](https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/overview)

## Privilege Escalation

{% content-ref url="../az-privilege-escalation/az-postgresql-privesc.md" %}
[az-postgresql-privesc.md](../az-privilege-escalation/az-postgresql-privesc.md)
{% endcontent-ref %}

## Post Exploitation

{% content-ref url="../az-post-exploitation/az-postgresql-post-exploitation.md" %}
[az-postgresql-post-exploitation.md](../az-post-exploitation/az-postgresql-post-exploitation.md)
{% endcontent-ref %}

## ToDo

* ad-adminìœ¼ë¡œ ì ‘ê·¼í•  ë°©ë²•ì„ ì°¾ì•„ì„œ ì´ê²ƒì´ privesc ë°©ë²•ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.


{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê³  ì—°ìŠµí•˜ê¸°:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê³  ì—°ìŠµí•˜ê¸°: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
