# Az - PostgreSQL Databases

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Azure PostgreSQL
**Azure Database for PostgreSQL** —î –ø–æ–≤–Ω—ñ—Å—Ç—é –∫–µ—Ä–æ–≤–∞–Ω–æ—é **—Ä–µ–ª—è—Ü—ñ–π–Ω–æ—é –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö, –∑–∞—Å–Ω–æ–≤–∞–Ω–æ—é –Ω–∞ PostgreSQL** Community Edition. –í–æ–Ω–∞ —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–∞ –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω–æ—Å—Ç—ñ, –±–µ–∑–ø–µ–∫–∏ —Ç–∞ –≥–Ω—É—á–∫–æ—Å—Ç—ñ –¥–ª—è —Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω–∏—Ö –ø–æ—Ç—Ä–µ–± –∑–∞—Å—Ç–æ—Å—É–Ω–∫—ñ–≤. –ü–æ–¥—ñ–±–Ω–æ –¥–æ Azure MySQL, PostgreSQL –ø—Ä–æ–ø–æ–Ω—É—î –¥–≤—ñ –º–æ–¥–µ–ª—ñ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è:

* **Single Server** (–Ω–∞ –µ—Ç–∞–ø—ñ –≤–∏–≤–µ–¥–µ–Ω–Ω—è –∑ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó):
- –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ –¥–ª—è –ø—Ä–æ—Å—Ç–∏—Ö, –µ–∫–æ–Ω–æ–º—ñ—á–Ω–∏—Ö —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω—å PostgreSQL.
- –ú–∞—î –∞–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω—ñ —Ä–µ–∑–µ—Ä–≤–Ω—ñ –∫–æ–ø—ñ—ó, –±–∞–∑–æ–≤–µ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ –≤–∏—Å–æ–∫—É –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å.
- –Ü–¥–µ–∞–ª—å–Ω–æ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è –∑–∞—Å—Ç–æ—Å—É–Ω–∫—ñ–≤ –∑ –ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–∏–º–∏ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º–∏.
* **Flexible Server**:
- –ó–∞–±–µ–∑–ø–µ—á—É—î –±—ñ–ª—å—à–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è–º –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö —Ç–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—î—é.
- –ü—ñ–¥—Ç—Ä–∏–º—É—î –≤–∏—Å–æ–∫—É –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å, —è–∫ –≤ –æ–¥–Ω—ñ–π –∑–æ–Ω—ñ, —Ç–∞–∫ —ñ –º—ñ–∂ –∑–æ–Ω–∞–º–∏.
- –ú–∞—î –µ–ª–∞—Å—Ç–∏—á–Ω–µ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω–µ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è —Ç–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å –¥–ª—è –µ–∫–æ–Ω–æ–º—ñ—ó –≤–∏—Ç—Ä–∞—Ç.
- –î–æ–∑–≤–æ–ª—è—î –∑–∞–ø—É—Å–∫–∞—Ç–∏ —Ç–∞ –∑—É–ø–∏–Ω—è—Ç–∏ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó –≤–∏—Ç—Ä–∞—Ç.

### Key Features

* **Custom Maintenance Windows**: –ó–∞–ø–ª–∞–Ω—É–π—Ç–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è, —â–æ–± –º—ñ–Ω—ñ–º—ñ–∑—É–≤–∞—Ç–∏ –ø–µ—Ä–µ—Ä–≤–∏.
* **Active Monitoring**: –î–æ—Å—Ç—É–ø –¥–æ –¥–µ—Ç–∞–ª—å–Ω–∏—Ö –º–µ—Ç—Ä–∏–∫ —Ç–∞ –∂—É—Ä–Ω–∞–ª—ñ–≤ –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è —Ç–∞ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.
* **Stop/Start Server**: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –º–æ–∂—É—Ç—å –∑—É–ø–∏–Ω—è—Ç–∏ —Ç–∞ –∑–∞–ø—É—Å–∫–∞—Ç–∏ —Å–µ—Ä–≤–µ—Ä.
* **Automatic Backups**: –í–±—É–¥–æ–≤–∞–Ω—ñ —â–æ–¥–µ–Ω–Ω—ñ —Ä–µ–∑–µ—Ä–≤–Ω—ñ –∫–æ–ø—ñ—ó –∑ –ø–µ—Ä—ñ–æ–¥–∞–º–∏ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è, —è–∫—ñ –º–æ–∂–Ω–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –¥–æ 35 –¥–Ω—ñ–≤.
* **Role-Based Access**: –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ–∑–≤–æ–ª—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É —á–µ—Ä–µ–∑ Azure Active Directory.
* **Security and Networking**: –º–æ–∂–µ –∫–µ—Ä—É–≤–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –±—Ä–∞–Ω–¥–º–∞—É–µ—Ä–∞ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —Ç–∞ –≤—ñ–¥–∫–ª—é—á–∞—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ—ó –º–µ—Ä–µ–∂—ñ –∑–∞ –ø–æ—Ç—Ä–µ–±–∏.

### Enumeration

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List servers in a resource group
az postgres flexible-server list --resource-group <resource-group-name>
# List databases in a flexible-server
az postgres flexible-server db list --resource-group <resource-group-name> --server-name <server_name>
# Show specific details of a Postgre database
az postgres flexible-server db show --resource-group <resource-group-name> --server-name <server_name> --database-name <database_name>

# List firewall rules of the a server
az postgres flexible-server firewall-rule list --resource-group <resource-group-name> --name <server_name>
# List parameter values for a felxible server
az postgres flexible-server parameter list --resource-group <resource-group-name> --server-name <server_name>
# List private link
az postgres flexible-server private-link-resource list --resource-group <resource-group-name> --server-name <server_name>

# List all ad-admin in a server
az postgres flexible-server ad-admin list --resource-group <resource-group-name> --server-name <server_name>
# List all user assigned managed identities from the server
az postgres flexible-server identity list --resource-group <resource-group-name> --server-name <server_name>

# List the server backups
az postgres flexible-server backup list --resource-group <resource-group-name> --name <server_name>
# List all read replicas for a given server
az postgres flexible-server replica list --resource-group <resource-group-name> --name <server_name>
# List migrations
az postgres flexible-server migration list --resource-group <resource-group-name> --name <server_name>

# Get the server's advanced threat protection setting
az postgres flexible-server advanced-threat-protection-setting show --resource-group <resource-group-name> --name <server_name>
# List all of the maintenances of a flexible server
az postgres flexible-server maintenance list --resource-group <resource-group-name> --server-name <server_name>
# List log files for a server.
az postgres flexible-server server-logs list --resource-group <resource-group-name> --server-name <server_name>

```
{% endcode %}
{% endtab %}

{% tab title="Az PowerShell" %}
{% code overflow="wrap" %}
```bash
Get-Command -Module Az.PostgreSql

# List flexible-servers in a resource group
Get-AzPostgreSqlFlexibleServer -ResourceGroupName <resource-group-name>
# List databases in a flexible-server
Get-AzPostgreSqlFlexibleServerDatabase -ResourceGroupName <resource-group-name> -ServerName <server_name>

# List firewall rules of the a flexible-server
Get-AzPostgreSqlFlexibleServerFirewallRule -ResourceGroupName <resource-group-name> -ServerName <server_name>

# List configuration settings of a flexible server
Get-AzPostgreSqlFlexibleServerConfiguration -ResourceGroupName <resource-group-name> -ServerName <server_name>
# Get the connection string for a flexible server
Get-AzPostgreSqlFlexibleServerConnectionString -ResourceGroupName <resource-group-name> -ServerName <server_name> -Client <client>

Get-AzPostgreSqlFlexibleServerLocationBasedCapability -Location <location>

# List servers in a resource group
Get-AzPostgreSqlServer -ResourceGroupName <resource-group-name>

```
{% endcode %}
{% endtab %}
{% endtabs %}

### –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

–ó —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è–º rdbms-connect –≤–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é:

{% code overflow="wrap" %}
```bash
az postgres flexible-server connect -n <server-name> -u <username> -p <password> --interactive

#or execute commands
az postgres flexible-server execute \
-n <server-name> \
-u <username> \
-p "<password>" \
-d <database-name> \
--querytext "SELECT * FROM <table-name>;"

```
{% endcode %}

–ê–±–æ
{% code overflow="wrap" %}
```bash
psql -h testpostgresserver1994.postgres.database.azure.com -p 5432 -U adminuser <database-name>
```
{% endcode %}

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://learn.microsoft.com/en-us/azure/postgresql/](https://learn.microsoft.com/en-us/azure/postgresql/)
* [https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/service-overview](https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/service-overview)
* [https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/overview](https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/overview)

## –ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤

{% content-ref url="../az-privilege-escalation/az-postgresql-privesc.md" %}
[az-postgresql-privesc.md](../az-privilege-escalation/az-postgresql-privesc.md)
{% endcontent-ref %}

## –ü–æ—Å—Ç–µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è

{% content-ref url="../az-post-exploitation/az-postgresql-post-exploitation.md" %}
[az-postgresql-post-exploitation.md](../az-post-exploitation/az-postgresql-post-exploitation.md)
{% endcontent-ref %}

## ToDo

* –ó–Ω–∞–π—Ç–∏ —Å–ø–æ—Å—ñ–± –¥–æ—Å—Ç—É–ø—É –∑ ad-admin, —â–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ —Ü–µ –º–µ—Ç–æ–¥ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤


{% hint style="success" %}
–í—á—ñ—Ç—å—Å—è —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ Hacking AWS:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
–í—á—ñ—Ç—å—Å—è —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ Hacking GCP: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ github.

</details>
{% endhint %}
