# Az - Service Bus Post Exploitation

{{#include ../../../banners/hacktricks-training.md}}

## Service Bus

Για περισσότερες πληροφορίες ελέγξτε:

{{#ref}}
../az-services/az-servicebus-enum.md
{{#endref}}

### Actions: `Microsoft.ServiceBus/namespaces/Delete`

Ένας επιτιθέμενος με αυτή την άδεια μπορεί να διαγράψει ολόκληρο το Azure Service Bus namespace. Αυτή η ενέργεια αφαιρεί το namespace και όλους τους σχετικούς πόρους, συμπεριλαμβανομένων των ουρών, των θεμάτων, των συνδρομών και των μηνυμάτων τους, προκαλώντας εκτεταμένη αναστάτωση και μόνιμη απώλεια δεδομένων σε όλα τα εξαρτώμενα συστήματα και ροές εργασίας.
```bash
az servicebus namespace delete --resource-group <ResourceGroupName> --name <NamespaceName>
```
### Actions: `Microsoft.ServiceBus/namespaces/topics/Delete`

Ένας επιτιθέμενος με αυτή την άδεια μπορεί να διαγράψει ένα θέμα Azure Service Bus. Αυτή η ενέργεια αφαιρεί το θέμα και όλες τις σχετικές συνδρομές και μηνύματα του, ενδεχομένως προκαλώντας απώλεια κρίσιμων δεδομένων και διαταράσσοντας συστήματα και ροές εργασίας που βασίζονται στο θέμα.
```bash
az servicebus topic delete --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <TopicName>
```
### Actions: `Microsoft.ServiceBus/namespaces/queues/Delete`

Ένας επιτιθέμενος με αυτή την άδεια μπορεί να διαγράψει μια ουρά Azure Service Bus. Αυτή η ενέργεια αφαιρεί την ουρά και όλα τα μηνύματα μέσα σε αυτήν, ενδεχομένως προκαλώντας απώλεια κρίσιμων δεδομένων και διαταράσσοντας τα συστήματα και τις ροές εργασίας που εξαρτώνται από την ουρά.
```bash
az servicebus queue delete --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <QueueName>
```
### Actions: `Microsoft.ServiceBus/namespaces/topics/subscriptions/Delete`

Ένας επιτιθέμενος με αυτή την άδεια μπορεί να διαγράψει μια συνδρομή Azure Service Bus. Αυτή η ενέργεια αφαιρεί τη συνδρομή και όλα τα συσχετισμένα μηνύματα της, ενδεχομένως διαταράσσοντας τις ροές εργασίας, την επεξεργασία δεδομένων και τις λειτουργίες του συστήματος που βασίζονται στη συνδρομή.
```bash
az servicebus topic subscription delete --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --topic-name <TopicName> --name <SubscriptionName>
```
### Actions: `Microsoft.ServiceBus/namespaces/queues/write` (`Microsoft.ServiceBus/namespaces/queues/read`)

Ένας επιτιθέμενος με δικαιώματα για τη δημιουργία ή την τροποποίηση των Azure Service Bus queues (για να τροποποιήσετε την ουρά θα χρειαστείτε επίσης την ενέργεια: `Microsoft.ServiceBus/namespaces/queues/read`) μπορεί να εκμεταλλευτεί αυτό για να παρεμποδίσει δεδομένα, να διαταράξει ροές εργασίας ή να επιτρέψει μη εξουσιοδοτημένη πρόσβαση. Μπορούν να αλλάξουν κρίσιμες ρυθμίσεις όπως η προώθηση μηνυμάτων σε κακόβουλους προορισμούς, η προσαρμογή του TTL μηνυμάτων για να διατηρήσουν ή να διαγράψουν δεδομένα ακατάλληλα, ή η ενεργοποίηση dead-lettering για να παρεμποδίσουν την επεξεργασία σφαλμάτων. Επιπλέον, θα μπορούσαν να χειριστούν τα μεγέθη των ουρών, τις διάρκειες κλειδώματος ή τις καταστάσεις για να διαταράξουν τη λειτουργικότητα της υπηρεσίας ή να αποφύγουν την ανίχνευση, καθιστώντας αυτό έναν σημαντικό κίνδυνο μετά την εκμετάλλευση.
```bash
az servicebus queue create --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <QueueName>
az servicebus queue update --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <QueueName>
```
### Actions: `Microsoft.ServiceBus/namespaces/topics/write` (`Microsoft.ServiceBus/namespaces/topics/read`)

Ένας επιτιθέμενος με δικαιώματα για τη δημιουργία ή την τροποποίηση θεμάτων (για να τροποποιήσει το θέμα θα χρειαστεί επίσης την Ενέργεια: `Microsoft.ServiceBus/namespaces/topics/read`) εντός ενός Azure Service Bus namespace μπορεί να εκμεταλλευτεί αυτό για να διαταράξει τις ροές μηνυμάτων, να εκθέσει ευαίσθητα δεδομένα ή να επιτρέψει μη εξουσιοδοτημένες ενέργειες. Χρησιμοποιώντας εντολές όπως az servicebus topic update, μπορούν να χειριστούν ρυθμίσεις όπως η ενεργοποίηση κατακερματισμού για κακή χρήση κλιμάκωσης, η τροποποίηση ρυθμίσεων TTL για να διατηρούν ή να απορρίπτουν μηνύματα ακατάλληλα, ή η απενεργοποίηση ανίχνευσης διπλοτύπων για να παρακάμψουν τους ελέγχους. Επιπλέον, θα μπορούσαν να προσαρμόσουν τα όρια μεγέθους θεμάτων, να αλλάξουν την κατάσταση για να διαταράξουν τη διαθεσιμότητα, ή να ρυθμίσουν εκφραστικά θέματα για να αποθηκεύσουν προσωρινά τα παρεμβαλλόμενα μηνύματα, καθιστώντας τη διαχείριση θεμάτων κρίσιμο σημείο για την μείωση των επιπτώσεων μετά την εκμετάλλευση.
```bash
az servicebus topic create --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <TopicName>
az servicebus topic update --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <TopicName>
```
### Ενέργειες: `Microsoft.ServiceBus/namespaces/topics/subscriptions/write` (`Microsoft.ServiceBus/namespaces/topics/subscriptions/read`)

Ένας επιτιθέμενος με δικαιώματα για τη δημιουργία ή την τροποποίηση συνδρομών (για να τροποποιήσει τη συνδρομή θα χρειαστεί επίσης την Ενέργεια: `Microsoft.ServiceBus/namespaces/topics/subscriptions/read`) εντός ενός θέματος Azure Service Bus μπορεί να εκμεταλλευτεί αυτό για να παρεμβάλλει, να ανακατευθύνει ή να διαταράξει τις ροές μηνυμάτων. Χρησιμοποιώντας εντολές όπως az servicebus topic subscription update, μπορούν να χειριστούν ρυθμίσεις όπως η ενεργοποίηση dead lettering για να αποσπάσουν μηνύματα, η προώθηση μηνυμάτων σε μη εξουσιοδοτημένα σημεία, ή η τροποποίηση TTL και διάρκειας κλειδώματος για να διατηρήσουν ή να παρεμποδίσουν την παράδοση μηνυμάτων. Επιπλέον, μπορούν να αλλάξουν τις ρυθμίσεις κατάστασης ή μέγιστου αριθμού παράδοσης για να διαταράξουν τις λειτουργίες ή να αποφύγουν την ανίχνευση, καθιστώντας τον έλεγχο συνδρομών κρίσιμο στοιχείο σε σενάρια μετα-εκμετάλλευσης.
```bash
az servicebus topic subscription create --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --topic-name <TopicName> --name <SubscriptionName>
az servicebus topic subscription update --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --topic-name <TopicName> --name <SubscriptionName>
```
### Ενέργειες: `AuthorizationRules` Αποστολή & Λήψη Μηνυμάτων

Ρίξτε μια ματιά εδώ:

{{#ref}}
../az-privilege-escalation/az-queue-privesc.md
{{#endref}}

## Αναφορές

- [https://learn.microsoft.com/en-us/azure/storage/queues/storage-powershell-how-to-use-queues](https://learn.microsoft.com/en-us/azure/storage/queues/storage-powershell-how-to-use-queues)
- [https://learn.microsoft.com/en-us/rest/api/storageservices/queue-service-rest-api](https://learn.microsoft.com/en-us/rest/api/storageservices/queue-service-rest-api)
- [https://learn.microsoft.com/en-us/azure/storage/queues/queues-auth-abac-attributes](https://learn.microsoft.com/en-us/azure/storage/queues/queues-auth-abac-attributes)
- [https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-python-how-to-use-topics-subscriptions?tabs=passwordless](https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-python-how-to-use-topics-subscriptions?tabs=passwordless)
- [https://learn.microsoft.com/en-us/azure/role-based-access-control/permissions/integration#microsoftservicebus](https://learn.microsoft.com/en-us/azure/role-based-access-control/permissions/integration#microsoftservicebus)
- [https://learn.microsoft.com/en-us/cli/azure/servicebus/namespace?view=azure-cli-latest](https://learn.microsoft.com/en-us/cli/azure/servicebus/namespace?view=azure-cli-latest)
- [https://learn.microsoft.com/en-us/cli/azure/servicebus/queue?view=azure-cli-latest](https://learn.microsoft.com/en-us/cli/azure/servicebus/queue?view=azure-cli-latest)

{{#include ../../../banners/hacktricks-training.md}}
