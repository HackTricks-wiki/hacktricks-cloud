# Az - Service Bus Post Exploitation

{{#include ../../../banners/hacktricks-training.md}}

## Service Bus

अधिक जानकारी के लिए देखें:

{{#ref}}
../az-services/az-servicebus-enum.md
{{#endref}}

### Actions: `Microsoft.ServiceBus/namespaces/Delete`

इस अनुमति के साथ एक हमलावर पूरे Azure Service Bus namespace को हटा सकता है। यह क्रिया namespace और सभी संबंधित संसाधनों, जिसमें कतारें, विषय, सदस्यताएँ, और उनके संदेश शामिल हैं, को हटा देती है, जिससे सभी निर्भर प्रणालियों और कार्यप्रवाहों में व्यापक व्यवधान और स्थायी डेटा हानि होती है।
```bash
az servicebus namespace delete --resource-group <ResourceGroupName> --name <NamespaceName>
```
### Actions: `Microsoft.ServiceBus/namespaces/topics/Delete`

इस अनुमति के साथ एक हमलावर Azure Service Bus टॉपिक को हटा सकता है। यह क्रिया टॉपिक और इसके सभी संबंधित सब्सक्रिप्शन और संदेशों को हटा देती है, जिससे महत्वपूर्ण डेटा का नुकसान और उन सिस्टमों और कार्यप्रवाहों में व्यवधान हो सकता है जो टॉपिक पर निर्भर करते हैं।
```bash
az servicebus topic delete --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <TopicName>
```
### Actions: `Microsoft.ServiceBus/namespaces/queues/Delete`

इस अनुमति के साथ एक हमलावर Azure Service Bus कतार को हटा सकता है। यह क्रिया कतार और इसके भीतर सभी संदेशों को हटा देती है, जिससे महत्वपूर्ण डेटा का नुकसान और कतार पर निर्भर सिस्टम और कार्यप्रवाहों में बाधा उत्पन्न हो सकती है।
```bash
az servicebus queue delete --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <QueueName>
```
### Actions: `Microsoft.ServiceBus/namespaces/topics/subscriptions/Delete`

इस अनुमति के साथ एक हमलावर Azure Service Bus सदस्यता को हटा सकता है। यह क्रिया सदस्यता और इसके सभी संबंधित संदेशों को हटा देती है, जो संभावित रूप से कार्यप्रवाह, डेटा प्रसंस्करण, और सिस्टम संचालन को बाधित कर सकती है जो सदस्यता पर निर्भर करते हैं।
```bash
az servicebus topic subscription delete --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --topic-name <TopicName> --name <SubscriptionName>
```
### Actions: `Microsoft.ServiceBus/namespaces/queues/write` (`Microsoft.ServiceBus/namespaces/queues/read`)

एक हमलावर जिसके पास Azure Service Bus queues बनाने या संशोधित करने की अनुमति है (queue को संशोधित करने के लिए आपको Action:`Microsoft.ServiceBus/namespaces/queues/read` की भी आवश्यकता होगी) इसका उपयोग डेटा को इंटरसेप्ट करने, कार्यप्रवाहों को बाधित करने, या अनधिकृत पहुंच सक्षम करने के लिए कर सकता है। वे महत्वपूर्ण कॉन्फ़िगरेशन को बदल सकते हैं जैसे कि संदेशों को दुर्भावनापूर्ण एंडपॉइंट्स पर अग्रेषित करना, डेटा को अनुचित तरीके से बनाए रखने या हटाने के लिए संदेश TTL को समायोजित करना, या त्रुटि प्रबंधन में हस्तक्षेप करने के लिए डेड-लेटरिंग सक्षम करना। इसके अतिरिक्त, वे सेवा कार्यक्षमता को बाधित करने या पहचान से बचने के लिए queue के आकार, लॉक अवधि, या स्थिति में हेरफेर कर सकते हैं, जिससे यह एक महत्वपूर्ण पोस्ट-एक्सप्लॉइटेशन जोखिम बन जाता है।
```bash
az servicebus queue create --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <QueueName>
az servicebus queue update --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <QueueName>
```
### Actions: `Microsoft.ServiceBus/namespaces/topics/write` (`Microsoft.ServiceBus/namespaces/topics/read`)

एक हमलावर जिसके पास Azure Service Bus namespace के भीतर विषय बनाने या संशोधित करने की अनुमति है (विषय को संशोधित करने के लिए आपको Action:`Microsoft.ServiceBus/namespaces/topics/read` की भी आवश्यकता होगी) इसका उपयोग संदेश कार्यप्रवाहों को बाधित करने, संवेदनशील डेटा को उजागर करने, या अनधिकृत क्रियाओं को सक्षम करने के लिए कर सकता है। az servicebus topic update जैसे कमांड का उपयोग करके, वे कॉन्फ़िगरेशन को इस तरह से हेरफेर कर सकते हैं जैसे कि स्केलेबिलिटी दुरुपयोग के लिए विभाजन को सक्षम करना, संदेशों को अनुचित रूप से बनाए रखने या त्यागने के लिए TTL सेटिंग्स को बदलना, या नियंत्रणों को बायपास करने के लिए डुप्लिकेट पहचान को अक्षम करना। इसके अतिरिक्त, वे विषय आकार सीमाओं को समायोजित कर सकते हैं, उपलब्धता को बाधित करने के लिए स्थिति बदल सकते हैं, या अस्थायी रूप से इंटरसेप्टेड संदेशों को स्टोर करने के लिए एक्सप्रेस विषयों को कॉन्फ़िगर कर सकते हैं, जिससे विषय प्रबंधन पोस्ट-एक्सप्लॉइटेशन शमन के लिए एक महत्वपूर्ण ध्यान केंद्र बन जाता है।
```bash
az servicebus topic create --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <TopicName>
az servicebus topic update --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <TopicName>
```
### Actions: `Microsoft.ServiceBus/namespaces/topics/subscriptions/write` (`Microsoft.ServiceBus/namespaces/topics/subscriptions/read`)

एक हमलावर जिसके पास Azure Service Bus टॉपिक के भीतर सब्सक्रिप्शन बनाने या संशोधित करने की अनुमति है (सब्सक्रिप्शन को संशोधित करने के लिए आपको Action: `Microsoft.ServiceBus/namespaces/topics/subscriptions/read` की भी आवश्यकता होगी) इसका उपयोग संदेश कार्यप्रवाहों को इंटरसेप्ट, रीरूट या बाधित करने के लिए कर सकता है। az servicebus topic subscription update जैसे कमांड का उपयोग करके, वे संदेशों को मोड़ने के लिए डेड लेटरिंग सक्षम करने, संदेशों को अनधिकृत एंडपॉइंट्स पर अग्रेषित करने, या संदेश वितरण को बनाए रखने या बाधित करने के लिए TTL और लॉक अवधि को संशोधित करने जैसी कॉन्फ़िगरेशन में हेरफेर कर सकते हैं। इसके अतिरिक्त, वे संचालन को बाधित करने या पहचान से बचने के लिए स्थिति या अधिकतम वितरण गणना सेटिंग्स को भी बदल सकते हैं, जिससे सब्सक्रिप्शन नियंत्रण पोस्ट-एक्सप्लॉइटेशन परिदृश्यों का एक महत्वपूर्ण पहलू बन जाता है।
```bash
az servicebus topic subscription create --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --topic-name <TopicName> --name <SubscriptionName>
az servicebus topic subscription update --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --topic-name <TopicName> --name <SubscriptionName>
```
### क्रियाएँ: `AuthorizationRules` संदेश भेजें और प्राप्त करें

यहाँ देखें:

{{#ref}}
../az-privilege-escalation/az-queue-privesc.md
{{#endref}}

## संदर्भ

- [https://learn.microsoft.com/en-us/azure/storage/queues/storage-powershell-how-to-use-queues](https://learn.microsoft.com/en-us/azure/storage/queues/storage-powershell-how-to-use-queues)
- [https://learn.microsoft.com/en-us/rest/api/storageservices/queue-service-rest-api](https://learn.microsoft.com/en-us/rest/api/storageservices/queue-service-rest-api)
- [https://learn.microsoft.com/en-us/azure/storage/queues/queues-auth-abac-attributes](https://learn.microsoft.com/en-us/azure/storage/queues/queues-auth-abac-attributes)
- [https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-python-how-to-use-topics-subscriptions?tabs=passwordless](https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-python-how-to-use-topics-subscriptions?tabs=passwordless)
- [https://learn.microsoft.com/en-us/azure/role-based-access-control/permissions/integration#microsoftservicebus](https://learn.microsoft.com/en-us/azure/role-based-access-control/permissions/integration#microsoftservicebus)
- [https://learn.microsoft.com/en-us/cli/azure/servicebus/namespace?view=azure-cli-latest](https://learn.microsoft.com/en-us/cli/azure/servicebus/namespace?view=azure-cli-latest)
- [https://learn.microsoft.com/en-us/cli/azure/servicebus/queue?view=azure-cli-latest](https://learn.microsoft.com/en-us/cli/azure/servicebus/queue?view=azure-cli-latest)

{{#include ../../../banners/hacktricks-training.md}}
