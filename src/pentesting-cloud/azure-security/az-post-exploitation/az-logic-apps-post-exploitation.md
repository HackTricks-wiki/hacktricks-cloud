# Az - Logic Apps Post Exploitation

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’é€ä¿¡ã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}

## Logic Apps Database Post Exploitation
Logic Appsã«é–¢ã™ã‚‹è©³ç´°æƒ…å ±ã¯ã€ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

{% content-ref url="../az-services/az-logic-apps.md" %}
[az-logic-apps.md](../az-services/az-logic-apps.md)
{% endcontent-ref %}

### "Microsoft.Logic/workflows/read", "Microsoft.Logic/workflows/write" && "Microsoft.ManagedIdentity/userAssignedIdentities/assign/action"
ã“ã‚Œã‚‰ã®æ¨©é™ã‚’æŒã¤ã“ã¨ã§ã€Logic Appã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å¤‰æ›´ã—ã€ãã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ç®¡ç†ã§ãã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€ã‚·ã‚¹ãƒ†ãƒ å‰²ã‚Šå½“ã¦ãŠã‚ˆã³ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰²ã‚Šå½“ã¦ã®ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«å‰²ã‚Šå½“ã¦ãŸã‚Šã€å‰Šé™¤ã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã€ã“ã‚Œã«ã‚ˆã‚ŠLogic Appã¯æ˜ç¤ºçš„ãªè³‡æ ¼æƒ…å ±ãªã—ã§ä»–ã®Azureãƒªã‚½ãƒ¼ã‚¹ã«èªè¨¼ã—ã€ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

{% code overflow="wrap" %}
```bash
az logic workflow identity remove/assign \
--name <workflow_name> \
--resource-group <resource_group_name> \
--system-assigned true \
--user-assigned "/subscriptions/<subscription_id>/resourceGroups/<resource_group>/providers/Microsoft.ManagedIdentity/userAssignedIdentities/<identity_name>"
```
{% endcode %}

### "Microsoft.Web/sites/read", "Microsoft.Web/sites/write"
ã“ã‚Œã‚‰ã®æ¨©é™ã‚’æŒã¤ã“ã¨ã§ã€App Service Planã«ãƒ›ã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹Logic Appsã‚’ä½œæˆã¾ãŸã¯æ›´æ–°ã§ãã¾ã™ã€‚ã“ã‚Œã«ã¯ã€HTTPSå¼·åˆ¶ã®æœ‰åŠ¹åŒ–ã¾ãŸã¯ç„¡åŠ¹åŒ–ãªã©ã®è¨­å®šã®å¤‰æ›´ãŒå«ã¾ã‚Œã¾ã™ã€‚

{% code overflow="wrap" %}
```bash
az logicapp update \
--resource-group <resource_group_name> \
--name <logic_app_name> \
--set httpsOnly=false
```
{% endcode %}

### "Microsoft.Web/sites/stop/action", "Microsoft.Web/sites/start/action" || "Microsoft.Web/sites/restart/action"
ã“ã®æ¨©é™ã‚’æŒã¤ã“ã¨ã§ã€App Service Planä¸Šã«ãƒ›ã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹Logic Appsã‚’å«ã‚€Webã‚¢ãƒ—ãƒªã‚’é–‹å§‹/åœæ­¢/å†èµ·å‹•ã§ãã¾ã™ã€‚ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€ä»¥å‰ã«åœæ­¢ã•ã‚ŒãŸã‚¢ãƒ—ãƒªãŒã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã«æˆ»ã‚Šã€ãã®æ©Ÿèƒ½ã‚’å†é–‹ã™ã‚‹ã“ã¨ã‚’ä¿è¨¼ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒä¸­æ–­ã•ã‚ŒãŸã‚Šã€æ„å›³ã—ãªã„æ“ä½œãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚ŒãŸã‚Šã€Logic AppsãŒäºˆæœŸã›ãšã«é–‹å§‹ã€åœæ­¢ã€ã¾ãŸã¯å†èµ·å‹•ã•ã‚Œã‚‹ã“ã¨ã«ã‚ˆã£ã¦ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

{% code overflow="wrap" %}
```bash
az webapp start/stop/restart \
--name <logic_app_name> \
--resource-group <resource_group_name>
```
{% endcode %}


### "Microsoft.Web/sites/config/list/action", "Microsoft.Web/sites/read" && "Microsoft.Web/sites/config/write"

ã“ã®æ¨©é™ã‚’æŒã¤ã“ã¨ã§ã€App Service Planä¸Šã§ãƒ›ã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹Logic Appsã‚’å«ã‚€Webã‚¢ãƒ—ãƒªã®è¨­å®šã‚’æ§‹æˆã¾ãŸã¯å¤‰æ›´ã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¢ãƒ—ãƒªè¨­å®šã€æ¥ç¶šæ–‡å­—åˆ—ã€èªè¨¼è¨­å®šãªã©ã®å¤‰æ›´ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

{% code overflow="wrap" %}
```bash
az logicapp config appsettings set \
--name <logic_app_name> \
--resource-group <resource_group_name> \
--settings "<key>=<value>"
```
{% endcode %}

### "Microsoft.Logic/integrationAccounts/write"
ã“ã®æ¨©é™ã‚’æŒã¤ã“ã¨ã§ã€Azure Logic Appsã®çµ±åˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã€æ›´æ–°ã€ã¾ãŸã¯å‰Šé™¤ã§ãã¾ã™ã€‚ã“ã‚Œã«ã¯ã€ãƒãƒƒãƒ—ã€ã‚¹ã‚­ãƒ¼ãƒã€ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã€å¥‘ç´„ãªã©ã®çµ±åˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ¬ãƒ™ãƒ«ã®è¨­å®šã®ç®¡ç†ãŒå«ã¾ã‚Œã¾ã™ã€‚

{% code overflow="wrap" %}
```bash
az logic integration-account create \
--resource-group <resource_group_name> \
--name <integration_account_name> \
--location <location> \
--sku <Standard|Free> \
--state Enabled
```
{% endcode %}

### "Microsoft.Resources/subscriptions/resourcegroups/read" && "Microsoft.Logic/integrationAccounts/batchConfigurations/write"

ã“ã®æ¨©é™ã‚’æŒã¤ã“ã¨ã§ã€Azure Logic Appsã®çµ±åˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã§ãƒãƒƒãƒæ§‹æˆã‚’ä½œæˆã¾ãŸã¯å¤‰æ›´ã§ãã¾ã™ã€‚ãƒãƒƒãƒæ§‹æˆã¯ã€Logic AppsãŒãƒãƒƒãƒå‡¦ç†ã®ãŸã‚ã«å—ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã©ã®ã‚ˆã†ã«å‡¦ç†ã—ã€ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã™ã‚‹ã‹ã‚’å®šç¾©ã—ã¾ã™ã€‚

{% code overflow="wrap" %}
```bash
az logic integration-account batch-configuration create \
--resource-group <resource_group_name> \
--integration-account-name <integration_account_name> \
--name <batch_configuration_name> \
--release-criteria '{
"messageCount": 100,
"batchSize": 1048576,
}'
```
{% endcode %}

### "Microsoft.Resources/subscriptions/resourcegroups/read" && "Microsoft.Logic/integrationAccounts/maps/write"
ã“ã®æ¨©é™ã‚’æŒã¤ã“ã¨ã§ã€Azure Logic Appsã®çµ±åˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã§ãƒãƒƒãƒ—ã‚’ä½œæˆã¾ãŸã¯å¤‰æ›´ã§ãã¾ã™ã€‚ãƒãƒƒãƒ—ã¯ã€ç•°ãªã‚‹ã‚·ã‚¹ãƒ†ãƒ ã‚„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–“ã§ã®ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªçµ±åˆã‚’å¯èƒ½ã«ã™ã‚‹ãŸã‚ã«ã€ãƒ‡ãƒ¼ã‚¿ã‚’ã‚ã‚‹å½¢å¼ã‹ã‚‰åˆ¥ã®å½¢å¼ã«å¤‰æ›ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

{% code overflow="wrap" %}
```bash
az logic integration-account map create \
--resource-group <resource_group_name> \
--integration-account-name <integration_account_name> \
--name <map_name> \
--map-type <Xslt|Xslt20|Xslt30> \
--content-type application/xml \
--map-content map-content.xslt
```
{% endcode %}

### "Microsoft.Resources/subscriptions/resourcegroups/read" && "Microsoft.Logic/integrationAccounts/partners/write"
ã“ã®æ¨©é™ã‚’æŒã¤ã“ã¨ã§ã€Azure Logic Apps çµ±åˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã®ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚’ä½œæˆã¾ãŸã¯å¤‰æ›´ã§ãã¾ã™ã€‚ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã¯ã€ãƒ“ã‚¸ãƒã‚¹é–“ (B2B) ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«å‚åŠ ã™ã‚‹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¾ãŸã¯ã‚·ã‚¹ãƒ†ãƒ ã‚’è¡¨ã—ã¾ã™ã€‚

{% code overflow="wrap" %}
```bash
az logic integration-account partner create \
--resource-group <resource_group_name> \
--integration-account-name <integration_account_name> \
--name <partner_name> \
--partner-type <partner-type> \
--content '{
"b2b": {
"businessIdentities": [
{
"qualifier": "ZZ",
"value": "TradingPartner1"
}
]
}
}'
```
{% endcode %}

### "Microsoft.Resources/subscriptions/resourcegroups/read" && "Microsoft.Logic/integrationAccounts/sessions/write"
ã“ã®æ¨©é™ã‚’æŒã¤ã“ã¨ã§ã€Azure Logic Appsã®çµ±åˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆã¾ãŸã¯å¤‰æ›´ã§ãã¾ã™ã€‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯B2Bãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã€å®šç¾©ã•ã‚ŒãŸæœŸé–“ã«ã‚ãŸã‚‹é–¢é€£ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½è·¡ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

{% code overflow="wrap" %}
```bash
az logic integration-account session create \
--resource-group <resource_group_name> \
--integration-account-name <integration_account_name> \
--name <session_name> \
--content '{
"properties": {
"sessionId": "session123",
"data": {
"key1": "value1",
"key2": "value2"
}
}
}'
```
{% endcode %}

### "*/delete"
ã“ã®æ¨©é™ã‚’æŒã¤ã¨ã€Azure Logic Apps ã«é–¢é€£ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ã§ãã¾ã™ã€‚

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’é€ä¿¡ã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
