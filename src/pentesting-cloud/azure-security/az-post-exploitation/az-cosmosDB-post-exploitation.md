# Az - CosmosDB Post Exploitation

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## CosmosDB Post Exploitation
SQL Database hakkÄ±nda daha fazla bilgi iÃ§in kontrol edin:

{% content-ref url="../az-services/az-cosmosDB.md" %}
[az-cosmosDB.md](../az-services/az-cosmosDB.md)
{% endcontent-ref %}


### "Microsoft.DocumentDB/databaseAccounts/read" && "Microsoft.DocumentDB/databaseAccounts/write"
Bu izinle, Azure Cosmos DB hesaplarÄ± oluÅŸturabilir veya gÃ¼ncelleyebilirsiniz. Bu, hesap dÃ¼zeyindeki ayarlarÄ± deÄŸiÅŸtirmeyi, bÃ¶lgeleri eklemeyi veya kaldÄ±rmayÄ±, tutarlÄ±lÄ±k seviyelerini deÄŸiÅŸtirmeyi ve Ã§ok bÃ¶lgeli yazma gibi Ã¶zellikleri etkinleÅŸtirmeyi veya devre dÄ±ÅŸÄ± bÄ±rakmayÄ± iÃ§erir.

{% code overflow="wrap" %}
```bash
az cosmosdb update \
--name <account_name> \
--resource-group <resource_group_name> \
--public-network-access ENABLED
```
{% endcode %}

### "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/read" && "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/write"
Bu izinle, bir Azure Cosmos DB hesabÄ±nÄ±n SQL veritabanÄ± iÃ§inde konteynerleri (koleksiyonlarÄ±) oluÅŸturabilir veya deÄŸiÅŸtirebilirsiniz. Konteynerler verileri depolamak iÃ§in kullanÄ±lÄ±r ve bunlardaki deÄŸiÅŸiklikler veritabanÄ±nÄ±n yapÄ±sÄ±nÄ± ve eriÅŸim desenlerini etkileyebilir.

{% code overflow="wrap" %}
```bash
# Create
az cosmosdb sql container create \
--account-name <account_name> \
--resource-group <resource_group_name> \
--database-name <database_name> \
--name <container_name> \
--partition-key-path <partition_key_path>

#Update
az cosmosdb sql container update \
--account-name <account_name> \
--resource-group <resource_group_name> \
--database-name <database_name> \
--name <container_name> \
--ttl 3600
```
{% endcode %}

### "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/write" && "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/read"
Bu izinle, bir Azure Cosmos DB hesabÄ± iÃ§inde SQL veritabanlarÄ± oluÅŸturabilir veya deÄŸiÅŸtirebilirsiniz. Bu, veritabanÄ± yapÄ±sÄ±nÄ± yÃ¶netmeyi ve hesaba yeni veritabanlarÄ± eklemeyi saÄŸlar. Bu izin veritabanÄ± oluÅŸturmayÄ± saÄŸlasa da, uygunsuz veya yetkisiz kullanÄ±m gereksiz kaynak tÃ¼ketimine, artan maliyetlere veya operasyonel verimsizliklere yol aÃ§abilir.

{% code overflow="wrap" %}
```bash
az cosmosdb sql database create \
--account-name <account_name> \
--resource-group <resource_group_name> \
--name <database_name>
```
{% endcode %}

### "Microsoft.DocumentDB/databaseAccounts/failoverPriorityChange/action"

Bu izinle, bir Azure Cosmos DB veritabanÄ± hesabÄ± iÃ§in bÃ¶lgelerin failover Ã¶nceliÄŸini deÄŸiÅŸtirebilirsiniz. Bu eylem, bir failover olayÄ± sÄ±rasÄ±nda bÃ¶lgelerin Ã¶ncelikli hale gelme sÄ±rasÄ±nÄ± belirler. Bu iznin yanlÄ±ÅŸ kullanÄ±mÄ±, veritabanÄ±nÄ±n yÃ¼ksek kullanÄ±labilirliÄŸini bozabilir veya istenmeyen operasyonel etkilere yol aÃ§abilir.

{% code overflow="wrap" %}
```bash
az cosmosdb failover-priority-change \
--name <database_account_name> \
--resource-group <resource_group_name> \
--failover-policies <region1=priority1> <region2=priority2>

```
{% endcode %}

### "Microsoft.DocumentDB/databaseAccounts/regenerateKey/action"
Bu izinle, bir Azure Cosmos DB hesabÄ± iÃ§in birincil veya ikincil anahtarlarÄ± yeniden oluÅŸturabilirsiniz. Bu genellikle eski anahtarlarÄ± deÄŸiÅŸtirmek suretiyle gÃ¼venliÄŸi artÄ±rmak iÃ§in kullanÄ±lÄ±r, ancak mevcut anahtarlara baÄŸÄ±mlÄ± olan hizmetler veya uygulamalar iÃ§in eriÅŸimi kesintiye uÄŸratabilir.

{% code overflow="wrap" %}
```bash
az cosmosdb keys regenerate \
--name <account_name> \
--resource-group <resource_group_name> \
--key-kind <primary|secondary>

```
{% endcode %}

### "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/userDefinedFunctions/write" && "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/userDefinedFunctions/read"

Bu izinle, bir Azure Cosmos DB hesabÄ±ndaki SQL veritabanÄ± konteynerinde tetikleyiciler oluÅŸturabilir veya deÄŸiÅŸtirebilirsiniz. Tetikleyiciler, iÅŸlemlere yanÄ±t olarak sunucu tarafÄ± mantÄ±ÄŸÄ±nÄ± yÃ¼rÃ¼tmenizi saÄŸlar.

{% code overflow="wrap" %}
```bash
az cosmosdb sql trigger create \
--account-name <account_name> \
--resource-group <resource_group_name> \
--database-name <sql_database_name> \
--container-name <container_name> \
--name <trigger_name> \
--body 'function trigger() { var context = getContext(); var request = context.getRequest(); request.setBody("Triggered operation!"); }' \
--type Pre \
--operation All
```
{% endcode %}

### "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/storedProcedures/write" && "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/storedProcedures/read"
Bu izinle, bir Azure Cosmos DB hesabÄ±ndaki SQL veritabanÄ± konteynerinde saklanan prosedÃ¼rleri oluÅŸturabilir veya deÄŸiÅŸtirebilirsiniz. Cosmos DB'deki saklanan prosedÃ¼rler, verileri iÅŸlemek veya doÄŸrudan veritabanÄ± iÃ§inde iÅŸlemler gerÃ§ekleÅŸtirmek iÃ§in mantÄ±ÄŸÄ± kapsÃ¼llemenizi saÄŸlayan sunucu tarafÄ± JavaScript fonksiyonlarÄ±dÄ±r.

{% code overflow="wrap" %}
```bash
az cosmosdb sql stored-procedure create \
--account-name <account_name> \
--resource-group <resource_group_name> \
--database-name <sql_database_name> \
--container-name <container_name> \
--name <stored_procedure_name> \
--body 'function sample() { return "Hello, Cosmos!"; }'
```
{% endcode %}

### "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/triggers/write" && "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/triggers/read"
Bu izinle, bir Azure Cosmos DB hesabÄ±ndaki SQL veritabanÄ± konteynerinde tetikleyiciler oluÅŸturabilir veya deÄŸiÅŸtirebilirsiniz. Tetikleyiciler, ekleme, gÃ¼ncelleme veya silme gibi iÅŸlemlere yanÄ±t olarak sunucu tarafÄ± mantÄ±ÄŸÄ±nÄ± Ã§alÄ±ÅŸtÄ±rmanÄ±za olanak tanÄ±r.

{% code overflow="wrap" %}
```bash
az cosmosdb sql trigger create \
--account-name <account_name> \
--resource-group <resource_group_name> \
--database-name <sql_database_name> \
--container-name <container_name> \
--name <trigger_name> \
--body 'function trigger() { var context = getContext(); var request = context.getRequest(); request.setBody("Triggered operation!"); }' \
--type Pre \
--operation All
```
{% endcode %}

### "Microsoft.DocumentDB/databaseAccounts/mongodbDatabases/collections/read" && "Microsoft.DocumentDB/databaseAccounts/mongodbDatabases/collections/write"
Bu izinle, bir Azure Cosmos DB hesabÄ±ndaki MongoDB veritabanlarÄ±nda koleksiyonlar oluÅŸturabilir veya bunlarÄ± deÄŸiÅŸtirebilirsiniz. Koleksiyonlar, belgeleri depolamak ve veriler iÃ§in yapÄ± ve bÃ¶lÃ¼mlendirme tanÄ±mlamak iÃ§in kullanÄ±lÄ±r.

{% code overflow="wrap" %}
```bash
az cosmosdb mongodb collection create \
--account-name <account_name> \
--resource-group <resource_group_name> \
--database-name <mongodb_database_name> \
--name <collection_name>
```
{% endcode %}

### "Microsoft.DocumentDB/databaseAccounts/mongodbDatabases/write" && "Microsoft.DocumentDB/databaseAccounts/mongodbDatabases/read"
Bu izinle, bir Azure Cosmos DB hesabÄ± iÃ§inde yeni MongoDB veritabanlarÄ± oluÅŸturabilirsiniz. Bu, koleksiyonlarÄ± ve belgeleri depolamak ve yÃ¶netmek iÃ§in yeni veritabanlarÄ± saÄŸlamanÄ±za olanak tanÄ±r.

{% code overflow="wrap" %}
```bash
az cosmosdb mongodb database create \
--account-name <account_name> \
--resource-group <resource_group_name> \
--name <database_name>
```
{% endcode %}

### "Microsoft.DocumentDB/databaseAccounts/mongodbRoleDefinitions/write" && "Microsoft.DocumentDB/databaseAccounts/mongodbRoleDefinitions/read"
Bu izinle, bir Azure Cosmos DB hesabÄ±nda yeni MongoDB rol tanÄ±mlarÄ± oluÅŸturabilirsiniz. Bu, MongoDB kullanÄ±cÄ±larÄ± iÃ§in belirli izinlere sahip Ã¶zel roller tanÄ±mlamayÄ± saÄŸlar.

{% code overflow="wrap" %}
```bash
az cosmosdb mongodb role definition create \
--account-name <account_name> \
--resource-group <resource_group_name> \
--body '{
"Id": "<mydatabase>.readWriteRole",
"RoleName": "readWriteRole",
"Type": "CustomRole",
"DatabaseName": "<mydatabase>",
"Privileges": [
{
"Resource": {
"Db": "<mydatabase>",
"Collection": "mycollection"
},
"Actions": [
"insert",
"find",
"update"
]
}
],
"Roles": []
}'
```
{% endcode %}

### "Microsoft.DocumentDB/databaseAccounts/mongodbUserDefinitions/write" && "Microsoft.DocumentDB/databaseAccounts/mongodbUserDefinitions/read"
Bu izinle, bir Azure Cosmos DB hesabÄ± iÃ§inde yeni MongoDB kullanÄ±cÄ± tanÄ±mlarÄ± oluÅŸturabilirsiniz. Bu, MongoDB veritabanlarÄ±na belirli roller ve eriÅŸim seviyeleri ile kullanÄ±cÄ±larÄ±n saÄŸlanmasÄ±nÄ± mÃ¼mkÃ¼n kÄ±lar.
{% code overflow="wrap" %}
```bash
az cosmosdb mongodb user definition create \
--account-name <account_name> \
--resource-group <resource_group_name> \
--body '{
"Id": "<mydatabase>.myUser",
"UserName": "myUser",
"Password": "mySecurePassword",
"DatabaseName": "<mydatabase>",
"CustomData": "TestCustomData",
"Mechanisms": "SCRAM-SHA-256",
"Roles": [
{
"Role": "readWriteRole",
"Db": "<mydatabase>"
}
]
}'
```
{% endcode %}

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
