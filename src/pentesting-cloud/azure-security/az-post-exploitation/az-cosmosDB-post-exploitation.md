# Az - CosmosDB åæœŸåˆ©ç”¨

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## CosmosDB åæœŸåˆ©ç”¨
æœ‰å…³ SQL æ•°æ®åº“çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ï¼š

{% content-ref url="../az-services/az-cosmosDB.md" %}
[az-cosmosDB.md](../az-services/az-cosmosDB.md)
{% endcontent-ref %}


### "Microsoft.DocumentDB/databaseAccounts/read" && "Microsoft.DocumentDB/databaseAccounts/write"
æ‹¥æœ‰æ­¤æƒé™ï¼Œæ‚¨å¯ä»¥åˆ›å»ºæˆ–æ›´æ–° Azure Cosmos DB è´¦æˆ·ã€‚è¿™åŒ…æ‹¬ä¿®æ”¹è´¦æˆ·çº§è®¾ç½®ã€æ·»åŠ æˆ–åˆ é™¤åŒºåŸŸã€æ”¹å˜ä¸€è‡´æ€§çº§åˆ«ï¼Œä»¥åŠå¯ç”¨æˆ–ç¦ç”¨å¤šåŒºåŸŸå†™å…¥ç­‰åŠŸèƒ½ã€‚

{% code overflow="wrap" %}
```bash
az cosmosdb update \
--name <account_name> \
--resource-group <resource_group_name> \
--public-network-access ENABLED
```
{% endcode %}

### "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/read" && "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/write"
æ‹¥æœ‰æ­¤æƒé™ï¼Œæ‚¨å¯ä»¥åœ¨ Azure Cosmos DB å¸æˆ·çš„ SQL æ•°æ®åº“ä¸­åˆ›å»ºæˆ–ä¿®æ”¹å®¹å™¨ï¼ˆé›†åˆï¼‰ã€‚å®¹å™¨ç”¨äºå­˜å‚¨æ•°æ®ï¼Œå¯¹å®ƒä»¬çš„æ›´æ”¹å¯èƒ½ä¼šå½±å“æ•°æ®åº“çš„ç»“æ„å’Œè®¿é—®æ¨¡å¼ã€‚

{% code overflow="wrap" %}
```bash
# Create
az cosmosdb sql container create \
--account-name <account_name> \
--resource-group <resource_group_name> \
--database-name <database_name> \
--name <container_name> \
--partition-key-path <partition_key_path>

#Update
az cosmosdb sql container update \
--account-name <account_name> \
--resource-group <resource_group_name> \
--database-name <database_name> \
--name <container_name> \
--ttl 3600
```
{% endcode %}

### "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/write" && "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/read"
æ‹¥æœ‰æ­¤æƒé™ï¼Œæ‚¨å¯ä»¥åœ¨ Azure Cosmos DB å¸æˆ·ä¸­åˆ›å»ºæˆ–ä¿®æ”¹ SQL æ•°æ®åº“ã€‚è¿™å…è®¸ç®¡ç†æ•°æ®åº“ç»“æ„å¹¶å‘å¸æˆ·æ·»åŠ æ–°æ•°æ®åº“ã€‚è™½ç„¶æ­¤æƒé™å…è®¸åˆ›å»ºæ•°æ®åº“ï¼Œä½†ä¸å½“æˆ–æœªç»æˆæƒçš„ä½¿ç”¨å¯èƒ½å¯¼è‡´ä¸å¿…è¦çš„èµ„æºæ¶ˆè€—ã€æˆæœ¬å¢åŠ æˆ–æ“ä½œæ•ˆç‡ä½ä¸‹ã€‚

{% code overflow="wrap" %}
```bash
az cosmosdb sql database create \
--account-name <account_name> \
--resource-group <resource_group_name> \
--name <database_name>
```
{% endcode %}

### "Microsoft.DocumentDB/databaseAccounts/failoverPriorityChange/action"

é€šè¿‡æ­¤æƒé™ï¼Œæ‚¨å¯ä»¥æ›´æ”¹ Azure Cosmos DB æ•°æ®åº“å¸æˆ·çš„åŒºåŸŸæ•…éšœè½¬ç§»ä¼˜å…ˆçº§ã€‚æ­¤æ“ä½œç¡®å®šåœ¨æ•…éšœè½¬ç§»äº‹ä»¶ä¸­ï¼ŒåŒºåŸŸæˆä¸ºä¸»åŒºåŸŸçš„é¡ºåºã€‚é”™è¯¯ä½¿ç”¨æ­¤æƒé™å¯èƒ½ä¼šå¹²æ‰°æ•°æ®åº“çš„é«˜å¯ç”¨æ€§æˆ–å¯¼è‡´æ„å¤–çš„æ“ä½œå½±å“ã€‚

{% code overflow="wrap" %}
```bash
az cosmosdb failover-priority-change \
--name <database_account_name> \
--resource-group <resource_group_name> \
--failover-policies <region1=priority1> <region2=priority2>

```
{% endcode %}

### "Microsoft.DocumentDB/databaseAccounts/regenerateKey/action"
é€šè¿‡æ­¤æƒé™ï¼Œæ‚¨å¯ä»¥ä¸º Azure Cosmos DB å¸æˆ·é‡æ–°ç”Ÿæˆä¸»å¯†é’¥æˆ–è¾…åŠ©å¯†é’¥ã€‚è¿™é€šå¸¸ç”¨äºé€šè¿‡æ›¿æ¢æ—§å¯†é’¥æ¥å¢å¼ºå®‰å…¨æ€§ï¼Œä½†å¯èƒ½ä¼šå¹²æ‰°ä¾èµ–å½“å‰å¯†é’¥çš„æœåŠ¡æˆ–åº”ç”¨ç¨‹åºçš„è®¿é—®ã€‚

{% code overflow="wrap" %}
```bash
az cosmosdb keys regenerate \
--name <account_name> \
--resource-group <resource_group_name> \
--key-kind <primary|secondary>

```
{% endcode %}

### "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/userDefinedFunctions/write" && "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/userDefinedFunctions/read"

é€šè¿‡æ­¤æƒé™ï¼Œæ‚¨å¯ä»¥åœ¨ Azure Cosmos DB å¸æˆ·çš„ SQL æ•°æ®åº“å®¹å™¨ä¸­åˆ›å»ºæˆ–ä¿®æ”¹è§¦å‘å™¨ã€‚è§¦å‘å™¨å…è®¸æ‚¨åœ¨å“åº”æ“ä½œæ—¶æ‰§è¡ŒæœåŠ¡å™¨ç«¯é€»è¾‘ã€‚

{% code overflow="wrap" %}
```bash
az cosmosdb sql trigger create \
--account-name <account_name> \
--resource-group <resource_group_name> \
--database-name <sql_database_name> \
--container-name <container_name> \
--name <trigger_name> \
--body 'function trigger() { var context = getContext(); var request = context.getRequest(); request.setBody("Triggered operation!"); }' \
--type Pre \
--operation All
```
{% endcode %}

### "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/storedProcedures/write" && "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/storedProcedures/read"
é€šè¿‡æ­¤æƒé™ï¼Œæ‚¨å¯ä»¥åœ¨ Azure Cosmos DB å¸æˆ·çš„ SQL æ•°æ®åº“å®¹å™¨ä¸­åˆ›å»ºæˆ–ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹ã€‚Cosmos DB ä¸­çš„å­˜å‚¨è¿‡ç¨‹æ˜¯æœåŠ¡å™¨ç«¯çš„ JavaScript å‡½æ•°ï¼Œå…è®¸æ‚¨å°è£…å¤„ç†æ•°æ®æˆ–ç›´æ¥åœ¨æ•°æ®åº“ä¸­æ‰§è¡Œæ“ä½œçš„é€»è¾‘ã€‚

{% code overflow="wrap" %}
```bash
az cosmosdb sql stored-procedure create \
--account-name <account_name> \
--resource-group <resource_group_name> \
--database-name <sql_database_name> \
--container-name <container_name> \
--name <stored_procedure_name> \
--body 'function sample() { return "Hello, Cosmos!"; }'
```
{% endcode %}

### "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/triggers/write" && "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/triggers/read"
é€šè¿‡æ­¤æƒé™ï¼Œæ‚¨å¯ä»¥åœ¨ Azure Cosmos DB å¸æˆ·çš„ SQL æ•°æ®åº“å®¹å™¨ä¸­åˆ›å»ºæˆ–ä¿®æ”¹è§¦å‘å™¨ã€‚è§¦å‘å™¨å…è®¸æ‚¨åœ¨æ’å…¥ã€æ›´æ–°æˆ–åˆ é™¤ç­‰æ“ä½œå‘ç”Ÿæ—¶æ‰§è¡ŒæœåŠ¡å™¨ç«¯é€»è¾‘ã€‚

{% code overflow="wrap" %}
```bash
az cosmosdb sql trigger create \
--account-name <account_name> \
--resource-group <resource_group_name> \
--database-name <sql_database_name> \
--container-name <container_name> \
--name <trigger_name> \
--body 'function trigger() { var context = getContext(); var request = context.getRequest(); request.setBody("Triggered operation!"); }' \
--type Pre \
--operation All
```
{% endcode %}

### "Microsoft.DocumentDB/databaseAccounts/mongodbDatabases/collections/read" && "Microsoft.DocumentDB/databaseAccounts/mongodbDatabases/collections/write"
æ‹¥æœ‰æ­¤æƒé™ï¼Œæ‚¨å¯ä»¥åœ¨ Azure Cosmos DB å¸æˆ·ä¸­çš„ MongoDB æ•°æ®åº“å†…åˆ›å»ºæˆ–ä¿®æ”¹é›†åˆã€‚é›†åˆç”¨äºå­˜å‚¨æ–‡æ¡£å¹¶å®šä¹‰æ•°æ®çš„ç»“æ„å’Œåˆ†åŒºã€‚

{% code overflow="wrap" %}
```bash
az cosmosdb mongodb collection create \
--account-name <account_name> \
--resource-group <resource_group_name> \
--database-name <mongodb_database_name> \
--name <collection_name>
```
{% endcode %}

### "Microsoft.DocumentDB/databaseAccounts/mongodbDatabases/write" && "Microsoft.DocumentDB/databaseAccounts/mongodbDatabases/read"
æ‹¥æœ‰æ­¤æƒé™ï¼Œæ‚¨å¯ä»¥åœ¨ Azure Cosmos DB å¸æˆ·ä¸­åˆ›å»ºæ–°çš„ MongoDB æ•°æ®åº“ã€‚è¿™å…è®¸ä¸ºå­˜å‚¨å’Œç®¡ç†é›†åˆåŠæ–‡æ¡£è€Œé…ç½®æ–°çš„æ•°æ®åº“ã€‚

{% code overflow="wrap" %}
```bash
az cosmosdb mongodb database create \
--account-name <account_name> \
--resource-group <resource_group_name> \
--name <database_name>
```
{% endcode %}

### "Microsoft.DocumentDB/databaseAccounts/mongodbRoleDefinitions/write" && "Microsoft.DocumentDB/databaseAccounts/mongodbRoleDefinitions/read"
æ‹¥æœ‰æ­¤æƒé™ï¼Œæ‚¨å¯ä»¥åœ¨ Azure Cosmos DB å¸æˆ·ä¸­åˆ›å»ºæ–°çš„ MongoDB è§’è‰²å®šä¹‰ã€‚è¿™å…è®¸ä¸º MongoDB ç”¨æˆ·å®šä¹‰å…·æœ‰ç‰¹å®šæƒé™çš„è‡ªå®šä¹‰è§’è‰²ã€‚

{% code overflow="wrap" %}
```bash
az cosmosdb mongodb role definition create \
--account-name <account_name> \
--resource-group <resource_group_name> \
--body '{
"Id": "<mydatabase>.readWriteRole",
"RoleName": "readWriteRole",
"Type": "CustomRole",
"DatabaseName": "<mydatabase>",
"Privileges": [
{
"Resource": {
"Db": "<mydatabase>",
"Collection": "mycollection"
},
"Actions": [
"insert",
"find",
"update"
]
}
],
"Roles": []
}'
```
{% endcode %}

### "Microsoft.DocumentDB/databaseAccounts/mongodbUserDefinitions/write" && "Microsoft.DocumentDB/databaseAccounts/mongodbUserDefinitions/read"
æ‹¥æœ‰æ­¤æƒé™ï¼Œæ‚¨å¯ä»¥åœ¨ Azure Cosmos DB å¸æˆ·ä¸­åˆ›å»ºæ–°çš„ MongoDB ç”¨æˆ·å®šä¹‰ã€‚è¿™å…è®¸ä¸º MongoDB æ•°æ®åº“æä¾›å…·æœ‰ç‰¹å®šè§’è‰²å’Œè®¿é—®çº§åˆ«çš„ç”¨æˆ·ã€‚
{% code overflow="wrap" %}
```bash
az cosmosdb mongodb user definition create \
--account-name <account_name> \
--resource-group <resource_group_name> \
--body '{
"Id": "<mydatabase>.myUser",
"UserName": "myUser",
"Password": "mySecurePassword",
"DatabaseName": "<mydatabase>",
"CustomData": "TestCustomData",
"Mechanisms": "SCRAM-SHA-256",
"Roles": [
{
"Role": "readWriteRole",
"Db": "<mydatabase>"
}
]
}'
```
{% endcode %}

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
