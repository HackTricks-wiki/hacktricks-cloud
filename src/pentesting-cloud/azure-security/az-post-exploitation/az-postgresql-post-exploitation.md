# Az - PostgreSQL Post Exploitation

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**ë””ìŠ¤ì½”ë“œ ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}

## PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ í¬ìŠ¤íŠ¸ ìµìŠ¤í”Œë¡œì´í…Œì´ì…˜
PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="../az-services/az-postgresql.md" %}
[az-postgresql.md](../az-services/az-postgresql.md)
{% endcontent-ref %}

### "Microsoft.DBforPostgreSQL/flexibleServers/databases/write" && "Microsoft.DBforPostgreSQL/flexibleServers/databases/read"

ì´ ê¶Œí•œì„ ì‚¬ìš©í•˜ë©´ Azureì˜ Postgres Flexible Server ì¸ìŠ¤í„´ìŠ¤ ë‚´ì—ì„œ ìƒˆë¡œìš´ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì‘ì—… ìì²´ëŠ” ê¸°ì¡´ ë¦¬ì†ŒìŠ¤ë¥¼ ìˆ˜ì •í•˜ì§€ ì•Šì§€ë§Œ, ê³¼ë„í•˜ê±°ë‚˜ ë¬´ë‹¨ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒì„±í•˜ë©´ ë¦¬ì†ŒìŠ¤ ì†Œë¹„ ë˜ëŠ” ì„œë²„ì˜ ì ì¬ì  ì˜¤ìš©ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
az postgres flexible-server db create \
--server-name <server_name> \
--resource-group <resource_group_name> \
--database-name <database_name>
```
{% endcode %}

### "Microsoft.DBforPostgreSQL/flexibleServers/backups/write"

ì´ ê¶Œí•œì„ ì‚¬ìš©í•˜ë©´ Azureì—ì„œ Postgres Flexible Server ì¸ìŠ¤í„´ìŠ¤ì˜ ë°±ì—… ìƒì„±ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì‚¬ìš©ìëŠ” íŠ¹ì • ì‹œì ì— ë°ì´í„°ë¥¼ ë³´ì¡´í•˜ëŠ” ë° ìœ ìš©í•œ ì˜¨ë””ë§¨ë“œ ë°±ì—…ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
az postgres flexible-server backup create \
--name <server_name> \
--resource-group <resource_group_name>
--backup-name <backup_name>
```
{% endcode %}

### "Microsoft.DBforPostgreSQL/flexibleServers/advancedThreatProtectionSettings/write" && "Microsoft.DBforPostgreSQL/flexibleServers/advancedThreatProtectionSettings/read"

ì´ ê¶Œí•œì„ ì‚¬ìš©í•˜ë©´ Azureì˜ Postgres Flexible Server ì¸ìŠ¤í„´ìŠ¤ì— ëŒ€í•œ ê³ ê¸‰ ìœ„í˜‘ ë³´í˜¸(ATP) ì„¤ì •ì„ êµ¬ì„±í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë¹„ì •ìƒì ì¸ í™œë™ ë° ì ì¬ì  ìœ„í˜‘ì„ ê°ì§€í•˜ê³  ëŒ€ì‘í•˜ê¸° ìœ„í•´ ì„¤ê³„ëœ ë³´ì•ˆ ê¸°ëŠ¥ì„ í™œì„±í™”í•˜ê±°ë‚˜ ë¹„í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
az postgres flexible-server threat-protection-policy update \
--name <server_name> \
--resource-group <resource_group_name> \
--state <Enabled|Disabled>
```
{% endcode %}

### "Microsoft.DBforPostgreSQL/flexibleServers/firewallRules/write", "Microsoft.DBforPostgreSQL/flexibleServers/read" && "Microsoft.DBforPostgreSQL/flexibleServers/firewallRules/read"

ì´ ê¶Œí•œì„ ì‚¬ìš©í•˜ë©´ Azureì˜ Postgres Flexible Server ì¸ìŠ¤í„´ìŠ¤ì— ëŒ€í•œ ë°©í™”ë²½ ê·œì¹™ì„ ìƒì„±í•˜ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì–´ë–¤ IP ì£¼ì†Œ ë˜ëŠ” ë²”ìœ„ê°€ ì„œë²„ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê¶Œí•œì„ ë¬´ë‹¨ìœ¼ë¡œ ë˜ëŠ” ë¶€ì ì ˆí•˜ê²Œ ì‚¬ìš©í•˜ë©´ ì„œë²„ê°€ ì›ì¹˜ ì•Šê±°ë‚˜ ì•…ì˜ì ì¸ ì ‘ê·¼ì— ë…¸ì¶œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
# Create Rule
az postgres flexible-server firewall-rule create \
--name <server_name> \
--resource-group <resource_group_name> \
--rule-name <rule_name> \
--start-ip-address <start_ip> \
--end-ip-address <end_ip>

# Update Rule
az postgres flexible-server firewall-rule update \
--name <server_name> \
--resource-group <resource_group_name> \
--rule-name <rule_name> \
--start-ip-address <start_ip> \
--end-ip-address <end_ip>
```
{% endcode %}

### "Microsoft.DBforPostgreSQL/flexibleServers/configurations/write" && "Microsoft.DBforPostgreSQL/flexibleServers/configurations/read"

ì´ ê¶Œí•œì„ ì‚¬ìš©í•˜ë©´ Azureì—ì„œ Postgres Flexible Server ì¸ìŠ¤í„´ìŠ¤ì˜ êµ¬ì„± ì„¤ì •ì„ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì„±ëŠ¥ ì¡°ì •, ë³´ì•ˆ êµ¬ì„± ë˜ëŠ” ìš´ì˜ ì„¤ì •ê³¼ ê°™ì€ ì„œë²„ ë§¤ê°œë³€ìˆ˜ë¥¼ ì‚¬ìš©ì ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
az postgres flexible-server parameter set \
--resource-group <resource_group_name> \
--server-name <server_name> \
--name <parameter_name> \
--value <parameter_value>
```
{% endcode %}

### "Microsoft.DBforPostgreSQL/flexibleServers/stop/action"

ì´ ê¶Œí•œì„ ì‚¬ìš©í•˜ë©´ Azureì—ì„œ PostgreSQL Flexible Server ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¤‘ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„œë²„ë¥¼ ì¤‘ì§€í•˜ë©´ ë°ì´í„°ë² ì´ìŠ¤ì— ì˜ì¡´í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ì‚¬ìš©ìì—ê²Œ ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ì¼ì‹œì ì¸ ì„œë¹„ìŠ¤ ì¤‘ë‹¨ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
az postgres flexible-server stop \
--name <server_name> \
--resource-group <resource_group_name>
```
{% endcode %}

### "Microsoft.DBforPostgreSQL/flexibleServers/start/action"
With this permission, you can start a stopped PostgreSQL Flexible Server instance on Azure. Starting a server restores its availability, enabling applications and users to reconnect and access the database.

{% code overflow="wrap" %}
```bash
az postgres flexible-server start \
--name <server_name> \
--resource-group <resource_group_name>
```
{% endcode %}

### "Microsoft.DBforPostgreSQL/flexibleServers/read", "Microsoft.DBforPostgreSQL/flexibleServers/write" && "Microsoft.ManagedIdentity/userAssignedIdentities/assign/action"

With this permission, you can assign a user-assigned managed identity to postgres flexible servers.

{% code overflow="wrap" %}
```bash
az postgres flexible-server identity assign \
--resource-group <ResourceGroupName> \
--server-name <ServerName> \
--identity <IdentityName>
```
{% endcode %}

### "*/delete"
With this permissions you can delete resources related to postgres server in Azure such as server, firewalls, managed identities or configurations


{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
