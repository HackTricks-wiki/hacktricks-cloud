# Az - MySQL 后期利用

{{#include ../../../banners/hacktricks-training.md}}

## MySQL 数据库后期利用
有关 MySQL 数据库的更多信息，请查看：

{% content-ref url="../az-services/az-mysql.md" %}
[az-mysql.md](../az-services/az-mysql.md)
{% endcontent-ref %}

### "Microsoft.DBforMySQL/flexibleServers/databases/write" && "Microsoft.DBforMySQL/flexibleServers/databases/read"

拥有此权限后，您可以在 Azure 的 MySQL Flexible Server 实例中创建新数据库。虽然此操作本身不会修改现有资源，但过度或未经授权的数据库创建可能会导致资源消耗或服务器的潜在滥用。

{% code overflow="wrap" %}
```bash
az mysql flexible-server db create \
--server-name <server_name> \
--resource-group <resource_group_name> \
--database-name <database_name>
```
{% endcode %}

### "Microsoft.DBforMySQL/flexibleServers/backups/write"

拥有此权限，您可以在 Azure 上为 MySQL Flexible Server 实例启动备份的创建。这使用户能够生成按需备份，这对于在特定时间点保存数据非常有用。

{% code overflow="wrap" %}
```bash
az mysql flexible-server backup create \
--name <server_name> \
--resource-group <resource_group_name>
--backup-name <backup_name>
```
{% endcode %}

### "Microsoft.DBforMySQL/flexibleServers/advancedThreatProtectionSettings/write"

通过此权限，您可以配置或更新 Azure 上 MySQL Flexible Server 实例的高级威胁保护 (ATP) 设置。这允许启用或禁用旨在检测和响应异常活动及潜在威胁的安全功能。

{% code overflow="wrap" %}
```bash
az mysql flexible-server threat-protection-policy update \
--name <server_name> \
--resource-group <resource_group_name> \
--state <Enabled|Disabled>
```
{% endcode %}

### "Microsoft.DBforMySQL/flexibleServers/firewallRules/write"

通过此权限，您可以为 Azure 上的 MySQL Flexible Server 实例创建或修改防火墙规则。这允许控制哪些 IP 地址或范围可以访问服务器。未经授权或不当使用此权限可能会使服务器暴露于不必要或恶意的访问。

{% code overflow="wrap" %}
```bash
# Create Rule
az mysql flexible-server firewall-rule create \
--name <server_name> \
--resource-group <resource_group_name> \
--rule-name <rule_name> \
--start-ip-address <start_ip> \
--end-ip-address <end_ip>

# Update Rule
az mysql flexible-server firewall-rule update \
--name <server_name> \
--resource-group <resource_group_name> \
--rule-name <rule_name> \
--start-ip-address <start_ip> \
--end-ip-address <end_ip>
```
{% endcode %}

### "Microsoft.DBforMySQL/flexibleServers/resetGtid/action"

拥有此权限，您可以重置 Azure 上 MySQL Flexible Server 实例的 GTID（全局事务标识符）。重置 GTID 将使所有在重置操作之前进行的自动备份、按需备份和地理备份失效。GTID 重置后，如果所选恢复时间在 GTID 重置时间之前，您将无法使用最快恢复点或自定义恢复点执行 PITR（时间点恢复）。成功的地理恢复仅在 5 天后才可能进行。

{% code overflow="wrap" %}
```bash
az mysql flexible-server reset-gtid \
--name  \
--resource-group <resource_group_name> \
--gtid-set <gtid>
```
{% endcode %}

### "Microsoft.DBforMySQL/flexibleServers/updateConfigurations/action"

通过此权限，您可以更新 Azure 上 MySQL Flexible Server 实例的配置设置。这允许自定义服务器参数，例如性能调优、安全配置或操作设置。您可以批量更新以下参数：audit_log_enabled, audit_log_events, binlog_expire_logs_seconds, binlog_row_image, character_set_server, collation_server, connect_timeout, enforce_gtid_consistency, gtid_mode, init_connect, innodb_buffer_pool_size, innodb_io_capacity, innodb_io_capacity_max, innodb_purge_threads, innodb_read_io_threads, innodb_thread_concurrency, innodb_write_io_threads, long_query_time, max_connect_errors 和 max_connections。

{% code overflow="wrap" %}
```bash
az mysql flexible-server parameter set-batch \
--resource-group <resource_group_name> \
--server-name <server_name> \
--args max_connections=<value>
```
{% endcode %}

### "Microsoft.DBforMySQL/flexibleServers/read", "Microsoft.DBforMySQL/flexibleServers/write" && "Microsoft.ManagedIdentity/userAssignedIdentities/assign/action"

通过此权限，您可以将用户分配的托管身份分配给 MySQL 灵活服务器。

{% code overflow="wrap" %}
```bash
az mysql flexible-server identity assign \
--resource-group <ResourceGroupName> \
--server-name <ServerName> \
--identity <IdentityName>
```
{% endcode %}

### "Microsoft.DBforMySQL/flexibleServers/stop/action"

拥有此权限，您可以停止 Azure 上的 PostgreSQL Flexible Server 实例。停止服务器可能会导致临时服务中断，影响依赖于数据库的应用程序和用户。

{% code overflow="wrap" %}
```bash
az mysql flexible-server stop \
--name <server_name> \
--resource-group <resource_group_name>
```
{% endcode %}

### "Microsoft.DBforMySQL/flexibleServers/start/action"
With this permission, you can start a stopped PostgreSQL Flexible Server instance on Azure. Starting a server restores its availability, enabling applications and users to reconnect and access the database.

{% code overflow="wrap" %}
```bash
az mysql flexible-server start \
--name <server_name> \
--resource-group <resource_group_name>
```
{% endcode %}

### "*/delete"

With this permissions you can delete resources related to mysql server in Azure such as server, firewalls, managed identities or configurations

{{#include ../../../banners/hacktricks-training.md}}
