# Az - VMs & Network Post Exploitation

{{#include ../../../banners/hacktricks-training.md}}

## VMs & Network

Kwa maelezo zaidi kuhusu Azure VMs na mitandao angalia ukurasa ufuatao:

{{#ref}}
../az-services/vms/
{{#endref}}

### VM Application Pivoting

Programu za VM zinaweza kushirikiwa na usajili na wapangaji wengine. Ikiwa programu inashirikiwa, huenda ni kwa sababu inatumika. Hivyo, ikiwa mshambuliaji anafanikiwa **kuharibu programu na kupakia toleo lililo na backdoor** inaweza kuwa inawezekana kwamba itatekelezwa **katika mpangaji au usajili mwingine**.

### Taarifa nyeti katika picha

Inaweza kuwa inawezekana kupata **taarifa nyeti ndani ya picha** zilizochukuliwa kutoka kwa VMs katika siku za nyuma.

1. **Orodhesha picha** kutoka kwenye maktaba
```bash
# Get galleries
az sig list -o table

# List images inside gallery
az sig image-definition list \
--resource-group <RESOURCE_GROUP> \
--gallery-name <GALLERY_NAME> \
-o table

# Get images versions
az sig image-version list \
--resource-group <RESOURCE_GROUP> \
--gallery-name <GALLERY_NAME> \
--gallery-image-definition <IMAGE_DEFINITION> \
-o table
```
2. **Orodha ya picha za kawaida**
```bash
az image list -o table
```
3. **Unda VM kutoka picha ID** na tafuta taarifa nyeti ndani yake
```bash
# Create VM from image
az vm create \
--resource-group <RESOURCE_GROUP> \
--name <VM_NAME> \
--image /subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP>/providers/Microsoft.Compute/galleries/<GALLERY_NAME>/images/<IMAGE_DEFINITION>/versions/<IMAGE_VERSION> \
--admin-username <ADMIN_USERNAME> \
--generate-ssh-keys
```
### Taarifa nyeti katika maeneo ya kurejesha

Inaweza kuwa inawezekana kupata **taarifa nyeti ndani ya maeneo ya kurejesha**.

1. **Orodhesha maeneo ya kurejesha**
```bash
az restore-point list \
--resource-group <RESOURCE_GROUP> \
--restore-point-collection-name <COLLECTION_NAME> \
-o table
```
2. **Unda diski** kutoka kwa nukta ya kurejesha
```bash
az disk create \
--resource-group <RESOURCE_GROUP> \
--name <NEW_DISK_NAME> \
--source /subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP>/providers/Microsoft.Compute/restorePointCollections/<COLLECTION_NAME>/restorePoints/<RESTORE_POINT_NAME>
```
3. **Unganisha diski kwa VM** (mshambuliaji anahitaji kuwa amepata udhibiti wa VM ndani ya akaunti tayari)
```bash
az vm disk attach \
--resource-group <RESOURCE_GROUP> \
--vm-name <VM_NAME> \
--name <DISK_NAME>
```
4. **Panda** diski na **tafuta taarifa nyeti**

{{#tabs }}
{{#tab name="Linux" }}
```bash
# List all available disks
sudo fdisk -l

# Check disk format
sudo file -s /dev/sdX

# Mount it
sudo mkdir /mnt/mydisk
sudo mount /dev/sdX1 /mnt/mydisk
```
{{#endtab }}

{{#tab name="Windows" }}

#### **1. Fungua Usimamizi wa Diski**

1. Bonyeza kulia **Kuanza** na uchague **Usimamizi wa Diski**.
2. Diski iliyoambatanishwa inapaswa kuonekana kama **Offline** au **Isiyopangwa**.

#### **2. Leta Diski Mtandaoni**

1. Tafuta diski kwenye sehemu ya chini.
2. Bonyeza kulia diski (mfano, **Disk 1**) na uchague **Mtandaoni**.

#### **3. Anzisha Diski**

1. Ikiwa diski haijaanzishwa, bonyeza kulia na uchague **Anzisha Diski**.
2. Chagua mtindo wa sehemu:
- **MBR** (Master Boot Record) au **GPT** (GUID Partition Table). GPT inapendekezwa kwa mifumo ya kisasa.

#### **4. Unda Hifadhi Mpya**

1. Bonyeza kulia kwenye nafasi isiyopangwa kwenye diski na uchague **Hifadhi Mpya Rahisi**.
2. Fuata msaidizi ili:
- Kuweka herufi ya diski (mfano, `D:`).
- Fanya muundo wa diski (chagua NTFS kwa kesi nyingi).
{{#endtab }}
{{#endtabs }}

### Taarifa nyeti kwenye diski & picha za snapshot

Inaweza kuwa inawezekana kupata **taarifa nyeti ndani ya diski au hata picha za snapshot za zamani za diski**.

1. **Orodhesha picha za snapshot**
```bash
az snapshot list \
--resource-group <RESOURCE_GROUP> \
-o table
```
2. **Unda diski kutoka kwa picha** (ikiwa inahitajika)
```bash
az disk create \
--resource-group <RESOURCE_GROUP> \
--name <DISK_NAME> \
--source <SNAPSHOT_ID> \
--size-gb <DISK_SIZE>
```
3. **Unganisha na kuunganisha diski** kwa VM na kutafuta taarifa nyeti (angalia sehemu iliyopita kuona jinsi ya kufanya hivyo)

### Taarifa nyeti katika VM Extensions & VM Applications

Inaweza kuwa inawezekana kupata **taarifa nyeti ndani ya VM extensions na VM applications**.

1. **Orodhesha programu zote za VM**
```bash
## List all VM applications inside a gallery
az sig gallery-application list --gallery-name <gallery-name> --resource-group <res-group> --output table
```
2. Sakinisha kiendelezi kwenye VM na **tafuta taarifa nyeti**
```bash
az vm application set \
--resource-group <rsc-group> \
--name <vm-name> \
--app-version-ids /subscriptions/9291ff6e-6afb-430e-82a4-6f04b2d05c7f/resourceGroups/Resource_Group_1/providers/Microsoft.Compute/galleries/myGallery/applications/myReverseShellApp/versions/1.0.2 \
--treat-deployment-as-failure true
```
{{#include ../../../banners/hacktricks-training.md}}
