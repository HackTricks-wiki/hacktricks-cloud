# Az - VMs & Network Post Exploitation

{{#include ../../../banners/hacktricks-training.md}}

## VMs & Network

Azure VMs ve ağlar hakkında daha fazla bilgi için aşağıdaki sayfayı kontrol edin:

{{#ref}}
../az-services/vms/
{{#endref}}

### VM Uygulama Pivotlama

VM uygulamaları diğer abonelikler ve kiracılar ile paylaşılabilir. Bir uygulama paylaşılıyorsa, muhtemelen kullanıldığı içindir. Bu nedenle, saldırgan **uygulamayı ele geçirip arka kapılı** bir versiyonunu yüklemeyi başarırsa, bu versiyonun **başka bir kiracı veya abonelikte çalıştırılması** mümkün olabilir.

### Görsellerdeki hassas bilgiler

Geçmişteki VMs'den alınan **görsellerin içinde hassas bilgiler** bulmak mümkün olabilir.

1. **Galeri**'lerden görselleri listele
```bash
# Get galleries
az sig list -o table

# List images inside gallery
az sig image-definition list \
--resource-group <RESOURCE_GROUP> \
--gallery-name <GALLERY_NAME> \
-o table

# Get images versions
az sig image-version list \
--resource-group <RESOURCE_GROUP> \
--gallery-name <GALLERY_NAME> \
--gallery-image-definition <IMAGE_DEFINITION> \
-o table
```
2. **Özel görüntüleri listele**
```bash
az image list -o table
```
3. **Görüntü ID'sinden VM oluşturun** ve içinde hassas bilgileri arayın
```bash
# Create VM from image
az vm create \
--resource-group <RESOURCE_GROUP> \
--name <VM_NAME> \
--image /subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP>/providers/Microsoft.Compute/galleries/<GALLERY_NAME>/images/<IMAGE_DEFINITION>/versions/<IMAGE_VERSION> \
--admin-username <ADMIN_USERNAME> \
--generate-ssh-keys
```
### Restore noktalarında hassas bilgiler

**Restore noktalarında hassas bilgilerin** bulunması mümkün olabilir.

1. **Restore noktalarını listele**
```bash
az restore-point list \
--resource-group <RESOURCE_GROUP> \
--restore-point-collection-name <COLLECTION_NAME> \
-o table
```
2. **Bir disk oluşturun** bir geri yükleme noktasından
```bash
az disk create \
--resource-group <RESOURCE_GROUP> \
--name <NEW_DISK_NAME> \
--source /subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP>/providers/Microsoft.Compute/restorePointCollections/<COLLECTION_NAME>/restorePoints/<RESTORE_POINT_NAME>
```
3. **Bir diski bir VM'ye ekle** (saldırganın zaten hesap içindeki bir VM'yi ele geçirmiş olması gerekir)
```bash
az vm disk attach \
--resource-group <RESOURCE_GROUP> \
--vm-name <VM_NAME> \
--name <DISK_NAME>
```
4. **Disk'i bağlayın** ve **hassas bilgileri arayın**

{{#tabs }}
{{#tab name="Linux" }}
```bash
# List all available disks
sudo fdisk -l

# Check disk format
sudo file -s /dev/sdX

# Mount it
sudo mkdir /mnt/mydisk
sudo mount /dev/sdX1 /mnt/mydisk
```
{{#endtab }}

{{#tab name="Windows" }}

#### **1. Disk Yönetimini Açın**

1. **Başlat**'a sağ tıklayın ve **Disk Yönetimi**'ni seçin.
2. Bağlı disk **Çevrimdışı** veya **Ayrılmamış** olarak görünmelidir.

#### **2. Diski Çevrimiçi Yapın**

1. Alt pencerede diski bulun.
2. Diske sağ tıklayın (örneğin, **Disk 1**) ve **Çevrimiçi**'yi seçin.

#### **3. Diski Başlatın**

1. Disk başlatılmamışsa, sağ tıklayın ve **Diski Başlat**'ı seçin.
2. Bölüm stilini seçin:
- **MBR** (Master Boot Record) veya **GPT** (GUID Partition Table). Modern sistemler için GPT önerilir.

#### **4. Yeni Bir Birim Oluşturun**

1. Diskteki ayrılmamış alana sağ tıklayın ve **Yeni Basit Birim**'i seçin.
2. Sihirbazı takip edin:
- Bir sürücü harfi atayın (örneğin, `D:`).
- Diski biçimlendirin (çoğu durumda NTFS seçin).
{{#endtab }}
{{#endtabs }}

### Disklerde ve anlık görüntülerde hassas bilgiler

**Disklerde veya hatta eski disk anlık görüntülerinde hassas bilgilerin bulunması mümkün olabilir**.

1. **Anlık görüntüleri listeleyin**
```bash
az snapshot list \
--resource-group <RESOURCE_GROUP> \
-o table
```
2. **Anlık görüntüden disk oluştur** (gerekirse)
```bash
az disk create \
--resource-group <RESOURCE_GROUP> \
--name <DISK_NAME> \
--source <SNAPSHOT_ID> \
--size-gb <DISK_SIZE>
```
3. **Bir diski bir VM'ye ekleyin ve bağlayın** ve hassas bilgileri arayın (bunu nasıl yapacağınızı görmek için önceki bölüme bakın)

### VM Uzantıları ve VM Uygulamalarında Hassas Bilgiler

**VM uzantıları ve VM uygulamaları içinde hassas bilgilerin** bulunması mümkün olabilir.

1. **Tüm VM uygulamalarını listeleyin**
```bash
## List all VM applications inside a gallery
az sig gallery-application list --gallery-name <gallery-name> --resource-group <res-group> --output table
```
2. Bir VM'de uzantıyı yükleyin ve **hassas bilgileri arayın**
```bash
az vm application set \
--resource-group <rsc-group> \
--name <vm-name> \
--app-version-ids /subscriptions/9291ff6e-6afb-430e-82a4-6f04b2d05c7f/resourceGroups/Resource_Group_1/providers/Microsoft.Compute/galleries/myGallery/applications/myReverseShellApp/versions/1.0.2 \
--treat-deployment-as-failure true
```
{{#include ../../../banners/hacktricks-training.md}}
