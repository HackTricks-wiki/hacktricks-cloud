# Az - VMs & Network Post Exploitation

{{#include ../../../banners/hacktricks-training.md}}

## VMs & Network

Azure VMs और नेटवर्किंग के बारे में अधिक जानकारी के लिए निम्नलिखित पृष्ठ देखें:

{{#ref}}
../az-services/vms/
{{#endref}}

### VM Application Pivoting

VM एप्लिकेशन अन्य सब्सक्रिप्शन और टेनेंट के साथ साझा किए जा सकते हैं। यदि कोई एप्लिकेशन साझा किया जा रहा है, तो शायद इसका उपयोग किया जा रहा है। इसलिए यदि हमलावर **एप्लिकेशन को समझौता करता है और एक बैकडोर संस्करण अपलोड करता है**, तो यह संभव है कि इसे **दूसरे टेनेंट या सब्सक्रिप्शन में निष्पादित किया जाएगा**।

### Sensitive information in images

यह संभव है कि **अतीत में VMs से ली गई छवियों के अंदर संवेदनशील जानकारी** मिल सके।

1. **गैलरी से छवियों की सूची**
```bash
# Get galleries
az sig list -o table

# List images inside gallery
az sig image-definition list \
--resource-group <RESOURCE_GROUP> \
--gallery-name <GALLERY_NAME> \
-o table

# Get images versions
az sig image-version list \
--resource-group <RESOURCE_GROUP> \
--gallery-name <GALLERY_NAME> \
--gallery-image-definition <IMAGE_DEFINITION> \
-o table
```
2. **कस्टम इमेज़ की सूची बनाएं**
```bash
az image list -o table
```
3. **इमेज आईडी से VM बनाएं** और इसके अंदर संवेदनशील जानकारी के लिए खोजें
```bash
# Create VM from image
az vm create \
--resource-group <RESOURCE_GROUP> \
--name <VM_NAME> \
--image /subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP>/providers/Microsoft.Compute/galleries/<GALLERY_NAME>/images/<IMAGE_DEFINITION>/versions/<IMAGE_VERSION> \
--admin-username <ADMIN_USERNAME> \
--generate-ssh-keys
```
### पुनर्स्थापना बिंदुओं में संवेदनशील जानकारी

यह संभव है कि **पुनर्स्थापना बिंदुओं के अंदर संवेदनशील जानकारी** मिल सके।

1. **पुनर्स्थापना बिंदुओं की सूची बनाएं**
```bash
az restore-point list \
--resource-group <RESOURCE_GROUP> \
--restore-point-collection-name <COLLECTION_NAME> \
-o table
```
2. **एक डिस्क बनाएं** एक पुनर्स्थापना बिंदु से
```bash
az disk create \
--resource-group <RESOURCE_GROUP> \
--name <NEW_DISK_NAME> \
--source /subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP>/providers/Microsoft.Compute/restorePointCollections/<COLLECTION_NAME>/restorePoints/<RESTORE_POINT_NAME>
```
3. **एक VM से डिस्क को संलग्न करें** (हमलावर को पहले से ही खाते के अंदर एक VM को समझौता करना होगा)
```bash
az vm disk attach \
--resource-group <RESOURCE_GROUP> \
--vm-name <VM_NAME> \
--name <DISK_NAME>
```
4. **डिस्क को माउंट करें** और **संवेदनशील जानकारी के लिए खोजें**

{{#tabs }}
{{#tab name="Linux" }}
```bash
# List all available disks
sudo fdisk -l

# Check disk format
sudo file -s /dev/sdX

# Mount it
sudo mkdir /mnt/mydisk
sudo mount /dev/sdX1 /mnt/mydisk
```
{{#endtab }}

{{#tab name="Windows" }}

#### **1. डिस्क प्रबंधन खोलें**

1. **स्टार्ट** पर राइट-क्लिक करें और **डिस्क प्रबंधन** चुनें।
2. संलग्न डिस्क **ऑफलाइन** या **अनआवंटित** के रूप में दिखाई देनी चाहिए।

#### **2. डिस्क को ऑनलाइन लाएं**

1. नीचे के पैन में डिस्क को खोजें।
2. डिस्क (जैसे, **डिस्क 1**) पर राइट-क्लिक करें और **ऑनलाइन** चुनें।

#### **3. डिस्क को प्रारंभ करें**

1. यदि डिस्क प्रारंभ नहीं की गई है, तो राइट-क्लिक करें और **डिस्क प्रारंभ करें** चुनें।
2. विभाजन शैली चुनें:
- **MBR** (मास्टर बूट रिकॉर्ड) या **GPT** (GUID विभाजन तालिका)। आधुनिक सिस्टम के लिए GPT की सिफारिश की जाती है।

#### **4. एक नया वॉल्यूम बनाएं**

1. डिस्क पर अनआवंटित स्थान पर राइट-क्लिक करें और **नया साधारण वॉल्यूम** चुनें।
2. विज़ार्ड का पालन करें:
- एक ड्राइव लेटर असाइन करें (जैसे, `D:`)।
- डिस्क को फॉर्मेट करें (अधिकतर मामलों में NTFS चुनें)।
{{#endtab }}
{{#endtabs }}

### डिस्क और स्नैपशॉट में संवेदनशील जानकारी

यह संभव है कि **डिस्क या यहां तक कि पुराने डिस्क के स्नैपशॉट में संवेदनशील जानकारी मिल सके**।

1. **स्नैपशॉट की सूची**
```bash
az snapshot list \
--resource-group <RESOURCE_GROUP> \
-o table
```
2. **Snapshot से डिस्क बनाएं** (यदि आवश्यक हो)
```bash
az disk create \
--resource-group <RESOURCE_GROUP> \
--name <DISK_NAME> \
--source <SNAPSHOT_ID> \
--size-gb <DISK_SIZE>
```
3. **डिस्क को एक VM से जोड़ें और माउंट करें** और संवेदनशील जानकारी के लिए खोजें (यह करने के लिए पिछले अनुभाग को देखें)

### VM एक्सटेंशन और VM एप्लिकेशन में संवेदनशील जानकारी

यह संभव है कि **VM एक्सटेंशन और VM एप्लिकेशन के अंदर संवेदनशील जानकारी मिल सके**।

1. **सभी VM ऐप्स की सूची बनाएं**
```bash
## List all VM applications inside a gallery
az sig gallery-application list --gallery-name <gallery-name> --resource-group <res-group> --output table
```
2. एक VM में एक्सटेंशन इंस्टॉल करें और **संवेदनशील जानकारी** के लिए खोजें
```bash
az vm application set \
--resource-group <rsc-group> \
--name <vm-name> \
--app-version-ids /subscriptions/9291ff6e-6afb-430e-82a4-6f04b2d05c7f/resourceGroups/Resource_Group_1/providers/Microsoft.Compute/galleries/myGallery/applications/myReverseShellApp/versions/1.0.2 \
--treat-deployment-as-failure true
```
{{#include ../../../banners/hacktricks-training.md}}
