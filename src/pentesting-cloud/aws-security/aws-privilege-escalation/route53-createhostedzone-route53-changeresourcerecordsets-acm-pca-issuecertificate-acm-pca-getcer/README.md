# AWS - Route53 Privesc

{{#include ../../../../banners/hacktricks-training.md}}

Kwa taarifa zaidi kuhusu Route53 angalia:

{{#ref}}
../../aws-services/aws-route53-enum.md
{{#endref}}

### `route53:CreateHostedZone`, `route53:ChangeResourceRecordSets`, `acm-pca:IssueCertificate`, `acm-pca:GetCertificate`

> [!NOTE]
> Ili kufanya shambulio hili akaunti lengwa lazima tayari iwe na [**AWS Certificate Manager Private Certificate Authority**](https://aws.amazon.com/certificate-manager/private-certificate-authority/) **(AWS-PCA)** imewekwa ndani ya akaunti, na instances za EC2 katika VPC(s) lazima tayari ziwe zimeingiza vyeti ili kuiamini. Ukiwa na miundombinu hii, shambulio lifuatalo linaweza kufanywa kuingilia kati trafiki ya AWS API.

Ruhusa nyingine **zinapendekezwa lakini hazihitajiki kwa sehemu ya enumeration**: `route53:GetHostedZone`, `route53:ListHostedZones`, `acm-pca:ListCertificateAuthorities`, `ec2:DescribeVpcs`

Kwa kuzingatia kuna AWS VPC yenye applications nyingi za cloud-native zikizungumza miongoni mwao na na AWS API. Kwa kuwa mawasiliano kati ya microservices mara nyingi yamefichwa kwa TLS, lazima kuwe na private CA itakayetoa vyeti halali kwa huduma hizo. **Ikiwa ACM-PCA imetumika** kwa hilo na mshambuliaji anafanikiwa kupata **access to control both route53 and acm-pca private CA** kwa seti ndogo ya ruhusa zilizoelezewa hapo juu, anaweza **hijack the application calls to AWS API** na kuichukua IAM permissions zao.

Hii inawezekana kwa sababu:

- AWS SDKs hazina Certificate Pinning
- Route53 inaruhusu kuunda Private Hosted Zone na DNS records kwa domain names za AWS APIs
- Private CA katika ACM-PCA haiwezi kuwekewa mipaka ya kusaini vyeti tu kwa Common Names maalum

**Potential Impact:** Privesc isiyo ya moja kwa moja kwa kuingilia kati taarifa nyeti katika trafiki.

#### Utekelezaji <a href="#discovery" id="discovery"></a>

Pata hatua za utekelezaji katika utafiti wa asili: [**https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/**](https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/)

{{#include ../../../../banners/hacktricks-training.md}}
