# AWS - Route53 Privesc

{{#include ../../../../banners/hacktricks-training.md}}

Vir meer inligting oor Route53 kyk:

{{#ref}}
../../aws-services/aws-route53-enum.md
{{#endref}}

### `route53:CreateHostedZone`, `route53:ChangeResourceRecordSets`, `acm-pca:IssueCertificate`, `acm-pca:GetCertificate`

> [!NOTE]
> Om hierdie aanval uit te voer moet die teikenrekening reeds 'n [**AWS Certificate Manager Private Certificate Authority**](https://aws.amazon.com/certificate-manager/private-certificate-authority/) **(AWS-PCA)** opgestel hê in die rekening, en EC2-instanties in die VPC(s) moet reeds die sertifikate ingevoer hê om dit te vertrou. Met hierdie infrastruktuur in plek kan die volgende aanval uitgevoer word om AWS API-verkeer te onderskep.

Ander toestemmings wat aanbeveel word maar nie vereis is vir die enumerasie-deel nie: `route53:GetHostedZone`, `route53:ListHostedZones`, `acm-pca:ListCertificateAuthorities`, `ec2:DescribeVpcs`

Aangesien die kommunikasie tussen die microdienste dikwels met TLS versleuteld is, moet daar 'n private CA wees om geldige sertifikate vir daardie dienste uit te reik. **If ACM-PCA is used** daarvoor en die teenstander slaag daarin om **toegang te kry om beide route53 en die acm-pca private CA te beheer** met die minimum stel permissies hierbo beskryf, kan hy **die toepassingsoproepe na die AWS API kaapseer** en hul IAM-permissies oorneem.

Dit is moontlik omdat:

- AWS SDKs het nie [Certificate Pinning](https://www.digicert.com/blog/certificate-pinning-what-is-certificate-pinning) nie
- Route53 laat toe om Private Hosted Zone en DNS-rekords vir AWS APIs domeinnames te skep
- Private CA in ACM-PCA kan nie beperk word om slegs sertifikate vir spesifieke Common Names te onderteken nie

**Potensiële impak:** Indirekte privesc deur sensitiewe inligting in die verkeer te onderskep.

#### Exploitation <a href="#discovery" id="discovery"></a>

Vind die uitbuitingstappe in die oorspronklike navorsing: [**https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/**](https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/)

{{#include ../../../../banners/hacktricks-training.md}}
