# AWS - Codepipeline Privesc

{{#include ../../../banners/hacktricks-training.md}}

## codepipeline

Kwa maelezo zaidi kuhusu codepipeline angalia:

{{#ref}}
../aws-services/aws-datapipeline-codepipeline-codebuild-and-codecommit.md
{{#endref}}

### `iam:PassRole`, `codepipeline:CreatePipeline`, `codebuild:CreateProject, codepipeline:StartPipelineExecution`

Unapounda code pipeline unaweza kuashiria **codepipeline IAM Role ya kuendesha**, hivyo unaweza kuathiri hizo.

Mbali na ruhusa za awali unahitaji **ufikiaji wa mahali ambapo msimbo umehifadhiwa** (S3, ECR, github, bitbucket...)

Nilijaribu hii kwa kufanya mchakato kwenye tovuti, ruhusa zilizoashiriwa hapo awali si zile za Orodha/Pata zinazohitajika kuunda codepipeline, lakini ili kuunda kwenye wavuti pia utahitaji: `codebuild:ListCuratedEnvironmentImages, codebuild:ListProjects, codebuild:ListRepositories, codecommit:ListRepositories, events:PutTargets, codepipeline:ListPipelines, events:PutRule, codepipeline:ListActionTypes, cloudtrail:<several>`

Wakati wa **kuunda mradi wa kujenga** unaweza kuashiria **amri ya kuendesha** (rev shell?) na kuendesha awamu ya kujenga kama **mtumiaji mwenye mamlaka**, hiyo ndiyo usanidi anahitaji mshambuliaji kuathiri:

![](<../../../images/image (276).png>)

![](<../../../images/image (181).png>)

### ?`codebuild:UpdateProject, codepipeline:UpdatePipeline, codepipeline:StartPipelineExecution`

Inaweza kuwa inawezekana kubadilisha jukumu lililotumika na amri inayotekelezwa kwenye codepipeline kwa ruhusa za awali.

### `codepipeline:pollforjobs`

[AWS inasema](https://docs.aws.amazon.com/codepipeline/latest/APIReference/API_PollForJobs.html):

> Wakati API hii inaitwa, CodePipeline **inarudisha akreditif za muda kwa ajili ya S3 bucket** inayotumika kuhifadhi vitu vya pipeline, ikiwa hatua inahitaji ufikiaji wa S3 bucket hiyo kwa ajili ya vitu vya ingizo au pato. API hii pia **inarudisha thamani zozote za siri zilizofafanuliwa kwa ajili ya hatua**.

{{#include ../../../banners/hacktricks-training.md}}
