# AWS - Codepipeline Privesc

{{#include ../../../banners/hacktricks-training.md}}

## codepipeline

Για περισσότερες πληροφορίες σχετικά με το codepipeline, ελέγξτε:

{{#ref}}
../aws-services/aws-datapipeline-codepipeline-codebuild-and-codecommit.md
{{#endref}}

### `iam:PassRole`, `codepipeline:CreatePipeline`, `codebuild:CreateProject, codepipeline:StartPipelineExecution`

Όταν δημιουργείτε μια pipeline κώδικα, μπορείτε να υποδείξετε έναν **ρόλο IAM codepipeline για εκτέλεση**, επομένως θα μπορούσατε να τους παραβιάσετε.

Εκτός από τις προηγούμενες άδειες, θα χρειαστείτε **πρόσβαση στον τόπο όπου αποθηκεύεται ο κώδικας** (S3, ECR, github, bitbucket...)

Δοκίμασα αυτή τη διαδικασία στην ιστοσελίδα, οι άδειες που αναφέρθηκαν προηγουμένως δεν είναι οι List/Get που απαιτούνται για τη δημιουργία μιας codepipeline, αλλά για να την δημιουργήσετε στο web θα χρειαστείτε επίσης: `codebuild:ListCuratedEnvironmentImages, codebuild:ListProjects, codebuild:ListRepositories, codecommit:ListRepositories, events:PutTargets, codepipeline:ListPipelines, events:PutRule, codepipeline:ListActionTypes, cloudtrail:<several>`

Κατά τη **δημιουργία του έργου κατασκευής**, μπορείτε να υποδείξετε μια **εντολή για εκτέλεση** (rev shell?) και να εκτελέσετε τη φάση κατασκευής ως **privileged user**, αυτή είναι η ρύθμιση που χρειάζεται ο επιτιθέμενος για να παραβιάσει:

![](<../../../images/image (276).png>)

![](<../../../images/image (181).png>)

### ?`codebuild:UpdateProject, codepipeline:UpdatePipeline, codepipeline:StartPipelineExecution`

Ενδέχεται να είναι δυνατή η τροποποίηση του ρόλου που χρησιμοποιείται και της εντολής που εκτελείται σε μια codepipeline με τις προηγούμενες άδειες.

### `codepipeline:pollforjobs`

[AWS αναφέρει](https://docs.aws.amazon.com/codepipeline/latest/APIReference/API_PollForJobs.html):

> Όταν καλείται αυτή η API, το CodePipeline **επιστρέφει προσωρινές διαπιστευτήρια για τον κάδο S3** που χρησιμοποιείται για την αποθήκευση των αντικειμένων για την pipeline, εάν η ενέργεια απαιτεί πρόσβαση σε αυτόν τον κάδο S3 για εισροές ή εκροές αντικειμένων. Αυτή η API επίσης **επιστρέφει οποιαδήποτε μυστικά τιμές ορίζονται για την ενέργεια**.

{{#include ../../../banners/hacktricks-training.md}}
