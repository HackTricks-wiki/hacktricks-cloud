# AWS - EBS Privesc

{{#include ../../../../banners/hacktricks-training.md}}

## EBS

### `ebs:ListSnapshotBlocks`, `ebs:GetSnapshotBlock`, `ec2:DescribeSnapshots`

これらの権限を持つ攻撃者は、**ローカルにボリュームのスナップショットをダウンロードして解析する**ことが可能になり、それらから機密情報（シークレットやソースコードなど）を検索できる可能性があります。やり方は以下を参照してください:

{{#ref}}
../../aws-post-exploitation/aws-ec2-ebs-ssm-and-vpc-post-exploitation/aws-ebs-snapshot-dump.md
{{#endref}}

他に役立つ可能性のある権限: `ec2:DescribeInstances`, `ec2:DescribeVolumes`, `ec2:DeleteSnapshot`, `ec2:CreateSnapshot`, `ec2:CreateTags`

The tool [https://github.com/Static-Flow/CloudCopy](https://github.com/Static-Flow/CloudCopy) performs this attack to e**xtract passwords from a domain controller**.

**潜在的影響:** スナップショット内の機密情報を特定することで間接的にprivescが発生する（Active Directoryのパスワードさえ取得できる可能性があります）。

### **`ec2:CreateSnapshot`**

**`EC2:CreateSnapshot`** 権限を持つ任意のAWSユーザーは、**Domain Controller** のスナップショットを作成し、それを自分の制御するインスタンスにマウントして **NTDS.dit と SYSTEM** レジストリハイブをエクスポートすることで、ドメインユーザー全員のハッシュを盗むことができます（Impacketのsecretsdumpプロジェクトで使用可能）。

この攻撃を自動化するにはこのツールを使用できます: [https://github.com/Static-Flow/CloudCopy](https://github.com/Static-Flow/CloudCopy) またはスナップショット作成後に前述の手法を利用してください。

{{#include ../../../../banners/hacktricks-training.md}}
