# AWS - EBS Privesc

{{#include ../../../../banners/hacktricks-training.md}}

## EBS

### `ebs:ListSnapshotBlocks`, `ebs:GetSnapshotBlock`, `ec2:DescribeSnapshots`

Bu izinlere sahip bir saldırgan, **volume snapshot'larını yerel olarak indirip analiz edebilir** ve bunlarda (örneğin secrets veya source code gibi) hassas bilgiler arayabilir. Bunu nasıl yapacağınızı şurada bulun:

{{#ref}}
../../aws-post-exploitation/aws-ec2-ebs-ssm-and-vpc-post-exploitation/aws-ebs-snapshot-dump.md
{{#endref}}

Diğer faydalı olabilecek izinler: `ec2:DescribeInstances`, `ec2:DescribeVolumes`, `ec2:DeleteSnapshot`, `ec2:CreateSnapshot`, `ec2:CreateTags`

The tool [https://github.com/Static-Flow/CloudCopy](https://github.com/Static-Flow/CloudCopy) bu saldırıyı gerçekleştirerek **domain controller'dan parolaları çıkartır**.

**Potential Impact:** Snapshot içinde hassas bilgi bularak dolaylı privesc (hatta Active Directory parolalarını bile alabilirsiniz).

### **`ec2:CreateSnapshot`**

Herhangi bir AWS kullanıcısı **`EC2:CreateSnapshot`** iznine sahipse, bir **Domain Controller'ın snapshot'ını** oluşturarak bunu kontrol ettikleri bir instance'a bağlayıp **NTDS.dit ve SYSTEM** kayıt defteri hive dosyasını dışa aktararak tüm domain kullanıcılarının hash'lerini çalabilir; bu dosyalar Impacket'ın secretsdump projesinde kullanılabilir.

Saldırıyı otomatikleştirmek için bu aracı kullanabilirsiniz: [https://github.com/Static-Flow/CloudCopy](https://github.com/Static-Flow/CloudCopy) veya snapshot oluşturduktan sonra önceki tekniklerden birini kullanabilirsiniz.

{{#include ../../../../banners/hacktricks-training.md}}
