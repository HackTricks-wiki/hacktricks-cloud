# AWS - Codepipeline Privesc

{{#include ../../../../banners/hacktricks-training.md}}

## codepipeline

codepipeline hakkında daha fazla bilgi için bakınız:

{{#ref}}
../../aws-services/aws-datapipeline-codepipeline-codebuild-and-codecommit.md
{{#endref}}

### `iam:PassRole`, `codepipeline:CreatePipeline`, `codebuild:CreateProject, codepipeline:StartPipelineExecution`

Bir code pipeline oluştururken **codepipeline IAM Role to run** belirtebilirsiniz, bu nedenle bu rolleri ele geçirebilirsiniz.

Önceki izinlerin yanı sıra **kodun depolandığı yere erişim** (S3, ECR, github, bitbucket...) gerekir.

Bunu web arayüzünde test ettim; önceki belirtilen izinler codepipeline oluşturmak için gereken List/Get olmayan izinlerdir, fakat web üzerinde oluşturmak için ayrıca şunlar gerekir: `codebuild:ListCuratedEnvironmentImages, codebuild:ListProjects, codebuild:ListRepositories, codecommit:ListRepositories, events:PutTargets, codepipeline:ListPipelines, events:PutRule, codepipeline:ListActionTypes, cloudtrail:<several>`

**creation of the build project** sırasında bir **command to run** (rev shell?) belirtebilir ve build aşamasını **privileged user** olarak çalıştırabilirsiniz; saldırganın ele geçirmek için ihtiyaç duyduğu konfigürasyon budur:

![](<../../../images/image (276).png>)

![](<../../../images/image (181).png>)

### ?`codebuild:UpdateProject, codepipeline:UpdatePipeline, codepipeline:StartPipelineExecution`

Önceki izinlerle bir codepipeline'da kullanılan rolü ve çalıştırılan komutu değiştirmek mümkün olabilir.

### `codepipeline:pollforjobs`

[AWS şöyle belirtir](https://docs.aws.amazon.com/codepipeline/latest/APIReference/API_PollForJobs.html):

> Bu API çağrıldığında, CodePipeline **pipeline için artifact'leri depolamakta kullanılan S3 bucket için geçici kimlik bilgilerini döndürür**, eğer eylem söz konusu S3 bucket'a giriş veya çıkış artifact'leri için erişim gerektiriyorsa. Bu API ayrıca **eylem için tanımlanmış herhangi bir gizli değeri de döndürür**.

{{#include ../../../../banners/hacktricks-training.md}}
