# AWS - Codepipeline Privesc

{{#include ../../../../banners/hacktricks-training.md}}

## codepipeline

Za više informacija o codepipeline pogledajte:

{{#ref}}
../../aws-services/aws-datapipeline-codepipeline-codebuild-and-codecommit.md
{{#endref}}

### `iam:PassRole`, `codepipeline:CreatePipeline`, `codebuild:CreateProject, codepipeline:StartPipelineExecution`

Kada kreirate code pipeline možete navesti **codepipeline IAM Role to run**, stoga biste ih mogli kompromitovati.

Pored prethodnih dozvola biće vam potreban i **pristup mestu gde je kod smešten** (S3, ECR, github, bitbucket...)

Testirao sam ovo radeći proces na web stranici — dozvole navedene ranije su one (ne List/Get) potrebne za kreiranje codepipeline, ali za kreiranje preko web-a takođe će vam trebati: `codebuild:ListCuratedEnvironmentImages, codebuild:ListProjects, codebuild:ListRepositories, codecommit:ListRepositories, events:PutTargets, codepipeline:ListPipelines, events:PutRule, codepipeline:ListActionTypes, cloudtrail:<several>`

Tokom **kreiranja build projekta** možete navesti **komandu za izvršavanje** (rev shell?) i pokrenuti build fazu kao **privilegovan korisnik** — to je konfiguracija koju napadač treba da kompromituje:

![](<../../../images/image (276).png>)

![](<../../../images/image (181).png>)

### ?`codebuild:UpdateProject, codepipeline:UpdatePipeline, codepipeline:StartPipelineExecution`

Može biti moguće izmeniti ulogu koja se koristi i komandu koja se izvršava na codepipeline uz prethodne dozvole.

### `codepipeline:pollforjobs`

[AWS mentions](https://docs.aws.amazon.com/codepipeline/latest/APIReference/API_PollForJobs.html):

> Kada se ovaj API pozove, CodePipeline **vraća privremene kredencijale za S3 bucket** koji se koristi za čuvanje artefakata za pipeline, ako akcija zahteva pristup tom S3 bucket-u za ulazne ili izlazne artefakte. Ovaj API takođe **vraća sve vrednosti tajni definisane za akciju**.

{{#include ../../../../banners/hacktricks-training.md}}
