# AWS - MQ Privesc

{{#include ../../../../banners/hacktricks-training.md}}

## MQ

有关 MQ 的更多信息，请查看：

{{#ref}}
../../aws-services/aws-mq-enum.md
{{#endref}}

### `mq:ListBrokers`, `mq:CreateUser`

拥有这些权限，你可以 **在 ActimeMQ broker 中创建一个新用户**（这在 RabbitMQ 中不起作用）：
```bash
aws mq list-brokers
aws mq create-user --broker-id <value> --console-access --password <value> --username <value>
```
**潜在影响：** 通过在 ActiveMQ 中导航访问敏感信息

### `mq:ListBrokers`, `mq:ListUsers`, `mq:UpdateUser`

拥有这些权限后，你可以 **在 ActimeMQ broker 中创建新用户**（这在 RabbitMQ 中无效）：
```bash
aws mq list-brokers
aws mq list-users --broker-id <value>
aws mq update-user --broker-id <value> --console-access --password <value> --username <value>
```
**Potential Impact:** 通过 ActiveMQ 导航访问敏感信息

### `mq:ListBrokers`, `mq:UpdateBroker`

如果 broker 使用 **LDAP** 与 **ActiveMQ** 进行授权，攻击者可以 **更改** 所使用的 LDAP 服务器的 **配置**，将其指向 **由 attacker 控制的服务器**。这样攻击者将能够 **窃取通过 LDAP 发送的所有 credentials**。
```bash
aws mq list-brokers
aws mq update-broker --broker-id <value> --ldap-server-metadata=...
```
如果你能找到 ActiveMQ 使用的原始凭证，你可以进行 MitM，窃取这些 creds，在原服务器上使用它们并发送响应（也许只需重用被窃取的 creds 就能做到）。

**Potential Impact:** 窃取 ActiveMQ 凭证

{{#include ../../../../banners/hacktricks-training.md}}
