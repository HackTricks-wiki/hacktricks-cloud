# Amazon Macie - Обхід перевірки цілісності `Reveal Sample`

AWS Macie - це служба безпеки, яка автоматично виявляє чутливі дані в середовищах AWS, такі як облікові дані, особисто ідентифікована інформація (PII) та інші конфіденційні дані. Коли Macie виявляє чутливі облікові дані, такі як секретний ключ AWS, збережений у S3 бакеті, він генерує виявлення, яке дозволяє власнику переглядати "зразок" виявлених даних. Зазвичай, після видалення чутливого файлу з S3 бакету очікується, що секрет більше не можна буде відновити.

Однак було виявлено **обхід**, при якому зловмисник з достатніми правами може **знову завантажити файл з тією ж назвою**, але з різними, не чутливими даними. Це призводить до того, що Macie асоціює новозавантажений файл з оригінальним виявленням, що дозволяє зловмиснику використовувати **функцію "Reveal Sample"** для витягування раніше виявленого секрету. Ця проблема становить значний ризик для безпеки, оскільки секрети, які вважалися видаленими, залишаються доступними через цей метод.

<img src="https://github.com/user-attachments/assets/c44228ae-12cd-41bd-9a04-57f503a63281" height="800" width="auto"/>

## Кроки для відтворення:

1. Завантажте файл (наприклад, `test-secret.txt`) до S3 бакету з чутливими даними, такими як секретний ключ AWS. Дочекайтеся, поки AWS Macie просканує та згенерує виявлення.

2. Перейдіть до AWS Macie Findings, знайдіть згенероване виявлення та використайте функцію **Reveal Sample**, щоб переглянути виявлений секрет.

3. Видаліть `test-secret.txt` з S3 бакету та перевірте, що його більше не існує.

4. Створіть новий файл з назвою `test-secret.txt` з фальшивими даними та знову завантажте його до того ж S3 бакету, використовуючи **обліковий запис зловмисника**.

5. Поверніться до AWS Macie Findings, отримайте доступ до оригінального виявлення та знову натисніть **Reveal Sample**.

6. Спостерігайте, що Macie все ще розкриває оригінальний секрет, незважаючи на те, що файл був видалений і замінений на інший контент **з різних облікових записів, у нашому випадку це буде обліковий запис зловмисника**.

## Резюме:

Ця вразливість дозволяє зловмиснику з достатніми правами AWS IAM відновлювати раніше виявлені секрети, навіть після того, як оригінальний файл був видалений з S3. Якщо секретний ключ AWS, токен доступу або інші чутливі облікові дані будуть розкриті, зловмисник може скористатися цим недоліком, щоб отримати їх і отримати несанкціонований доступ до ресурсів AWS. Це може призвести до ескалації привілеїв, несанкціонованого доступу до даних або подальшого компрометації хмарних активів, що призведе до витоків даних і збоїв у роботі сервісів.
