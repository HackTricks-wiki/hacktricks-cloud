# Amazon Macie - Ominięcie kontroli integralności `Reveal Sample`

AWS Macie to usługa zabezpieczeń, która automatycznie wykrywa wrażliwe dane w środowiskach AWS, takie jak dane uwierzytelniające, informacje umożliwiające identyfikację osób (PII) i inne poufne dane. Gdy Macie identyfikuje wrażliwe dane uwierzytelniające, takie jak tajny klucz AWS przechowywany w wiadrze S3, generuje ustalenie, które pozwala właścicielowi na wyświetlenie "przykładu" wykrytych danych. Zazwyczaj, gdy wrażliwy plik zostanie usunięty z wiadra S3, oczekuje się, że tajny klucz nie może być już odzyskany.

Jednak zidentyfikowano **ominięcie**, w którym atakujący z wystarczającymi uprawnieniami może **ponownie przesłać plik o tej samej nazwie**, ale zawierający różne, niewrażliwe dane zastępcze. Powoduje to, że Macie kojarzy nowo przesłany plik z oryginalnym ustaleniem, co pozwala atakującemu na użycie funkcji **"Reveal Sample"** do wydobycia wcześniej wykrytego sekretu. Problem ten stanowi poważne zagrożenie dla bezpieczeństwa, ponieważ sekrety, które uznano za usunięte, pozostają możliwe do odzyskania tą metodą.

<img src="https://github.com/user-attachments/assets/c44228ae-12cd-41bd-9a04-57f503a63281" height="800" width="auto"/>

## Kroki do odtworzenia:

1. Prześlij plik (np. `test-secret.txt`) do wiadra S3 z wrażliwymi danymi, takimi jak tajny klucz AWS. Poczekaj, aż AWS Macie przeskanuje i wygeneruje ustalenie.

2. Przejdź do ustaleń AWS Macie, zlokalizuj wygenerowane ustalenie i użyj funkcji **Reveal Sample**, aby wyświetlić wykryty sekret.

3. Usuń `test-secret.txt` z wiadra S3 i upewnij się, że już nie istnieje.

4. Utwórz nowy plik o nazwie `test-secret.txt` z danymi zastępczymi i ponownie prześlij go do tego samego wiadra S3, używając **konta atakującego**.

5. Wróć do ustaleń AWS Macie, uzyskaj dostęp do oryginalnego ustalenia i kliknij ponownie **Reveal Sample**.

6. Zauważ, że Macie nadal ujawnia oryginalny sekret, mimo że plik został usunięty i zastąpiony inną zawartością **z różnych kont, w naszym przypadku będzie to konto atakującego**.

## Podsumowanie:

Ta luka pozwala atakującemu z wystarczającymi uprawnieniami AWS IAM na odzyskanie wcześniej wykrytych sekretów, nawet po usunięciu oryginalnego pliku z S3. Jeśli tajny klucz AWS, token dostępu lub inne wrażliwe dane uwierzytelniające zostaną ujawnione, atakujący może wykorzystać tę wadę do ich odzyskania i uzyskania nieautoryzowanego dostępu do zasobów AWS. Może to prowadzić do eskalacji uprawnień, nieautoryzowanego dostępu do danych lub dalszego kompromitowania zasobów w chmurze, co skutkuje naruszeniami danych i zakłóceniami w usługach.
