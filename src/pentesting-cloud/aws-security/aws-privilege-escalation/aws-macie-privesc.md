# Amazon Macie - Bypass `Reveal Sample` Integrity Check

AWS Macie ni huduma ya usalama inayogundua kiotomatiki data nyeti ndani ya mazingira ya AWS, kama vile akidi, taarifa za kibinafsi zinazoweza kutambulika (PII), na data nyingine za siri. Wakati Macie inatambua akidi nyeti, kama vile funguo za siri za AWS zilizohifadhiwa katika S3 bucket, inaunda matokeo yanayomruhusu mmiliki kuona "kielelezo" cha data iliyogunduliwa. Kwa kawaida, mara tu faili nyeti inapondolewa kutoka S3 bucket, inatarajiwa kwamba siri haiwezi tena kupatikana.

Hata hivyo, **bypass** imegundulika ambapo mshambuliaji mwenye ruhusa za kutosha anaweza **ku-upload tena faili yenye jina sawa** lakini ikiwa na data tofauti, zisizo nyeti. Hii inasababisha Macie kuhusisha faili iliyopakiwa upya na matokeo ya awali, ikimruhusu mshambuliaji kutumia **kipengele cha "Reveal Sample"** kutoa siri iliyogunduliwa hapo awali. Tatizo hili linaweka hatari kubwa ya usalama, kwani siri ambazo zilidhaniwa kufutwa zinabaki kupatikana kupitia njia hii.

<img src="https://github.com/user-attachments/assets/c44228ae-12cd-41bd-9a04-57f503a63281" height="800" width="auto"/>

## Steps To Reproduce:

1. Upload a file (e.g., `test-secret.txt`) to an S3 bucket with sensitive data, such as an AWS secret key. Wait for AWS Macie to scan and generate a finding.

2. Navigate to AWS Macie Findings, locate the generated finding, and use the **Reveal Sample** feature to view the detected secret.

3. Delete `test-secret.txt` from the S3 bucket and verify that it no longer exists.

4. Create a new file named `test-secret.txt` with dummy data and re-upload it to the same S3 bucket using **attacker's account**.

5. Return to AWS Macie Findings, access the original finding, and click **Reveal Sample** again.

6. Observe that Macie still reveals the original secret, despite the file being deleted and replaced with different content **from different accounts, in our case it will be the attacker's account**.

## Summary:

Uthibitisho huu unaruhusu mshambuliaji mwenye ruhusa za kutosha za AWS IAM kurejesha siri zilizogunduliwa hapo awali hata baada ya faili ya awali kufutwa kutoka S3. Ikiwa funguo ya siri ya AWS, token ya ufikiaji, au akidi nyingine nyeti inafichuliwa, mshambuliaji anaweza kutumia kasoro hii kuirejesha na kupata ufikiaji usioidhinishwa kwa rasilimali za AWS. Hii inaweza kusababisha kupanda kwa ruhusa, ufikiaji usioidhinishwa wa data, au kuathiri zaidi mali za wingu, na kusababisha uvunjaji wa data na usumbufu wa huduma.
