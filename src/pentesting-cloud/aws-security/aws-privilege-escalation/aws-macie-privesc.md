# AWS - Macie Privesc

{{#include ../../../banners/hacktricks-training.md}}

## Macie

Macie hakkında daha fazla bilgi için kontrol edin:

{{#ref}}
../aws-services/aws-macie-enum.md
{{#endref}}

### Amazon Macie - `Reveal Sample` Bütünlük Kontrolünü Atlatma

AWS Macie, AWS ortamlarında kimlik bilgileri, kişisel olarak tanımlanabilir bilgiler (PII) ve diğer gizli veriler gibi hassas verileri otomatik olarak tespit eden bir güvenlik hizmetidir. Macie, bir S3 kovasında saklanan bir AWS gizli anahtarı gibi hassas bir kimlik bilgisi tespit ettiğinde, sahibinin tespit edilen verinin bir "örneğini" görüntülemesine olanak tanıyan bir bulgu oluşturur. Genellikle, hassas dosya S3 kovasından kaldırıldığında, gizlinin artık geri alınamayacağı beklenir.

Ancak, yeterli izinlere sahip bir saldırganın **aynı isimle** ancak farklı, hassas olmayan sahte veriler içeren bir dosyayı **yeniden yükleyebileceği** bir **atlatma** tespit edilmiştir. Bu, Macie'nin yeni yüklenen dosyayı orijinal bulgu ile ilişkilendirmesine neden olur ve saldırgana daha önce tespit edilen gizli veriyi çıkarmak için **"Reveal Sample" özelliğini** kullanma imkanı tanır. Bu sorun, silindiği varsayılan gizlilerin bu yöntemle geri alınabilir olması nedeniyle önemli bir güvenlik riski oluşturur.

![flow](https://github.com/user-attachments/assets/7b83f2d3-1690-41f1-98cc-05ccd0154a66)

**Yeniden Üretme Adımları:**

1. Hassas veriler içeren bir dosya (örneğin, `test-secret.txt`) S3 kovasına yükleyin, örneğin bir AWS gizli anahtarı. AWS Macie'nin tarama yapmasını ve bir bulgu oluşturmasını bekleyin.

2. AWS Macie Bulgularına gidin, oluşturulan bulguyu bulun ve tespit edilen gizli veriyi görüntülemek için **Reveal Sample** özelliğini kullanın.

3. `test-secret.txt` dosyasını S3 kovasından silin ve artık mevcut olmadığını doğrulayın.

4. Sahte veriler içeren `test-secret.txt` adında yeni bir dosya oluşturun ve bunu **saldırganın hesabı** ile aynı S3 kovasına yeniden yükleyin.

5. AWS Macie Bulgularına geri dönün, orijinal bulguyu erişin ve tekrar **Reveal Sample**'a tıklayın.

6. Dosyanın silinmesine ve farklı içerikle **farklı hesaplardan, bizim durumumuzda saldırganın hesabından** değiştirilmesine rağmen Macie'nin hala orijinal gizli veriyi açıkladığını gözlemleyin.

**Özet:**

Bu zafiyet, yeterli AWS IAM izinlerine sahip bir saldırgana, orijinal dosya S3'ten silinmiş olsa bile daha önce tespit edilen gizli verileri geri alma imkanı tanır. Eğer bir AWS gizli anahtarı, erişim belirteci veya diğer hassas kimlik bilgileri ifşa edilirse, bir saldırgan bu açığı kullanarak bunları geri alabilir ve AWS kaynaklarına yetkisiz erişim sağlayabilir. Bu, ayrıcalık yükselmesine, yetkisiz veri erişimine veya bulut varlıklarının daha fazla tehlikeye girmesine yol açabilir ve veri ihlalleri ile hizmet kesintilerine neden olabilir.
