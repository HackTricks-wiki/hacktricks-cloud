# AWS - Macie Privesc

{{#include ../../../banners/hacktricks-training.md}}

## Macie

Macie के बारे में अधिक जानकारी के लिए देखें:

{{#ref}}
../aws-services/aws-macie-enum.md
{{#endref}}

### Amazon Macie - `Reveal Sample` इंटीग्रिटी चेक को बायपास करें

AWS Macie एक सुरक्षा सेवा है जो AWS वातावरण में संवेदनशील डेटा, जैसे कि क्रेडेंशियल्स, व्यक्तिगत पहचान योग्य जानकारी (PII), और अन्य गोपनीय डेटा का स्वचालित रूप से पता लगाती है। जब Macie एक संवेदनशील क्रेडेंशियल की पहचान करता है, जैसे कि S3 बकेट में संग्रहीत AWS सीक्रेट की, तो यह एक खोज उत्पन्न करता है जो मालिक को पता लगाए गए डेटा का "नमूना" देखने की अनुमति देता है। आमतौर पर, जब संवेदनशील फ़ाइल S3 बकेट से हटा दी जाती है, तो यह अपेक्षित होता है कि सीक्रेट को फिर से प्राप्त नहीं किया जा सकता।

हालांकि, एक **बायपास** की पहचान की गई है जहां एक हमलावर जिसके पास पर्याप्त अनुमतियाँ हैं, **एक ही नाम के साथ एक फ़ाइल को फिर से अपलोड कर सकता है** लेकिन जिसमें विभिन्न, गैर-संवेदनशील डमी डेटा होता है। इससे Macie को नई अपलोड की गई फ़ाइल को मूल खोज के साथ जोड़ने का कारण बनता है, जिससे हमलावर **"Reveal Sample" फीचर** का उपयोग करके पहले से पता किए गए सीक्रेट को निकाल सकता है। यह समस्या एक महत्वपूर्ण सुरक्षा जोखिम प्रस्तुत करती है, क्योंकि जो सीक्रेट हटाए गए थे वे इस विधि के माध्यम से पुनः प्राप्त किए जा सकते हैं।

![flow](https://github.com/user-attachments/assets/7b83f2d3-1690-41f1-98cc-05ccd0154a66)

**पुन: उत्पन्न करने के चरण:**

1. एक फ़ाइल (जैसे, `test-secret.txt`) को संवेदनशील डेटा के साथ S3 बकेट में अपलोड करें, जैसे कि AWS सीक्रेट की। AWS Macie के स्कैन और खोज उत्पन्न करने की प्रतीक्षा करें।

2. AWS Macie खोजों पर जाएं, उत्पन्न खोज को खोजें, और पता लगाए गए सीक्रेट को देखने के लिए **Reveal Sample** फीचर का उपयोग करें।

3. S3 बकेट से `test-secret.txt` को हटा दें और सत्यापित करें कि यह अब मौजूद नहीं है।

4. डमी डेटा के साथ `test-secret.txt` नाम की एक नई फ़ाइल बनाएं और इसे **हमलावर के खाते** का उपयोग करके उसी S3 बकेट में फिर से अपलोड करें।

5. AWS Macie खोजों पर लौटें, मूल खोज तक पहुँचें, और फिर से **Reveal Sample** पर क्लिक करें।

6. देखें कि Macie अभी भी मूल सीक्रेट को प्रकट करता है, भले ही फ़ाइल को हटा दिया गया हो और इसे **विभिन्न खातों से विभिन्न सामग्री के साथ प्रतिस्थापित किया गया हो, हमारे मामले में यह हमलावर के खाते होगा**।

**सारांश:**

यह भेद्यता एक हमलावर को, जिसके पास पर्याप्त AWS IAM अनुमतियाँ हैं, पहले से पता किए गए सीक्रेट को पुनः प्राप्त करने की अनुमति देती है, भले ही मूल फ़ाइल S3 से हटा दी गई हो। यदि एक AWS सीक्रेट की, एक्सेस टोकन, या अन्य संवेदनशील क्रेडेंशियल उजागर होता है, तो एक हमलावर इस दोष का लाभ उठाकर इसे पुनः प्राप्त कर सकता है और AWS संसाधनों तक अनधिकृत पहुँच प्राप्त कर सकता है। इससे विशेषाधिकार वृद्धि, अनधिकृत डेटा पहुँच, या क्लाउड संपत्तियों के आगे के समझौते का परिणाम हो सकता है, जिससे डेटा उल्लंघन और सेवा में व्यवधान हो सकता है।
