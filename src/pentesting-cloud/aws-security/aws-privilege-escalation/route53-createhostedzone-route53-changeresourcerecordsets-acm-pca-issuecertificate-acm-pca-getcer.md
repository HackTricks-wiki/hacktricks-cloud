# AWS - Route53 Privesc

{{#include ../../../banners/hacktricks-training.md}}

Route53 hakkında daha fazla bilgi için kontrol edin:

{{#ref}}
../aws-services/aws-route53-enum.md
{{#endref}}

### `route53:CreateHostedZone`, `route53:ChangeResourceRecordSets`, `acm-pca:IssueCertificate`, `acm-pca:GetCertificate`

> [!NOTE]
> Bu saldırıyı gerçekleştirmek için hedef hesapta zaten bir [**AWS Sertifika Yöneticisi Özel Sertifika Otoritesi**](https://aws.amazon.com/certificate-manager/private-certificate-authority/) **(AWS-PCA)** kurulmuş olmalıdır ve VPC'deki EC2 örnekleri sertifikaları güvenilir hale getirmek için içe aktarmış olmalıdır. Bu altyapı mevcut olduğunda, AWS API trafiğini kesmek için aşağıdaki saldırı gerçekleştirilebilir.

Diğer izinler **enumeration** kısmı için önerilir ancak zorunlu değildir: `route53:GetHostedZone`, `route53:ListHostedZones`, `acm-pca:ListCertificateAuthorities`, `ec2:DescribeVpcs`

Birden fazla bulut yerel uygulamanın birbirleriyle ve AWS API ile iletişim kurduğu bir AWS VPC'sinin olduğunu varsayalım. Mikro hizmetler arasındaki iletişim genellikle TLS ile şifreli olduğundan, bu hizmetler için geçerli sertifikaları vermek üzere bir özel CA'ya ihtiyaç vardır. **Eğer ACM-PCA kullanılıyorsa** ve düşman **route53 ve acm-pca özel CA'sını kontrol etme erişimine** minimum izin seti ile sahip olursa, **AWS API'ye yapılan uygulama çağrılarını ele geçirebilir** ve IAM izinlerini devralabilir.

Bu mümkündür çünkü:

- AWS SDK'ları [Sertifika Pinleme](https://www.digicert.com/blog/certificate-pinning-what-is-certificate-pinning) özelliğine sahip değildir
- Route53, AWS API'lerinin alan adları için Özel Barındırılan Alan ve DNS kayıtları oluşturulmasına izin verir
- ACM-PCA'daki Özel CA, yalnızca belirli Ortak İsimler için sertifika imzalamakla kısıtlanamaz

**Olası Etki:** Trafikteki hassas bilgileri keserek dolaylı privesc.

#### Exploitation <a href="#discovery" id="discovery"></a>

Sömürü adımlarını orijinal araştırmada bulabilirsiniz: [**https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/**](https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/)

{{#include ../../../banners/hacktricks-training.md}}
