# AWS - Codebuild Enum

{{#include ../../../banners/hacktricks-training.md}}

## CodeBuild

AWS **CodeBuild** est reconnu comme un **service d'intégration continue entièrement géré**. L'objectif principal de ce service est d'automatiser la suite de compilation du code source, l'exécution des tests et le packaging du logiciel en vue du déploiement. L'avantage principal offert par CodeBuild réside dans sa capacité à supprimer la nécessité pour les utilisateurs de provisionner, gérer et faire évoluer leurs serveurs de build, puisque le service prend en charge ces tâches. Les fonctionnalités essentielles d'AWS CodeBuild comprennent :

1. **Service géré**: CodeBuild gère et met à l'échelle les serveurs de build, libérant les utilisateurs de la maintenance des serveurs.
2. **Intégration continue**: Il s'intègre au workflow de développement et de déploiement, automatisant les phases de build et de test du processus de release logiciel.
3. **Production de packages**: Après les phases de build et de test, il prépare les packages logiciels, prêts pour le déploiement.

AWS CodeBuild s'intègre parfaitement avec d'autres services AWS, améliorant l'efficacité et la fiabilité du pipeline CI/CD (Continuous Integration/Continuous Deployment).

### **Github/Gitlab/Bitbucket Credentials**

#### **Default source credentials**

Il s'agit de l'option héritée où il est possible de configurer certains **accès** (comme un Github token ou une app) qui seront **partagés entre les CodeBuild projects**, de sorte que tous les projets puissent utiliser cet ensemble d'identifiants configuré.

Les identifiants stockés (tokens, passwords...) sont **gérés par CodeBuild** et il n'existe aucun moyen public de les récupérer via les APIs AWS.

#### Custom source credential

Selon la plateforme de dépôt (Github, Gitlab et Bitbucket), différentes options sont proposées. Mais en général, toute option qui exige de **stocker un token ou un password le stockera en tant que secret dans le secrets manager**.

Cela permet à **différents CodeBuild projects d'utiliser des accès configurés différents** aux fournisseurs au lieu d'utiliser uniquement le réglage par défaut configuré.

### Enumeration
```bash
# List external repo creds (such as github tokens)
## It doesn't return the token but just the ARN where it's located
aws codebuild list-source-credentials

# Projects
aws codebuild list-shared-projects
aws codebuild list-projects
aws codebuild batch-get-projects --names <project_name> # Check for creds in env vars

# Builds
aws codebuild list-builds
aws codebuild list-builds-for-project --project-name <p_name>
aws codebuild list-build-batches
aws codebuild list-build-batches-for-project --project-name <p_name>

# Reports
aws codebuild list-reports
aws codebuild describe-test-cases --report-arn <ARN>
```
> [!TIP]
> Si vous avez `codebuild:StartBuild`, souvenez-vous que vous pouvez souvent remplacer les env vars au moment du build (`--environment-variables-override`). Cela suffit pour certaines attaques même sans `UpdateProject` ni remplacements de `buildspec` (par exemple : rediriger les buckets artifact/upload pour exfiltrate des secrets, ou abuser des env vars language/runtime pour exécuter des commandes).

### Privesc

Sur la page suivante, vous pouvez voir comment **abuser des permissions codebuild pour escalader les privilèges** :

{{#ref}}
../aws-privilege-escalation/aws-codebuild-privesc/README.md
{{#endref}}

### Post Exploitation

{{#ref}}
../aws-post-exploitation/aws-codebuild-post-exploitation/
{{#endref}}

### Unauthenticated Access

{{#ref}}
../aws-unauthenticated-enum-access/aws-codebuild-unauthenticated-access/README.md
{{#endref}}

## Références

- [https://docs.aws.amazon.com/managedservices/latest/userguide/code-build.html](https://docs.aws.amazon.com/managedservices/latest/userguide/code-build.html)

{{#include ../../../banners/hacktricks-training.md}}
