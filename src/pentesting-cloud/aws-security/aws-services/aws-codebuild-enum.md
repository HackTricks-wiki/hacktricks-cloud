# AWS - Codebuild Enum

{{#include ../../../banners/hacktricks-training.md}}

## CodeBuild

Η AWS **CodeBuild** αναγνωρίζεται ως μια **πλήρως διαχειριζόμενη υπηρεσία συνεχούς ενσωμάτωσης**. Ο κύριος σκοπός αυτής της υπηρεσίας είναι να αυτοματοποιεί τη σειρά μεταγλώττισης του source code, την εκτέλεση δοκιμών και το πακετάρισμα του λογισμικού για σκοπούς ανάπτυξης. Το κύριο πλεονέκτημα που προσφέρει η CodeBuild είναι ότι μειώνει την ανάγκη των χρηστών να προμηθεύουν, να διαχειρίζονται και να κλιμακώνουν τους build servers. Αυτή η ευκολία προκύπτει επειδή η ίδια η υπηρεσία αναλαμβάνει αυτές τις εργασίες. Τα βασικά χαρακτηριστικά της AWS CodeBuild περιλαμβάνουν:

1. **Managed Service**: Η CodeBuild διαχειρίζεται και κλιμακώνει τους build servers, απαλλάσσοντας τους χρήστες από τη συντήρηση των servers.
2. **Continuous Integration**: Ενσωματώνεται στη ροή εργασιών ανάπτυξης και deployment, αυτοματοποιώντας τα στάδια build και test της διαδικασίας έκδοσης λογισμικού.
3. **Package Production**: Μετά τα στάδια build και test, προετοιμάζει τα πακέτα λογισμικού, καθιστώντας τα έτοιμα για deployment.

Η AWS CodeBuild ενσωματώνεται απρόσκοπτα με άλλες υπηρεσίες της AWS, βελτιώνοντας την αποδοτικότητα και αξιοπιστία της CI/CD (Continuous Integration/Continuous Deployment) pipeline.

### **Github/Gitlab/Bitbucket Credentials**

#### **Default source credentials**

Αυτή είναι η παλαιότερη επιλογή όπου είναι δυνατό να διαμορφωθεί κάποιο **access** (π.χ. ένα Github token ή app) που θα είναι **shared across codebuild projects**, ώστε όλα τα projects να μπορούν να χρησιμοποιούν αυτό το διαμορφωμένο σύνολο διαπιστευτηρίων.

Τα αποθηκευμένα διαπιστευτήρια (tokens, passwords...) είναι **managed by codebuild** και δεν υπάρχει δημόσιος τρόπος να τα ανακτήσετε μέσω των AWS APIs.

#### Custom source credential

Ανάλογα με την πλατφόρμα του repository (Github, Gitlab και Bitbucket) παρέχονται διαφορετικές επιλογές. Αλλά γενικά, οποιαδήποτε επιλογή που απαιτεί την αποθήκευση ενός token ή ενός password θα το **αποθηκεύει ως secret στο secrets manager**.

Αυτό επιτρέπει σε **different codebuild projects to use different configured accesses** προς τους παρόχους, αντί να χρησιμοποιούν μόνο το προεπιλεγμένο.

### Enumeration
```bash
# List external repo creds (such as github tokens)
## It doesn't return the token but just the ARN where it's located
aws codebuild list-source-credentials

# Projects
aws codebuild list-shared-projects
aws codebuild list-projects
aws codebuild batch-get-projects --names <project_name> # Check for creds in env vars

# Builds
aws codebuild list-builds
aws codebuild list-builds-for-project --project-name <p_name>
aws codebuild list-build-batches
aws codebuild list-build-batches-for-project --project-name <p_name>

# Reports
aws codebuild list-reports
aws codebuild describe-test-cases --report-arn <ARN>
```
> [!TIP]
> Αν έχετε `codebuild:StartBuild`, θυμηθείτε ότι συχνά μπορείτε να αντικαταστήσετε τα env vars κατά το build (`--environment-variables-override`). Αυτό είναι αρκετό για κάποιες επιθέσεις ακόμη και χωρίς `UpdateProject` ή παρακάμψεις `buildspec` (για παράδειγμα: ανακατεύθυνση artifact/upload buckets για exfiltrate secrets, ή κατάχρηση των language/runtime env vars για εκτέλεση εντολών).

### Privesc

Στην επόμενη σελίδα μπορείτε να δείτε πώς να **abuse codebuild permissions to escalate privileges**:

{{#ref}}
../aws-privilege-escalation/aws-codebuild-privesc/README.md
{{#endref}}

### Post Exploitation

{{#ref}}
../aws-post-exploitation/aws-codebuild-post-exploitation/
{{#endref}}

### Unauthenticated Access

{{#ref}}
../aws-unauthenticated-enum-access/aws-codebuild-unauthenticated-access/README.md
{{#endref}}

## Αναφορές

- [https://docs.aws.amazon.com/managedservices/latest/userguide/code-build.html](https://docs.aws.amazon.com/managedservices/latest/userguide/code-build.html)

{{#include ../../../banners/hacktricks-training.md}}
