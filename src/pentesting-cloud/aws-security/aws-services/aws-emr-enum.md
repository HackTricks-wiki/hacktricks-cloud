# AWS - EMR Enum

{{#include ../../../banners/hacktricks-training.md}}

## EMR

Η υπηρεσία Elastic MapReduce (EMR) της AWS, ξεκινώντας από την έκδοση 4.8.0, εισήγαγε μια δυνατότητα **διαμόρφωσης ασφαλείας** που ενισχύει την προστασία των δεδομένων επιτρέποντας στους χρήστες να καθορίζουν ρυθμίσεις κρυπτογράφησης για δεδομένα σε κατάσταση ηρεμίας και σε μεταφορά εντός των κλάσεων EMR, οι οποίες είναι κλιμακωτές ομάδες EC2 instances σχεδιασμένες να επεξεργάζονται μεγάλα δεδομένα όπως το Apache Hadoop και το Spark.

Κύρια χαρακτηριστικά περιλαμβάνουν:

- **Προεπιλεγμένη Κρυπτογράφηση Κλάσης**: Από προεπιλογή, τα δεδομένα σε κατάσταση ηρεμίας εντός μιας κλάσης δεν είναι κρυπτογραφημένα. Ωστόσο, η ενεργοποίηση της κρυπτογράφησης παρέχει πρόσβαση σε πολλές δυνατότητες:
- **Ενοποιημένη Ρύθμιση Κλειδιών Linux**: Κρυπτογραφεί τους όγκους κλάσης EBS. Οι χρήστες μπορούν να επιλέξουν την Υπηρεσία Διαχείρισης Κλειδιών AWS (KMS) ή έναν προμηθευτή προσαρμοσμένου κλειδιού.
- **Κρυπτογράφηση HDFS Ανοιχτού Κώδικα**: Προσφέρει δύο επιλογές κρυπτογράφησης για το Hadoop:
- Ασφαλές Hadoop RPC (Remote Procedure Call), ρυθμισμένο σε ιδιωτικότητα, αξιοποιώντας το Simple Authentication Security Layer.
- Κρυπτογράφηση μεταφοράς μπλοκ HDFS, ρυθμισμένη σε true, χρησιμοποιεί τον αλγόριθμο AES-256.
- **Κρυπτογράφηση σε Μεταφορά**: Επικεντρώνεται στην ασφάλεια των δεδομένων κατά τη μεταφορά. Οι επιλογές περιλαμβάνουν:
- **Ανοιχτού Κώδικα Ασφάλεια Μεταφοράς (TLS)**: Η κρυπτογράφηση μπορεί να ενεργοποιηθεί επιλέγοντας έναν προμηθευτή πιστοποιητικού:
- **PEM**: Απαιτεί χειροκίνητη δημιουργία και συσκευασία των πιστοποιητικών PEM σε ένα αρχείο zip, αναφερόμενο από έναν κάδο S3.
- **Προσαρμοσμένο**: Περιλαμβάνει την προσθήκη μιας προσαρμοσμένης κλάσης Java ως προμηθευτή πιστοποιητικού που παρέχει κρυπτογραφικά στοιχεία.

Μόλις ενσωματωθεί ένας προμηθευτής πιστοποιητικού TLS στη διαμόρφωση ασφαλείας, οι παρακάτω δυνατότητες κρυπτογράφησης συγκεκριμένων εφαρμογών μπορούν να ενεργοποιηθούν, ποικίλλοντας ανάλογα με την έκδοση EMR:

- **Hadoop**:
- Μπορεί να μειώσει την κρυπτογραφημένη αναδιάταξη χρησιμοποιώντας TLS.
- Ασφαλές Hadoop RPC με Simple Authentication Security Layer και HDFS Block Transfer με AES-256 ενεργοποιούνται με κρυπτογράφηση σε κατάσταση ηρεμίας.
- **Presto** (έκδοση EMR 5.6.0+):
- Η εσωτερική επικοινωνία μεταξύ των κόμβων Presto είναι ασφαλής χρησιμοποιώντας SSL και TLS.
- **Tez Shuffle Handler**:
- Χρησιμοποιεί TLS για κρυπτογράφηση.
- **Spark**:
- Χρησιμοποιεί TLS για το πρωτόκολλο Akka.
- Χρησιμοποιεί Simple Authentication Security Layer και 3DES για την Υπηρεσία Μεταφοράς Μπλοκ.
- Η εξωτερική υπηρεσία αναδιάταξης είναι ασφαλής με το Simple Authentication Security Layer.

Αυτές οι δυνατότητες συλλογικά ενισχύουν τη θέση ασφάλειας των κλάσεων EMR, ειδικά όσον αφορά την προστασία των δεδομένων κατά τη διάρκεια των φάσεων αποθήκευσης και μετάδοσης.

#### Enumeration
```bash
aws emr list-clusters
aws emr describe-cluster --cluster-id <id>
aws emr list-instances --cluster-id <id>
aws emr list-instance-fleets --cluster-id <id>
aws emr list-steps --cluster-id <id>
aws emr list-notebook-executions
aws emr list-security-configurations
aws emr list-studios #Get studio URLs
```
#### Privesc

{{#ref}}
../aws-privilege-escalation/aws-emr-privesc.md
{{#endref}}

## Αναφορές

- [https://cloudacademy.com/course/domain-three-designing-secure-applications-and-architectures/elastic-mapreduce-emr-encryption-1/](https://cloudacademy.com/course/domain-three-designing-secure-applications-and-architectures/elastic-mapreduce-emr-encryption-1/)

{{#include ../../../banners/hacktricks-training.md}}
