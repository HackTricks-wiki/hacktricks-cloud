# AWS - EMR Enum

{{#include ../../../banners/hacktricks-training.md}}

## EMR

AWS的弹性MapReduce（EMR）服务，从版本4.8.0开始，引入了**安全配置**功能，通过允许用户为EMR集群中的静态和动态数据指定加密设置，从而增强数据保护。EMR集群是可扩展的EC2实例组，旨在处理大数据框架，如Apache Hadoop和Spark。

主要特点包括：

- **集群加密默认**：默认情况下，集群内的静态数据未加密。然而，启用加密可以访问多个功能：
- **Linux统一密钥设置**：加密EBS集群卷。用户可以选择AWS密钥管理服务（KMS）或自定义密钥提供者。
- **开源HDFS加密**：为Hadoop提供两种加密选项：
- 安全Hadoop RPC（远程过程调用），设置为隐私，利用简单身份验证安全层。
- HDFS块传输加密，设置为true，使用AES-256算法。
- **传输中的加密**：专注于在传输过程中保护数据。选项包括：
- **开源传输层安全性（TLS）**：通过选择证书提供者可以启用加密：
- **PEM**：需要手动创建并将PEM证书打包到zip文件中，从S3桶中引用。
- **自定义**：涉及添加自定义Java类作为证书提供者，提供加密工件。

一旦将TLS证书提供者集成到安全配置中，可以激活以下特定于应用程序的加密功能，具体取决于EMR版本：

- **Hadoop**：
- 可能会减少使用TLS的加密洗牌。
- 使用简单身份验证安全层的安全Hadoop RPC和使用AES-256的HDFS块传输在静态加密时激活。
- **Presto**（EMR版本5.6.0+）：
- Presto节点之间的内部通信使用SSL和TLS进行安全保护。
- **Tez Shuffle Handler**：
- 使用TLS进行加密。
- **Spark**：
- 对Akka协议使用TLS。
- 对块传输服务使用简单身份验证安全层和3DES。
- 外部洗牌服务使用简单身份验证安全层进行保护。

这些功能共同增强了EMR集群的安全态势，特别是在存储和传输阶段的数据保护方面。

#### Enumeration
```bash
aws emr list-clusters
aws emr describe-cluster --cluster-id <id>
aws emr list-instances --cluster-id <id>
aws emr list-instance-fleets --cluster-id <id>
aws emr list-steps --cluster-id <id>
aws emr list-notebook-executions
aws emr list-security-configurations
aws emr list-studios #Get studio URLs
```
#### 提权

{{#ref}}
../aws-privilege-escalation/aws-emr-privesc.md
{{#endref}}

## 参考

- [https://cloudacademy.com/course/domain-three-designing-secure-applications-and-architectures/elastic-mapreduce-emr-encryption-1/](https://cloudacademy.com/course/domain-three-designing-secure-applications-and-architectures/elastic-mapreduce-emr-encryption-1/)

{{#include ../../../banners/hacktricks-training.md}}
