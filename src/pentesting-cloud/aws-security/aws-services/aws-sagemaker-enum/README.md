# AWS - SageMaker Enum

{{#include ../../../../banners/hacktricks-training.md}}

## Diens Oorsig

Amazon SageMaker is AWS' beheerde masjienleer-platform wat notaboeke, training infrastructure, orkestrasie, registries, en beheerde endpoints aanmekaar heg. 'n Kompromie van SageMaker-resources bied tipies:

- Langdurige IAM-uitvoeringsrolle met wye toegang tot S3, ECR, Secrets Manager, of KMS.
- Toegang tot gevoelige datastelle gestoor in S3, EFS, of binne feature stores.
- Netwerkvoetings binne VPCs (Studio apps, training jobs, endpoints).
- Hoë-privilegie presigned URLs wat konsole-authentisering omseil.

Om te verstaan hoe SageMaker saamgestel is, is noodsaaklik voordat jy pivot, persist, of exfiltrate data.

## Kernboublokke

- **Studio Domains & Spaces**: Web IDE (JupyterLab, Code Editor, RStudio). Elke domain het 'n gedeelde EFS-lêerstelsel en 'n standaard uitvoeringsrol.
- **Notebook Instances**: Beheerde EC2-instanse vir onafhanklike notebooks; gebruik aparte uitvoeringsrolle.
- **Training / Processing / Transform Jobs**: Tydelike kontainers wat kode van ECR en data van S3 trek.
- **Pipelines & Experiments**: Gekoördineerde workflows wat alle stappe, insette, en uitsette beskryf.
- **Models & Endpoints**: Verpakte artefakte ontplooi vir inferensie via HTTPS endpoints.
- **Feature Store & Data Wrangler**: Beheerde dienste vir data-voorbereiding en feature-bestuur.
- **Autopilot & JumpStart**: Geautomatiseerde ML en 'n gekeurde modelkatalogus.
- **MLflow Tracking Servers**: Beheerde MLflow UI/API met presigned toegangstokens.

Elke hulpbron verwys na 'n uitvoeringsrol, S3-ligginge, kontainerbeelde, en opsionele VPC/KMS-konfigurasie—vang al hulle tydens enumerasie.

## Rekening- en globale metadata
```bash
REGION=us-east-1
# Portfolio status, used when provisioning Studio resources
aws sagemaker get-sagemaker-servicecatalog-portfolio-status --region $REGION

# List execution roles used by models (extend to other resources as needed)
aws sagemaker list-models --region $REGION --query 'Models[].ExecutionRoleArn' --output text | tr '	' '
' | sort -u

# Generic tag sweep across any SageMaker ARN you know
aws sagemaker list-tags --resource-arn <sagemaker-arn> --region $REGION
```
Neem kennis van enige cross-account trust (execution roles of S3 buckets met external principals) en basiese beperkings soos service control policies of SCPs.

## Studio-domeine, apps & gedeelde ruimtes
```bash
aws sagemaker list-domains --region $REGION
aws sagemaker describe-domain --domain-id <domain-id> --region $REGION
aws sagemaker list-user-profiles --domain-id-equals <domain-id> --region $REGION
aws sagemaker describe-user-profile --domain-id <domain-id> --user-profile-name <profile> --region $REGION

# Enumerate apps (JupyterServer, KernelGateway, RStudioServerPro, CodeEditor, Canvas, etc.)
aws sagemaker list-apps --domain-id-equals <domain-id> --region $REGION
aws sagemaker describe-app --domain-id <domain-id> --user-profile-name <profile> --app-type JupyterServer --app-name default --region $REGION

# Shared collaborative spaces
aws sagemaker list-spaces --domain-id-equals <domain-id> --region $REGION
aws sagemaker describe-space --domain-id <domain-id> --space-name <space> --region $REGION

# Studio lifecycle configurations (shell scripts at start/stop)
aws sagemaker list-studio-lifecycle-configs --region $REGION
aws sagemaker describe-studio-lifecycle-config --studio-lifecycle-config-name <name> --region $REGION
```
Wat om op te neem:

- `DomainArn`, `AppSecurityGroupIds`, `SubnetIds`, `DefaultUserSettings.ExecutionRole`.
- Gemonteerde EFS (`HomeEfsFileSystemId`) en S3 tuismappe.
- Lifecycle-skripte (bevat dikwels bootstrap credentials of push/pull ekstra kode).

> [!TIP]
> Presigned Studio URLs kan verifikasie omseil as hulle wyd toegeken is.

## Notebook Instances & Lifecycle Configs
```bash
aws sagemaker list-notebook-instances --region $REGION
aws sagemaker describe-notebook-instance --notebook-instance-name <name> --region $REGION
aws sagemaker list-notebook-instance-lifecycle-configs --region $REGION
aws sagemaker describe-notebook-instance-lifecycle-config --notebook-instance-lifecycle-config-name <cfg> --region $REGION
```
Notebook-metadata openbaar:

- Uitvoeringsrol (`RoleArn`), direkte internettoegang vs. VPC-slegs-modus.
- S3-lokaliteite in `DefaultCodeRepository`, `DirectInternetAccess`, `RootAccess`.
- Lewensiklus-skripte vir credentials of persistence hooks.

## Opleiding, Verwerking, Transformasie & Batch-jobs
```bash
aws sagemaker list-training-jobs --region $REGION
aws sagemaker describe-training-job --training-job-name <job> --region $REGION

aws sagemaker list-processing-jobs --region $REGION
aws sagemaker describe-processing-job --processing-job-name <job> --region $REGION

aws sagemaker list-transform-jobs --region $REGION
aws sagemaker describe-transform-job --transform-job-name <job> --region $REGION
```
Ondersoek:

- `AlgorithmSpecification.TrainingImage` / `AppSpecification.ImageUri` – watter ECR images ontplooi word.
- `InputDataConfig` & `OutputDataConfig` – S3 buckets, voorvoegsels en KMS-sleutels.
- `ResourceConfig.VolumeKmsKeyId`, `VpcConfig`, `EnableNetworkIsolation` – bepaal netwerk- of enkripsie-opstelling.
- `HyperParameters` kan omgewingsgeheime of verbindingsstringe leak.

## Pipelines, Eksperimente & Proewe
```bash
aws sagemaker list-pipelines --region $REGION
aws sagemaker list-pipeline-executions --pipeline-name <pipeline> --region $REGION
aws sagemaker describe-pipeline --pipeline-name <pipeline> --region $REGION

aws sagemaker list-experiments --region $REGION
aws sagemaker list-trials --experiment-name <experiment> --region $REGION
aws sagemaker list-trial-components --trial-name <trial> --region $REGION
```
Pyplyn-definisies beskryf elke stap, verwante rolle, kontainerbeelde en omgewingsveranderlikes. Proefkomponente bevat dikwels opleidingsartefak-URIs, S3 logs en metrieks wat dui op sensitiewe datavloei.

## Modelle, Eindpuntkonfigurasies & Ontplooide Eindpunte
```bash
aws sagemaker list-models --region $REGION
aws sagemaker describe-model --model-name <name> --region $REGION

aws sagemaker list-endpoint-configs --region $REGION
aws sagemaker describe-endpoint-config --endpoint-config-name <cfg> --region $REGION

aws sagemaker list-endpoints --region $REGION
aws sagemaker describe-endpoint --endpoint-name <endpoint> --region $REGION
```
Fokusgebiede:

- Model-artefak S3 URIs (`PrimaryContainer.ModelDataUrl`) en inference container images.
- Endpoint data capture-konfigurasie (S3 bucket, KMS) vir moontlike log exfil.
- Multi-model endpoints wat `S3DataSource` of `ModelPackage` gebruik (kontroleer vir cross-account packaging).
- Netwerk-konfigurasies en security groups wat aan endpoints gekoppel is.

## Feature Store, Data Wrangler & Clarify
```bash
aws sagemaker list-feature-groups --region $REGION
aws sagemaker describe-feature-group --feature-group-name <feature-group> --region $REGION

aws sagemaker list-data-wrangler-flows --region $REGION
aws sagemaker describe-data-wrangler-flow --flow-name <flow> --region $REGION

aws sagemaker list-model-quality-job-definitions --region $REGION
aws sagemaker list-model-monitoring-schedule --region $REGION
```
Sekuriteitsopsomming:

- Online feature stores repliseer data na Kinesis; kontroleer `OnlineStoreConfig.SecurityConfig.KmsKeyId` en VPC.
- Data Wrangler flows bevat dikwels ingebedde JDBC/Redshift-inlogbewyse of private endpoints.
- Clarify/Model Monitor-jobs voer data uit na S3 wat dalk wêreldleesbaar of kruis-rekening-toeganklik kan wees.

## MLflow Opsporingsbedieners, Autopilot & JumpStart
```bash
aws sagemaker list-mlflow-tracking-servers --region $REGION
aws sagemaker describe-mlflow-tracking-server --tracking-server-name <name> --region $REGION

aws sagemaker list-auto-ml-jobs --region $REGION
aws sagemaker describe-auto-ml-job --auto-ml-job-name <name> --region $REGION

aws sagemaker list-jumpstart-models --region $REGION
aws sagemaker list-jumpstart-script-resources --region $REGION
```
- MLflow tracking-bedieners berg eksperimente en artefakte; presigned URLs kan alles blootstel.
- Autopilot jobs voer verskeie training jobs uit — ondersoek die uitsette vir versteekte data.
- JumpStart reference architectures kan geprivilegieerde rolle in die account ontplooi.

## IAM & Netwerk-oorwegings

- Lys IAM-beleid wat aan alle uitvoeringsrolle gekoppel is (Studio, notebooks, training jobs, pipelines, endpoints).
- Kontroleer netwerk-kontekste: subnets, security groups, VPC endpoints. Baie organisasies isoleer training jobs maar vergeet om uitgaande verkeer te beperk.
- Hersien S3 bucket policies wat in `ModelDataUrl`, `DataCaptureConfig`, `InputDataConfig` verwys word vir eksterne toegang.

## Privilege Escalation

{{#ref}}
../../aws-privilege-escalation/aws-sagemaker-privesc/README.md
{{#endref}}

## Persistence

{{#ref}}
../../aws-persistence/aws-sagemaker-persistence/README.md
{{#endref}}

## Post-Exploitation

{{#ref}}
../../aws-post-exploitation/aws-sagemaker-post-exploitation/README.md
{{#endref}}

## Unauthorized Access

{{#ref}}
../../aws-unauthenticated-enum-access/aws-sagemaker-unauthenticated-enum/README.md
{{#endref}}

## Verwysings

- [AWS SageMaker Documentation](https://docs.aws.amazon.com/sagemaker/latest/dg/whatis.html)
- [AWS CLI SageMaker Reference](https://docs.aws.amazon.com/cli/latest/reference/sagemaker/index.html)
- [SageMaker Studio Architecture](https://docs.aws.amazon.com/sagemaker/latest/dg/gs-studio.html)
- [SageMaker Security Best Practices](https://docs.aws.amazon.com/sagemaker/latest/dg/security.html)

{{#include ../../../../banners/hacktricks-training.md}}
