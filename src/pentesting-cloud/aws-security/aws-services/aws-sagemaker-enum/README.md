# AWS - SageMaker Enum

{{#include ../../../../banners/hacktricks-training.md}}

## Muhtasari wa Huduma

Amazon SageMaker ni jukwaa iliyoendeshwa na AWS ya machine-learning ambayo inaunganisha notebooks, miundombinu ya training, orchestration, registries, na managed endpoints. Kuingiliwa kwa rasilimali za SageMaker kwa kawaida kunatoa:

- IAM execution roles za muda mrefu zenye upatikanaji mpana wa S3, ECR, Secrets Manager, au KMS.
- Upatikanaji wa seti za data nyeti zilizohifadhiwa katika S3, EFS, au ndani ya feature stores.
- Vifunguo vya mtandao ndani ya VPCs (Studio apps, training jobs, endpoints).
- Presigned URLs zenye ruhusa za juu ambazo zinaweza kupita console authentication.

Kuelewa jinsi SageMaker ilivyojengwa ni muhimu kabla ya kufanya pivot, persist, au exfiltrate data.

## Vipengele vya Msingi

- **Studio Domains & Spaces**: Web IDE (JupyterLab, Code Editor, RStudio). Kila domain ina mfumo wa faili wa EFS unaoshirikiwa na default execution role.
- **Notebook Instances**: Managed EC2 instances kwa notebooks huru; hutumia execution roles tofauti.
- **Training / Processing / Transform Jobs**: Containers za muda mfupi zinazovuta code kutoka ECR na data kutoka S3.
- **Pipelines & Experiments**: Orchestrated workflows ambazo zinaelezea hatua zote, inputs, na outputs.
- **Models & Endpoints**: Artefacts zilizopakizwa zinazotumika kwa inference kupitia HTTPS endpoints.
- **Feature Store & Data Wrangler**: Managed services kwa maandalizi ya data na usimamizi wa features.
- **Autopilot & JumpStart**: Automated ML na katalogi ya modeli zilizochaguliwa.
- **MLflow Tracking Servers**: MLflow UI/API iliyosimamiwa yenye presigned access tokens.

Kila rasilimali ina rejea kwa execution role, maeneo ya S3, container images, na usanidi wa hiari wa VPC/KMS — rekodi zote hizi wakati wa enumeration.

## Akaunti & Metadata ya Ulimwenguni
```bash
REGION=us-east-1
# Portfolio status, used when provisioning Studio resources
aws sagemaker get-sagemaker-servicecatalog-portfolio-status --region $REGION

# List execution roles used by models (extend to other resources as needed)
aws sagemaker list-models --region $REGION --query 'Models[].ExecutionRoleArn' --output text | tr '	' '
' | sort -u

# Generic tag sweep across any SageMaker ARN you know
aws sagemaker list-tags --resource-arn <sagemaker-arn> --region $REGION
```
Tambua uaminifu wowote kati ya akaunti (cross-account trust) — kama execution roles au S3 buckets zenye external principals — na vikwazo vya msingi kama service control policies au SCPs.

## Domaini za Studio, Apps & Nafasi Zilizoshirikiwa
```bash
aws sagemaker list-domains --region $REGION
aws sagemaker describe-domain --domain-id <domain-id> --region $REGION
aws sagemaker list-user-profiles --domain-id-equals <domain-id> --region $REGION
aws sagemaker describe-user-profile --domain-id <domain-id> --user-profile-name <profile> --region $REGION

# Enumerate apps (JupyterServer, KernelGateway, RStudioServerPro, CodeEditor, Canvas, etc.)
aws sagemaker list-apps --domain-id-equals <domain-id> --region $REGION
aws sagemaker describe-app --domain-id <domain-id> --user-profile-name <profile> --app-type JupyterServer --app-name default --region $REGION

# Shared collaborative spaces
aws sagemaker list-spaces --domain-id-equals <domain-id> --region $REGION
aws sagemaker describe-space --domain-id <domain-id> --space-name <space> --region $REGION

# Studio lifecycle configurations (shell scripts at start/stop)
aws sagemaker list-studio-lifecycle-configs --region $REGION
aws sagemaker describe-studio-lifecycle-config --studio-lifecycle-config-name <name> --region $REGION
```
Nini cha kurekodi:

- `DomainArn`, `AppSecurityGroupIds`, `SubnetIds`, `DefaultUserSettings.ExecutionRole`.
- EFS iliyopachikwa (`HomeEfsFileSystemId`) na folda za nyumbani za S3.
- Lifecycle scripts (mara nyingi huwa na bootstrap credentials au push/pull code ya ziada).

> [!TIP]
> Presigned Studio URLs zinaweza kupita uthibitishaji ikiwa zimepewa kwa wingi.

## Notebook Instances & Lifecycle Configs
```bash
aws sagemaker list-notebook-instances --region $REGION
aws sagemaker describe-notebook-instance --notebook-instance-name <name> --region $REGION
aws sagemaker list-notebook-instance-lifecycle-configs --region $REGION
aws sagemaker describe-notebook-instance-lifecycle-config --notebook-instance-lifecycle-config-name <cfg> --region $REGION
```
Metadata ya notebook inaonyesha:

- Role ya utekelezaji (`RoleArn`), ufikiaji wa moja kwa moja wa intaneti dhidi ya hali ya VPC pekee.
- Maeneo ya S3 katika `DefaultCodeRepository`, `DirectInternetAccess`, `RootAccess`.
- Scripts za lifecycle kwa ajili ya credentials au persistence hooks.

## Mafunzo, Usindikaji, Transform & Kazi za Batch
```bash
aws sagemaker list-training-jobs --region $REGION
aws sagemaker describe-training-job --training-job-name <job> --region $REGION

aws sagemaker list-processing-jobs --region $REGION
aws sagemaker describe-processing-job --processing-job-name <job> --region $REGION

aws sagemaker list-transform-jobs --region $REGION
aws sagemaker describe-transform-job --transform-job-name <job> --region $REGION
```
Chunguza kwa makini:

- `AlgorithmSpecification.TrainingImage` / `AppSpecification.ImageUri` – ni ECR images zipi zimewekwa.
- `InputDataConfig` & `OutputDataConfig` – S3 buckets, prefixes, na KMS keys.
- `ResourceConfig.VolumeKmsKeyId`, `VpcConfig`, `EnableNetworkIsolation` – baini msimamo wa mtandao au usimbaji.
- `HyperParameters` inaweza leak siri za mazingira au connection strings.

## Mifereji, Experimenti & Majaribio
```bash
aws sagemaker list-pipelines --region $REGION
aws sagemaker list-pipeline-executions --pipeline-name <pipeline> --region $REGION
aws sagemaker describe-pipeline --pipeline-name <pipeline> --region $REGION

aws sagemaker list-experiments --region $REGION
aws sagemaker list-trials --experiment-name <experiment> --region $REGION
aws sagemaker list-trial-components --trial-name <trial> --region $REGION
```
Maelezo ya pipeline yanaelezea kila hatua, majukumu yaliyohusishwa, picha za container, na variables za mazingira. Vipengele vya majaribio mara nyingi vinabeba URI za artefakti za mafunzo, logi za S3, na metrics zinazoashiria mtiririko wa data nyeti.

## Miundo, Mipangilio ya Endpoint & Endpoints Zilizowekwa
```bash
aws sagemaker list-models --region $REGION
aws sagemaker describe-model --model-name <name> --region $REGION

aws sagemaker list-endpoint-configs --region $REGION
aws sagemaker describe-endpoint-config --endpoint-config-name <cfg> --region $REGION

aws sagemaker list-endpoints --region $REGION
aws sagemaker describe-endpoint --endpoint-name <endpoint> --region $REGION
```
Maeneo ya kipaumbele:

- URI za artefakti za modeli kwenye S3 (`PrimaryContainer.ModelDataUrl`) na container images za inference.
- Usanidi wa Endpoint data capture (S3 bucket, KMS) kwa ajili ya uwezekano wa log exfil.
- Multi-model endpoints zinazotumia `S3DataSource` au `ModelPackage` (kagua kwa cross-account packaging).
- Network configs na security groups zilizounganishwa na endpoints.

## Feature Store, Data Wrangler & Clarify
```bash
aws sagemaker list-feature-groups --region $REGION
aws sagemaker describe-feature-group --feature-group-name <feature-group> --region $REGION

aws sagemaker list-data-wrangler-flows --region $REGION
aws sagemaker describe-data-wrangler-flow --flow-name <flow> --region $REGION

aws sagemaker list-model-quality-job-definitions --region $REGION
aws sagemaker list-model-monitoring-schedule --region $REGION
```
Mambo muhimu ya usalama:

- Online feature stores hureplica data kwa Kinesis; angalia `OnlineStoreConfig.SecurityConfig.KmsKeyId` na VPC.
- Data Wrangler flows mara nyingi hujumuisha nenosiri za JDBC/Redshift au endpoints za kibinafsi.
- Clarify/Model Monitor jobs huweka data kwenye S3 ambayo inaweza kusomeka kwa umma au kupatikana kwa accounts nyingine.

## MLflow Tracking Servers, Autopilot & JumpStart
```bash
aws sagemaker list-mlflow-tracking-servers --region $REGION
aws sagemaker describe-mlflow-tracking-server --tracking-server-name <name> --region $REGION

aws sagemaker list-auto-ml-jobs --region $REGION
aws sagemaker describe-auto-ml-job --auto-ml-job-name <name> --region $REGION

aws sagemaker list-jumpstart-models --region $REGION
aws sagemaker list-jumpstart-script-resources --region $REGION
```
- MLflow tracking servers store experiments and artefacts; presigned URLs can expose everything.
- Autopilot jobs spin multiple training jobs—enumerate outputs for hidden data.
- JumpStart reference architectures may deploy privileged roles into the account.

## IAM & Networking Considerations

- Enumerate IAM policies attached to all execution roles (Studio, notebooks, training jobs, pipelines, endpoints).
- Check network contexts: subnets, security groups, VPC endpoints. Many organisations isolate training jobs but forget to restrict outbound traffic.
- Review S3 bucket policies referenced in `ModelDataUrl`, `DataCaptureConfig`, `InputDataConfig` for external access.

## Privilege Escalation

{{#ref}}
../../aws-privilege-escalation/aws-sagemaker-privesc/README.md
{{#endref}}

## Persistence

{{#ref}}
../../aws-persistence/aws-sagemaker-persistence/README.md
{{#endref}}

## Post-Exploitation

{{#ref}}
../../aws-post-exploitation/aws-sagemaker-post-exploitation/README.md
{{#endref}}

## Unauthorized Access

{{#ref}}
../aws-sagemaker-unauthenticated-enum/README.md
{{#endref}}

## References

- [AWS SageMaker Documentation](https://docs.aws.amazon.com/sagemaker/latest/dg/whatis.html)
- [AWS CLI SageMaker Reference](https://docs.aws.amazon.com/cli/latest/reference/sagemaker/index.html)
- [SageMaker Studio Architecture](https://docs.aws.amazon.com/sagemaker/latest/dg/gs-studio.html)
- [SageMaker Security Best Practices](https://docs.aws.amazon.com/sagemaker/latest/dg/security.html)

{{#include ../../../../banners/hacktricks-training.md}}
