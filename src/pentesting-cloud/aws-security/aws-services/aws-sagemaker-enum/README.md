# AWS - SageMaker Enum

{{#include ../../../../banners/hacktricks-training.md}}

## Muhtasari wa Huduma

Amazon SageMaker ni jukwaa la AWS la managed machine-learning linalounganisha notebooks, training infrastructure, orchestration, registries, na managed endpoints. Kukamatwa kwa rasilimali za SageMaker kwa kawaida kunatoa:

- Roles za utekelezaji za IAM zenye maisha marefu na ufikiaji mpana wa S3, ECR, Secrets Manager, au KMS.
- Ufikiaji wa datasets nyeti zilizohifadhiwa kwenye S3, EFS, au ndani ya feature stores.
- Footholds za mtandao ndani ya VPCs (Studio apps, training jobs, endpoints).
- Presigned URLs zenye kiwango cha juu cha ruhusa zinazopita authentication ya console.

Kuelewa jinsi SageMaker imejengwa ni muhimu kabla ya pivot, persist, au exfiltrate data.

## Core Building Blocks

- **Studio Domains & Spaces**: Web IDE (JupyterLab, Code Editor, RStudio). Kila domain ina sistema ya faili ya shared EFS na default execution role.
- **Notebook Instances**: Managed EC2 instances kwa notebooks standalone; hutumia execution roles tofauti.
- **Training / Processing / Transform Jobs**: Containers za ephemeral zinazovuta code kutoka ECR na data kutoka S3.
- **Pipelines & Experiments**: Workflows za orchestration zinazoeleza hatua zote, inputs, na outputs.
- **Models & Endpoints**: Artefacts zilizopakizwa zinazotumika kwa inference kupitia HTTPS endpoints.
- **Feature Store & Data Wrangler**: Managed services kwa maandalizi ya data na usimamizi wa features.
- **Autopilot & JumpStart**: Automated ML na catalogue ya models iliyorekebishwa.
- **MLflow Tracking Servers**: Managed MLflow UI/API zenye presigned access tokens.

Kila rasilimali inarejea execution role, S3 locations, container images, na configuration ya hiari ya VPC/KMS—zisikie zote wakati wa enumeration.

## Metadata ya Akaunti & Ulimwenguni
```bash
REGION=us-east-1
# Portfolio status, used when provisioning Studio resources
aws sagemaker get-sagemaker-servicecatalog-portfolio-status --region $REGION

# List execution roles used by models (extend to other resources as needed)
aws sagemaker list-models --region $REGION --query 'Models[].ExecutionRoleArn' --output text | tr '	' '
' | sort -u

# Generic tag sweep across any SageMaker ARN you know
aws sagemaker list-tags --resource-arn <sagemaker-arn> --region $REGION
```
Angalia chochote cross-account trust (execution roles or S3 buckets with external principals) na vikwazo vya msingi kama service control policies or SCPs.

## Studio Domains, Apps & Shared Spaces
```bash
aws sagemaker list-domains --region $REGION
aws sagemaker describe-domain --domain-id <domain-id> --region $REGION
aws sagemaker list-user-profiles --domain-id-equals <domain-id> --region $REGION
aws sagemaker describe-user-profile --domain-id <domain-id> --user-profile-name <profile> --region $REGION

# Enumerate apps (JupyterServer, KernelGateway, RStudioServerPro, CodeEditor, Canvas, etc.)
aws sagemaker list-apps --domain-id-equals <domain-id> --region $REGION
aws sagemaker describe-app --domain-id <domain-id> --user-profile-name <profile> --app-type JupyterServer --app-name default --region $REGION

# Shared collaborative spaces
aws sagemaker list-spaces --domain-id-equals <domain-id> --region $REGION
aws sagemaker describe-space --domain-id <domain-id> --space-name <space> --region $REGION

# Studio lifecycle configurations (shell scripts at start/stop)
aws sagemaker list-studio-lifecycle-configs --region $REGION
aws sagemaker describe-studio-lifecycle-config --studio-lifecycle-config-name <name> --region $REGION
```
Kile cha kurekodi:

- `DomainArn`, `AppSecurityGroupIds`, `SubnetIds`, `DefaultUserSettings.ExecutionRole`.
- EFS iliyopachikwa (`HomeEfsFileSystemId`) na saraka za nyumbani za S3.
- Scripti za lifecycle (mara nyingi zinaweza kuwa na bootstrap credentials au code ya ziada ya push/pull).

> [!TIP]
> Presigned Studio URLs zinaweza kupitisha uthibitisho ikiwa zimetolewa kwa upana.

## Notebook Instances & Lifecycle Configs
```bash
aws sagemaker list-notebook-instances --region $REGION
aws sagemaker describe-notebook-instance --notebook-instance-name <name> --region $REGION
aws sagemaker list-notebook-instance-lifecycle-configs --region $REGION
aws sagemaker describe-notebook-instance-lifecycle-config --notebook-instance-lifecycle-config-name <cfg> --region $REGION
```
Metadata ya notebook inaonyesha:

- Role ya utekelezaji (`RoleArn`), ufikiaji wa moja kwa moja wa intaneti dhidi ya hali ya VPC pekee.
- Maeneo ya S3 katika `DefaultCodeRepository`, `DirectInternetAccess`, `RootAccess`.
- Script za lifecycle kwa ajili ya credentials au persistence hooks.

## Mafunzo, Usindikaji, Transform & Batch Jobs
```bash
aws sagemaker list-training-jobs --region $REGION
aws sagemaker describe-training-job --training-job-name <job> --region $REGION

aws sagemaker list-processing-jobs --region $REGION
aws sagemaker describe-processing-job --processing-job-name <job> --region $REGION

aws sagemaker list-transform-jobs --region $REGION
aws sagemaker describe-transform-job --transform-job-name <job> --region $REGION
```
Chunguza:

- `AlgorithmSpecification.TrainingImage` / `AppSpecification.ImageUri` – ni ECR images gani zimetumika.
- `InputDataConfig` & `OutputDataConfig` – S3 buckets, prefixes, na KMS keys.
- `ResourceConfig.VolumeKmsKeyId`, `VpcConfig`, `EnableNetworkIsolation` – zinaamua msimamo wa mtandao au usimbaji.
- `HyperParameters` inaweza leak siri za mazingira au connection strings.

## Pipelines, Experiments & Trials
```bash
aws sagemaker list-pipelines --region $REGION
aws sagemaker list-pipeline-executions --pipeline-name <pipeline> --region $REGION
aws sagemaker describe-pipeline --pipeline-name <pipeline> --region $REGION

aws sagemaker list-experiments --region $REGION
aws sagemaker list-trials --experiment-name <experiment> --region $REGION
aws sagemaker list-trial-components --trial-name <trial> --region $REGION
```
Ufafanuzi wa pipeline unaeleza kila hatua, majukumu yanayohusiana, container images, na environment variables. Vijenge vya jaribio mara nyingi vina training artefact URIs, logi za S3, na metrics zinazoweza kuashiria mtiririko wa data nyeti.

## Modeli, Mipangilio ya Endpoint & Endpoints Zilizowekwa
```bash
aws sagemaker list-models --region $REGION
aws sagemaker describe-model --model-name <name> --region $REGION

aws sagemaker list-endpoint-configs --region $REGION
aws sagemaker describe-endpoint-config --endpoint-config-name <cfg> --region $REGION

aws sagemaker list-endpoints --region $REGION
aws sagemaker describe-endpoint --endpoint-name <endpoint> --region $REGION
```
Maeneo ya kuzingatia:

- URI za artefact za modeli za S3 (`PrimaryContainer.ModelDataUrl`) na inference container images.
- Usanidi wa kunasa data wa endpoint (S3 bucket, KMS) kwa ajili ya possible log exfil.
- Multi-model endpoints zinazotumia `S3DataSource` au `ModelPackage` (angalia cross-account packaging).
- Mipangilio ya network na security groups zilizoambatishwa kwa endpoints.

## Feature Store, Data Wrangler & Clarify
```bash
aws sagemaker list-feature-groups --region $REGION
aws sagemaker describe-feature-group --feature-group-name <feature-group> --region $REGION

aws sagemaker list-data-wrangler-flows --region $REGION
aws sagemaker describe-data-wrangler-flow --flow-name <flow> --region $REGION

aws sagemaker list-model-quality-job-definitions --region $REGION
aws sagemaker list-model-monitoring-schedule --region $REGION
```
Mambo muhimu ya usalama:

- Online feature stores hunakili data kwa Kinesis; angalia `OnlineStoreConfig.SecurityConfig.KmsKeyId` na VPC.
- Data Wrangler flows mara nyingi huingiza kredensiali za JDBC/Redshift au private endpoints.
- Clarify/Model Monitor jobs hutoa data kwenda S3 ambayo inaweza kusomwa na mtu yeyote (world-readable) au kupatikana kwa akaunti nyingine (cross-account accessible).

## MLflow Seva za Kufuatilia, Autopilot & JumpStart
```bash
aws sagemaker list-mlflow-tracking-servers --region $REGION
aws sagemaker describe-mlflow-tracking-server --tracking-server-name <name> --region $REGION

aws sagemaker list-auto-ml-jobs --region $REGION
aws sagemaker describe-auto-ml-job --auto-ml-job-name <name> --region $REGION

aws sagemaker list-jumpstart-models --region $REGION
aws sagemaker list-jumpstart-script-resources --region $REGION
```
- Server za tracking za MLflow zinahifadhi experiments na artefacts; presigned URLs zinaweza kufichua kila kitu.
- Autopilot jobs huendesha training jobs nyingi—orodhesha outputs kutafuta data iliyofichwa.
- JumpStart reference architectures zinaweza kupeleka privileged roles ndani ya akaunti.

## IAM & Mambo ya Mtandao

- Orodhesha IAM policies zilizounganishwa na execution roles zote (Studio, notebooks, training jobs, pipelines, endpoints).
- Kagua muktadha wa mtandao: subnets, security groups, VPC endpoints. Mashirika mengi hutenganisha training jobs lakini kusahau kuzuia outbound traffic.
- Kagua S3 bucket policies zilizotajwa katika `ModelDataUrl`, `DataCaptureConfig`, `InputDataConfig` kwa ufikiaji wa nje.

## Privilege Escalation

{{#ref}}
../../aws-privilege-escalation/aws-sagemaker-privesc/README.md
{{#endref}}

## Persistence

{{#ref}}
../../aws-persistence/aws-sagemaker-persistence/README.md
{{#endref}}

## Post-Exploitation

{{#ref}}
../../aws-post-exploitation/aws-sagemaker-post-exploitation/README.md
{{#endref}}

## Unauthorized Access

{{#ref}}
../aws-sagemaker-unauthenticated-enum/README.md
{{#endref}}

## Marejeo

- [AWS SageMaker Documentation](https://docs.aws.amazon.com/sagemaker/latest/dg/whatis.html)
- [AWS CLI SageMaker Reference](https://docs.aws.amazon.com/cli/latest/reference/sagemaker/index.html)
- [SageMaker Studio Architecture](https://docs.aws.amazon.com/sagemaker/latest/dg/gs-studio.html)
- [SageMaker Security Best Practices](https://docs.aws.amazon.com/sagemaker/latest/dg/security.html)

{{#include ../../../../banners/hacktricks-training.md}}
