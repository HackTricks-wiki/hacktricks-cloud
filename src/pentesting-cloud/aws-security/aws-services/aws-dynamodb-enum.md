# AWS - DynamoDB Enum

{{#include ../../../banners/hacktricks-training.md}}

## DynamoDB

### Temel Bilgiler

Amazon DynamoDB, AWS tarafından **tamamen yönetilen, sunucusuz, anahtar-değer NoSQL veritabanı** olarak sunulmaktadır ve boyutlarından bağımsız olarak yüksek performanslı uygulamaları desteklemek için tasarlanmıştır. Hizmet, yerleşik güvenlik önlemleri, kesintisiz yedeklemeler, birden fazla bölgede otomatik çoğaltma, entegre bellek içi önbellekleme ve kullanışlı veri dışa aktarma araçları gibi sağlam özellikler sunar.

DynamoDB bağlamında, geleneksel bir veritabanı kurmak yerine, **tablolar oluşturulur**. Her tablo, **tablonun birincil anahtarının** ayrılmaz bir bileşeni olarak bir **bölüm anahtarı** belirtmeyi zorunlu kılar. Bu bölüm anahtarı, esasen bir **hash değeri** olup, hem öğelerin alınmasında hem de verilerin çeşitli sunucular arasında dağıtımında kritik bir rol oynar. Bu dağıtım, veritabanının ölçeklenebilirliğini ve kullanılabilirliğini korumak için hayati öneme sahiptir. Ayrıca, veri organizasyonunu daha da geliştirmek için bir **sıralama anahtarı** ekleme seçeneği de bulunmaktadır.

### Şifreleme

Varsayılan olarak, DynamoDB, **Amazon DynamoDB'ye ait** bir KMS anahtarı kullanır, bu anahtar, en azından hesabınıza ait olan AWS yönetilen anahtar bile değildir.

<figure><img src="https://lh4.googleusercontent.com/JjtNS7aA-_GRMgZb4v93jWEQJi6DQdUPq0FEpzZPdeyCeNoG05p0NJiV9Zs-ULs_-Tfjmx0W1ZgsE2Ui2ljo7D-1a87Xny-gpLVQO0XmXdFoph9ci1RepbVNwaCe9oPruEZSEDxGTxF5dIv6pW1WpT6kWA=s2048" alt=""><figcaption></figcaption></figure>

### Yedeklemeler & S3'e Dışa Aktarma

**Tablo yedeklemelerinin** oluşturulmasını **planlamak** veya **talep üzerine** oluşturmak mümkündür. Ayrıca, bir tablo için **Zamanda Nokta Kurtarma (PITR)** özelliğini etkinleştirmek de mümkündür. Zamanda nokta kurtarma, yanlış yazma veya silme işlemlerine karşı koruma sağlamak için DynamoDB verilerinizi **35 gün** boyunca sürekli **yedekler**.

Ayrıca, **bir tablonun verilerini S3'e dışa aktarmak** da mümkündür, ancak tablonun **PITR etkinleştirilmiş** olması gerekir.

### GUI

[https://github.com/aaronshaf/dynamodb-admin](https://github.com/aaronshaf/dynamodb-admin) gibi yerel Dynamo hizmetleri için [DynamoDB Local](https://aws.amazon.com/blogs/aws/dynamodb-local-for-desktop-development/), [dynalite](https://github.com/mhart/dynalite), [localstack](https://github.com/localstack/localstack) gibi yararlı bir GUI bulunmaktadır.

### Enumeration
```bash
# Tables
aws dynamodb list-tables
aws dynamodb describe-table --table-name <t_name> #Get metadata info
## The primary key and sort key will appear inside the KeySchema field

#Check if point in time recovery is enabled
aws dynamodb describe-continuous-backups \
--table-name tablename

# Backups
aws dynamodb list-backups
aws dynamodb describe-backup --backup-arn <arn>
aws dynamodb describe-continuous-backups --table-name <t_name>

# Global tables
aws dynamodb list-global-tables
aws dynamodb describe-global-table --global-table-name <name>

# Exports
aws dynamodb list-exports
aws dynamodb describe-export --export-arn <arn>

# Misc
aws dynamodb describe-endpoints #Dynamodb endpoints
```
### Kimlik Doğrulama Olmadan Erişim

{{#ref}}
../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md
{{#endref}}

### Yetki Yükseltme

{{#ref}}
../aws-privilege-escalation/aws-dynamodb-privesc.md
{{#endref}}

### Saldırı Sonrası

{{#ref}}
../aws-post-exploitation/aws-dynamodb-post-exploitation.md
{{#endref}}

### Süreklilik

{{#ref}}
../aws-persistence/aws-dynamodb-persistence.md
{{#endref}}

## DynamoDB Enjeksiyonu

### SQL Enjeksiyonu

DynamoDB verilerine **SQL sözdizimi** ile erişmenin yolları vardır, bu nedenle tipik **SQL enjeksiyonları da mümkündür**.

{{#ref}}
https://book.hacktricks.xyz/pentesting-web/sql-injection
{{#endref}}

### NoSQL Enjeksiyonu

DynamoDB'de verileri almak için farklı **koşullar** kullanılabilir, eğer bir NoSQL Enjeksiyonu'nda olduğu gibi **verileri almak için daha fazla koşul zincirleme** mümkünse, gizli verilere (veya tüm tabloyu dökme) ulaşabilirsiniz.\
DynamoDB tarafından desteklenen koşulları burada bulabilirsiniz: [https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_Condition.html](https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_Condition.html)

Verilere **`query`** veya **`scan`** aracılığıyla erişiliyorsa **farklı koşulların** desteklendiğini unutmayın.

> [!NOTE]
> Aslında, **Query** işlemleri, çalışması için **birincil** anahtarda **"EQ" (eşittir)** koşulunu belirtmelidir, bu da onu **NoSQL enjeksiyonlarına karşı daha az duyarlı** hale getirir (ve ayrıca işlemi çok sınırlı hale getirir).

Eğer **karşılaştırmayı** değiştirebilir veya yenilerini ekleyebilirseniz, daha fazla veri alabilirsiniz.
```bash
# Comparators to dump the database
"NE": "a123" #Get everything that doesn't equal "a123"
"NOT_CONTAINS": "a123" #What you think
"GT": " " #All strings are greater than a space
```
{{#ref}}
https://book.hacktricks.xyz/pentesting-web/nosql-injection
{{#endref}}

### Ham Json enjeksiyonu

> [!DİKKAT]
> **Bu zafiyet, artık kullanımdan kaldırılmış olan dynamodb Scan Filter'a dayanmaktadır!**

**DynamoDB**, DB içindeki verileri **arama** için **Json** nesnelerini kabul eder. Eğer arama için gönderilen json nesnesinde yazma yapabileceğinizi bulursanız, DB'yi dökebilir, tüm içeriklerini alabilirsiniz.

Örneğin, bir isteğe enjeksiyon yaparak:
```bash
'{"Id": {"ComparisonOperator": "EQ","AttributeValueList": [{"N": "' + user_input + '"}]}}'
```
bir saldırgan şunları enjekte edebilir:

`1000"}],"ComparisonOperator": "GT","AttributeValueList": [{"N": "0`

ID 1000 için "EQ" koşulunu düzeltin ve ardından 0'dan büyük bir Id dizesi ile tüm verileri arayın, bu da hepsidir.

Başka bir **gü vulnerable örnek bir giriş kullanarak** şöyle olabilir:
```python
scan_filter = """{
"username": {
"ComparisonOperator": "EQ",
"AttributeValueList": [{"S": "%s"}]
},
"password": {
"ComparisonOperator": "EQ",
"AttributeValueList": [{"S": "%s"}]
}
}
""" % (user_data['username'], user_data['password'])

dynamodb.scan(TableName="table-name", ScanFilter=json.loads(scan_filter))
```
Bu, şuna karşı savunmasız olacaktır:
```
username: none"}],"ComparisonOperator": "NE","AttributeValueList": [{"S": "none
password: none"}],"ComparisonOperator": "NE","AttributeValueList": [{"S": "none
```
### :property Injection

Bazı SDK'lar, gerçekleştirilecek filtrelemeyi belirten bir dize kullanmaya izin verir, örneğin:
```java
new ScanSpec().withProjectionExpression("UserName").withFilterExpression(user_input+" = :username and Password = :password").withValueMap(valueMap)
```
DynamoDB'de **filtre ifadelerinde** bir niteliğin **değerini** **değiştirmek** için öğeleri tararken, token'ların **`:`** karakteri ile **başlaması** gerektiğini bilmelisiniz. Bu token'lar, **çalışma zamanında** gerçek **nitelik değeri ile** **değiştirilecektir**.

Bu nedenle, önceki gibi bir giriş, şu şekilde atlatılabilir:
```bash
:username = :username or :username
# This will generate the query:
# :username = :username or :username = :username and Password = :password
# which is always true
```
{{#include ../../../banners/hacktricks-training.md}}
