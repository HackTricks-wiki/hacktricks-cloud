# AWS - ECR Enum

## AWS - ECR Enum

{{#include ../../../banners/hacktricks-training.md}}

### ECR

#### Basic Information

Amazon **Elastic Container Registry** (Amazon ECR) ni **huduma ya usajili wa picha za kontena inayosimamiwa**. Imeundwa ili kutoa mazingira ambapo wateja wanaweza kuingiliana na picha zao za kontena kwa kutumia interfaces zinazojulikana. Kwa haswa, matumizi ya Docker CLI au mteja yeyote anayependelea yanasaidiwa, kuruhusu shughuli kama vile kusukuma, kuvuta, na kusimamia picha za kontena.

ECR inajumuisha aina 2 za vitu: **Registries** na **Repositories**.

**Registries**

Kila akaunti ya AWS ina registries 2: **Private** & **Public**.

1. **Private Registries**:

- **Private kwa default**: Picha za kontena zilizohifadhiwa katika usajili wa kibinafsi wa Amazon ECR ni **zinapatikana tu kwa watumiaji walioidhinishwa** ndani ya akaunti yako ya AWS au kwa wale ambao wamepewa ruhusa.
- URI ya **repository ya kibinafsi** inafuata muundo `<account_id>.dkr.ecr.<region>.amazonaws.com/<repo-name>`
- **Udhibiti wa ufikiaji**: Unaweza **kudhibiti ufikiaji** wa picha zako za kontena za kibinafsi kwa kutumia **sera za IAM**, na unaweza kuunda ruhusa za kina kulingana na watumiaji au majukumu.
- **Ushirikiano na huduma za AWS**: Usajili wa kibinafsi wa Amazon ECR unaweza **kuunganishwa kwa urahisi na huduma nyingine za AWS**, kama EKS, ECS...
- **Chaguzi nyingine za usajili wa kibinafsi**:
- Safu ya immutability ya Tag inaonyesha hali yake, ikiwa immutability ya tag imewezeshwa it **zuia** picha **kusukumwa** na **tags zilizopo** kutoka kufunika picha hizo.
- Safu ya **aina ya Uthibitishaji** inaonyesha mali za uthibitishaji za repository, inaonyesha aina za uthibitishaji za default kama AES-256, au ina **KMS** iliyowezeshwa.
- Safu ya **Pull through cache** inaonyesha hali yake, ikiwa hali ya Pull through cache ni Active itahifadhi **repositories katika usajili wa umma wa nje ndani ya repository yako ya kibinafsi**.
- Sera maalum za **IAM** zinaweza kuundwa ili kutoa ruhusa tofauti.
- **Mkonfigu wa skanning** inaruhusu kuchunguza udhaifu katika picha zilizohifadhiwa ndani ya repo.

2. **Public Registries**:

- **Upatikanaji wa umma**: Picha za kontena zilizohifadhiwa katika usajili wa Umma wa ECR ni **zinapatikana kwa mtu yeyote kwenye mtandao bila uthibitisho.**
- URI ya **repository ya umma** ni kama `public.ecr.aws/<random>/<name>`. Ingawa sehemu ya `<random>` inaweza kubadilishwa na msimamizi kuwa string nyingine rahisi kukumbuka.

**Repositories**

Hizi ni **picha** ambazo ziko katika **usajili wa kibinafsi** au kwa **umum**.

> [!NOTE]
> Kumbuka kwamba ili kupakia picha kwenye repository, **repository ya ECR inahitaji kuwa na jina sawa na picha**.

#### Registry & Repository Policies

**Registries & repositories** pia zina **sera ambazo zinaweza kutumika kutoa ruhusa kwa wahusika/akaunti nyingine**. Kwa mfano, katika picha ifuatayo ya sera ya repository unaweza kuona jinsi mtumiaji yeyote kutoka shirika zima atavyoweza kufikia picha hiyo:

<figure><img src="../../../images/image (280).png" alt=""><figcaption></figcaption></figure>

#### Enumeration
```bash
# Get repos
aws ecr describe-repositories
aws ecr describe-registry

# Get image metadata
aws ecr list-images --repository-name <repo_name>
aws ecr describe-images --repository-name <repo_name>
aws ecr describe-image-replication-status --repository-name <repo_name> --image-id <image_id>
aws ecr describe-image-scan-findings --repository-name <repo_name> --image-id <image_id>
aws ecr describe-pull-through-cache-rules --repository-name <repo_name> --image-id <image_id>

# Get public repositories
aws ecr-public describe-repositories

# Get policies
aws ecr get-registry-policy
aws ecr get-repository-policy --repository-name <repo_name>
```
#### Unauthenticated Enum

{{#ref}}
../aws-unauthenticated-enum-access/aws-ecr-unauthenticated-enum.md
{{#endref}}

#### Privesc

Katika ukurasa ufuatao unaweza kuangalia jinsi ya **kudhulumu ruhusa za ECR ili kupandisha mamlaka**:

{{#ref}}
../aws-privilege-escalation/aws-ecr-privesc.md
{{#endref}}

#### Post Exploitation

{{#ref}}
../aws-post-exploitation/aws-ecr-post-exploitation.md
{{#endref}}

#### Persistence

{{#ref}}
../aws-persistence/aws-ecr-persistence.md
{{#endref}}

## References

- [https://docs.aws.amazon.com/AmazonECR/latest/APIReference/Welcome.html](https://docs.aws.amazon.com/AmazonECR/latest/APIReference/Welcome.html)

{{#include ../../../banners/hacktricks-training.md}}
