# AWS - CodeBuild Неавтентифікований доступ

{{#include ../../../../banners/hacktricks-training.md}}

## CodeBuild

Для більш детальної інформації див. цю сторінку:

{{#ref}}
../../aws-services/aws-codebuild-enum.md
{{#endref}}

### buildspec.yml

Якщо ви отримаєте права запису в репозиторій, який містить файл з назвою **`buildspec.yml`**, ви можете **backdoor** цей файл — він визначає **команди, що будуть виконані** в проекті CodeBuild і дозволяє exfiltrate the secrets, скомпрометувати виконувані дії та також скомпрометувати **CodeBuild IAM role credentials**.

Зверніть увагу, що навіть якщо файлу **`buildspec.yml`** немає, але ви знаєте, що використовується CodeBuild (або інший CI/CD), **зміна легітимного коду**, який буде виконуватись, також може, наприклад, дати вам reverse shell.

Для суміжної інформації перегляньте сторінку про те, як атакувати Github Actions (схоже на це):

{{#ref}}
../../../../pentesting-ci-cd/github-security/abusing-github-actions/
{{#endref}}

## Self-hosted GitHub Actions runners in AWS CodeBuild <a href="#action-runner" id="action-runner"></a>

Як [**вказано в документації**](https://docs.aws.amazon.com/codebuild/latest/userguide/action-runner.html), можливо налаштувати **CodeBuild** для запуску **self-hosted Github actions**, коли у відповідному Github repo тригериться workflow. Це можна виявити, перевіривши конфігурацію проекту CodeBuild, оскільки **`Event type`** має містити: **`WORKFLOW_JOB_QUEUED`**, а в Github Workflow буде обрано **self-hosted** runner, як от:
```bash
runs-on: codebuild-<project-name>-${{ github.run_id }}-${{ github.run_attempt }}
```
Цей новий зв'язок між Github Actions та AWS створює ще один спосіб скомпрометувати AWS через Github, оскільки код на Github виконуватиметься в проекті CodeBuild з прикріпленою роллю IAM.

{{#include ../../../../banners/hacktricks-training.md}}
