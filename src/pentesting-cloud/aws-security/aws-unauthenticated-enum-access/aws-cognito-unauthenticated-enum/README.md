# AWS - Cognito Unauthenticated Enum

{{#include ../../../../banners/hacktricks-training.md}}

## Unauthenticated Cognito

Cognito ni huduma ya AWS inayowezesha watengenezaji **kuwawezesha watumiaji wa app zao kupata huduma za AWS**. Watengenezaji watatoa **IAM roles kwa watumiaji walio na uthibitisho** kwenye app yao (huenda watu waweze kujisajili tu) na pia wanaweza kutoa **IAM role kwa watumiaji wasiojathibitishwa**.

Kwa taarifa za msingi kuhusu Cognito angalia:

{{#ref}}
../../aws-services/aws-cognito-enum/
{{#endref}}

### Identity Pool ID

Identity Pools zinaweza kutoa **IAM roles kwa watumiaji wasiojathibitishwa** ambao tu **wanajua Identity Pool ID** (ambayo ni ya kawaida sana kuipata), na mshambuliaji akiwa na taarifa hii anaweza kujaribu **kupata ufikiaji wa IAM role hiyo** na kuifanya matumizi mabaya.\
Zaidi ya hayo, IAM roles pia zinaweza kutolewa kwa **watumiaji walio na uthibitisho** wanaoingia kwenye Identity Pool. Ikiwa mshambuliaji anaweza **kujiregistra mtumiaji** au tayari ana **ufikiaji wa identity provider** inayotumika katika identity pool, unaweza kupata **IAM role inayotolewa kwa watumiaji walio na uthibitisho** na kuitumia vibaya ruhusa zake.

[**Check how to do that here**](../../aws-services/aws-cognito-enum/cognito-identity-pools.md).

### User Pool ID

Kwa chaguo-msingi Cognito inaruhusu **kujiregistra mtumiaji mpya**. Kuwa na uwezo wa kujisajili kunaweza kukupa **ufikiaji** kwa **application iliyoko chini** au kwa **authenticated IAM access role ya Identity Pool** ambayo inakubali Cognito User Pool kama identity provider. [**Check how to do that here**](../../aws-services/aws-cognito-enum/cognito-user-pools.md#registration).

### Pacu modules for pentesting and enumeration

[Pacu](https://github.com/RhinoSecurityLabs/pacu), the AWS exploitation framework, sasa inajumuisha moduli za "cognito__enum" na "cognito__attack" ambazo zinaendesha enumeration ya mali zote za Cognito katika akaunti na kubaini misanidi dhaifu, sifa za watumiaji zinazotumika kwa udhibiti wa ufikiaji, n.k., na pia zinaendesha uundaji wa watumiaji (ikiwa ni pamoja na msaada wa MFA) na privilege escalation kulingana na custom attributes zinazoweza kubadilishwa, vitambulisho vinavyotumika vya identity pool, roles zinazoweza kuchukuliwa katika id tokens, n.k.

Kwa maelezo ya kazi za moduli angalia sehemu ya 2 ya [blog post](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2). Kwa maagizo ya ufungaji angalia ukurasa mkuu wa [Pacu](https://github.com/RhinoSecurityLabs/pacu).

#### Matumizi

Mfano wa matumizi ya `cognito__attack` kujaribu uundaji wa mtumiaji na vigezo vyote vya privesc dhidi ya identity pool na user pool client fulani:
```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
Mfano wa matumizi ya cognito\_\_enum kukusanya user pools zote, user pool clients, identity pools, users, n.k. zinazoonekana katika akaunti ya sasa ya AWS:
```bash
Pacu (new:test) > run cognito__enum
```
{{#include ../../../../banners/hacktricks-training.md}}
