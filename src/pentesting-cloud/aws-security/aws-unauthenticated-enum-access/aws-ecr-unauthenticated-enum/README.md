# AWS - ECR Unauthenticated Enum

{{#include ../../../../banners/hacktricks-training.md}}

## ECR

For more information check:

{{#ref}}
../../aws-services/aws-ecr-enum.md
{{#endref}}

### パブリックレジストリのリポジトリ（イメージ）

As mentioned in the ECS Enum section, a public registry is **accessible by anyone** uses the format **`public.ecr.aws/<random>/<name>`**. If a public repository URL is located by an attacker he could **download the image and search for sensitive information** in the metadata and content of the image.
```bash
aws ecr describe-repositories --query 'repositories[?repositoryUriPublic == `true`].repositoryName' --output text
```
> [!WARNING]
> これは **プライベートレジストリ** においても、レジストリポリシーやリポジトリポリシーが **例えば `"AWS": "*"` にアクセスを許可している** 場合に発生する可能性があります。誰でもAWSアカウントを持っていればそのrepoにアクセスできる可能性があります。
    
### プライベートRepoの列挙

ツール [**skopeo**](https://github.com/containers/skopeo) と [**crane**](https://github.com/google/go-containerregistry/blob/main/cmd/crane/doc/crane.md) を使って、プライベートレジストリ内のアクセス可能なリポジトリを一覧することができます。
```bash
# Get image names
skopeo list-tags docker://<PRIVATE_REGISTRY_URL> | grep -oP '(?<=^Name: ).+'
crane ls <PRIVATE_REGISTRY_URL> | sed 's/ .*//'
```
{{#include ../../../../banners/hacktricks-training.md}}
