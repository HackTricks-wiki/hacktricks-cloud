# AWS - Acceso No Autenticado a CodeBuild

{{#include ../../../banners/hacktricks-training.md}}

## CodeBuild

Para más información, consulta esta página:

{{#ref}}
../aws-services/aws-codebuild-enum.md
{{#endref}}

### buildspec.yml

Si comprometes el acceso de escritura sobre un repositorio que contiene un archivo llamado **`buildspec.yml`**, podrías **insertar un backdoor** en este archivo, que especifica los **comandos que se van a ejecutar** dentro de un proyecto de CodeBuild y exfiltrar los secretos, comprometer lo que se hace y también comprometer las **credenciales del rol IAM de CodeBuild**.

Ten en cuenta que incluso si no hay ningún archivo **`buildspec.yml`** pero sabes que se está utilizando Codebuild (o un CI/CD diferente), **modificar algún código legítimo** que se va a ejecutar también puede conseguirte un shell reverso, por ejemplo.

Para más información relacionada, podrías consultar la página sobre cómo atacar Github Actions (similar a esto):

{{#ref}}
../../../pentesting-ci-cd/github-security/abusing-github-actions/
{{#endref}}

## Runners de GitHub Actions autoalojados en AWS CodeBuild <a href="#action-runner" id="action-runner"></a>

Como [**se indica en la documentación**](https://docs.aws.amazon.com/codebuild/latest/userguide/action-runner.html), es posible configurar **CodeBuild** para ejecutar **acciones de Github autoalojadas** cuando se activa un flujo de trabajo dentro de un repositorio de Github configurado. Esto se puede detectar revisando la configuración del proyecto de CodeBuild porque el **`Tipo de evento`** necesita contener: **`WORKFLOW_JOB_QUEUED`** y en un flujo de trabajo de Github porque seleccionará un runner **autoalojado** como este:
```bash
runs-on: codebuild-<project-name>-${{ github.run_id }}-${{ github.run_attempt }}
```
Esta nueva relación entre Github Actions y AWS crea otra forma de comprometer AWS desde Github, ya que el código en Github se ejecutará en un proyecto de CodeBuild con un rol IAM adjunto.

{{#include ../../../banners/hacktricks-training.md}}
