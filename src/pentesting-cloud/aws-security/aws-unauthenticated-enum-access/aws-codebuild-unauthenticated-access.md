# AWS - CodeBuild 無認証アクセス

{{#include ../../../banners/hacktricks-training.md}}

## CodeBuild

詳細については、このページを確認してください：

{{#ref}}
../aws-services/aws-codebuild-enum.md
{{#endref}}

### buildspec.yml

**`buildspec.yml`** という名前のファイルを含むリポジトリに対する書き込みアクセスを侵害した場合、このファイルを**バックドア**することができ、これはCodeBuildプロジェクト内で実行される**コマンドを指定**し、秘密情報を流出させ、実行される内容を妨害し、さらに**CodeBuild IAMロールの資格情報**を侵害することができます。

**`buildspec.yml`** ファイルが存在しなくても、Codebuildが使用されていることを知っている場合（または別のCI/CDが使用されている場合）、実行される**正当なコードを修正する**ことで、例えばリバースシェルを取得することも可能です。

関連情報については、Github Actionsを攻撃する方法に関するページを確認してください（これに類似しています）：

{{#ref}}
../../../pentesting-ci-cd/github-security/abusing-github-actions/
{{#endref}}

## AWS CodeBuildにおける自己ホスト型GitHub Actionsランナー <a href="#action-runner" id="action-runner"></a>

[**ドキュメントに示されているように**](https://docs.aws.amazon.com/codebuild/latest/userguide/action-runner.html)、**CodeBuild**を構成して、設定されたGithubリポジトリ内でワークフローがトリガーされたときに**自己ホスト型Githubアクション**を実行することが可能です。これは、**`Event type`**が**`WORKFLOW_JOB_QUEUED`**を含む必要があるため、CodeBuildプロジェクトの設定を確認することで検出できます。また、Githubワークフロー内では、次のように**自己ホスト型**ランナーが選択されます：
```bash
runs-on: codebuild-<project-name>-${{ github.run_id }}-${{ github.run_attempt }}
```
このGithub ActionsとAWSの新しい関係は、GithubからAWSを妥協させる別の方法を生み出します。Githubのコードは、IAMロールが付与されたCodeBuildプロジェクトで実行されます。

{{#include ../../../banners/hacktricks-training.md}}
