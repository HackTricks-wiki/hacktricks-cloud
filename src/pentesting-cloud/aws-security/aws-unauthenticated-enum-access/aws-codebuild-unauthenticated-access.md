# AWS - CodeBuild Unauthenticated Access

{{#include ../../../banners/hacktricks-training.md}}

## CodeBuild

Για περισσότερες πληροφορίες, ελέγξτε αυτή τη σελίδα:

{{#ref}}
../aws-services/aws-codebuild-enum.md
{{#endref}}

### buildspec.yml

Εάν αποκτήσετε πρόσβαση εγγραφής σε ένα αποθετήριο που περιέχει ένα αρχείο με όνομα **`buildspec.yml`**, θα μπορούσατε να **backdoor** αυτό το αρχείο, το οποίο καθορίζει τις **εντολές που θα εκτελούνται** μέσα σε ένα έργο CodeBuild και να εξάγετε τα μυστικά, να συμβιβάσετε ό,τι γίνεται και επίσης να συμβιβάσετε τα **credentials ρόλου IAM του CodeBuild**.

Σημειώστε ότι ακόμη και αν δεν υπάρχει κανένα αρχείο **`buildspec.yml`** αλλά γνωρίζετε ότι χρησιμοποιείται το Codebuild (ή μια διαφορετική CI/CD), **η τροποποίηση κάποιου νόμιμου κώδικα** που πρόκειται να εκτελεστεί μπορεί επίσης να σας δώσει ένα reverse shell, για παράδειγμα.

Για κάποιες σχετικές πληροφορίες, μπορείτε να ελέγξετε τη σελίδα σχετικά με το πώς να επιτεθείτε σε Github Actions (παρόμοια με αυτό):

{{#ref}}
../../../pentesting-ci-cd/github-security/abusing-github-actions/
{{#endref}}

## Self-hosted GitHub Actions runners in AWS CodeBuild <a href="#action-runner" id="action-runner"></a>

Όπως [**υποδεικνύεται στα έγγραφα**](https://docs.aws.amazon.com/codebuild/latest/userguide/action-runner.html), είναι δυνατόν να ρυθμίσετε το **CodeBuild** να εκτελεί **self-hosted Github actions** όταν ενεργοποιείται μια ροή εργασίας μέσα σε ένα αποθετήριο Github που έχει ρυθμιστεί. Αυτό μπορεί να ανιχνευθεί ελέγχοντας τη διαμόρφωση του έργου CodeBuild, επειδή ο **`Τύπος συμβάντος`** πρέπει να περιέχει: **`WORKFLOW_JOB_QUEUED`** και σε μια Ροή Εργασίας Github επειδή θα επιλέξει έναν **self-hosted** runner όπως αυτός:
```bash
runs-on: codebuild-<project-name>-${{ github.run_id }}-${{ github.run_attempt }}
```
Αυτή η νέα σχέση μεταξύ του Github Actions και του AWS δημιουργεί έναν άλλο τρόπο για να παραβιαστεί το AWS από το Github, καθώς ο κώδικας στο Github θα εκτελείται σε ένα έργο CodeBuild με έναν ρόλο IAM συνδεδεμένο. 

{{#include ../../../banners/hacktricks-training.md}}
