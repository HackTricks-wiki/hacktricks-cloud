# AWS - EC2 无需认证枚举

{{#include ../../../../banners/hacktricks-training.md}}

## EC2 & Related Services

请在下列页面查看有关此内容的更多信息：

{{#ref}}
../../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/
{{#endref}}

### Public Ports

可能将虚拟机的**任意端口**暴露到互联网。根据暴露端口上**运行的服务内容**，攻击者可能会滥用它。

#### SSRF

{{#ref}}
https://book.hacktricks.wiki/en/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf.html
{{#endref}}

### Public AMIs & EBS Snapshots

AWS 允许**授予任何人下载 AMIs 和 Snapshots 的权限**。你可以很容易地从自己的账号列出这些资源：
```bash
# Public AMIs
aws ec2 describe-images --executable-users all

## Search AMI by ownerID
aws ec2 describe-images --executable-users all --query 'Images[?contains(ImageLocation, `967541184254/`) == `true`]'

## Search AMI by substr ("shared" in the example)
aws ec2 describe-images --executable-users all --query 'Images[?contains(ImageLocation, `shared`) == `true`]'

# Public EBS snapshots (hard-drive copies)
aws ec2 describe-snapshots --restorable-by-user-ids all
aws ec2 describe-snapshots --restorable-by-user-ids all | jq '.Snapshots[] | select(.OwnerId == "099720109477")'
```
如果你发现一个任何人都可以还原的 snapshot，请务必查看 [AWS - EBS Snapshot Dump](https://cloud.hacktricks.wiki/en/pentesting-cloud/aws-security/aws-post-exploitation/aws-ec2-ebs-ssm-and-vpc-post-exploitation/index.html#ebs-snapshot-dump) 以获取有关 downloading and looting the snapshot 的说明。

#### Public URL template
```bash
# EC2
ec2-{ip-seperated}.compute-1.amazonaws.com
# ELB
http://{user_provided}-{random_id}.{region}.elb.amazonaws.com:80/443
https://{user_provided}-{random_id}.{region}.elb.amazonaws.com
```
### 枚举带有 public IP 的 EC2 实例
```bash
aws ec2 describe-instances --query "Reservations[].Instances[?PublicIpAddress!=null].PublicIpAddress" --output text
```
{{#include ../../../../banners/hacktricks-training.md}}
