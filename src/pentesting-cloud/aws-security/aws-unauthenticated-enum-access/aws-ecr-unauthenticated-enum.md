# AWS - ECR 未认证枚举

{{#include ../../../banners/hacktricks-training.md}}

## ECR

有关更多信息，请查看：

{{#ref}}
../aws-services/aws-ecr-enum.md
{{#endref}}

### 公共注册表存储库（镜像）

如ECS枚举部分所述，公共注册表是**任何人都可以访问的**，使用格式**`public.ecr.aws/<random>/<name>`**。如果攻击者找到公共存储库URL，他可以**下载镜像并在镜像的元数据和内容中搜索敏感信息**。
```bash
aws ecr describe-repositories --query 'repositories[?repositoryUriPublic == `true`].repositoryName' --output text
```
> [!WARNING]
> 这也可能发生在 **私有注册表** 中，其中注册表策略或存储库策略 **授予访问权限，例如 `"AWS": "*"`**。任何拥有 AWS 账户的人都可以访问该存储库。

### 枚举私有存储库

工具 [**skopeo**](https://github.com/containers/skopeo) 和 [**crane**](https://github.com/google/go-containerregistry/blob/main/cmd/crane/doc/crane.md) 可用于列出私有注册表中可访问的存储库。
```bash
# Get image names
skopeo list-tags docker://<PRIVATE_REGISTRY_URL> | grep -oP '(?<=^Name: ).+'
crane ls <PRIVATE_REGISTRY_URL> | sed 's/ .*//'
```
{{#include ../../../banners/hacktricks-training.md}}
