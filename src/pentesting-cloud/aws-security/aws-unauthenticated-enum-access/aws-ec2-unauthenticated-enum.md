# AWS - EC2 인증되지 않은 열거

{{#include ../../../banners/hacktricks-training.md}}

## EC2 및 관련 서비스

이 페이지에서 더 많은 정보를 확인하세요:

{{#ref}}
../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/
{{#endref}}

### 공개 포트

**가상 머신의 모든 포트를 인터넷에 노출**할 수 있습니다. 노출된 포트에서 **무엇이 실행되고 있는지**에 따라 공격자가 이를 악용할 수 있습니다.

#### SSRF

{{#ref}}
https://book.hacktricks.wiki/en/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf.html
{{#endref}}

### 공개 AMI 및 EBS 스냅샷

AWS는 **누구나 AMI 및 스냅샷을 다운로드할 수 있도록 접근을 허용**합니다. 자신의 계정에서 이러한 리소스를 매우 쉽게 나열할 수 있습니다:
```bash
# Public AMIs
aws ec2 describe-images --executable-users all

## Search AMI by ownerID
aws ec2 describe-images --executable-users all --query 'Images[?contains(ImageLocation, `967541184254/`) == `true`]'

## Search AMI by substr ("shared" in the example)
aws ec2 describe-images --executable-users all --query 'Images[?contains(ImageLocation, `shared`) == `true`]'

# Public EBS snapshots (hard-drive copies)
aws ec2 describe-snapshots --restorable-by-user-ids all
aws ec2 describe-snapshots --restorable-by-user-ids all | jq '.Snapshots[] | select(.OwnerId == "099720109477")'
```
누구나 복원할 수 있는 스냅샷을 찾으면, 스냅샷을 다운로드하고 약탈하는 방법에 대한 지침을 보려면 [AWS - EBS Snapshot Dump](https://cloud.hacktricks.wiki/en/pentesting-cloud/aws-security/aws-post-exploitation/aws-ec2-ebs-ssm-and-vpc-post-exploitation/index.html#ebs-snapshot-dump)를 확인하세요.

#### 공개 URL 템플릿
```bash
# EC2
ec2-{ip-seperated}.compute-1.amazonaws.com
# ELB
http://{user_provided}-{random_id}.{region}.elb.amazonaws.com:80/443
https://{user_provided}-{random_id}.{region}.elb.amazonaws.com
```
### 퍼블릭 IP가 있는 EC2 인스턴스 나열하기
```bash
aws ec2 describe-instances --query "Reservations[].Instances[?PublicIpAddress!=null].PublicIpAddress" --output text
```
{{#include ../../../banners/hacktricks-training.md}}
