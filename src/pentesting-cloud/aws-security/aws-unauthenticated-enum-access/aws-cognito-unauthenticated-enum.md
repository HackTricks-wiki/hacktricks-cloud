# AWS - Cognito Yetkisiz Enum

{{#include ../../../banners/hacktricks-training.md}}

## Yetkisiz Cognito

Cognito, geliştiricilerin **uygulama kullanıcılarına AWS hizmetlerine erişim vermesini** sağlayan bir AWS hizmetidir. Geliştiriciler, uygulamalarındaki **kimlik doğrulama yapılmış kullanıcılara IAM rolleri** vereceklerdir (potansiyel olarak insanlar sadece kaydolabilecek) ve ayrıca **yetkisiz kullanıcılara IAM rolü** de verebilirler.

Cognito hakkında temel bilgi için kontrol edin:

{{#ref}}
../aws-services/aws-cognito-enum/
{{#endref}}

### Kimlik Havuzu ID'si

Kimlik Havuzları, sadece **Kimlik Havuzu ID'sini** bilen **yetkisiz kullanıcılara IAM rolleri** verebilir (bu genellikle **bulunması kolaydır**), ve bu bilgiye sahip bir saldırgan, **o IAM rolüne erişmeye** ve bunu istismar etmeye çalışabilir.\
Ayrıca, IAM rolleri, Kimlik Havuzuna erişen **kimlik doğrulama yapılmış kullanıcılara** da atanabilir. Eğer bir saldırgan **bir kullanıcı kaydedebilirse** veya zaten kimlik havuzunda kullanılan **kimlik sağlayıcısına erişimi varsa**, **kimlik doğrulama yapılmış** kullanıcılara verilen **IAM rolüne** erişebilir ve ayrıcalıklarını kötüye kullanabilir.

[**Bunu nasıl yapacağınızı buradan kontrol edin**](../aws-services/aws-cognito-enum/cognito-identity-pools.md).

### Kullanıcı Havuzu ID'si

Varsayılan olarak Cognito, **yeni kullanıcı kaydetmeye** izin verir. Bir kullanıcı kaydedebilmek, size **altındaki uygulamaya** veya Cognito Kullanıcı Havuzunu kimlik sağlayıcı olarak kabul eden bir Kimlik Havuzunun **kimlik doğrulama yapılmış IAM erişim rolüne** **erişim** verebilir. [**Bunu nasıl yapacağınızı buradan kontrol edin**](../aws-services/aws-cognito-enum/cognito-user-pools.md#registration).

### Pentesting ve enum için Pacu modülleri

[Pacu](https://github.com/RhinoSecurityLabs/pacu), AWS istismar çerçevesi, artık bir hesapta tüm Cognito varlıklarının enum'lanmasını otomatikleştiren ve zayıf yapılandırmaları, erişim kontrolü için kullanılan kullanıcı özelliklerini vb. işaret eden "cognito\_\_enum" ve "cognito\_\_attack" modüllerini içermektedir. Ayrıca, kullanıcı oluşturmayı (MFA desteği dahil) ve değiştirilebilir özel özelliklere, kullanılabilir kimlik havuzu kimlik bilgilerine, id token'larındaki üstlenilebilir rollere dayalı ayrıcalık yükseltmeyi otomatikleştirir.

Modüllerin işlevlerinin açıklaması için [blog yazısının](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2) 2. kısmına bakın. Kurulum talimatları için ana [Pacu](https://github.com/RhinoSecurityLabs/pacu) sayfasına bakın.

#### Kullanım

Belirli bir kimlik havuzu ve kullanıcı havuzu istemcisi karşısında kullanıcı oluşturma ve tüm ayrıcalık yükseltme vektörlerini denemek için örnek `cognito__attack` kullanımı:
```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
Örnek cognito\_\_enum kullanımı, mevcut AWS hesabında görünen tüm kullanıcı havuzlarını, kullanıcı havuzu istemcilerini, kimlik havuzlarını, kullanıcıları vb. toplamak için:
```bash
Pacu (new:test) > run cognito__enum
```
{{#include ../../../banners/hacktricks-training.md}}
