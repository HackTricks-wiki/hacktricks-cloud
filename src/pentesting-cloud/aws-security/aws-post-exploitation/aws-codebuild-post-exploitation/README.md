# AWS - CodeBuild Post Exploitation

{{#include ../../../../banners/hacktricks-training.md}}

## CodeBuild

Για περισσότερες πληροφορίες, ελέγξτε:

{{#ref}}
../../aws-services/aws-codebuild-enum.md
{{#endref}}

### Έλεγχος Μυστικών

Εάν έχουν ρυθμιστεί διαπιστευτήρια στο Codebuild για σύνδεση με το Github, Gitlab ή Bitbucket με τη μορφή προσωπικών tokens, κωδικών πρόσβασης ή OAuth token access, αυτά τα **διαπιστευτήρια θα αποθηκευτούν ως μυστικά στον διαχειριστή μυστικών**.\
Επομένως, εάν έχετε πρόσβαση για να διαβάσετε τον διαχειριστή μυστικών, θα μπορείτε να αποκτήσετε αυτά τα μυστικά και να μεταβείτε στην συνδεδεμένη πλατφόρμα.

{{#ref}}
../../aws-privilege-escalation/aws-secrets-manager-privesc.md
{{#endref}}

### Κατάχρηση Πρόσβασης Repo CodeBuild

Για να ρυθμιστεί το **CodeBuild**, θα χρειαστεί **πρόσβαση στο repo κώδικα** που θα χρησιμοποιεί. Πολλές πλατφόρμες θα μπορούσαν να φιλοξενούν αυτόν τον κώδικα:

<figure><img src="../../../../images/image (96).png" alt=""><figcaption></figcaption></figure>

Το **project CodeBuild πρέπει να έχει πρόσβαση** στον ρυθμισμένο πάροχο πηγών, είτε μέσω **IAM role** είτε με ένα github/bitbucket **token ή OAuth access**.

Ένας επιτιθέμενος με **υψηλά δικαιώματα σε ένα CodeBuild** θα μπορούσε να καταχραστεί αυτήν την ρυθμισμένη πρόσβαση για να διαρρεύσει τον κώδικα του ρυθμισμένου repo και άλλων όπου τα ρυθμισμένα διαπιστευτήρια έχουν πρόσβαση.\
Για να το κάνει αυτό, ένας επιτιθέμενος θα χρειαστεί απλώς να **αλλάξει το URL του αποθετηρίου σε κάθε repo που έχουν πρόσβαση τα ρυθμισμένα διαπιστευτήρια** (σημειώστε ότι η ιστοσελίδα aws θα τα παραθέσει όλα για εσάς):

<figure><img src="../../../../images/image (107).png" alt=""><figcaption></figcaption></figure>

Και **να αλλάξει τις εντολές Buildspec για να εξάγει κάθε repo**.

> [!WARNING]
> Ωστόσο, αυτή η **εργασία είναι επαναλαμβανόμενη και κουραστική** και εάν έχει ρυθμιστεί ένα github token με **δικαιώματα εγγραφής**, ένας επιτιθέμενος **δεν θα μπορέσει να (κατα)χρηστεί αυτά τα δικαιώματα** καθώς δεν έχει πρόσβαση στο token.\
> Ή μήπως έχει; Ελέγξτε την επόμενη ενότητα

### Διαρροή Access Tokens από το AWS CodeBuild

Μπορείτε να διαρρεύσετε την πρόσβαση που δίνεται στο CodeBuild σε πλατφόρμες όπως το Github. Ελέγξτε αν έχει δοθεί οποιαδήποτε πρόσβαση σε εξωτερικές πλατφόρμες με:
```bash
aws codebuild list-source-credentials
```
{{#ref}}
aws-codebuild-token-leakage.md
{{#endref}}

### `codebuild:DeleteProject`

Ένας επιτιθέμενος θα μπορούσε να διαγράψει ολόκληρο το έργο CodeBuild, προκαλώντας απώλεια της διαμόρφωσης του έργου και επηρεάζοντας τις εφαρμογές που βασίζονται στο έργο.
```bash
aws codebuild delete-project --name <value>
```
**Πιθανές Επιπτώσεις**: Απώλεια διαμόρφωσης έργου και διακοπή υπηρεσίας για εφαρμογές που χρησιμοποιούν το διαγραμμένο έργο.

### `codebuild:TagResource` , `codebuild:UntagResource`

Ένας επιτιθέμενος θα μπορούσε να προσθέσει, να τροποποιήσει ή να αφαιρέσει ετικέτες από τους πόρους του CodeBuild, διαταράσσοντας την κατανομή κόστους της οργάνωσής σας, την παρακολούθηση πόρων και τις πολιτικές ελέγχου πρόσβασης με βάση τις ετικέτες.
```bash
aws codebuild tag-resource --resource-arn <value> --tags <value>
aws codebuild untag-resource --resource-arn <value> --tag-keys <value>
```
**Πιθανές Επιπτώσεις**: Διαταραχή της κατανομής κόστους, παρακολούθησης πόρων και πολιτικών ελέγχου πρόσβασης με βάση τις ετικέτες.

### `codebuild:DeleteSourceCredentials`

Ένας επιτιθέμενος θα μπορούσε να διαγράψει τα διαπιστευτήρια πηγής για ένα Git αποθετήριο, επηρεάζοντας τη φυσιολογική λειτουργία των εφαρμογών που βασίζονται στο αποθετήριο.
```sql
aws codebuild delete-source-credentials --arn <value>
```
**Πιθανές Επιπτώσεις**: Διαταραχή της κανονικής λειτουργίας για εφαρμογές που βασίζονται στο επηρεαζόμενο αποθετήριο λόγω της αφαίρεσης των διαπιστευτηρίων πηγής.

{{#include ../../../../banners/hacktricks-training.md}}
