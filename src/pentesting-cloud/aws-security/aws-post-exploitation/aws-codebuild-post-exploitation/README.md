# AWS - CodeBuild Post Exploitation

{{#include ../../../../banners/hacktricks-training.md}}

## CodeBuild

For more information, check:

{{#ref}}
../../aws-services/aws-codebuild-enum.md
{{#endref}}

### Check Secrets

Ikiwa credentials zimewekwa katika CodeBuild ili kuunganishwa na Github, Gitlab au Bitbucket kwa njia ya personal tokens, passwords au OAuth token access, hizi **credentials zitatunzwa kama secrets katika secret manager**.\
Kwa hivyo, ikiwa una access ya kusoma secret manager utaweza kupata secrets hizi na pivot kwenye platform iliyounganishwa.

{{#ref}}
../../aws-privilege-escalation/aws-secrets-manager-privesc/README.md
{{#endref}}

### Abuse CodeBuild Repo Access

Ili kusanidi **CodeBuild**, itahitaji **access to the code repo** itakayokuwa ikitumia. Platform mbalimbali zinaweza kuwa zinahost code hii:

<figure><img src="../../../../images/image (96).png" alt=""><figcaption></figcaption></figure>

The **CodeBuild project must have access** to the configured source provider, either via **IAM role** of with a github/bitbucket **token or OAuth access**.

An attacker with **elevated permissions in over a CodeBuild** could abuse this configured access to leak the code of the configured repo and others where the set creds have access.\
Ili kufanya hivyo, attacker angehitaji tu **kubadilisha repository URL kwa kila repo ambazo config credentials zina access** (kumbuka kuwa the aws web itawaorodhesha zote kwako):

<figure><img src="../../../../images/image (107).png" alt=""><figcaption></figcaption></figure>

Na **kubadilisha Buildspec commands ili exfiltrate kila repo**.

> [!WARNING]
> Hata hivyo, hii **kazi ni ya kurudia-rudia na ya kuchosha** na ikiwa github token ilisanidiwa na **write permissions**, attacker **hatawezi (ab)use hizo permissions** kwani hana access kwa token.\
> Au ana? Angalia sekta inayofuata

### Leaking Access Tokens from AWS CodeBuild

You can leak access given in CodeBuild to platforms like Github. Check if any access to external platforms was given with:
```bash
aws codebuild list-source-credentials
```
{{#ref}}
aws-codebuild-token-leakage.md
{{#endref}}

### Utekelezaji wa PR isiyo ya kuaminika kupitia usanidi mbaya wa kichujio cha webhook

Ikiwa vichujio vya webhook ni dhaifu, washambuliaji wa nje wanaweza kupata PR zao zijengwe katika miradi ya CodeBuild yenye ruhusa za juu na kisha kutekeleza arbitrary code katika CI.

{{#ref}}
aws-codebuild-untrusted-pr-webhook-bypass.md
{{#endref}}

### `codebuild:DeleteProject`

Mshambuliaji anaweza kufuta mradi mzima wa CodeBuild, kusababisha kupoteza usanidi wa mradi na kuathiri maombi yanayotegemea mradi huo.
```bash
aws codebuild delete-project --name <value>
```
**Potential Impact**: Kupoteza usanidi wa mradi na kusababisha kusimamishwa kwa huduma kwa maombi yanayotumia mradi uliyefutwa.

### `codebuild:TagResource` , `codebuild:UntagResource`

Mshambuliaji anaweza kuongeza, kubadilisha, au kuondoa tags kutoka kwa rasilimali za CodeBuild, akivuruga mgawanyo wa gharama wa shirika lako, ufuatiliaji wa rasilimali, na sera za udhibiti wa ufikiaji zinazotegemea tags.
```bash
aws codebuild tag-resource --resource-arn <value> --tags <value>
aws codebuild untag-resource --resource-arn <value> --tag-keys <value>
```
**Athari Inayoweza Kutokea**: Kuvuruga ugawaji wa gharama, ufuatiliaji wa rasilimali, na sera za udhibiti wa upatikanaji zenye msingi wa tag.

### `codebuild:DeleteSourceCredentials`

Mshambuliaji anaweza kufuta cheti za chanzo kwa Git repository, na kuathiri utendakazi wa kawaida wa programu zinazotegemea repository.
```sql
aws codebuild delete-source-credentials --arn <value>
```
**Athari Inayowezekana**: Kuvurugika kwa utendaji wa kawaida kwa programu zinazotegemea repository iliyokumbwa kutokana na kuondolewa kwa cheti za chanzo.

{{#include ../../../../banners/hacktricks-training.md}}
