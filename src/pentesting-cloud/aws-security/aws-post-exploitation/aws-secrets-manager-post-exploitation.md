# AWS - Secrets Manager Post Exploitation

{{#include ../../../banners/hacktricks-training.md}}

## Secrets Manager

更多信息请参阅：

{{#ref}}
../aws-services/aws-secrets-manager-enum.md
{{#endref}}

### 读取 Secrets

这些 **secrets 本身是敏感信息**，[查看 privesc 页面](../aws-privilege-escalation/aws-secrets-manager-privesc.md) 了解如何读取它们。

### DoS 更改 Secret 值

更改 secret 的值可能会导致所有依赖该值的系统 **被 DoS。**

> [!WARNING]
> 请注意，先前的值也会被存储，因此很容易回滚到之前的值。
```bash
# Requires permission secretsmanager:PutSecretValue
aws secretsmanager put-secret-value \
--secret-id MyTestSecret \
--secret-string "{\"user\":\"diegor\",\"password\":\"EXAMPLE-PASSWORD\"}"
```
### DoS Change KMS key

如果攻击者具有 secretsmanager:UpdateSecret 权限，他们可以将 secret 配置为使用攻击者拥有的 KMS key。该 key 最初被设置为任何人都可以访问和使用，因此可以使用该新 key 更新 secret。如果该 key 无法访问，则无法更新 secret。

在更改 secret 使用的 key 之后，攻击者会修改他们的 key 的配置，使只有他们自己可以访问。这样，secret 的后续版本将使用该新 key 加密，由于无法访问该 key，就无法检索这些 secret。

需要注意的是，这种不可访问性只会出现在后续版本（在 secret 内容更改之后），因为当前版本仍然使用原来的 KMS key 加密。
```bash
aws secretsmanager update-secret \
--secret-id MyTestSecret \
--kms-key-id arn:aws:kms:us-west-2:123456789012:key/EXAMPLE1-90ab-cdef-fedc-ba987EXAMPLE
```
### DoS Deleting Secret

删除一个 secret 的最短天数为 7 天
```bash
aws secretsmanager delete-secret \
--secret-id MyTestSecret \
--recovery-window-in-days 7
```
{{#include ../../../banners/hacktricks-training.md}}
