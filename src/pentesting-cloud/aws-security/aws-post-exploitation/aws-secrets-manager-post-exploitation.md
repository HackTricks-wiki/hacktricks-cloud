# AWS - Secrets Manager Post Exploitation

{{#include ../../../banners/hacktricks-training.md}}

## Secrets Manager

Para más información, consulta:

{{#ref}}
../aws-services/aws-secrets-manager-enum.md
{{#endref}}

### Leer Secrets

Los **secrets en sí son información sensible**, [consulta la página privesc](../aws-privilege-escalation/aws-secrets-manager-privesc.md) para aprender cómo leerlos.

### DoS Cambiar el valor del secret

Al cambiar el valor del secret podrías **hacer DoS a todos los sistemas que dependen de ese valor.**

> [!WARNING]
> Ten en cuenta que los valores anteriores también se almacenan, por lo que es fácil volver al valor anterior.
```bash
# Requires permission secretsmanager:PutSecretValue
aws secretsmanager put-secret-value \
--secret-id MyTestSecret \
--secret-string "{\"user\":\"diegor\",\"password\":\"EXAMPLE-PASSWORD\"}"
```
### DoS Change KMS key

Si el attacker tiene el permiso secretsmanager:UpdateSecret, puede configurar el secret para que use una KMS key propiedad del attacker. Esa key se configura inicialmente de forma que cualquiera pueda acceder y usarla, por lo que es posible actualizar el secret con la nueva key. Si la key no fuera accesible, no se podría actualizar el secret.

Tras cambiar la key del secret, el attacker modifica la configuración de su key para que sólo él pueda acceder a ella. De este modo, en las versiones posteriores del secret se cifrará con la nueva key, y al no haber acceso a ésta, se perdería la posibilidad de recuperar el secret.

Es importante señalar que esta inaccesibilidad sólo ocurrirá en versiones posteriores, después de que cambie el contenido del secret, ya que la versión actual sigue estando cifrada con la KMS key original.
```bash
aws secretsmanager update-secret \
--secret-id MyTestSecret \
--kms-key-id arn:aws:kms:us-west-2:123456789012:key/EXAMPLE1-90ab-cdef-fedc-ba987EXAMPLE
```
### DoS Deleting Secret

El número mínimo de días para eliminar un secret es 7
```bash
aws secretsmanager delete-secret \
--secret-id MyTestSecret \
--recovery-window-in-days 7
```
{{#include ../../../banners/hacktricks-training.md}}
