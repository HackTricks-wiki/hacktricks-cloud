# AWS - Secrets Manager Post Exploitation

{{#include ../../../banners/hacktricks-training.md}}

## Secrets Manager

Für weitere Informationen siehe:

{{#ref}}
../aws-services/aws-secrets-manager-enum.md
{{#endref}}

### Secrets lesen

Die **Secrets selbst sind sensible Informationen** — [check the privesc page](../aws-privilege-escalation/aws-secrets-manager-privesc.md) um zu erfahren, wie man sie liest.

### DoS Change Secret Value

Durch Ändern des Werts des Secrets könnten Sie **alle Systeme, die von diesem Wert abhängen, einem DoS aussetzen.**

> [!WARNING]
> Beachte, dass vorherige Werte ebenfalls gespeichert werden, sodass es leicht ist, zum vorherigen Wert zurückzukehren.
```bash
# Requires permission secretsmanager:PutSecretValue
aws secretsmanager put-secret-value \
--secret-id MyTestSecret \
--secret-string "{\"user\":\"diegor\",\"password\":\"EXAMPLE-PASSWORD\"}"
```
### DoS Change KMS key

Wenn der Angreifer die Berechtigung secretsmanager:UpdateSecret hat, kann er das Secret so konfigurieren, dass es einen KMS key verwendet, der dem Angreifer gehört. Dieser Key wird anfangs so eingerichtet, dass jeder darauf zugreifen und ihn verwenden kann, sodass ein Update des Secret mit dem neuen Key möglich ist. Wäre der Key nicht zugänglich, könnte das Secret nicht aktualisiert werden.

Nachdem der Angreifer den Key für das Secret geändert hat, passt er die Konfiguration seines Keys so an, dass nur noch er darauf zugreifen kann. Auf diese Weise werden in späteren Versionen des Secret diese mit dem neuen Key verschlüsselt, und da kein Zugriff darauf besteht, geht die Möglichkeit verloren, das Secret abzurufen.

Es ist wichtig zu beachten, dass diese Unzugänglichkeit nur bei späteren Versionen auftritt, nachdem sich der Inhalt des Secret geändert hat, da die aktuelle Version noch mit dem ursprünglichen KMS key verschlüsselt ist.
```bash
aws secretsmanager update-secret \
--secret-id MyTestSecret \
--kms-key-id arn:aws:kms:us-west-2:123456789012:key/EXAMPLE1-90ab-cdef-fedc-ba987EXAMPLE
```
### DoS: Secret löschen

Die Mindestanzahl an Tagen, um ein Secret zu löschen, beträgt 7.
```bash
aws secretsmanager delete-secret \
--secret-id MyTestSecret \
--recovery-window-in-days 7
```
{{#include ../../../banners/hacktricks-training.md}}
