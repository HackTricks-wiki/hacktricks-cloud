# AWS - Secrets Manager Post Exploitation

{{#include ../../../banners/hacktricks-training.md}}

## Secrets Manager

Kwa maelezo zaidi angalia:

{{#ref}}
../aws-services/aws-secrets-manager-enum.md
{{#endref}}

### Read Secrets

**secrets wenyewe ni taarifa nyeti**, [angalia ukurasa wa privesc](../aws-privilege-escalation/aws-secrets-manager-privesc.md) ili ujifunze jinsi ya kuvisoma.

### DoS Change Secret Value

Kubadilisha thamani ya secret kunaweza **kusababisha DoS kwa mifumo yote inayotegemea thamani hiyo.**

> [!WARNING]
> Kumbuka kwamba thamani za awali pia zinahifadhiwa, hivyo ni rahisi kurudi kwenye thamani ya awali.
```bash
# Requires permission secretsmanager:PutSecretValue
aws secretsmanager put-secret-value \
--secret-id MyTestSecret \
--secret-string "{\"user\":\"diegor\",\"password\":\"EXAMPLE-PASSWORD\"}"
```
### DoS Change KMS key

Kama mshambuliaji ana ruhusa secretsmanager:UpdateSecret, anaweza kusanidi secret itumie KMS key inayomilikiwa na mshambuliaji. KMS key hiyo imewekwa awali kwa njia ambayo yeyote anaweza kuifikia na kuitumia, hivyo kusasisha secret kwa key mpya kunawezekana. Ikiwa key haikuweza kupatikana, secret haiwezi kusasishwa.

Baada ya kubadilisha key ya secret, mshambuliaji anabadilisha usanidi wa KMS key yao ili yeye pekee aweze kuifikia. Kwa hivyo, katika matoleo yajayo ya secret, zitawekwa kwa encryption kwa KMS key mpya, na kwa kuwa hakuna ufikikaji wa key hiyo, uwezo wa kupata secret utapotea.

Ni muhimu kutambua kuwa ukosefu huu wa ufikikaji utatokea tu katika matoleo ya baadaye, baada ya maudhui ya secret kubadilika, kwani toleo la sasa bado limeencrypted na KMS key ya asili.
```bash
aws secretsmanager update-secret \
--secret-id MyTestSecret \
--kms-key-id arn:aws:kms:us-west-2:123456789012:key/EXAMPLE1-90ab-cdef-fedc-ba987EXAMPLE
```
### DoS Kufuta Siri

Idadi ya chini ya siku za kufuta siri ni 7.
```bash
aws secretsmanager delete-secret \
--secret-id MyTestSecret \
--recovery-window-in-days 7
```
{{#include ../../../banners/hacktricks-training.md}}
