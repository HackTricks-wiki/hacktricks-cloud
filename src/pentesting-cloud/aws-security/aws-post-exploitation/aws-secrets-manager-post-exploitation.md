# AWS - Secrets Manager Post Exploitation

{{#include ../../../banners/hacktricks-training.md}}

## Secrets Manager

Vir meer inligting, kyk:

{{#ref}}
../aws-services/aws-secrets-manager-enum.md
{{#endref}}

### Read Secrets

Die **secrets self is sensitiewe inligting**, [kyk na die privesc bladsy](../aws-privilege-escalation/aws-secrets-manager-privesc.md) om te leer hoe om dit te lees.

### DoS Change Secret Value

Deur die waarde van die secret te verander, kan jy **alle stelsels wat van daardie waarde afhanklik is DoS maak.**

> [!WARNING]
> Neem kennis dat vorige waardes ook gestoor word, so dit is maklik om net terug te gaan na die vorige waarde.
```bash
# Requires permission secretsmanager:PutSecretValue
aws secretsmanager put-secret-value \
--secret-id MyTestSecret \
--secret-string "{\"user\":\"diegor\",\"password\":\"EXAMPLE-PASSWORD\"}"
```
### DoS Change KMS key

As die aanvaller die secretsmanager:UpdateSecret-toestemming het, kan hulle die secret so konfigureer dat dit 'n KMS key gebruik wat aan die aanvaller behoort. Daardie sleutel is aanvanklik so ingestel dat enigiemand toegang daartoe kan kry en dit kan gebruik, dus is dit moontlik om die secret met die nuwe sleutel by te werk. As die sleutel nie toeganklik was nie, sou die secret nie bygewerk kon word nie.

Na die verandering van die sleutel vir die secret, wysig die aanvaller die konfiguratie van hul sleutel sodat slegs hulle toegang daartoe het. Op hierdie manier sal toekomstige weergawes van die secret met die nuwe sleutel geïnkripteer word, en aangesien daar geen toegang tot hierdie sleutel is nie, sal die vermoë om die secret op te haal verlore wees.

Dit is belangrik om te let dat hierdie ontoeganklikheid slegs in later weergawes sal voorkom, nadat die inhoud van die secret verander is, aangesien die huidige weergawe nog steeds met die oorspronklike KMS key geïnkripteer is.
```bash
aws secretsmanager update-secret \
--secret-id MyTestSecret \
--kms-key-id arn:aws:kms:us-west-2:123456789012:key/EXAMPLE1-90ab-cdef-fedc-ba987EXAMPLE
```
### DoS Verwydering van geheim

Die minimum aantal dae om 'n geheim te verwyder is 7
```bash
aws secretsmanager delete-secret \
--secret-id MyTestSecret \
--recovery-window-in-days 7
```
{{#include ../../../banners/hacktricks-training.md}}
