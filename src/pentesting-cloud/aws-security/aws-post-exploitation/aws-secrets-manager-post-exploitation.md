# AWS - Secrets Manager Post Exploitation

{{#include ../../../banners/hacktricks-training.md}}

## Secrets Manager

Для отримання додаткової інформації див.:

{{#ref}}
../aws-services/aws-secrets-manager-enum.md
{{#endref}}

### Читання секретів

Самі **секрети є конфіденційною інформацією**, [check the privesc page](../aws-privilege-escalation/aws-secrets-manager-privesc.md) щоб дізнатися, як їх читати.

### DoS — Зміна значення секрету

Змінивши значення секрету, ви можете спричинити **DoS для всіх систем, що залежать від цього значення.**

> [!WARNING]
> Зверніть увагу, що попередні значення також зберігаються, тому легко просто повернутися до попереднього значення.
```bash
# Requires permission secretsmanager:PutSecretValue
aws secretsmanager put-secret-value \
--secret-id MyTestSecret \
--secret-string "{\"user\":\"diegor\",\"password\":\"EXAMPLE-PASSWORD\"}"
```
### DoS Change KMS key

Якщо зловмисник має дозвіл secretsmanager:UpdateSecret, він може налаштувати secret на використання KMS key, що належить зловмисникові. Спочатку цей KMS key налаштовано так, що будь-хто може отримати до нього доступ і використовувати його, тому оновлення secret з новим ключем можливе. Якби KMS key був недоступний, secret не можна було б оновити.

Після зміни KMS key для secret зловмисник модифікує конфігурацію свого ключа так, щоб доступ до нього мав лише він. Таким чином у наступних версіях secret вони будуть зашифровані цим новим ключем, і через відсутність доступу до ключа можливість отримати secret буде втрачена.

Важливо зазначити, що така недоступність виникне лише в пізніших версіях, після зміни вмісту secret, оскільки поточна версія все ще зашифрована оригінальним KMS key.
```bash
aws secretsmanager update-secret \
--secret-id MyTestSecret \
--kms-key-id arn:aws:kms:us-west-2:123456789012:key/EXAMPLE1-90ab-cdef-fedc-ba987EXAMPLE
```
### DoS Deleting Secret

Мінімальна кількість днів для видалення секрету — 7
```bash
aws secretsmanager delete-secret \
--secret-id MyTestSecret \
--recovery-window-in-days 7
```
{{#include ../../../banners/hacktricks-training.md}}
