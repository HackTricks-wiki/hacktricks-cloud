# AWS - S3 Post Exploitation

{{#include ../../../../banners/hacktricks-training.md}}

## S3

For more information check:

{{#ref}}
../../aws-services/aws-s3-athena-and-glacier-enum.md
{{#endref}}

### Sensitive Information

Czasami można znaleźć wrażliwe informacje dostępne do odczytu w bucketach. Na przykład terraform state secrets.

### Pivoting

Różne platformy mogą używać S3 do przechowywania wrażliwych zasobów.\
For example, **airflow** could be storing **DAGs** **code** in there, or **web pages** could be directly served from S3. An attacker with write permissions could **modify the code** from the bucket to **pivot** to other platforms, or **takeover accounts** modifying JS files.

### S3 Ransomware

W tym scenariuszu **attacker creates a KMS (Key Management Service) key in their own AWS account** lub w innym skompromitowanym koncie. Następnie czynią ten **key accessible to anyone in the world**, pozwalając dowolnemu AWS user, role, lub account szyfrować obiekty przy użyciu tego klucza. Jednak obiekty nie mogą być odszyfrowane.

Attacker identyfikuje docelowy **S3 bucket and gains write-level access** do niego przy użyciu różnych metod. Może to być spowodowane złą konfiguracją bucketu, która wystawia go publicznie, lub dostępem atakującego do samego środowiska AWS. Attacker zwykle celuje w buckety zawierające wrażliwe informacje, takie jak personally identifiable information (PII), protected health information (PHI), logi, backupy i inne.

Aby określić, czy bucket może być celem ransomware, attacker sprawdza jego konfigurację. Obejmuje to weryfikację, czy **S3 Object Versioning** jest włączone oraz czy **multi-factor authentication delete (MFA delete) is enabled**. Jeśli Object Versioning nie jest włączone, attacker może kontynuować. Jeśli Object Versioning jest włączone, ale MFA delete jest wyłączone, attacker może **disable Object Versioning**. Jeśli zarówno Object Versioning jak i MFA delete są włączone, staje się trudniej dla attacker’a przeprowadzić ransomware na tym konkretnym buckecie.

Używając AWS API, attacker **replaces each object in the bucket with an encrypted copy using their KMS key**. To skutecznie szyfruje dane w buckecie, czyniąc je niedostępnymi bez klucza.

Aby zwiększyć presję, attacker planuje usunięcie KMS key użytego w ataku. Daje to celowi 7-dniowe okno na odzyskanie danych zanim klucz zostanie usunięty i dane staną się na zawsze utracone.

Na koniec attacker może przesłać finalny plik, zwykle nazwany "ransom-note.txt", który zawiera instrukcje dla celu jak odzyskać swoje pliki. Ten plik jest przesyłany bez szyfrowania, prawdopodobnie aby zwrócić uwagę celu i uczynić go świadomym ataku ransomware.

**For more info** [**check the original research**](https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/)**.**

{{#include ../../../../banners/hacktricks-training.md}}
