# AWS - S3 Post Exploitation

{{#include ../../../../banners/hacktricks-training.md}}

## S3

For more information check:

{{#ref}}
../../aws-services/aws-s3-athena-and-glacier-enum.md
{{#endref}}

### Sensitive Information

कभी-कभी आप buckets में पठनीय रूप में संवेदनशील जानकारी पा सकते हैं। उदाहरण के लिए, terraform state secrets।

### Pivoting

विभिन्न प्लेटफ़ॉर्म S3 का उपयोग संवेदनशील assets स्टोर करने के लिए कर सकते हैं।\
उदाहरण के लिए, **airflow** वहाँ **DAGs** **code** स्टोर कर सकता है, या **web pages** सीधे S3 से serve किए जा सकते हैं। जिनके पास write permissions हैं, वे bucket के code को **modify the code** कर के अन्य प्लेटफ़ॉर्म पर **pivot** कर सकते हैं, या JS फाइलें बदल कर **takeover accounts** कर सकते हैं।

### S3 Ransomware

इस परिदृश्य में, **हमलावर अपने ही AWS account में या किसी अन्य compromised account में एक KMS (Key Management Service) key बनाता है**। फिर वे इस **key को दुनिया के किसी भी व्यक्ति के लिए accessible बना देते हैं**, जिससे कोई भी AWS user, role, या account इस key का उपयोग करके objects को encrypt कर सकता है। हालाँकि, objects को decrypt नहीं किया जा सकता।

हमलावर एक target **S3 bucket पहचानता है और उस पर write-level access प्राप्त करता है** विभिन्न तरीकों से। यह खराब bucket configuration के कारण सार्वजनिक रूप से एक्सपोज़ होने के कारण हो सकता है या हमलावर ने खुद AWS environment तक पहुँच बना ली हो। हमलावर आम तौर पर उन buckets को निशाना बनाता है जिनमें संवेदनशील जानकारी होती है — जैसे PII, PHI, logs, backups, आदि।

यह निर्धारित करने के लिए कि क्या bucket ransomware के लिए लक्षित किया जा सकता है, हमलावर इसकी configuration की जाँच करता है। इसमें यह सत्यापित करना शामिल है कि क्या **S3 Object Versioning** enabled है और क्या **multi-factor authentication delete (MFA delete)** enabled है। यदि Object Versioning enabled नहीं है, तो हमलावर आगे बढ़ सकता है। यदि Object Versioning enabled है पर MFA delete disabled है, तो हमलावर **Object Versioning को disable** कर सकता है। यदि दोनों Object Versioning और MFA delete enabled हैं, तो उस विशेष bucket को ransomware करना कठिन हो जाता है।

AWS API का उपयोग करके, हमलावर **हर ऑब्जेक्ट को bucket में उनके KMS key का उपयोग कर एक encrypted copy से बदल देता है**। यह प्रभावी रूप से bucket के डेटा को encrypt कर देता है, जिससे बिना key के वह डेटा inaccessible हो जाता है।

अधिक दबाव डालने के लिए, हमलावर उस KMS key को delete करने का शेड्यूल कर देता है जिसका उपयोग आक्रमण में हुआ था। इससे लक्ष्य के पास अपने डेटा को recover करने के लिए 7-day विंडो मिलती है, उसके बाद key delete हो जाने पर डेटा स्थायी रूप से खो सकता है।

अंत में, हमलावर आमतौर पर "ransom-note.txt" नामक एक अंतिम फ़ाइल अपलोड कर सकता है, जिसमें लक्षित व्यक्ति को अपनी फ़ाइलें कैसे वापस पायी जा सकती हैं इसकी निर्देशिका होती है। यह फ़ाइल बिना encryption के अपलोड की जाती है, ताकि लक्षित व्यक्ति का ध्यानाकर्षण हो और वे ransomware हमले से अवगत हो सकें।

### `s3:RestoreObject`

जिसके पास s3:RestoreObject permission है वह Glacier या Deep Archive में archived objects को पुनः सक्रिय कर सकता है, जिससे वे अस्थायी रूप से accessible हो जाते हैं। यह सामान्यतः पहुँच से बाहर रहने वाले ऐतिहासिक रूप से archived डेटा (backups, snapshots, logs, certifications, old secrets) की recovery और exfiltration को सक्षम बनाता है। यदि हमलावर इस permission को read permissions (उदा., s3:GetObject) के साथ combine करता है, तो वे संवेदनशील डेटा की पूरी copies प्राप्त कर सकते हैं।
```bash
aws s3api restore-object \
--bucket <BUCKET_NAME> \
--key <OBJECT_KEY> \
--restore-request '{
"Days": <NUMBER_OF_DAYS>,
"GlacierJobParameters": { "Tier": "Standard" }
}'
```
### `s3:Delete*`

एक attacker जिसके पास s3:Delete* permission है, वह objects, versions और पूरे buckets को delete कर सकता है, backups को बाधित कर सकता है, और तुरंत तथा अपरिवर्तनीय data loss, सबूतों के नष्ट होने, तथा backup या recovery artifacts के compromise का कारण बन सकता है।
```bash
# Delete an object from a bucket
aws s3api delete-object \
--bucket <BUCKET_NAME> \
--key <OBJECT_KEY>

# Delete a specific version
aws s3api delete-object \
--bucket <BUCKET_NAME> \
--key <OBJECT_KEY> \
--version-id <VERSION_ID>

# Delete a bucket
aws s3api delete-bucket \
--bucket <BUCKET_NAME>
```
**अधिक जानकारी के लिए** [**मूल शोध देखें**](https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/)**.**

{{#include ../../../../banners/hacktricks-training.md}}
