# AWS - CloudFront Post Exploitation

{{#include ../../../../banners/hacktricks-training.md}}

## CloudFront

詳細は以下を参照してください:

{{#ref}}
../../aws-services/aws-cloudfront-enum.md
{{#endref}}

### Man-in-the-Middle

This [**blog post**](https://medium.com/@adan.alvarez/how-attackers-can-misuse-aws-cloudfront-access-to-make-it-rain-cookies-acf9ce87541c) は、**Lambda** が **CloudFront** を通した通信に追加（すでに使用されている場合は修正）され、セッションの **cookie** のようなユーザ情報を**stealing**し、**response** を**modifying**（悪意のある JS スクリプトを注入）する目的で使われるいくつかのシナリオを示しています。

#### scenario 1: CloudFront が bucket の HTML にアクセスするよう設定されている場合の MitM

- 悪意のある **function** を **作成** する。
- それを CloudFront distribution に **関連付け** する。
- **イベントタイプを "Viewer Response" に設定する。**

レスポンスにアクセスすることで、ユーザの cookie を盗み、悪意のある JS を注入できます。

#### scenario 2: CloudFront がすでに lambda function を使用している場合の MitM

- lambda function の **code を変更** して機密情報を盗む。

You can check the [**tf code to recreate this scenarios here**](https://github.com/adanalvarez/AWS-Attack-Scenarios/tree/main).

{{#include ../../../../banners/hacktricks-training.md}}
