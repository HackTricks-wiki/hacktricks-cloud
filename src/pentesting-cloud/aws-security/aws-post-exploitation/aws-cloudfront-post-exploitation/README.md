# AWS - CloudFront Post Exploitation

{{#include ../../../../banners/hacktricks-training.md}}

## CloudFront

Daha fazla bilgi için bakınız:

{{#ref}}
../../aws-services/aws-cloudfront-enum.md
{{#endref}}

### `cloudfront:Delete*`
cloudfront:Delete* yetkisi bulunan bir saldırgan distributions, policies ve diğer kritik CDN yapılandırma nesnelerini silebilir — örneğin distributions, cache/origin policies, key groups, origin access identities, functions/configs ve ilgili kaynaklar. Bu, hizmet kesintisine, içerik kaybına ve yapılandırma ya da adli kanıtların silinmesine yol açabilir.

Bir distribution'ı silmek için saldırgan şunu kullanabilir:
```bash
aws cloudfront delete-distribution \
--id <DISTRIBUTION_ID> \
--if-match <ETAG>
```
### Man-in-the-Middle

This [**blog post**](https://medium.com/@adan.alvarez/how-attackers-can-misuse-aws-cloudfront-access-to-make-it-rain-cookies-acf9ce87541c) birkaç farklı senaryo öneriyor: bir **Lambda**, **CloudFront** üzerinden gerçekleşen bir iletişime eklenebilir (veya zaten kullanılıyorsa değiştirilebilir) ve amaç kullanıcı bilgilerini (ör. oturum **cookie**'sini) **çalmak** ve **response**'ı **değiştirmek** (kötü amaçlı bir JS script'ı enjekte etmek).

#### senaryo 1: MitM — CloudFront'un bir bucket'taki bazı HTML'lere erişecek şekilde yapılandırıldığı durum

- **Oluşturun** kötü amaçlı **function**'ı.
- **İlişkilendirin** onu CloudFront dağıtımı ile.
- **Olay türünü "Viewer Response" olarak ayarlayın**.

Response'a erişerek kullanıcıların cookie'sini çalabilir ve kötü amaçlı bir JS enjekte edebilirsiniz.

#### senaryo 2: MitM — CloudFront zaten bir lambda function kullanıyorsa

- Lambda function'ın kodunu **değiştirin** ve hassas bilgileri çalın.

Bunları yeniden oluşturmak için [**tf code to recreate this scenarios here**](https://github.com/adanalvarez/AWS-Attack-Scenarios/tree/main) adresine bakabilirsiniz.

{{#include ../../../../banners/hacktricks-training.md}}
