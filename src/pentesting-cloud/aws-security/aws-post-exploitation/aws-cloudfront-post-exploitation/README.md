# AWS - CloudFront Post Exploitation

{{#include ../../../../banners/hacktricks-training.md}}

## CloudFront

詳細については次を参照してください:

{{#ref}}
../../aws-services/aws-cloudfront-enum.md
{{#endref}}

### `cloudfront:Delete*`
cloudfront:Delete* が付与された攻撃者は distributions、policies およびその他の重要な CDN 設定オブジェクト（例えば distributions、cache/origin policies、key groups、origin access identities、functions/configs、および関連リソース）を削除できます。これによりサービス停止、コンテンツの損失、設定やフォレンジックの証跡の消失が発生する可能性があります。

distribution を削除するために、攻撃者は次のような方法を使用できます:
```bash
aws cloudfront delete-distribution \
--id <DISTRIBUTION_ID> \
--if-match <ETAG>
```
### Man-in-the-Middle

この[**ブログ記事**](https://medium.com/@adan.alvarez/how-attackers-can-misuse-aws-cloudfront-access-to-make-it-rain-cookies-acf9ce87541c)では、**Lambda** を（既に使用されている場合は変更して）**communication through CloudFront** に組み込み、ユーザ情報（例えばセッションの **cookie**）を**盗む**ことや、**response** を**改変**して（悪意ある JS スクリプトを注入するなど）情報を奪うことを目的としたいくつかのシナリオが提案されています。

#### シナリオ 1: CloudFront が bucket の HTML にアクセスするように設定されている MitM

- **Create** 悪意のある **function** を作成する。
- **Associate** それを CloudFront distribution に関連付ける。
- **Set the event type to "Viewer Response"**。

**response** にアクセスすることで、ユーザの **cookie** を盗み、悪意ある JS を注入できます。

#### シナリオ 2: CloudFront が既に Lambda function を使用している MitM

- **Modify the code** of the Lambda function によりコードを変更して機密情報を盗む。

これらのシナリオを再現する[**tf code to recreate this scenarios here**](https://github.com/adanalvarez/AWS-Attack-Scenarios/tree/main)は、こちらで確認できます。

{{#include ../../../../banners/hacktricks-training.md}}
