# AWS - CloudFront Post Exploitation

{{#include ../../../../banners/hacktricks-training.md}}

## CloudFront

Für weitere Informationen siehe:

{{#ref}}
../../aws-services/aws-cloudfront-enum.md
{{#endref}}

### `cloudfront:Delete*`
Ein attacker, dem cloudfront:Delete* gewährt wurde, kann distributions, policies und andere kritische CDN-Konfigurationsobjekte löschen — zum Beispiel distributions, cache/origin policies, key groups, origin access identities, functions/configs und zugehörige Ressourcen. Dies kann zu Dienstunterbrechungen, Datenverlust und zur Entfernung von Konfigurations- oder forensischen Artefakten führen.

Um eine distribution zu löschen, könnte ein attacker Folgendes verwenden:
```bash
aws cloudfront delete-distribution \
--id <DISTRIBUTION_ID> \
--if-match <ETAG>
```
### Man-in-the-Middle

Dieser [**Blogbeitrag**](https://medium.com/@adan.alvarez/how-attackers-can-misuse-aws-cloudfront-access-to-make-it-rain-cookies-acf9ce87541c) beschreibt ein paar verschiedene Szenarien, in denen eine **Lambda** hinzugefügt werden könnte (oder modifiziert, falls sie bereits verwendet wird) in eine **Kommunikation durch CloudFront** mit dem Ziel, Benutzerinformationen zu **stehlen** (wie das Session-**cookie**) und die **Antwort** zu **modifizieren** (Einfügen eines bösartigen JS-Skripts).

#### Szenario 1: MitM, bei dem CloudFront so konfiguriert ist, dass es HTML aus einem bucket abruft

- **Erstelle** die bösartige **function**.
- **Verknüpfe** sie mit der CloudFront Distribution.
- **Setze den event type auf "Viewer Response"**.

Durch Zugriff auf die Antwort kannst du das Benutzer-**cookie** stehlen und ein bösartiges JS injizieren.

#### Szenario 2: MitM, bei dem CloudFront bereits eine lambda function verwendet

- **Ändere den code** der lambda function, um sensible Informationen zu stehlen

Du kannst den [**tf code, um diese Szenarien hier nachzustellen**](https://github.com/adanalvarez/AWS-Attack-Scenarios/tree/main) einsehen.

{{#include ../../../../banners/hacktricks-training.md}}
