# AWS - CloudFront Post Exploitation

{{#include ../../../../banners/hacktricks-training.md}}

## CloudFront

更多信息请参见：

{{#ref}}
../../aws-services/aws-cloudfront-enum.md
{{#endref}}

### `cloudfront:Delete*`
获得 cloudfront:Delete* 权限的 attacker 可以删除 distributions、policies 以及其他关键的 CDN 配置对象 — 例如 distributions、cache/origin policies、key groups、origin access identities、functions/configs 及相关资源。 这可能导致服务中断、内容丢失，以及配置或取证痕迹被移除。

要删除 distribution，attacker 可以使用：
```bash
aws cloudfront delete-distribution \
--id <DISTRIBUTION_ID> \
--if-match <ETAG>
```
### Man-in-the-Middle

这篇 [**blog post**](https://medium.com/@adan.alvarez/how-attackers-can-misuse-aws-cloudfront-access-to-make-it-rain-cookies-acf9ce87541c) 提出了几种不同的场景，在这些场景中可以将一个 **Lambda** 添加（如果已在使用则修改）到通过 **CloudFront** 的通信中，目的是 **窃取** 用户信息（例如会话 **cookie**）并 **修改** **response**（注入恶意 **JS** 脚本）。

#### scenario 1: MitM where CloudFront is configured to access some HTML of a bucket

- **创建** 恶意 **函数**。
- **将其关联到** CloudFront **分发**。
- **将 event type 设置为 "Viewer Response"**。

访问响应后，你可以窃取用户的 **cookie** 并注入恶意 **JS**。

#### scenario 2: MitM where CloudFront is already using a lambda function

- **修改代码**，在 lambda 函数 中窃取敏感信息。

You can check the [**tf code to recreate this scenarios here**](https://github.com/adanalvarez/AWS-Attack-Scenarios/tree/main).

{{#include ../../../../banners/hacktricks-training.md}}
