# AWS - Lambda Post Exploitation

{{#include ../../../../banners/hacktricks-training.md}}

## Lambda

更多信息请参见：

{{#ref}}
../../aws-services/aws-lambda-enum.md
{{#endref}}

### Exfilrtate Lambda Credentials

Lambda 在运行时通过环境变量注入凭证。如果你能访问这些变量（例如读取 `/proc/self/environ` 或使用存在漏洞的函数本身），就可以直接使用这些凭证。它们存放在默认变量名 `AWS_SESSION_TOKEN`、`AWS_SECRET_ACCESS_KEY` 和 `AWS_ACCESS_KEY_ID` 中。

默认情况下，这些凭证通常有权限写入一个 cloudwatch log group（其名称保存在 `AWS_LAMBDA_LOG_GROUP_NAME` 中），并可创建任意 log group，但实际 lambda 函数常根据用途被分配更多权限。

### Steal Others Lambda URL Requests

如果攻击者设法在 Lambda 中获得 RCE，他可以窃取其他用户发向该 Lambda 的 HTTP 请求。如果这些请求包含敏感信息（cookies、凭证等），攻击者就能获取这些信息。

{{#ref}}
aws-warm-lambda-persistence.md
{{#endref}}

### Steal Others Lambda URL Requests & Extensions Requests

滥用 Lambda Layers 还可以利用 extensions 在 Lambda 中实现持久化，同时窃取并篡改请求。

{{#ref}}
../../aws-persistence/aws-lambda-persistence/aws-abusing-lambda-extensions.md
{{#endref}}

### AWS Lambda – VPC Egress Bypass

通过将配置更新为空的 VpcConfig (SubnetIds=[], SecurityGroupIds=[]) 可以将 Lambda 函数从受限 VPC 中强制移出。函数随后将在 Lambda 托管的网络平面运行，恢复外网访问，从而绕过由私有 VPC 子网（无 NAT）实施的出站流量控制。

{{#ref}}
aws-lambda-vpc-egress-bypass.md
{{#endref}}

### AWS Lambda – Runtime Pinning/Rollback Abuse

滥用 `lambda:PutRuntimeManagementConfig` 将函数固定到特定 runtime 版本 (Manual) 或冻结更新 (FunctionUpdate)。这可保持对恶意 layers/wrappers 的兼容性，并使函数停留在过时且易受攻击的 runtime 上，从而帮助利用和长期持久化。

{{#ref}}
aws-lambda-runtime-pinning-abuse.md
{{#endref}}

### AWS Lambda – Log Siphon via LoggingConfig.LogGroup Redirection

滥用 `lambda:UpdateFunctionConfiguration` 的高级日志控制，可将函数的日志重定向到攻击者指定的 CloudWatch Logs log group。此操作无需修改代码或执行角色（大多数 Lambda 角色通过 `AWSLambdaBasicExecutionRole` 已包含 `logs:CreateLogGroup/CreateLogStream/PutLogEvents`）。如果函数打印了 secrets/请求体或崩溃并输出堆栈跟踪，可从新的 log group 收集这些信息。

{{#ref}}
aws-lambda-loggingconfig-redirection.md
{{#endref}}

### AWS - Lambda Function URL Public Exposure

将私有 Lambda Function URL 变为公共的无身份验证端点：将 Function URL AuthType 切换为 NONE，并附加一个授予 lambda:InvokeFunctionUrl 给所有人的基于资源的策略。这样可以匿名调用内部函数，可能暴露敏感的后端操作。

{{#ref}}
aws-lambda-function-url-public-exposure.md
{{#endref}}

### AWS Lambda – Event Source Mapping Target Hijack

滥用 `UpdateEventSourceMapping` 更改现有 Event Source Mapping (ESM) 的目标 Lambda 函数，使来自 DynamoDB Streams、Kinesis 或 SQS 的记录被投递到攻击者控制的函数。这样可以在不接触生产者或原函数代码的情况下，悄然转移实时数据。

{{#ref}}
aws-lambda-event-source-mapping-target-hijack.md
{{#endref}}

### AWS Lambda – EFS Mount Injection data exfiltration

滥用 `lambda:UpdateFunctionConfiguration` 将现有的 EFS Access Point 挂载到 Lambda，然后部署简单代码列出/读取挂载路径的文件，从而 exfiltrate 函数之前无法访问的共享 secrets/配置。

{{#ref}}
aws-lambda-efs-mount-injection.md
{{#endref}}



{{#include ../../../../banners/hacktricks-training.md}}
