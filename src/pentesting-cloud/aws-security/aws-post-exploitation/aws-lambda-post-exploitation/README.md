# AWS - Lambda Post Exploitation

{{#include ../../../../banners/hacktricks-training.md}}

## Lambda

For more information check:

{{#ref}}
../../aws-services/aws-lambda-enum.md
{{#endref}}

### Exfilrtate Lambda Credentials

Lambda çalışma zamanında kimlik bilgilerini çevresel değişkenler aracılığıyla inject eder. Eğer bunlara erişebilirseniz (ör. `/proc/self/environ` okuyarak veya zafiyetli fonksiyonun kendisini kullanarak) bunları kendiniz kullanabilirsiniz. Bu bilgiler varsayılan olarak `AWS_SESSION_TOKEN`, `AWS_SECRET_ACCESS_KEY` ve `AWS_ACCESS_KEY_ID` isimli değişkenlerde bulunur.

Varsayılan olarak, bunların bir cloudwatch log group'una yazma erişimi vardır (adını `AWS_LAMBDA_LOG_GROUP_NAME` içinde saklar), ayrıca rastgele log group'ları oluşturma izni de bulunur; ancak Lambda fonksiyonlarına genellikle kullanım amaçlarına göre daha fazla izin atanır.

### Steal Others Lambda URL Requests

Eğer bir attacker herhangi bir şekilde Lambda içinde RCE elde ederse, diğer kullanıcıların Lambda'ya gönderdiği HTTP isteklerini çalabilir. İstekler hassas bilgi (cookies, kimlik bilgileri...) içeriyorsa, bunları ele geçirebilir.

{{#ref}}
aws-warm-lambda-persistence.md
{{#endref}}

### Steal Others Lambda URL Requests & Extensions Requests

Lambda Layers'ı kötüye kullanarak extensions'ları istismar etmek ve Lambda içinde kalıcı olmak mümkündür; ayrıca istekleri çalmak ve değiştirmek de mümkündür.

{{#ref}}
../../aws-persistence/aws-lambda-persistence/aws-abusing-lambda-extensions.md
{{#endref}}

### AWS Lambda – VPC Egress Bypass

Boş bir VpcConfig ile (SubnetIds=[], SecurityGroupIds=[]) yapılandırmayı güncelleyerek Lambda fonksiyonunu kısıtlı bir VPC'den çıkarmaya zorlayın. Fonksiyon daha sonra Lambda tarafından yönetilen ağ düzleminde çalışır, outbound internet erişimini yeniden kazanır ve NAT olmayan özel VPC alt ağları tarafından uygulanan egress kontrollerini atlatır.

{{#ref}}
aws-lambda-vpc-egress-bypass.md
{{#endref}}

### AWS Lambda – Runtime Pinning/Rollback Abuse

`lambda:PutRuntimeManagementConfig`'i kullanarak bir fonksiyonu belirli bir runtime sürümüne pinleyin (Manual) veya güncellemeleri dondurun (FunctionUpdate). Bu, kötü amaçlı layer/wrapper'larla uyumluluğu korur ve fonksiyonu sömürüye yardımcı olmak ve uzun süreli kalıcılık sağlamak için eski, vuln bir runtime'ta tutabilir.

{{#ref}}
aws-lambda-runtime-pinning-abuse.md
{{#endref}}

### AWS Lambda – Log Siphon via LoggingConfig.LogGroup Redirection

`lambda:UpdateFunctionConfiguration`'ın gelişmiş logging kontrollerini kullanarak bir fonksiyonun loglarını saldırganın seçtiği bir CloudWatch Logs log group'una yönlendirin. Bu, kodu veya execution role'u değiştirmeden çalışır (çoğu Lambda rolü zaten `AWSLambdaBasicExecutionRole` aracılığıyla `logs:CreateLogGroup/CreateLogStream/PutLogEvents` içerir). Fonksiyon gizli bilgileri/istek gövdelerini yazdırıyorsa veya stack trace ile çökerse, bunları yeni log group'tan toplayabilirsiniz.

{{#ref}}
aws-lambda-loggingconfig-redirection.md
{{#endref}}

### AWS - Lambda Function URL Public Exposure

Function URL AuthType'ı NONE yapıp herkese lambda:InvokeFunctionUrl veren resource-based bir politika ekleyerek özel bir Lambda Function URL'ini genel, kimlik doğrulamasız bir endpoint'e çevirin. Bu, iç fonksiyonların anonim çağrılmasına izin verir ve hassas backend işlemlerini açığa çıkarabilir.

{{#ref}}
aws-lambda-function-url-public-exposure.md
{{#endref}}

### AWS Lambda – Event Source Mapping Target Hijack

`UpdateEventSourceMapping`'i kullanarak mevcut bir Event Source Mapping (ESM) hedef Lambda fonksiyonunu değiştirin; böylece DynamoDB Streams, Kinesis veya SQS'ten gelen kayıtlar saldırgan kontrollü bir fonksiyona teslim edilir. Bu, üreticilere veya orijinal fonksiyon koduna dokunmadan canlı veriyi sessizce saptırır.

{{#ref}}
aws-lambda-event-source-mapping-target-hijack.md
{{#endref}}

### AWS Lambda – EFS Mount Injection data exfiltration

`lambda:UpdateFunctionConfiguration`'ı kullanarak var olan bir EFS Access Point'i Lambda'ya bağlayın, ardından mount edilen yoldan dosyaları listeleyen/okuyan basit kodu deploy ederek fonksiyonun daha önce erişemediği paylaşılan sırları/konfigürasyonu dışa aktarmak mümkün olur.

{{#ref}}
aws-lambda-efs-mount-injection.md
{{#endref}}



{{#include ../../../../banners/hacktricks-training.md}}
