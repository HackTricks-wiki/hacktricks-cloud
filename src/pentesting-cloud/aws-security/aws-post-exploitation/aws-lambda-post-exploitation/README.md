# AWS - Lambda Post Exploitation

{{#include ../../../../banners/hacktricks-training.md}}

## Lambda

For more information check:

{{#ref}}
../../aws-services/aws-lambda-enum.md
{{#endref}}

### Exfilrtate Lambda Credentials

Lambda używa zmiennych środowiskowych do dostarczania poświadczeń w czasie wykonywania. Jeśli uzyskasz do nich dostęp (np. odczytując `/proc/self/environ` lub wykorzystując podatną funkcję), możesz ich użyć samodzielnie. Są przechowywane w domyślnych zmiennych `AWS_SESSION_TOKEN`, `AWS_SECRET_ACCESS_KEY`, i `AWS_ACCESS_KEY_ID`.

Domyślnie będą miały uprawnienia do zapisu do grupy logów cloudwatch (jej nazwa jest przechowywana w `AWS_LAMBDA_LOG_GROUP_NAME`), jak również do tworzenia dowolnych grup logów; jednak funkcje lambda często mają dodatkowe uprawnienia przyznane w zależności od ich przeznaczenia.

### Steal Others Lambda URL Requests

Jeśli atakujący w jakiś sposób uzyska RCE wewnątrz Lambda, będzie mógł przechwytywać żądania HTTP innych użytkowników kierowane do tej funkcji. Jeśli żądania zawierają wrażliwe informacje (cookies, credentials...), będzie mógł je ukraść.

{{#ref}}
aws-warm-lambda-persistence.md
{{#endref}}

### Steal Others Lambda URL Requests & Extensions Requests

Nadużywając Lambda Layers można także wykorzystać extensions do utrwalenia dostępu w lambda oraz do przechwytywania i modyfikowania żądań.

{{#ref}}
../../aws-persistence/aws-lambda-persistence/aws-abusing-lambda-extensions.md
{{#endref}}

### AWS Lambda – VPC Egress Bypass

Wymuś uruchomienie funkcji Lambda poza ograniczonym VPC, aktualizując jej konfigurację z pustym VpcConfig (SubnetIds=[], SecurityGroupIds=[]). Funkcja zacznie wtedy działać w zarządzanym przez Lambda obszarze sieciowym, odzyskując dostęp do internetu wychodzącego i omijając kontrole egress wymuszane przez prywatne podsieci VPC bez NAT.

{{#ref}}
aws-lambda-vpc-egress-bypass.md
{{#endref}}

### AWS Lambda – Runtime Pinning/Rollback Abuse

Wykorzystaj `lambda:PutRuntimeManagementConfig` do przypięcia funkcji do konkretnej wersji runtime (Manual) lub zamrożenia aktualizacji (FunctionUpdate). To zachowuje kompatybilność z złośliwymi layers/wrappers i może utrzymać funkcję na przestarzałym, podatnym runtime, co ułatwia exploitation i długoterminową persistence.

{{#ref}}
aws-lambda-runtime-pinning-abuse.md
{{#endref}}

### AWS Lambda – Log Siphon via LoggingConfig.LogGroup Redirection

Wykorzystaj zaawansowane ustawienia logowania `lambda:UpdateFunctionConfiguration` do przekierowania logów funkcji do wybranej przez atakującego grupy logów CloudWatch Logs. Działa to bez zmiany kodu ani roli wykonawczej (większość ról Lambda już zawiera `logs:CreateLogGroup/CreateLogStream/PutLogEvents` przez `AWSLambdaBasicExecutionRole`). Jeśli funkcja wypisuje secrets/request bodies lub ulega crashowi ze stack trace, możesz je zebrać z nowej grupy logów.

{{#ref}}
aws-lambda-loggingconfig-redirection.md
{{#endref}}

### AWS - Lambda Function URL Public Exposure

Zamień prywatny Lambda Function URL w publiczny, nieautoryzowany endpoint, zmieniając Function URL AuthType na NONE i dołączając resource-based policy, która przyznaje lambda:InvokeFunctionUrl wszystkim. To umożliwia anonimowe wywoływanie wewnętrznych funkcji i może ujawnić wrażliwe operacje backendowe.

{{#ref}}
aws-lambda-function-url-public-exposure.md
{{#endref}}

### AWS Lambda – Event Source Mapping Target Hijack

Wykorzystaj `UpdateEventSourceMapping` do zmiany docelowej funkcji Lambda istniejącego Event Source Mapping (ESM), tak aby rekordy z DynamoDB Streams, Kinesis, lub SQS były dostarczane do funkcji kontrolowanej przez atakującego. To cicho przekierowuje dane na żywo bez ingerencji w producentów ani oryginalny kod funkcji.

{{#ref}}
aws-lambda-event-source-mapping-hijack.md
{{#endref}}

### AWS Lambda – EFS Mount Injection data exfiltration

Wykorzystaj `lambda:UpdateFunctionConfiguration` do podłączenia istniejącego EFS Access Point do Lambda, a następnie wdrożenia prostego kodu, który listuje/odczytuje pliki z zamontowanej ścieżki, aby exfiltrate współdzielone secrets/config, do których funkcja wcześniej nie miała dostępu.

{{#ref}}
aws-lambda-efs-mount-injection.md
{{#endref}}



{{#include ../../../../banners/hacktricks-training.md}}
