# AWS - Lambda Post Exploitation

{{#include ../../../../banners/hacktricks-training.md}}

## Lambda

有关更多信息，请查看：

{{#ref}}
../../aws-services/aws-lambda-enum.md
{{#endref}}

### Exfilrtate Lambda Credentials

Lambda 使用环境变量在运行时注入凭证。如果你能获取到这些变量（通过读取 `/proc/self/environ` 或使用有漏洞的函数本身），就可以直接使用它们。它们存放在默认变量名 `AWS_SESSION_TOKEN`、`AWS_SECRET_ACCESS_KEY` 和 `AWS_ACCESS_KEY_ID` 中。

默认情况下，这些凭证有权限写入一个 cloudwatch log group（其名称存储在 `AWS_LAMBDA_LOG_GROUP_NAME` 中），并且可以创建任意日志组，不过 Lambda 函数通常会根据其预期用途被分配更多权限。

### Steal Others Lambda URL Requests

如果攻击者以某种方式在 Lambda 内获得 RCE，他将能够窃取其他用户发往该 lambda 的 HTTP 请求。如果请求中包含敏感信息（cookies、credentials 等），攻击者就能窃取这些信息。

{{#ref}}
aws-warm-lambda-persistence.md
{{#endref}}

### Steal Others Lambda URL Requests & Extensions Requests

滥用 Lambda Layers 也可以利用 extensions 实现持久化，同时窃取和修改请求。

{{#ref}}
../../aws-persistence/aws-lambda-persistence/aws-abusing-lambda-extensions.md
{{#endref}}

### AWS Lambda – VPC Egress Bypass

通过将函数配置更新为一个空的 VpcConfig（SubnetIds=[], SecurityGroupIds=[]）可以强制 Lambda 函数脱离受限的 VPC。函数随后将在 Lambda 管理的网络平面中运行，恢复出站互联网访问，从而绕过由私有 VPC 子网（无 NAT）实施的出站控制。

{{#ref}}
aws-lambda-vpc-egress-bypass.md
{{#endref}}

### AWS Lambda – Runtime Pinning/Rollback Abuse

滥用 `lambda:PutRuntimeManagementConfig` 将函数固定到特定 runtime 版本（Manual）或冻结更新（FunctionUpdate）。这可保留与恶意 layers/wrappers 的兼容性，并将函数保持在过时且易受攻击的 runtime 上，以便于利用和长期持久化。

{{#ref}}
aws-lambda-runtime-pinning-abuse.md
{{#endref}}

### AWS Lambda – Log Siphon via LoggingConfig.LogGroup Redirection

滥用 `lambda:UpdateFunctionConfiguration` 的高级日志控制，将函数的日志重定向到攻击者指定的 CloudWatch Logs 日志组。此方法无需更改代码或执行角色（大多数 Lambda 角色已通过 `AWSLambdaBasicExecutionRole` 包含 `logs:CreateLogGroup/CreateLogStream/PutLogEvents`）。如果函数打印了 secrets/请求体或崩溃并产生堆栈跟踪，你可以从新的日志组中收集这些信息。

{{#ref}}
aws-lambda-loggingconfig-redirection.md
{{#endref}}

### AWS - Lambda Function URL Public Exposure

将私有 Lambda Function URL 转为公共未认证端点的方法是将 Function URL AuthType 切换为 NONE，并附加一个授予 lambda:InvokeFunctionUrl 给所有人的基于资源的策略。这样可以匿名调用内部函数，可能暴露敏感的后端操作。

{{#ref}}
aws-lambda-function-url-public-exposure.md
{{#endref}}

### AWS Lambda – Event Source Mapping Target Hijack

滥用 `UpdateEventSourceMapping` 更改现有 Event Source Mapping (ESM) 的目标 Lambda 函数，使来自 DynamoDB Streams、Kinesis 或 SQS 的记录被发送到攻击者控制的函数。这会在不接触生产者或原始函数代码的情况下静默地劫持实时数据。

{{#ref}}
aws-lambda-event-source-mapping-hijack.md
{{#endref}}

### AWS Lambda – EFS Mount Injection data exfiltration

滥用 `lambda:UpdateFunctionConfiguration` 将现有的 EFS Access Point 附加到 Lambda，然后部署简单代码来列出/读取挂载路径中的文件，以外传函数之前无法访问的共享 secrets/配置。

{{#ref}}
aws-lambda-efs-mount-injection.md
{{#endref}}



{{#include ../../../../banners/hacktricks-training.md}}
