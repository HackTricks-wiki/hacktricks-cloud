# AWS - Lambda Пост-експлуатація

{{#include ../../../../banners/hacktricks-training.md}}

## Lambda

Для додаткової інформації див.:

{{#ref}}
../../aws-services/aws-lambda-enum.md
{{#endref}}

### Експфільтрація Lambda Credentials

Lambda використовує змінні середовища для ін'єкції облікових даних під час виконання. Якщо ви можете отримати до них доступ (наприклад, прочитавши `/proc/self/environ` або використавши саму вразливу функцію), ви можете використовувати їх самостійно. Вони зберігаються у змінних за замовчуванням `AWS_SESSION_TOKEN`, `AWS_SECRET_ACCESS_KEY` та `AWS_ACCESS_KEY_ID`.

За замовчуванням ці облікові дані матимуть доступ на запис у cloudwatch log group (назва якої зберігається в `AWS_LAMBDA_LOG_GROUP_NAME`), а також на створення довільних log group; проте lambda functions часто мають більше дозволів, призначених відповідно до їхнього призначення.

### `lambda:Delete*`
Зловмисник, якому надано `lambda:Delete*`, може видаляти Lambda functions, versions/aliases, layers, event source mappings та інші пов'язані конфігурації.
```bash
aws lambda delete-function \
--function-name <LAMBDA_NAME>
```
### Steal Others Lambda URL Requests

Якщо атакуючому якимось чином вдасться отримати RCE всередині Lambda, він зможе викрасти HTTP-запити інших користувачів до цієї Lambda. Якщо запити містять конфіденційну інформацію (cookies, credentials...), він зможе їх викрасти.

{{#ref}}
aws-warm-lambda-persistence.md
{{#endref}}

### Steal Others Lambda URL Requests & Extensions Requests

Зловживаючи Lambda Layers, також можна використовувати extensions для забезпечення персистенції в Lambda, а також викрадати й модифікувати запити.

{{#ref}}
../../aws-persistence/aws-lambda-persistence/aws-abusing-lambda-extensions.md
{{#endref}}

### AWS Lambda – VPC Egress Bypass

Примусово виведіть Lambda function з обмеженого VPC, оновивши його конфігурацію порожнім VpcConfig (SubnetIds=[], SecurityGroupIds=[]). Функція тоді виконуватиметься в мережевій площині, керованій Lambda, відновлюючи доступ до зовнішнього інтернету та обходячи обмеження вихідного трафіку, що застосовуються приватними VPC підмережами без NAT.

{{#ref}}
aws-lambda-vpc-egress-bypass.md
{{#endref}}

### AWS Lambda – Runtime Pinning/Rollback Abuse

Зловживайте `lambda:PutRuntimeManagementConfig`, щоб зафіксувати функцію на конкретній версії runtime (Manual) або заморозити оновлення (FunctionUpdate). Це зберігає сумісність з шкідливими layers/wrappers і може утримувати функцію на застарілому, вразливому runtime, полегшуючи експлуатацію та довготривалу персистенцію.

{{#ref}}
aws-lambda-runtime-pinning-abuse.md
{{#endref}}

### AWS Lambda – Log Siphon via LoggingConfig.LogGroup Redirection

Зловживайте `lambda:UpdateFunctionConfiguration` просунутими налаштуваннями логування, щоб перенаправити логи функції в CloudWatch Logs log group, обраний атакуючим. Це працює без зміни коду або execution role (більшість Lambda ролей вже включають `logs:CreateLogGroup/CreateLogStream/PutLogEvents` через `AWSLambdaBasicExecutionRole`). Якщо функція виводить secrets/request bodies або аварійно завершується зі stack traces, ви можете зібрати їх із нового log group.

{{#ref}}
aws-lambda-loggingconfig-redirection.md
{{#endref}}

### AWS - Lambda Function URL Public Exposure

Перетворіть приватний Lambda Function URL на публічний неаутентифікований endpoint, переключивши Function URL AuthType на NONE та прикріпивши resource-based policy, яка надає lambda:InvokeFunctionUrl всім. Це дозволяє анонімно викликати внутрішні функції і може викрити конфіденційні backend-операції.

{{#ref}}
aws-lambda-function-url-public-exposure.md
{{#endref}}

### AWS Lambda – Event Source Mapping Target Hijack

Зловживайте `UpdateEventSourceMapping`, щоб змінити цільову Lambda function існуючого Event Source Mapping (ESM), так щоб записи з DynamoDB Streams, Kinesis або SQS доставлялися до функції під контролем атакуючого. Це непомітно відводить живі дані без змін у продюсерах або коді оригінальної функції.

{{#ref}}
aws-lambda-event-source-mapping-hijack.md
{{#endref}}

### AWS Lambda – EFS Mount Injection data exfiltration

Зловживайте `lambda:UpdateFunctionConfiguration`, щоб приєднати існуючий EFS Access Point до Lambda, а потім розгорнути тривіальний код, який перераховує/читає файли з підключеного шляху для ексфільтрації спільних секретів/конфігів, до яких функція раніше не мала доступу.

{{#ref}}
aws-lambda-efs-mount-injection.md
{{#endref}}



{{#include ../../../../banners/hacktricks-training.md}}
