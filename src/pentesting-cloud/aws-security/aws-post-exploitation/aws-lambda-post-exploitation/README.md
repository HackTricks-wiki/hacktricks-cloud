# AWS - Lambda Post Exploitation

{{#include ../../../../banners/hacktricks-training.md}}

## Lambda

Daha fazla bilgi için bakınız:

{{#ref}}
../../aws-services/aws-lambda-enum.md
{{#endref}}

### Exfilrtate Lambda Credentials

Lambda, çalışma zamanında kimlik bilgilerini ortam değişkenleri aracılığıyla enjekte eder. Eğer onlara erişebilirseniz ( `/proc/self/environ` dosyasını okuyarak veya zafiyetli fonksiyonun kendisini kullanarak), bu kimlik bilgilerini kendiniz kullanabilirsiniz. Bu bilgiler varsayılan değişken isimlerinde saklanır: `AWS_SESSION_TOKEN`, `AWS_SECRET_ACCESS_KEY`, ve `AWS_ACCESS_KEY_ID`.

Varsayılan olarak, bunların `AWS_LAMBDA_LOG_GROUP_NAME` değişkeninde saklanan isme sahip bir cloudwatch log group'una yazma ve ayrıca yeni log group'lar oluşturma erişimi olur; ancak lambda fonksiyonlarına genellikle kullanım amaçlarına bağlı olarak daha fazla izin atanır.

### `lambda:Delete*`
lambda:Delete* izni verilen bir saldırgan, Lambda fonksiyonlarını, versions/aliases, layers, event source mappings ve diğer ilişkili yapılandırmaları silebilir.
```bash
aws lambda delete-function \
--function-name <LAMBDA_NAME>
```
### Steal Others Lambda URL Requests

Bir saldırgan bir şekilde bir Lambda içinde RCE elde ederse, diğer kullanıcıların Lambda'ya gönderdiği HTTP isteklerini çalabilir. İstekler hassas bilgiler (cookies, credentials...) içeriyorsa, bunları çalabilir.

{{#ref}}
aws-warm-lambda-persistence.md
{{#endref}}

### Steal Others Lambda URL Requests & Extensions Requests

Lambda Layers'ı kötüye kullanarak extensions'ları da suistimal etmek ve Lambda içinde kalıcılık sağlamak; ayrıca istekleri çalmak ve değiştirmek de mümkündür.

{{#ref}}
../../aws-persistence/aws-lambda-persistence/aws-abusing-lambda-extensions.md
{{#endref}}

### AWS Lambda – VPC Egress Bypass

Konfigürasyonunu boş bir VpcConfig (SubnetIds=[], SecurityGroupIds=[]) ile güncelleyerek bir Lambda fonksiyonunu kısıtlı bir VPC'den çıkmaya zorlayın. Fonksiyon daha sonra Lambda tarafından yönetilen ağ düzleminde çalışır, çıkış internet erişimini yeniden kazanır ve NAT olmayan özel VPC alt ağları tarafından uygulanan egress kontrollerini atlar.

{{#ref}}
aws-lambda-vpc-egress-bypass.md
{{#endref}}

### AWS Lambda – Runtime Pinning/Rollback Abuse

`lambda:PutRuntimeManagementConfig`'i kötüye kullanarak bir fonksiyonu belirli bir runtime sürümüne sabitleyebilir (Manual) veya güncellemeleri dondurabilirsiniz (FunctionUpdate). Bu, kötü amaçlı layers/wrappers ile uyumluluğu korur ve fonksiyonu eski, zafiyetli bir runtime'da tutarak exploitation ve long-term persistence'e yardımcı olabilir.

{{#ref}}
aws-lambda-runtime-pinning-abuse.md
{{#endref}}

### AWS Lambda – Log Siphon via LoggingConfig.LogGroup Redirection

`lambda:UpdateFunctionConfiguration`'in gelişmiş logging kontrollerini kötüye kullanarak bir fonksiyonun loglarını saldırganın seçtiği bir CloudWatch Logs log group'una yönlendirebilirsiniz. Bu, kodu veya execution role'ü değiştirmeden işe yarar (çoğu Lambda rolü zaten `AWSLambdaBasicExecutionRole` aracılığıyla `logs:CreateLogGroup/CreateLogStream/PutLogEvents` içerir). Fonksiyon secrets/request bodies yazdırıyorsa veya stack trace ile çökerse, bunları yeni log grubundan toplayabilirsiniz.

{{#ref}}
aws-lambda-loggingconfig-redirection.md
{{#endref}}

### AWS - Lambda Function URL Public Exposure

Function URL AuthType'ı NONE olarak değiştirip herkese lambda:InvokeFunctionUrl izni veren resource-based policy ekleyerek özel bir Lambda Function URL'ini herkese açık, kimlik doğrulamasız bir endpoint'e dönüştürebilirsiniz. Bu, iç fonksiyonların anonim olarak çağrılmasına izin verir ve hassas backend operasyonlarını açığa çıkarabilir.

{{#ref}}
aws-lambda-function-url-public-exposure.md
{{#endref}}

### AWS Lambda – Event Source Mapping Target Hijack

`UpdateEventSourceMapping`'i kötüye kullanarak mevcut bir Event Source Mapping (ESM)'in hedef Lambda fonksiyonunu değiştirin; böylece DynamoDB Streams, Kinesis veya SQS'ten gelen kayıtlar saldırgan kontrollü bir fonksiyona teslim edilir. Bu, üreticilere veya orijinal fonksiyon koduna dokunmadan canlı veriyi sessizce saptırır.

{{#ref}}
aws-lambda-event-source-mapping-hijack.md
{{#endref}}

### AWS Lambda – EFS Mount Injection data exfiltration

`lambda:UpdateFunctionConfiguration`'ı kötüye kullanarak mevcut bir EFS Access Point'i Lambda'ya bağlayın, ardından bağlanan yoldaki dosyaları listeleyen/okuyan basit kodu dağıtarak fonksiyonun daha önce erişemediği paylaşılan secrets/config'i exfiltrate edin.

{{#ref}}
aws-lambda-efs-mount-injection.md
{{#endref}}



{{#include ../../../../banners/hacktricks-training.md}}
