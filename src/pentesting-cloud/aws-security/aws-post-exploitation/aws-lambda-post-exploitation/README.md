# AWS - Lambda Post Exploitation

{{#include ../../../../banners/hacktricks-training.md}}

## Lambda

Daha fazla bilgi için bakınız:

{{#ref}}
../../aws-services/aws-lambda-enum.md
{{#endref}}

### Exfilrtate Lambda Credentials

Lambda, runtime sırasında kimlik bilgilerini environment variables aracılığıyla enjekte eder. Eğer onlara erişebilirseniz ( `/proc/self/environ` dosyasını okuyarak veya zafiyetli fonksiyonun kendisini kullanarak) bunları kendiniz kullanabilirsiniz. Bu bilgiler varsayılan değişken adlarında bulunur: `AWS_SESSION_TOKEN`, `AWS_SECRET_ACCESS_KEY` ve `AWS_ACCESS_KEY_ID`.

Varsayılan olarak bunlar bir cloudwatch log group'una yazma (grup adı `AWS_LAMBDA_LOG_GROUP_NAME` değişkeninde saklanır) ve ayrıca rastgele log grupları oluşturma yetkisine sahiptir; ancak lambda fonksiyonlarına genellikle kullanım amaçlarına göre daha fazla izin atanır.

### Steal Others Lambda URL Requests

Eğer bir saldırgan Lambda içinde bir şekilde RCE elde ederse, diğer kullanıcıların Lambda'ya gönderdiği HTTP isteklerini çalabilir. İstekler hassas bilgiler (cookies, credentials...) içeriyorsa bunları ele geçirebilir.

{{#ref}}
aws-warm-lambda-persistence.md
{{#endref}}

### Steal Others Lambda URL Requests & Extensions Requests

Lambda Layers'ı kötüye kullanarak extensions'ları da suistimal etmek ve Lambda içinde kalıcılık sağlamak mümkün; ayrıca istekleri çalmak ve değiştirmek de mümkün olur.

{{#ref}}
../../aws-persistence/aws-lambda-persistence/aws-abusing-lambda-extensions.md
{{#endref}}

### AWS Lambda – VPC Egress Bypass

Boş bir VpcConfig (SubnetIds=[], SecurityGroupIds=[]) ile yapılandırmasını güncelleyerek kısıtlı bir VPC'den bir Lambda fonksiyonunu zorla çıkarın. Fonksiyon daha sonra Lambda-managed networking plane üzerinde çalışacak, outbound internet erişimini yeniden kazanacak ve NAT olmayan özel VPC alt ağları tarafından uygulanan egress kontrollerini atlayacaktır.

{{#ref}}
aws-lambda-vpc-egress-bypass.md
{{#endref}}

### AWS Lambda – Runtime Pinning/Rollback Abuse

`lambda:PutRuntimeManagementConfig`'i kötüye kullanarak bir fonksiyonu belirli bir runtime sürümüne sabitleyebilir (Manual) veya güncellemeleri dondurabilirsiniz (FunctionUpdate). Bu, kötü amaçlı layers/wrappers ile uyumluluğu korur ve fonksiyonu eski, zafiyetli bir runtime üzerinde tutarak exploitation ve uzun dönem persistence sağlamaya yardımcı olabilir.

{{#ref}}
aws-lambda-runtime-pinning-abuse.md
{{#endref}}

### AWS Lambda – Log Siphon via LoggingConfig.LogGroup Redirection

`lambda:UpdateFunctionConfiguration`'ın gelişmiş logging kontrollerini kötüye kullanarak bir fonksiyonun loglarını saldırganın seçtiği bir CloudWatch Logs log grubuna yönlendirebilirsiniz. Bu, kodu veya execution role'u değiştirmeden (çoğu Lambda rolü zaten `AWSLambdaBasicExecutionRole` aracılığıyla `logs:CreateLogGroup/CreateLogStream/PutLogEvents` izinlerini içerir) çalışır. Eğer fonksiyon secrets/request bodies yazdırıyorsa veya stack trace ile çöküyorsa, bunları yeni log grubundan toplayabilirsiniz.

{{#ref}}
aws-lambda-loggingconfig-redirection.md
{{#endref}}

### AWS - Lambda Function URL Public Exposure

Function URL AuthType'ı NONE olarak değiştirip herkese lambda:InvokeFunctionUrl yetkisi veren bir resource-based policy ekleyerek özel bir Lambda Function URL'ini herkese açık, kimlik doğrulamasız bir endpoint'e dönüştürebilirsiniz. Bu, dahili fonksiyonların anonim çağrılmasına izin verir ve hassas backend işlemlerini açığa çıkarabilir.

{{#ref}}
aws-lambda-function-url-public-exposure.md
{{#endref}}

### AWS Lambda – Event Source Mapping Target Hijack

`UpdateEventSourceMapping`'i kötüye kullanarak mevcut bir Event Source Mapping (ESM)'in hedef Lambda fonksiyonunu değiştirin; böylece DynamoDB Streams, Kinesis veya SQS'ten gelen kayıtlar saldırgan kontrolündeki bir fonksiyona teslim edilir. Bu, üreticilere veya orijinal fonksiyon koduna dokunmadan canlı verileri sessizce yönlendirir.

{{#ref}}
aws-lambda-event-source-mapping-hijack.md
{{#endref}}

### AWS Lambda – EFS Mount Injection data exfiltration

`lambda:UpdateFunctionConfiguration`'ı kötüye kullanarak mevcut bir EFS Access Point'i bir Lambda'ya bağlayın, ardından bağlanan yoldaki dosyaları listeleyen/okuyan basit bir kod dağıtarak fonksiyonun önceden erişemediği paylaşılan secrets/config'i exfiltrate edin.

{{#ref}}
aws-lambda-efs-mount-injection.md
{{#endref}}



{{#include ../../../../banners/hacktricks-training.md}}
