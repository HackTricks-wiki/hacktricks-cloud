# AWS - Lambda Post Exploitation

{{#include ../../../../banners/hacktricks-training.md}}

## Lambda

Για περισσότερες πληροφορίες δείτε:

{{#ref}}
../../aws-services/aws-lambda-enum.md
{{#endref}}

### Exfilrtate Lambda Credentials

Η Lambda χρησιμοποιεί μεταβλητές περιβάλλοντος για να εισάγει credentials κατά το runtime. Αν αποκτήσετε πρόσβαση σε αυτές (διαβάζοντας `/proc/self/environ` ή χρησιμοποιώντας την ίδια την ευάλωτη function), μπορείτε να τις χρησιμοποιήσετε. Βρίσκονται στις προεπιλεγμένες μεταβλητές `AWS_SESSION_TOKEN`, `AWS_SECRET_ACCESS_KEY`, και `AWS_ACCESS_KEY_ID`.

Κατά προεπιλογή, αυτές έχουν πρόσβαση για εγγραφή σε ένα cloudwatch log group (το όνομα του οποίου αποθηκεύεται στη μεταβλητή `AWS_LAMBDA_LOG_GROUP_NAME`), καθώς και για δημιουργία αυθαίρετων log groups, ωστόσο οι lambda functions συχνά έχουν περισσότερα permissions ανάλογα με τη χρήση τους.

### Steal Others Lambda URL Requests

Αν ένας attacker με κάποιον τρόπο αποκτήσει RCE μέσα σε μια Lambda, θα μπορεί να κλέψει τα HTTP requests άλλων χρηστών προς τη lambda. Αν τα requests περιέχουν ευαίσθητες πληροφορίες (cookies, credentials...) θα μπορεί να τις κλέψει.

{{#ref}}
aws-warm-lambda-persistence.md
{{#endref}}

### Steal Others Lambda URL Requests & Extensions Requests

Καταχρώμενος τα Lambda Layers, είναι επίσης δυνατό να καταχραστείς extensions και να διατηρήσεις παρουσία στη lambda, καθώς και να κλέψεις και να τροποποιήσεις requests.

{{#ref}}
../../aws-persistence/aws-lambda-persistence/aws-abusing-lambda-extensions.md
{{#endref}}

### AWS Lambda – VPC Egress Bypass

Εξαναγκάστε μια Lambda function να βγει από ένα περιορισμένο VPC ενημερώνοντας τη configuration με ένα κενό VpcConfig (SubnetIds=[], SecurityGroupIds=[]). Η function θα τρέξει τότε στο Lambda-managed networking plane, ανακτώντας την εξερχόμενη πρόσβαση στο Internet και παρακάμπτοντας τους ελέγχους egress που επιβάλλονται από ιδιωτικά VPC subnets χωρίς NAT.

{{#ref}}
aws-lambda-vpc-egress-bypass.md
{{#endref}}

### AWS Lambda – Runtime Pinning/Rollback Abuse

Καταχρηστείτε την ενέργεια `lambda:PutRuntimeManagementConfig` για να "pin" μια function σε συγκεκριμένη έκδοση runtime (Manual) ή να παγώσετε ενημερώσεις (FunctionUpdate). Αυτό διατηρεί συμβατότητα με malicious layers/wrappers και μπορεί να κρατήσει τη function σε ένα ξεπερασμένο, ευάλωτο runtime για διευκόλυνση exploitation και μακροχρόνιας persistence.

{{#ref}}
aws-lambda-runtime-pinning-abuse.md
{{#endref}}

### AWS Lambda – Log Siphon via LoggingConfig.LogGroup Redirection

Καταχρηστείτε το `lambda:UpdateFunctionConfiguration` για να χρησιμοποιήσετε τα advanced logging controls και να ανακατευθύνετε τα logs μιας function σε ένα CloudWatch Logs log group που έχει επιλέξει ο attacker. Αυτό λειτουργεί χωρίς αλλαγή του code ή του execution role (οι περισσότερες Lambda roles ήδη περιλαμβάνουν `logs:CreateLogGroup/CreateLogStream/PutLogEvents` μέσω του `AWSLambdaBasicExecutionRole`). Αν η function εκτυπώνει secrets/request bodies ή πέφτει με stack traces, μπορείτε να τα συλλέξετε από το νέο log group.

{{#ref}}
aws-lambda-loggingconfig-redirection.md
{{#endref}}

### AWS - Lambda Function URL Public Exposure

Μετατρέψτε ένα ιδιωτικό Lambda Function URL σε δημόσιο μη-αυθεντικοποιημένο endpoint αλλάζοντας το Function URL AuthType σε NONE και επισυνάπτοντας ένα resource-based policy που δίνει το δικαίωμα lambda:InvokeFunctionUrl σε όλους. Αυτό επιτρέπει ανώνυμη invocation εσωτερικών functions και μπορεί να εκθέσει ευαίσθητες backend λειτουργίες.

{{#ref}}
aws-lambda-function-url-public-exposure.md
{{#endref}}

### AWS Lambda – Event Source Mapping Target Hijack

Καταχρηστείτε το `UpdateEventSourceMapping` για να αλλάξετε τον target Lambda function ενός υπάρχοντος Event Source Mapping (ESM) ώστε τα records από DynamoDB Streams, Kinesis ή SQS να παραδίδονται σε μια function που ελέγχει ο attacker. Αυτό αποκλίνει σιωπηλά τα ζωντανά δεδομένα χωρίς να πειράζει τους producers ή τον αρχικό function code.

{{#ref}}
aws-lambda-event-source-mapping-hijack.md
{{#endref}}

### AWS Lambda – EFS Mount Injection data exfiltration

Καταχρηστείτε το `lambda:UpdateFunctionConfiguration` για να προσθέσετε ένα υπάρχον EFS Access Point σε μια Lambda, και στη συνέχεια αναπτύξτε απλό code που κάνει list/read αρχείων από το mounted path για να εξάγετε κοινά secrets/config που η function προηγουμένως δεν μπορούσε να προσπελάσει.

{{#ref}}
aws-lambda-efs-mount-injection.md
{{#endref}}



{{#include ../../../../banners/hacktricks-training.md}}
