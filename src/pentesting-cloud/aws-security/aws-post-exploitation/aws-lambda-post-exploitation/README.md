# AWS - Lambda Post Exploitation

{{#include ../../../../banners/hacktricks-training.md}}

## Lambda

Για περισσότερες πληροφορίες δείτε:

{{#ref}}
../../aws-services/aws-lambda-enum.md
{{#endref}}

### Exfilrtate Lambda Credentials

Lambda χρησιμοποιεί μεταβλητές περιβάλλοντος για να εισάγει διαπιστευτήρια κατά το χρόνο εκτέλεσης. Αν αποκτήσετε πρόσβαση σε αυτές (διαβάζοντας `/proc/self/environ` ή χρησιμοποιώντας την ίδια την ευπαθή function), μπορείτε να τις χρησιμοποιήσετε οι ίδιοι. Βρίσκονται στις προεπιλεγμένες μεταβλητές `AWS_SESSION_TOKEN`, `AWS_SECRET_ACCESS_KEY`, and `AWS_ACCESS_KEY_ID`.

Κατά προεπιλογή, αυτές θα έχουν πρόσβαση για εγγραφή σε ένα cloudwatch log group (το όνομα του οποίου αποθηκεύεται στο `AWS_LAMBDA_LOG_GROUP_NAME`), καθώς και δικαίωμα δημιουργίας αυθαίρετων log groups. Ωστόσο, lambda functions συχνά έχουν περισσότερα δικαιώματα ανατεθειμένα βάσει της προοριζόμενης χρήσης τους.

### `lambda:Delete*`
Ένας attacker στον οποίο έχει παραχωρηθεί το lambda:Delete* μπορεί να διαγράψει Lambda functions, versions/aliases, layers, event source mappings και άλλες σχετικές ρυθμίσεις.
```bash
aws lambda delete-function \
--function-name <LAMBDA_NAME>
```
### Κλοπή αιτημάτων URL άλλων Lambda

Εάν ένας επιτιθέμενος με κάποιον τρόπο καταφέρει να αποκτήσει RCE εντός ενός Lambda, θα μπορεί να κλέψει τα HTTP requests άλλων χρηστών προς το Lambda. Εάν τα requests περιέχουν ευαίσθητες πληροφορίες (cookies, credentials...) θα μπορεί να τα κλέψει.

{{#ref}}
aws-warm-lambda-persistence.md
{{#endref}}

### Κλοπή αιτημάτων URL άλλων Lambda και αιτημάτων Extensions

Με την κατάχρηση των Lambda Layers είναι επίσης δυνατό να καταχραστείτε extensions, να παραμείνετε στο Lambda και να κλέψετε/τροποποιήσετε requests.

{{#ref}}
../../aws-persistence/aws-lambda-persistence/aws-abusing-lambda-extensions.md
{{#endref}}

### AWS Lambda – VPC Egress Bypass

Εξαναγκάστε μια Lambda function να εξέλθει από ένα περιορισμένο VPC ενημερώνοντας τη διαμόρφωσή της με ένα κενό VpcConfig (SubnetIds=[], SecurityGroupIds=[]). Η function θα τρέξει τότε στο Lambda-managed networking plane, ανακτώντας την εξερχόμενη πρόσβαση στο internet και παρακάμπτοντας τους ελέγχους egress που επιβάλλονται από ιδιωτικά VPC subnets χωρίς NAT.

{{#ref}}
aws-lambda-vpc-egress-bypass.md
{{#endref}}

### AWS Lambda – Runtime Pinning/Rollback Abuse

Καταχραστείτε `lambda:PutRuntimeManagementConfig` για να pinάρετε μια function σε συγκεκριμένη έκδοση runtime (Manual) ή να παγώσετε ενημερώσεις (FunctionUpdate). Αυτό διατηρεί συμβατότητα με κακόβουλα layers/wrappers και μπορεί να κρατήσει τη function σε παρωχημένο, ευάλωτο runtime για να διευκολύνει exploitation και long-term persistence.

{{#ref}}
aws-lambda-runtime-pinning-abuse.md
{{#endref}}

### AWS Lambda – Log Siphon via LoggingConfig.LogGroup Redirection

Καταχραστείτε `lambda:UpdateFunctionConfiguration` και τα προηγμένα logging controls για να ανακατευθύνετε τα logs μιας function σε έναν CloudWatch Logs log group που επιλέγει ο επιτιθέμενος. Αυτό λειτουργεί χωρίς αλλαγή του κώδικα ή του execution role (οι περισσότερες Lambda roles ήδη περιλαμβάνουν `logs:CreateLogGroup/CreateLogStream/PutLogEvents` μέσω `AWSLambdaBasicExecutionRole`). Εάν η function εκτυπώνει secrets/request bodies ή καταρρέει με stack traces, μπορείτε να τα συλλέξετε από το νέο log group.

{{#ref}}
aws-lambda-loggingconfig-redirection.md
{{#endref}}

### AWS - Lambda Function URL Public Exposure

Μετατρέψτε ένα private Lambda Function URL σε δημόσιο, unauthenticated endpoint αλλάζοντας το Function URL AuthType σε NONE και επισυνάπτοντας μια resource-based policy που παραχωρεί lambda:InvokeFunctionUrl σε όλους. Αυτό επιτρέπει ανώνυμη invocation εσωτερικών functions και μπορεί να εκθέσει ευαίσθητες backend λειτουργίες.

{{#ref}}
aws-lambda-function-url-public-exposure.md
{{#endref}}

### AWS Lambda – Event Source Mapping Target Hijack

Καταχραστείτε `UpdateEventSourceMapping` για να αλλάξετε τη target Lambda function ενός υπάρχοντος Event Source Mapping (ESM), ώστε τα records από DynamoDB Streams, Kinesis ή SQS να παραδίδονται σε μια function ελεγχόμενη από επιτιθέμενο. Αυτό αποκλίνει σιωπηλά live δεδομένα χωρίς να αγγίζει τους producers ή τον αρχικό κώδικα της function.

{{#ref}}
aws-lambda-event-source-mapping-hijack.md
{{#endref}}

### AWS Lambda – EFS Mount Injection data exfiltration

Καταχραστείτε `lambda:UpdateFunctionConfiguration` για να επισυνάψετε ένα υπάρχον EFS Access Point σε ένα Lambda, και στη συνέχεια αναπτύξτε έναν απλό κώδικα που παραθέτει/διαβάζει αρχεία από το mounted path για να exfiltrate κοινόχρηστα secrets/config που η function προηγουμένως δεν μπορούσε να προσπελάσει.

{{#ref}}
aws-lambda-efs-mount-injection.md
{{#endref}}



{{#include ../../../../banners/hacktricks-training.md}}
