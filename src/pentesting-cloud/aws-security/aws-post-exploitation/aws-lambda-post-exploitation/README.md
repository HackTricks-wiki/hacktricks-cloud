# AWS - Lambda Post Exploitation

{{#include ../../../../banners/hacktricks-training.md}}

## Lambda

For more information check:

{{#ref}}
../../aws-services/aws-lambda-enum.md
{{#endref}}

### Exfilrtate Lambda Credentials

Lambda는 런타임에 환경 변수를 통해 자격 증명을 주입합니다. `/proc/self/environ`을 읽거나 취약한 함수를 통해 해당 변수에 접근할 수 있다면, 이를 사용하여 권한을 얻을 수 있습니다. 자격 증명은 기본 환경 변수 이름 `AWS_SESSION_TOKEN`, `AWS_SECRET_ACCESS_KEY`, `AWS_ACCESS_KEY_ID`에 저장됩니다.

기본적으로 이 자격 증명들은 cloudwatch 로그 그룹에 쓰기 권한(로그 그룹 이름은 `AWS_LAMBDA_LOG_GROUP_NAME`에 저장됨)과 임의의 로그 그룹을 생성할 수 있는 권한을 가집니다. 다만 Lambda 함수들은 의도된 사용에 따라 더 많은 권한이 할당되는 경우가 많습니다.

### Steal Others Lambda URL Requests

공격자가 Lambda 내부에서 RCE를 얻으면 다른 사용자의 Lambda로 향하는 HTTP 요청을 탈취할 수 있습니다. 요청에 민감한 정보(쿠키, 자격 증명 등)가 포함되어 있다면 이를 훔칠 수 있습니다.

{{#ref}}
aws-warm-lambda-persistence.md
{{#endref}}

### Steal Others Lambda URL Requests & Extensions Requests

Lambda Layers를 악용하면 extensions를 남용하여 Lambda에 지속성을 확보하는 것뿐만 아니라 요청을 탈취하고 수정하는 것도 가능합니다.

{{#ref}}
../../aws-persistence/aws-lambda-persistence/aws-abusing-lambda-extensions.md
{{#endref}}

### AWS Lambda – VPC Egress Bypass

빈 VpcConfig(SubnetIds=[], SecurityGroupIds=[])로 구성 업데이트하여 제한된 VPC에서 Lambda 함수를 강제로 빼내세요. 그러면 함수는 Lambda가 관리하는 네트워킹 영역에서 실행되어 외부 인터넷 접근을 다시 얻고, NAT 없이 사설 VPC 서브넷에서 적용되는 아웃바운드 제어를 우회할 수 있습니다.

{{#ref}}
aws-lambda-vpc-egress-bypass.md
{{#endref}}

### AWS Lambda – Runtime Pinning/Rollback Abuse

`lambda:PutRuntimeManagementConfig`를 악용하여 함수를 특정 런타임 버전(Manual)에 고정하거나 업데이트를 동결(FunctionUpdate)하세요. 이렇게 하면 악의적인 layers/wrappers와의 호환성을 유지하고, 취약한 오래된 런타임에 함수를 머무르게 하여 악용 및 장기 지속성에 도움이 될 수 있습니다.

{{#ref}}
aws-lambda-runtime-pinning-abuse.md
{{#endref}}

### AWS Lambda – Log Siphon via LoggingConfig.LogGroup Redirection

`lambda:UpdateFunctionConfiguration`의 고급 로깅 제어를 악용해 함수의 로그를 공격자가 선택한 CloudWatch Logs 로그 그룹으로 리다이렉션하세요. 이는 코드나 실행 역할을 변경하지 않고도 동작합니다(대부분의 Lambda 역할은 이미 `AWSLambdaBasicExecutionRole`을 통해 `logs:CreateLogGroup/CreateLogStream/PutLogEvents`를 포함). 함수가 비밀/요청 본문을 출력하거나 스택 트레이스와 함께 크래시하면 새 로그 그룹에서 이를 수집할 수 있습니다.

{{#ref}}
aws-lambda-loggingconfig-redirection.md
{{#endref}}

### AWS - Lambda Function URL Public Exposure

Function URL의 AuthType을 NONE으로 변경하고 모든 사용자에게 lambda:InvokeFunctionUrl 권한을 부여하는 리소스 기반 정책을 연결하면, 프라이빗 Lambda Function URL을 공개 비인증 엔드포인트로 변경할 수 있습니다. 이는 내부 함수의 익명 호출을 가능하게 하며 민감한 백엔드 작업을 노출시킬 수 있습니다.

{{#ref}}
aws-lambda-function-url-public-exposure.md
{{#endref}}

### AWS Lambda – Event Source Mapping Target Hijack

`UpdateEventSourceMapping`을 악용하여 기존 Event Source Mapping(ESM)의 대상 Lambda 함수를 변경하면 DynamoDB Streams, Kinesis, 또는 SQS의 레코드가 공격자가 제어하는 함수로 전달됩니다. 이는 생산자나 원래 함수 코드를 건드리지 않고 실시간 데이터를 은밀히 전환합니다.

{{#ref}}
aws-lambda-event-source-mapping-hijack.md
{{#endref}}

### AWS Lambda – EFS Mount Injection data exfiltration

`lambda:UpdateFunctionConfiguration`를 악용해 기존 EFS Access Point를 Lambda에 연결한 다음, 마운트된 경로에서 파일을 나열/읽는 간단한 코드를 배포하여 함수가 이전에 접근할 수 없었던 공유 비밀/구성 정보를 exfiltrate하세요.

{{#ref}}
aws-lambda-efs-mount-injection.md
{{#endref}}



{{#include ../../../../banners/hacktricks-training.md}}
