# AWS - Lambda Post Exploitation

{{#include ../../../../banners/hacktricks-training.md}}

## Lambda

Po więcej informacji sprawdź:

{{#ref}}
../../aws-services/aws-lambda-enum.md
{{#endref}}

### Exfilrtate Lambda Credentials

Lambda używa zmiennych środowiskowych do wstrzykiwania credentials w runtime. Jeśli uzyskasz do nich dostęp (np. czytając `/proc/self/environ` lub używając samej podatnej funkcji), możesz ich użyć samodzielnie. Znajdują się one w domyślnych nazwach zmiennych `AWS_SESSION_TOKEN`, `AWS_SECRET_ACCESS_KEY`, i `AWS_ACCESS_KEY_ID`.

Domyślnie mają one uprawnienia do zapisu w grupie logów cloudwatch (jej nazwa jest przechowywana w `AWS_LAMBDA_LOG_GROUP_NAME`), oraz do tworzenia dowolnych grup logów, jednak funkcje Lambda często mają dodatkowe uprawnienia przypisane w zależności od ich przeznaczenia.

### Steal Others Lambda URL Requests

Jeśli atakujący w jakiś sposób uzyska RCE wewnątrz funkcji Lambda, będzie mógł przechwycić żądania HTTP innych użytkowników kierowane do tej funkcji. Jeśli żądania zawierają wrażliwe informacje (cookies, credentials...) będzie je mógł wykradać.

{{#ref}}
aws-warm-lambda-persistence.md
{{#endref}}

### Steal Others Lambda URL Requests & Extensions Requests

Nadużywając Lambda Layers można także wykorzystać extensions do utrzymania obecności w funkcji Lambda, a także do kradzieży i modyfikacji żądań.

{{#ref}}
../../aws-persistence/aws-lambda-persistence/aws-abusing-lambda-extensions.md
{{#endref}}

### AWS Lambda – VPC Egress Bypass

Zmusź funkcję Lambda do opuszczenia ograniczonego VPC poprzez zaktualizowanie jej konfiguracji z pustym VpcConfig (SubnetIds=[], SecurityGroupIds=[]). Funkcja zostanie wtedy uruchomiona w zarządzanym przez Lambda obszarze sieciowym, odzyskując dostęp wychodzący do internetu i omijając kontrole egress wymuszane przez prywatne subnety VPC bez NAT.

{{#ref}}
aws-lambda-vpc-egress-bypass.md
{{#endref}}

### AWS Lambda – Runtime Pinning/Rollback Abuse

Nadużyj `lambda:PutRuntimeManagementConfig`, aby przypiąć funkcję do konkretnej wersji runtime (Manual) lub zamrozić aktualizacje (FunctionUpdate). Pozwala to zachować kompatybilność ze złośliwymi layers/wrappers i może utrzymać funkcję na przestarzałym, podatnym runtime, co ułatwia eksploatację i długotrwałe utrzymanie dostępu.

{{#ref}}
aws-lambda-runtime-pinning-abuse.md
{{#endref}}

### AWS Lambda – Log Siphon via LoggingConfig.LogGroup Redirection

Nadużyj zaawansowanych ustawień logowania `lambda:UpdateFunctionConfiguration`, aby przekierować logi funkcji do grupy CloudWatch Logs wybranej przez atakującego. Działa to bez zmiany kodu czy roli wykonawczej (większość ról Lambda już zawiera `logs:CreateLogGroup/CreateLogStream/PutLogEvents` poprzez `AWSLambdaBasicExecutionRole`). Jeśli funkcja wypisuje sekrety/treści żądań lub awaryjnie kończy się ze stack traces, możesz je pobrać z nowej grupy logów.

{{#ref}}
aws-lambda-loggingconfig-redirection.md
{{#endref}}

### AWS - Lambda Function URL Public Exposure

Zamień prywatny Lambda Function URL w publiczny, nieautoryzowany endpoint, ustawiając Function URL AuthType na NONE i dołączając politykę opartą na zasobach, która przyznaje lambda:InvokeFunctionUrl wszystkim. To umożliwia anonimowe wywołanie wewnętrznych funkcji i może ujawnić wrażliwe operacje backendowe.

{{#ref}}
aws-lambda-function-url-public-exposure.md
{{#endref}}

### AWS Lambda – Event Source Mapping Target Hijack

Nadużyj `UpdateEventSourceMapping`, aby zmienić docelową funkcję Lambda istniejącego Event Source Mapping (ESM), tak aby rekordy z DynamoDB Streams, Kinesis lub SQS były dostarczane do funkcji kontrolowanej przez atakującego. To cicho przekierowuje dane w czasie rzeczywistym bez ingerencji w producentów lub oryginalny kod funkcji.

{{#ref}}
aws-lambda-event-source-mapping-hijack.md
{{#endref}}

### AWS Lambda – EFS Mount Injection data exfiltration

Nadużyj `lambda:UpdateFunctionConfiguration`, aby dołączyć istniejący EFS Access Point do funkcji Lambda, a następnie wdrożyć prosty kod, który listuje/odczytuje pliki z podmontowanej ścieżki w celu wyeksfiltrowania współdzielonych sekretów/konfiguracji, do których funkcja wcześniej nie miała dostępu.

{{#ref}}
aws-lambda-efs-mount-injection.md
{{#endref}}



{{#include ../../../../banners/hacktricks-training.md}}
