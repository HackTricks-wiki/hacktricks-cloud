# AWS - Lambda Post Exploitation

{{#include ../../../../banners/hacktricks-training.md}}

## Lambda

Za više informacija pogledajte:

{{#ref}}
../../aws-services/aws-lambda-enum.md
{{#endref}}

### Eksfiltracija Lambda kredencijala

Lambda koristi varijable okruženja da ubaci kredencijale prilikom izvršavanja. Ako možete doći do njih (čitajući `/proc/self/environ` ili koristeći samu ranjivu funkciju), možete ih iskoristiti. Nalaze se u podrazumevanim imenima promenljivih `AWS_SESSION_TOKEN`, `AWS_SECRET_ACCESS_KEY`, and `AWS_ACCESS_KEY_ID`.

Po podrazumevanoj postavci, ovi imaju pristup za upis u cloudwatch log group (čije ime je sačuvano u `AWS_LAMBDA_LOG_GROUP_NAME`), kao i za kreiranje proizvoljnih log grupa, međutim lambda functions često imaju više dodeljenih permisija zasnovanih na njihovoj nameni.

### `lambda:Delete*`
Napadač kome je dodeljen `lambda:Delete*` može obrisati Lambda functions, versions/aliases, layers, event source mappings i druge povezane konfiguracije.
```bash
aws lambda delete-function \
--function-name <LAMBDA_NAME>
```
### Steal Others Lambda URL Requests

Ako napadač nekako uspe da dobije RCE unutar Lambda funkcije, moći će da ukrade HTTP zahteve drugih korisnika upućene toj funkciji. Ako zahtevi sadrže osetljive informacije (cookies, credentials...) moći će da ih ukrade.

{{#ref}}
aws-warm-lambda-persistence.md
{{#endref}}

### Steal Others Lambda URL Requests & Extensions Requests

Zloupotrebom Lambda Layers moguće je zloupotrebiti extensions i ostvariti trajnu prisutnost u Lambda funkciji, kao i ukrasti i izmeniti zahteve.

{{#ref}}
../../aws-persistence/aws-lambda-persistence/aws-abusing-lambda-extensions.md
{{#endref}}

### AWS Lambda – VPC Egress Bypass

Prisilite Lambda funkciju da izađe iz ograničenog VPC-a tako što ćete ažurirati njenu konfiguraciju sa praznim VpcConfig (SubnetIds=[], SecurityGroupIds=[]). Funkcija će potom raditi u Lambda-upravljanoj mrežnoj ravni, ponovo dobijajući izlazni pristup internetu i zaobilazeći egress kontrole koje sprovode privatni VPC subnetsi bez NAT.

{{#ref}}
aws-lambda-vpc-egress-bypass.md
{{#endref}}

### AWS Lambda – Runtime Pinning/Rollback Abuse

Zloupotrebite `lambda:PutRuntimeManagementConfig` da zakačite funkciju na konkretnu verziju runtime-a (Manual) ili da zamrznete ažuriranja (FunctionUpdate). Ovo održava kompatibilnost sa malicioznim layers/wrappers i može zadržati funkciju na zastarelom, ranjivom runtime-u, što olakšava eksploataciju i dugoročnu prisutnost.

{{#ref}}
aws-lambda-runtime-pinning-abuse.md
{{#endref}}

### AWS Lambda – Log Siphon via LoggingConfig.LogGroup Redirection

Zloupotrebite napredne kontrole logovanja `lambda:UpdateFunctionConfiguration` da preusmerite logove funkcije u CloudWatch Logs log group po izboru napadača. Ovo radi bez menjanja koda ili execution role (većina Lambda rola već uključuje `logs:CreateLogGroup/CreateLogStream/PutLogEvents` putem `AWSLambdaBasicExecutionRole`). Ako funkcija ispisuje tajne/tela zahteva ili se ruši sa stack trace-ovima, možete ih prikupiti iz nove log grupe.

{{#ref}}
aws-lambda-loggingconfig-redirection.md
{{#endref}}

### AWS - Lambda Function URL Public Exposure

Pretvorite privatni Lambda Function URL u javni neautentifikovani endpoint tako što ćete promeniti Function URL AuthType u NONE i priložiti resource-based policy koji dodeljuje lambda:InvokeFunctionUrl svima. Ovo omogućava anonimno pozivanje unutrašnjih funkcija i može izložiti osetljive backend operacije.

{{#ref}}
aws-lambda-function-url-public-exposure.md
{{#endref}}

### AWS Lambda – Event Source Mapping Target Hijack

Zloupotrebite `UpdateEventSourceMapping` da promenite ciljnu Lambda funkciju postojeće Event Source Mapping (ESM) tako da zapisi iz DynamoDB Streams, Kinesis ili SQS budu isporučeni funkciji pod kontrolom napadača. Ovo tiho preusmerava žive podatke bez diranja proizvođača ili originalnog koda funkcije.

{{#ref}}
aws-lambda-event-source-mapping-hijack.md
{{#endref}}

### AWS Lambda – EFS Mount Injection data exfiltration

Zloupotrebite `lambda:UpdateFunctionConfiguration` da prikačite postojeći EFS Access Point na Lambda funkciju, zatim deploy-ujte trivialan kod koji listа/čita fajlove sa mount-ovane putanje kako biste eksfiltrirali deljene tajne/konfiguracije kojima funkcija ranije nije mogla pristupiti.

{{#ref}}
aws-lambda-efs-mount-injection.md
{{#endref}}



{{#include ../../../../banners/hacktricks-training.md}}
