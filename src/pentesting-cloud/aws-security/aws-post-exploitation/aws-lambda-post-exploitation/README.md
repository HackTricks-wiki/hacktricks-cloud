# AWS - Lambda Post Exploitation

{{#include ../../../../banners/hacktricks-training.md}}

## Lambda

Kwa taarifa zaidi angalia:

{{#ref}}
../../aws-services/aws-lambda-enum.md
{{#endref}}

### Exfilrtate Lambda Credentials

Lambda hutumia vigezo vya mazingira (environment variables) kuingiza credentials wakati wa runtime. Ikiwa unaweza kupata ufikiaji kwao (kwa kusoma `/proc/self/environ` au kwa kutumia function yenye udhaifu yenyewe), unaweza kuzitumia mwenyewe. Zipo katika majina ya kigezo cha default `AWS_SESSION_TOKEN`, `AWS_SECRET_ACCESS_KEY`, na `AWS_ACCESS_KEY_ID`.

Kwa chaguo-msingi, hizi zitakuwa na uwezo wa kuandika kwenye cloudwatch log group (jina lake limehifadhiwa katika `AWS_LAMBDA_LOG_GROUP_NAME`), pamoja na kuunda log groups yoyote; hata hivyo, Lambda functions mara nyingi zina idhini za ziada zilizotengwa kulingana na matumizi yao yaliyokusudiwa.

### Steal Others Lambda URL Requests

Ikiwa attacker kwa namna fulani anafanikiwa kupata RCE ndani ya Lambda, atakuwa na uwezo wa kuiba HTTP requests za watumiaji wengine kwa Lambda. Iki requests zina taarifa nyeti (cookies, credentials...) atakuwa na uwezo wa kuziiba.

{{#ref}}
aws-warm-lambda-persistence.md
{{#endref}}

### Steal Others Lambda URL Requests & Extensions Requests

Kwa kutumia vibaya Lambda Layers pia inawezekana kutumia vibaya extensions na kudumu ndani ya Lambda, pamoja na kuiba na kubadilisha requests.

{{#ref}}
../../aws-persistence/aws-lambda-persistence/aws-abusing-lambda-extensions.md
{{#endref}}

### AWS Lambda – VPC Egress Bypass

Lazimisha Lambda function kutoka kwenye VPC iliyozuiwa kwa kusasisha configuration yake kwa VpcConfig tupu (SubnetIds=[], SecurityGroupIds=[]). Function hiyo itaendeshwa kwenye plane ya networking inayosimamiwa na Lambda, ikipata tena uwezo wa kufikia mtandao wa nje na kuepuka controls za egress zinazotekelezwa na private VPC subnets bila NAT.

{{#ref}}
aws-lambda-vpc-egress-bypass.md
{{#endref}}

### AWS Lambda – Runtime Pinning/Rollback Abuse

Tumia vibaya `lambda:PutRuntimeManagementConfig` ku-pin function kwa runtime version maalum (Manual) au ku-ifreeze updates (FunctionUpdate). Hii inahifadhi compatibility na malicious layers/wrappers na inaweza kuifanya function ibaki kwenye runtime ya zamani yenye udhaifu ili kusaidia exploitation na persistence ya muda mrefu.

{{#ref}}
aws-lambda-runtime-pinning-abuse.md
{{#endref}}

### AWS Lambda – Log Siphon via LoggingConfig.LogGroup Redirection

Tumia vibaya `lambda:UpdateFunctionConfiguration` controls za advanced logging ili kurekebisha logs za function kwenda kwenye CloudWatch Logs log group iliyochaguliwa na mshambuliaji. Hii inafanya kazi bila kubadilisha code au execution role (most Lambda roles tayari zina `logs:CreateLogGroup/CreateLogStream/PutLogEvents` kupitia `AWSLambdaBasicExecutionRole`). Iki function ikachapisha secrets/request bodies au kukatika kwa crash na stack traces, unaweza kuzikusanya kutoka kwenye log group mpya.

{{#ref}}
aws-lambda-loggingconfig-redirection.md
{{#endref}}

### AWS - Lambda Function URL Public Exposure

Badilisha private Lambda Function URL kuwa endpoint ya umma isiyothibitishwa kwa kubadilisha Function URL AuthType kuwa NONE na kuambatisha resource-based policy inayowapa kila mtu lambda:InvokeFunctionUrl. Hii inaruhusu anonymous invocation ya internal functions na inaweza kufichua operesheni za backend zenye nyeti.

{{#ref}}
aws-lambda-function-url-public-exposure.md
{{#endref}}

### AWS Lambda – Event Source Mapping Target Hijack

Tumia vibaya `UpdateEventSourceMapping` kubadilisha target Lambda function ya Event Source Mapping (ESM) iliyopo ili rekodi kutoka DynamoDB Streams, Kinesis, au SQS ziletwe kwa function inayodhibitiwa na mshambuliaji. Hii inaelekeza data ya moja kwa moja kimya bila kugusa producers au code ya function ya awali.

{{#ref}}
aws-lambda-event-source-mapping-hijack.md
{{#endref}}

### AWS Lambda – EFS Mount Injection data exfiltration

Tumia vibaya `lambda:UpdateFunctionConfiguration` kuambatisha EFS Access Point iliyopo kwa Lambda, kisha tuma code rahisi inayoorodhesha/ikusoma files kutoka kwenye path iliyopachikwa ili exfiltrate secrets/config zilizoshirikiwa ambazo function haikuweza kufikia hapo awali.

{{#ref}}
aws-lambda-efs-mount-injection.md
{{#endref}}



{{#include ../../../../banners/hacktricks-training.md}}
