# AWS - Lambda Post Exploitation

{{#include ../../../../banners/hacktricks-training.md}}

## Lambda

Za više informacija pogledajte:

{{#ref}}
../../aws-services/aws-lambda-enum.md
{{#endref}}

### Eksfiltracija Lambda credentials

Lambda koristi environment variables da ubaci credentials u runtime. Ako možete da im pristupite (čitanjem `/proc/self/environ` ili korišćenjem same ranjive funkcije), možete ih koristiti. Nalaze se u podrazumevanim imenima promenljivih `AWS_SESSION_TOKEN`, `AWS_SECRET_ACCESS_KEY`, i `AWS_ACCESS_KEY_ID`.

### `lambda:Delete*`
Napadač kojem je dodeljeno lambda:Delete* može obrisati Lambda functions, versions/aliases, layers, event source mappings i ostale povezane konfiguracije.
```bash
aws lambda delete-function \
--function-name <LAMBDA_NAME>
```
### Krađa tuđih Lambda URL zahteva

Ako napadač na neki način uspe da dobije RCE unutar Lambda funkcije, moći će da ukrade HTTP zahteve drugih korisnika upućene toj Lambda. Ako zahtevi sadrže osetljive informacije (cookies, credentials...) moći će i njih da ukrade.

{{#ref}}
aws-warm-lambda-persistence.md
{{#endref}}

### Krađa tuđih Lambda URL zahteva & Extensions zahteva

Zloupotrebom Lambda Layers moguće je i zloupotrebiti Extensions i ostati persistentan u Lambda, kao i ukrasti i izmeniti zahteve.

{{#ref}}
../../aws-persistence/aws-lambda-persistence/aws-abusing-lambda-extensions.md
{{#endref}}

### AWS Lambda – VPC Egress Bypass

Primorajte Lambda funkciju da izađe iz ograničenog VPC ažuriranjem njene konfiguracije na praznu VpcConfig (SubnetIds=[], SecurityGroupIds=[]). Funkcija će tada raditi u Lambda-managed networking plane, ponovo dobijajući outbound internet pristup i zaobilaženje egress kontrola koje nameću privatni VPC subneti bez NAT.

{{#ref}}
aws-lambda-vpc-egress-bypass.md
{{#endref}}

### AWS Lambda – Runtime Pinning/Rollback Abuse

Zloupotrebite `lambda:PutRuntimeManagementConfig` da zakačite funkciju na specifičnu verziju runtime-a (Manual) ili zamrznete ažuriranja (FunctionUpdate). Ovo održava kompatibilnost sa malicioznim layers/wrappers i može zadržati funkciju na zastarelom, ranjivom runtime-u što olakšava eksploataciju i dugoročnu persistentnost.

{{#ref}}
aws-lambda-runtime-pinning-abuse.md
{{#endref}}

### AWS Lambda – Log Siphon via LoggingConfig.LogGroup Redirection

Zloupotrebite `lambda:UpdateFunctionConfiguration` napredne logging kontrole da preusmerite logove funkcije u CloudWatch Logs log group po izboru napadača. Ovo radi bez menjanja koda ili execution role (većina Lambda role već uključuje `logs:CreateLogGroup/CreateLogStream/PutLogEvents` preko `AWSLambdaBasicExecutionRole`). Ako funkcija ispisuje tajne/tela zahteva ili pada sa stack traces, možete ih prikupiti iz nove log grupe.

{{#ref}}
aws-lambda-loggingconfig-redirection.md
{{#endref}}

### AWS - Lambda Function URL Public Exposure

Pretvorite privatni Lambda Function URL u javni unauthenticated endpoint promenom Function URL AuthType na NONE i dodavanjem resource-based policy koja dodeljuje lambda:InvokeFunctionUrl svima. Ovo omogućava anonimno pozivanje internih funkcija i može izložiti osetljive backend operacije.

{{#ref}}
aws-lambda-function-url-public-exposure.md
{{#endref}}

### AWS Lambda – Event Source Mapping Target Hijack

Zloupotrebite `UpdateEventSourceMapping` da promenite ciljnu Lambda funkciju postojeće Event Source Mapping (ESM) tako da zapisi iz DynamoDB Streams, Kinesis, ili SQS budu isporučeni funkciji pod kontrolom napadača. Ovo tiho preusmerava žive podatke bez diranja producenata ili originalnog koda funkcije.

{{#ref}}
aws-lambda-event-source-mapping-hijack.md
{{#endref}}

### AWS Lambda – EFS Mount Injection data exfiltration

Zloupotrebite `lambda:UpdateFunctionConfiguration` da priključite postojeći EFS Access Point na Lambda, zatim postavite trivialan kod koji listа/čita fajlove sa mountovane putanje da biste eksfiltrirali deljene tajne/konfiguracije kojima funkcija ranije nije mogla pristupiti.

{{#ref}}
aws-lambda-efs-mount-injection.md
{{#endref}}



{{#include ../../../../banners/hacktricks-training.md}}
