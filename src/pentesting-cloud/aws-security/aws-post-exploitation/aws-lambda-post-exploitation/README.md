# AWS - Lambda Post Exploitation

{{#include ../../../../banners/hacktricks-training.md}}

## Lambda

Για περισσότερες πληροφορίες δείτε:

{{#ref}}
../../aws-services/aws-lambda-enum.md
{{#endref}}

### Exfilrtate Lambda Credentials

Το Lambda χρησιμοποιεί μεταβλητές περιβάλλοντος για να εισάγει credentials κατά το runtime. Αν έχετε πρόσβαση σ' αυτές (διαβάζοντας `/proc/self/environ` ή χρησιμοποιώντας τη vulnerable function), μπορείτε να τις χρησιμοποιήσετε εσείς. Βρίσκονται στα προεπιλεγμένα ονόματα μεταβλητών `AWS_SESSION_TOKEN`, `AWS_SECRET_ACCESS_KEY`, και `AWS_ACCESS_KEY_ID`.

Κατά προεπιλογή, αυτές θα έχουν πρόσβαση να γράφουν σε ένα cloudwatch log group (το όνομα του οποίου αποθηκεύεται στο `AWS_LAMBDA_LOG_GROUP_NAME`), καθώς και να δημιουργούν αυθαίρετα log groups, ωστόσο οι lambda functions συχνά έχουν περισσότερα permissions εκχωρημένα βάσει της προοριζόμενης χρήσης τους.

### Steal Others Lambda URL Requests

Αν ένας attacker κατά κάποιο τρόπο καταφέρει να αποκτήσει RCE μέσα σε ένα Lambda, θα μπορεί να κλέψει τα HTTP requests άλλων χρηστών προς το lambda. Αν τα requests περιέχουν ευαίσθητες πληροφορίες (cookies, credentials...) θα μπορεί να τα αποσπάσει.

{{#ref}}
aws-warm-lambda-persistence.md
{{#endref}}

### Steal Others Lambda URL Requests & Extensions Requests

Καταχρώμενοι τα Lambda Layers είναι επίσης δυνατό να καταχραστείτε extensions και να παραμείνετε στο Lambda, καθώς και να κλέψετε και να τροποποιήσετε requests.

{{#ref}}
../../aws-persistence/aws-lambda-persistence/aws-abusing-lambda-extensions.md
{{#endref}}

### AWS Lambda – VPC Egress Bypass

Force a Lambda function out of a restricted VPC by updating its configuration with an empty VpcConfig (SubnetIds=[], SecurityGroupIds=[]). The function will then run in the Lambda-managed networking plane, regaining outbound internet access and bypassing egress controls enforced by private VPC subnets without NAT.

{{#ref}}
aws-lambda-vpc-egress-bypass.md
{{#endref}}

### AWS Lambda – Runtime Pinning/Rollback Abuse

Abuse `lambda:PutRuntimeManagementConfig` to pin a function to a specific runtime version (Manual) or freeze updates (FunctionUpdate). This preserves compatibility with malicious layers/wrappers and can keep the function on an outdated, vulnerable runtime to aid exploitation and long-term persistence.

{{#ref}}
aws-lambda-runtime-pinning-abuse.md
{{#endref}}

### AWS Lambda – Log Siphon via LoggingConfig.LogGroup Redirection

Καταχραστείτε τα advanced logging controls του `lambda:UpdateFunctionConfiguration` για να ανακατευθύνετε τα logs μιας function σε ένα CloudWatch Logs log group που έχει επιλεγεί από τον attacker. Αυτό λειτουργεί χωρίς αλλαγή του code ή του execution role (οι περισσότερες Lambda roles ήδη περιλαμβάνουν `logs:CreateLogGroup/CreateLogStream/PutLogEvents` μέσω `AWSLambdaBasicExecutionRole`). Αν η function τυπώνει secrets/request bodies ή καταρρέει με stack traces, μπορείτε να τα συλλέξετε από το νέο log group.

{{#ref}}
aws-lambda-loggingconfig-redirection.md
{{#endref}}

### AWS - Lambda Function URL Public Exposure

Μετατρέψτε ένα private Lambda Function URL σε public unauthenticated endpoint αλλάζοντας το Function URL AuthType σε NONE και προσθέτοντας μια resource-based policy που δίνει lambda:InvokeFunctionUrl σε όλους. Αυτό επιτρέπει anonymous invocation εσωτερικών functions και μπορεί να εκθέσει ευαίσθητες backend operations.

{{#ref}}
aws-lambda-function-url-public-exposure.md
{{#endref}}

### AWS Lambda – Event Source Mapping Target Hijack

Καταχραστείτε το `UpdateEventSourceMapping` για να αλλάξετε τη στοχευόμενη Lambda function ενός υπάρχοντος Event Source Mapping (ESM), έτσι ώστε records από DynamoDB Streams, Kinesis, ή SQS να παραδίδονται σε μια attacker-controlled function. Αυτό αποκλίνει αθόρυβα live data χωρίς να πειράζει τους producers ή τον αρχικό function code.

{{#ref}}
aws-lambda-event-source-mapping-hijack.md
{{#endref}}

### AWS Lambda – EFS Mount Injection data exfiltration

Καταχραστείτε το `lambda:UpdateFunctionConfiguration` για να επισυνάψετε ένα υπάρχον EFS Access Point σε ένα Lambda, και στη συνέχεια αναπτύξτε trivial code που θα λιστάρει/διαβάζει αρχεία από το mounted path για να exfiltrate κοινόχρηστα secrets/config που η function προηγουμένως δεν μπορούσε να προσπελάσει.

{{#ref}}
aws-lambda-efs-mount-injection.md
{{#endref}}



{{#include ../../../../banners/hacktricks-training.md}}
