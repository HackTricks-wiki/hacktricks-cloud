# AWS - S3 Post Exploitation

{{#include ../../../banners/hacktricks-training.md}}

## S3

Για περισσότερες πληροφορίες ελέγξτε:

{{#ref}}
../aws-services/aws-s3-athena-and-glacier-enum.md
{{#endref}}

### Ευαίσθητες Πληροφορίες

Μερικές φορές θα μπορείτε να βρείτε ευαίσθητες πληροφορίες αναγνώσιμες στους κάδους. Για παράδειγμα, μυστικά κατάστασης terraform.

### Pivoting

Διαφορετικές πλατφόρμες θα μπορούσαν να χρησιμοποιούν το S3 για να αποθηκεύουν ευαίσθητα περιουσιακά στοιχεία.\
Για παράδειγμα, το **airflow** θα μπορούσε να αποθηκεύει τον **κώδικα DAGs** εκεί, ή οι **ιστοσελίδες** θα μπορούσαν να εξυπηρετούνται απευθείας από το S3. Ένας επιτιθέμενος με δικαιώματα εγγραφής θα μπορούσε να **τροποποιήσει τον κώδικα** από τον κάδο για να **pivot** σε άλλες πλατφόρμες, ή να **καταλάβει λογαριασμούς** τροποποιώντας αρχεία JS.

### S3 Ransomware

Σε αυτό το σενάριο, ο **επιτιθέμενος δημιουργεί ένα κλειδί KMS (Key Management Service) στον δικό του λογαριασμό AWS** ή σε άλλο παραβιασμένο λογαριασμό. Στη συνέχεια, καθιστά αυτό το **κλειδί προσβάσιμο σε οποιονδήποτε στον κόσμο**, επιτρέποντας σε οποιονδήποτε χρήστη, ρόλο ή λογαριασμό AWS να κρυπτογραφήσει αντικείμενα χρησιμοποιώντας αυτό το κλειδί. Ωστόσο, τα αντικείμενα δεν μπορούν να αποκρυπτογραφηθούν.

Ο επιτιθέμενος εντοπίζει έναν στόχο **S3 κάδο και αποκτά πρόσβαση επιπέδου εγγραφής** σε αυτόν χρησιμοποιώντας διάφορες μεθόδους. Αυτό θα μπορούσε να οφείλεται σε κακή διαμόρφωση του κάδου που τον εκθέτει δημόσια ή ο επιτιθέμενος αποκτά πρόσβαση στο περιβάλλον AWS. Ο επιτιθέμενος συνήθως στοχεύει κάδους που περιέχουν ευαίσθητες πληροφορίες όπως προσωπικά αναγνωρίσιμες πληροφορίες (PII), προστατευμένες πληροφορίες υγείας (PHI), αρχεία καταγραφής, αντίγραφα ασφαλείας και άλλα.

Για να προσδιορίσει αν ο κάδος μπορεί να στοχευθεί για ransomware, ο επιτιθέμενος ελέγχει τη διαμόρφωσή του. Αυτό περιλαμβάνει την επαλήθευση αν είναι ενεργοποιημένο το **S3 Object Versioning** και αν είναι ενεργοποιημένη η **διαγραφή πολλαπλών παραγόντων (MFA delete)**. Εάν το Object Versioning δεν είναι ενεργοποιημένο, ο επιτιθέμενος μπορεί να προχωρήσει. Εάν το Object Versioning είναι ενεργοποιημένο αλλά η MFA delete είναι απενεργοποιημένη, ο επιτιθέμενος μπορεί να **απενεργοποιήσει το Object Versioning**. Εάν και τα δύο, Object Versioning και MFA delete είναι ενεργοποιημένα, γίνεται πιο δύσκολο για τον επιτιθέμενο να ransomware αυτόν τον συγκεκριμένο κάδο.

Χρησιμοποιώντας το AWS API, ο επιτιθέμενος **αντικαθιστά κάθε αντικείμενο στον κάδο με μια κρυπτογραφημένη αντίγραφο χρησιμοποιώντας το KMS κλειδί του**. Αυτό κρυπτογραφεί αποτελεσματικά τα δεδομένα στον κάδο, καθιστώντας τα μη προσβάσιμα χωρίς το κλειδί.

Για να προσθέσει περαιτέρω πίεση, ο επιτιθέμενος προγραμματίζει τη διαγραφή του KMS κλειδιού που χρησιμοποιήθηκε στην επίθεση. Αυτό δίνει στον στόχο ένα παράθυρο 7 ημερών για να ανακτήσει τα δεδομένα του πριν το κλειδί διαγραφεί και τα δεδομένα γίνουν μόνιμα χαμένα.

Τέλος, ο επιτιθέμενος θα μπορούσε να ανεβάσει ένα τελικό αρχείο, συνήθως ονομαζόμενο "ransom-note.txt," το οποίο περιέχει οδηγίες για τον στόχο σχετικά με το πώς να ανακτήσει τα αρχεία του. Αυτό το αρχείο ανεβαίνει χωρίς κρυπτογράφηση, πιθανώς για να τραβήξει την προσοχή του στόχου και να τον ενημερώσει για την επίθεση ransomware.

**Για περισσότερες πληροφορίες** [**ελέγξτε την αρχική έρευνα**](https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/)**.**

{{#include ../../../banners/hacktricks-training.md}}
