# AWS - Cognito Διατήρηση

{{#include ../../../../banners/hacktricks-training.md}}

## Cognito

Για περισσότερες πληροφορίες, δείτε:

{{#ref}}
../../aws-services/aws-cognito-enum/
{{#endref}}

### Διατήρηση χρηστών

Cognito είναι μια υπηρεσία που επιτρέπει να ανατίθενται roles σε unauthenticated και authenticated users και να ελέγχεται ένας κατάλογος χρηστών. Πολλές διαφορετικές ρυθμίσεις μπορούν να τροποποιηθούν για να διατηρηθεί κάποια persistence, όπως:

- **Adding a User Pool** ελεγχόμενο από τον χρήστη σε ένα Identity Pool
- Δώστε ένα **IAM role** σε ένα unauthenticated Identity Pool και επιτρέψτε Basic auth flow
- Ή σε ένα **authenticated Identity Pool** αν ο attacker μπορεί να κάνει login
- Ή **βελτιώστε τα permissions** των δοθέντων roles
- **Create, verify & privesc** μέσω attributes σε ελεγχόμενους χρήστες ή νέους χρήστες σε ένα **User Pool**
- **Allowing external Identity Providers** να κάνουν login σε ένα User Pool ή σε ένα Identity Pool

Δείτε πώς να πραγματοποιήσετε αυτές τις ενέργειες στο

{{#ref}}
../../aws-privilege-escalation/aws-cognito-privesc/README.md
{{#endref}}

### `cognito-idp:SetRiskConfiguration`

Ένας attacker με αυτό το privilege θα μπορούσε να τροποποιήσει τη risk configuration ώστε να μπορεί να κάνει login ως χρήστης Cognito **χωρίς να ενεργοποιούνται alarms**. [**Check out the cli**](https://docs.aws.amazon.com/cli/latest/reference/cognito-idp/set-risk-configuration.html) για να δείτε όλες τις επιλογές:
```bash
aws cognito-idp set-risk-configuration --user-pool-id <pool-id> --compromised-credentials-risk-configuration EventFilter=SIGN_UP,Actions={EventAction=NO_ACTION}
```
Από προεπιλογή αυτό είναι απενεργοποιημένο:

<figure><img src="https://lh6.googleusercontent.com/EOiM0EVuEgZDfW3rOJHLQjd09-KmvraCMssjZYpY9sVha6NcxwUjStrLbZxAT3D3j9y08kd5oobvW8a2fLUVROyhkHaB1OPhd7X6gJW3AEQtlZM62q41uYJjTY1EJ0iQg6Orr1O7yZ798EpIJ87og4Tbzw=s2048" alt=""><figcaption></figcaption></figure>

{{#include ../../../../banners/hacktricks-training.md}}
