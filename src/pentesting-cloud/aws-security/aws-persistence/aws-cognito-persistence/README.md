# AWS - Cognito Persistence

{{#include ../../../../banners/hacktricks-training.md}}

## Cognito

Pour plus d'informations, consultez :

{{#ref}}
../../aws-services/aws-cognito-enum/
{{#endref}}

### User persistence

Cognito est un service qui permet d'attribuer des rôles aux utilisateurs non authentifiés et authentifiés et de contrôler un annuaire d'utilisateurs. Plusieurs configurations différentes peuvent être modifiées pour maintenir une certaine persistance, comme :

- **Adding a User Pool** contrôlé par l'utilisateur à un Identity Pool
- Give an **IAM role to an unauthenticated Identity Pool and allow Basic auth flow**
- Ou à un **authenticated Identity Pool** si l'attaquant peut se connecter
- Ou **améliorer les permissions** des rôles donnés
- **Create, verify & privesc** via des utilisateurs contrôlés par des attributs ou de nouveaux utilisateurs dans un **User Pool**
- **Allowing external Identity Providers** à se connecter dans un User Pool ou dans un Identity Pool

Check how to do these actions in

{{#ref}}
../../aws-privilege-escalation/aws-cognito-privesc/README.md
{{#endref}}

### `cognito-idp:SetRiskConfiguration`

Un attaquant disposant de ce privilège pourrait modifier la configuration des risques pour pouvoir se connecter en tant qu'utilisateur Cognito **sans déclencher d'alertes**. [**Check out the cli**](https://docs.aws.amazon.com/cli/latest/reference/cognito-idp/set-risk-configuration.html) to check all the options:
```bash
aws cognito-idp set-risk-configuration --user-pool-id <pool-id> --compromised-credentials-risk-configuration EventFilter=SIGN_UP,Actions={EventAction=NO_ACTION}
```
Par défaut, ceci est désactivé :

<figure><img src="https://lh6.googleusercontent.com/EOiM0EVuEgZDfW3rOJHLQjd09-KmvraCMssjZYpY9sVha6NcxwUjStrLbZxAT3D3j9y08kd5oobvW8a2fLUVROyhkHaB1OPhd7X6gJW3AEQtlZM62q41uYJjTY1EJ0iQg6Orr1O7yZ798EpIJ87og4Tbzw=s2048" alt=""><figcaption></figcaption></figure>

{{#include ../../../../banners/hacktricks-training.md}}
