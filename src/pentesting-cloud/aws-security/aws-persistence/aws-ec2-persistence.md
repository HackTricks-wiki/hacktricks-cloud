# AWS - EC2 Persistence

{{#include ../../../banners/hacktricks-training.md}}

## EC2

Kwa maelezo zaidi angalia:

{{#ref}}
../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/
{{#endref}}

### Usalama wa Kundi la Kunganisha Ufuatiliaji wa Ustahimilivu

Ikiwa mlinzi atagundua kuwa **EC2 instance ilikumbwa na shambulio** atajaribu **kuweka mbali** **mtandao** wa mashine hiyo. Anaweza kufanya hivyo kwa kutumia **Deny NACL** wazi (lakini NACL zinaathiri subnet nzima), au **kubadilisha kundi la usalama** kutoruhusu **aina yoyote ya trafiki ya kuingia au kutoka**.

Ikiwa mshambuliaji alikuwa na **reverse shell iliyoanzishwa kutoka kwa mashine**, hata kama SG imebadilishwa kutoruhusu trafiki ya kuingia au kutoka, **kuunganisha hakutakatishwa kutokana na** [**Ufuatiliaji wa Kunganisha Kundi la Usalama**](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/security-group-connection-tracking.html)**.**

### Meneja wa Mzunguko wa EC2

Huduma hii inaruhusu **kuandaa** **kuundwa kwa AMIs na snapshots** na hata **kuzishiriki na akaunti nyingine**.\
Mshambuliaji anaweza kuunda **uzalishaji wa AMIs au snapshots** za picha zote au volumu zote **kila wiki** na **kuzishiriki na akaunti yake**.

### Mifano ya Ratiba

Inawezekana kupanga mifano kufanya kazi kila siku, kila wiki au hata kila mwezi. Mshambuliaji anaweza kuendesha mashine yenye mamlaka ya juu au ufikiaji wa kuvutia ambapo anaweza kufikia.

### Ombi la Spot Fleet

Mifano ya spot ni **nafuu** kuliko mifano ya kawaida. Mshambuliaji anaweza kuzindua **ombile la spot fleet dogo kwa miaka 5** (kwa mfano), kwa **ugawaji wa IP** wa kiotomatiki na **data ya mtumiaji** inayotuma kwa mshambuliaji **wakati mfano wa spot unapoanza** na **anwani ya IP** na kwa **jukumu la IAM lenye mamlaka ya juu**.

### Mifano ya Backdoor

Mshambuliaji anaweza kupata ufikiaji wa mifano na kuziingiza backdoor:

- Kutumia **rootkit** wa jadi kwa mfano
- Kuongeza **funguo mpya za SSH za umma** (angalia [chaguzi za EC2 privesc](../aws-privilege-escalation/aws-ec2-privesc.md))
- Kuingiza backdoor kwenye **Data ya Mtumiaji**

### **Mipangilio ya Uzinduzi wa Backdoor**

- Kuingiza backdoor AMI iliyotumika
- Kuingiza backdoor Data ya Mtumiaji
- Kuingiza backdoor Key Pair

### VPN

Unda VPN ili mshambuliaji aweze kuungana moja kwa moja kupitia hiyo hadi VPC.

### VPC Peering

Unda muunganisho wa peering kati ya VPC ya mwathirika na VPC ya mshambuliaji ili aweze kufikia VPC ya mwathirika.

{{#include ../../../banners/hacktricks-training.md}}
