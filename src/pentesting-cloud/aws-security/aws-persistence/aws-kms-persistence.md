# AWS - KMS Persistence

{{#include ../../../banners/hacktricks-training.md}}

## KMS

Aby uzyskać więcej informacji, sprawdź:

{{#ref}}
../aws-services/aws-kms-enum.md
{{#endref}}

### Przyznawanie dostępu za pomocą polityk KMS

Atakujący może użyć uprawnienia **`kms:PutKeyPolicy`** do **przyznania dostępu** do klucza użytkownikowi pod jego kontrolą lub nawet do zewnętrznego konta. Sprawdź [**stronę KMS Privesc**](../aws-privilege-escalation/aws-kms-privesc.md) po więcej informacji.

### Wieczne Przyznanie

Przyznania to inny sposób na nadanie podmiotowi pewnych uprawnień do konkretnego klucza. Możliwe jest przyznanie, które pozwala użytkownikowi tworzyć przyznania. Co więcej, użytkownik może mieć kilka przyznań (nawet identycznych) do tego samego klucza.

Dlatego użytkownik może mieć 10 przyznań ze wszystkimi uprawnieniami. Atakujący powinien to stale monitorować. A jeśli w pewnym momencie 1 przyznanie zostanie usunięte, powin
```bash
# To generate grants, generate 10 like this one
aws kms create-grant \
--key-id <key-id> \
--grantee-principal <user_arn> \
--operations "CreateGrant" "Decrypt"

# To monitor grants
aws kms list-grants --key-id <key-id>
```
> [!NOTE]
> Grant może przyznać uprawnienia tylko z tego: [https://docs.aws.amazon.com/kms/latest/developerguide/grants.html#terms-grant-operations](https://docs.aws.amazon.com/kms/latest/developerguide/grants.html#terms-grant-operations)

{{#include ../../../banners/hacktricks-training.md}}
