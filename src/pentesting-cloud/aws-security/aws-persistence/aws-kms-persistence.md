# AWS - KMS Persistence

{{#include ../../../banners/hacktricks-training.md}}

## KMS

Για περισσότερες πληροφορίες, ελέγξτε:

{{#ref}}
../aws-services/aws-kms-enum.md
{{#endref}}

### Παροχή πρόσβασης μέσω πολιτικών KMS

Ένας επιτιθέμενος θα μπορούσε να χρησιμοποιήσει την άδεια **`kms:PutKeyPolicy`** για να **δώσει πρόσβαση** σε ένα κλειδί σε έναν χρήστη υπό τον έλεγχό του ή ακόμη και σε έναν εξωτερικό λογαριασμό. Ελέγξτε τη [**σελίδα KMS Privesc**](../aws-privilege-escalation/aws-kms-privesc.md) για περισσότερες πληροφορίες.

### Αιώνια Παροχή

Οι παροχές είναι ένας άλλος τρόπος για να δοθούν σε έναν κύριο ορισμένες άδειες σχετικά με ένα συγκεκριμένο κλειδί. Είναι δυνατόν να δοθεί μια παροχή που επιτρέπει σε έναν χρήστη να δημιουργεί παροχές. Επιπλέον, ένας χρήστης μπορεί να έχει πολλές παροχές (ακόμη και ταυτόσημες) για το ίδιο κλειδί.

Επομένως, είναι δυνατόν για έναν χρήστη να έχει 10 παροχές με όλες τις άδειες. Ο επιτιθέμενος θα πρέπει να παρακολουθεί αυτό συνεχώς. Και αν σε κάποιο σημείο 1 παροχή αφαιρεθεί, θα πρέπει να δημιουργηθούν άλλες 10.

(Χρησιμοποιούμε 10 και όχι 2 για να μπορέσουμε να ανιχνεύσουμε ότι μια παροχή αφαιρέθηκε ενώ ο χρήστης εξακολουθεί να έχει κάποιες παροχές)
```bash
# To generate grants, generate 10 like this one
aws kms create-grant \
--key-id <key-id> \
--grantee-principal <user_arn> \
--operations "CreateGrant" "Decrypt"

# To monitor grants
aws kms list-grants --key-id <key-id>
```
> [!NOTE]
> Μια χορήγηση μπορεί να δώσει δικαιώματα μόνο από αυτό: [https://docs.aws.amazon.com/kms/latest/developerguide/grants.html#terms-grant-operations](https://docs.aws.amazon.com/kms/latest/developerguide/grants.html#terms-grant-operations)

{{#include ../../../banners/hacktricks-training.md}}
