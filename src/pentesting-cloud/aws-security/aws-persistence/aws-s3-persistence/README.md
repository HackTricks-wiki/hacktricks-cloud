# AWS - S3 Persistence

{{#include ../../../../banners/hacktricks-training.md}}

## S3

Daha fazla bilgi için bakınız:

{{#ref}}
../../aws-services/aws-s3-athena-and-glacier-enum.md
{{#endref}}

### KMS Client-Side Encryption

Şifreleme işlemi tamamlandığında kullanıcı, yeni bir anahtar oluşturmak için KMS API'sini (`aws kms generate-data-key`) kullanır ve oluşturulan şifrelenmiş anahtarı dosyanın metadata'sı içinde **saklar** ([python code example](https://aioboto3.readthedocs.io/en/latest/cse.html#how-it-works-kms-managed-keys)) böylece decrypt işlemi gerçekleştiğinde anahtar tekrar KMS ile decrypt edilebilir:

<figure><img src="../../../images/image (226).png" alt=""><figcaption></figcaption></figure>

Bu nedenle, attacker bu anahtarı metadata'dan elde edip KMS ile (`aws kms decrypt`) decrypt ederek bilgiyi şifrelemek için kullanılan anahtarı elde edebilir. Böylece attacker şifreleme anahtarına sahip olur ve bu anahtar diğer dosyaları şifrelemek için yeniden kullanıldıysa, aynı anahtarı kullanarak onları da çözebilir.

### Using S3 ACLs

Genellikle bucket'ların ACL'leri devre dışı bırakılmış olsa da, yeterli ayrıcalıklara sahip bir attacker, bunları kötüye kullanarak (etkinleştirildiyse veya attacker bunları etkinleştirebiliyorsa) S3 bucket'a erişimi koruyabilir.

{{#include ../../../../banners/hacktricks-training.md}}
