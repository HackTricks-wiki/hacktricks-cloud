# AWS - S3 Persistence

{{#include ../../../../banners/hacktricks-training.md}}

## S3

Kwa habari zaidi angalia:

{{#ref}}
../../aws-services/aws-s3-athena-and-glacier-enum.md
{{#endref}}

### KMS Client-Side Encryption

Wakati the encryption process imemalizika, mtumiaji atatumia KMS API kutengeneza key mpya (`aws kms generate-data-key`) na ata **store the generated encrypted key inside the metadata** ya faili ([python code example](https://aioboto3.readthedocs.io/en/latest/cse.html#how-it-works-kms-managed-keys)), ili when the decrypting occur iweze ku-decrypt tena kwa kutumia KMS:

<figure><img src="../../../images/image (226).png" alt=""><figcaption></figcaption></figure>

Hivyo, attacker anaweza kupata key hii kutoka metadata na ku-decrypt kutumia KMS (`aws kms decrypt`) kupata key iliyotumika ku-encrypt taarifa. Kwa njia hii attacker atakuwa na encryption key na ikiwa key hiyo itatumiwa tena ku-encrypt faili nyingine ataweza kuitumia.

### Using S3 ACLs

Ingawa kwa kawaida ACLs za buckets zimeshizimwa, attacker mwenye privileges za kutosha anaweza kuzibadilisha matumizi yao (ikiwa zimeshawashwa au ikiwa attacker anaweza kuzizima) ili kudumisha access kwa S3 bucket.

{{#include ../../../../banners/hacktricks-training.md}}
