# AWS - S3 Персистентність

{{#include ../../../../banners/hacktricks-training.md}}

## S3

Для отримання додаткової інформації див.:

{{#ref}}
../../aws-services/aws-s3-athena-and-glacier-enum.md
{{#endref}}

### KMS Client-Side Encryption

Після завершення процесу шифрування користувач використовує KMS API для генерації нового ключа (`aws kms generate-data-key`) і **зберігає згенерований зашифрований ключ у метаданих** файлу ([python code example](https://aioboto3.readthedocs.io/en/latest/cse.html#how-it-works-kms-managed-keys)), тому під час дешифрування його можна знову розшифрувати за допомогою KMS:

<figure><img src="../../../images/image (226).png" alt=""><figcaption></figcaption></figure>

Отже, attacker може отримати цей ключ з метаданих і розшифрувати його за допомогою KMS (`aws kms decrypt`), щоб отримати ключ, який використовувався для шифрування інформації. Таким чином attacker отримає ключ шифрування, і якщо цей ключ буде повторно використано для шифрування інших файлів, він зможе ним користуватися.

### Using S3 ACLs

Хоча зазвичай ACLs для бакетів вимкнені, attacker з достатніми привілеями може зловживати ними (якщо вони увімкнені або якщо attacker може їх увімкнути), щоб зберегти доступ до S3 bucket.

{{#include ../../../../banners/hacktricks-training.md}}
