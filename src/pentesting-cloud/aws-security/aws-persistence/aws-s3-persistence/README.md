# AWS - S3 Persistence

{{#include ../../../../banners/hacktricks-training.md}}

## S3

Για περισσότερες πληροφορίες δείτε:

{{#ref}}
../../aws-services/aws-s3-athena-and-glacier-enum.md
{{#endref}}

### KMS Client-Side Encryption

Όταν ολοκληρωθεί η διαδικασία κρυπτογράφησης ο χρήστης θα χρησιμοποιήσει το KMS API για να δημιουργήσει ένα νέο κλειδί (`aws kms generate-data-key`) και θα **αποθηκεύσει το παραγόμενο κρυπτογραφημένο κλειδί στα μεταδεδομένα** του αρχείου ([python code example](https://aioboto3.readthedocs.io/en/latest/cse.html#how-it-works-kms-managed-keys)) έτσι ώστε όταν γίνει η αποκρυπτογράφηση να μπορεί να το αποκρυπτογραφήσει ξανά χρησιμοποιώντας το KMS:

<figure><img src="../../../images/image (226).png" alt=""><figcaption></figcaption></figure>

Επομένως, ένας επιτιθέμενος θα μπορούσε να πάρει αυτό το κλειδί από τα μεταδεδομένα και να το αποκρυπτογραφήσει με το KMS (`aws kms decrypt`) για να αποκτήσει το κλειδί που χρησιμοποιήθηκε για να κρυπτογραφήσει την πληροφορία. Με αυτόν τον τρόπο ο επιτιθέμενος θα έχει το κλειδί κρυπτογράφησης και εάν αυτό το κλειδί επαναχρησιμοποιηθεί για να κρυπτογραφήσει άλλα αρχεία θα μπορεί να το χρησιμοποιήσει.

### Using S3 ACLs

Αν και συνήθως τα ACLs των buckets είναι απενεργοποιημένα, ένας επιτιθέμενος με επαρκή δικαιώματα θα μπορούσε να τα καταχραστεί (αν είναι ενεργοποιημένα ή αν ο επιτιθέμενος μπορεί να τα ενεργοποιήσει) για να διατηρήσει πρόσβαση στο S3 bucket.

{{#include ../../../../banners/hacktricks-training.md}}
