# AWS - Utrwalanie dostępu w S3

{{#include ../../../../banners/hacktricks-training.md}}

## S3

Więcej informacji znajdziesz w:

{{#ref}}
../../aws-services/aws-s3-athena-and-glacier-enum.md
{{#endref}}

### KMS — szyfrowanie po stronie klienta

Gdy proces szyfrowania zostanie wykonany, użytkownik użyje KMS API do wygenerowania nowego klucza (`aws kms generate-data-key`) i **zapisze wygenerowany zaszyfrowany klucz w metadanych** pliku ([python code example](https://aioboto3.readthedocs.io/en/latest/cse.html#how-it-works-kms-managed-keys)), tak aby przy odszyfrowywaniu można było go ponownie odszyfrować za pomocą KMS:

<figure><img src="../../../images/image (226).png" alt=""><figcaption></figcaption></figure>

W związku z tym atakujący mógłby pobrać ten klucz z metadanych i odszyfrować go za pomocą KMS (`aws kms decrypt`), aby uzyskać klucz użyty do zaszyfrowania informacji. W ten sposób atakujący będzie miał klucz szyfrujący i jeśli klucz ten zostanie ponownie użyty do szyfrowania innych plików, będzie mógł go użyć.

### Używanie S3 ACLs

Chociaż zwykle ACLs dla bucketów są wyłączone, atakujący z wystarczającymi uprawnieniami może je nadużyć (jeśli są włączone lub jeśli atakujący może je włączyć), aby utrzymać dostęp do S3 bucketu.

{{#include ../../../../banners/hacktricks-training.md}}
