# AWS - SQS Persistence

{{#include ../../../../banners/hacktricks-training.md}}

## SQS

Για περισσότερες πληροφορίες δείτε:

{{#ref}}
../../aws-services/aws-sqs-and-sns-enum.md
{{#endref}}

### Χρήση resource policy

Στο SQS πρέπει να υποδείξετε με μια IAM policy **ποιος έχει πρόσβαση για ανάγνωση και εγγραφή**. Είναι δυνατόν να υποδείξετε εξωτερικούς λογαριασμούς, ARN of roles, ή **ακόμα και "\*"**.\
Η παρακάτω πολιτική δίνει σε όλους στο AWS πρόσβαση σε οτιδήποτε στην ουρά που ονομάζεται **MyTestQueue**:
```json
{
"Version": "2008-10-17",
"Id": "__default_policy_ID",
"Statement": [
{
"Sid": "__owner_statement",
"Effect": "Allow",
"Principal": {
"AWS": "*"
},
"Action": ["SQS:*"],
"Resource": "arn:aws:sqs:us-east-1:123123123123:MyTestQueue"
}
]
}
```
> [!NOTE]
> Μπορείτε ακόμη και να **ενεργοποιήσετε μια Lambda στον λογαριασμό του attacker κάθε φορά που μπαίνει ένα νέο μήνυμα** στην ουρά (θα χρειαστεί να το επανατοποθετήσετε). Για αυτό ακολουθήστε αυτές τις οδηγίες: [https://docs.aws.amazon.com/lambda/latest/dg/with-sqs-cross-account-example.html](https://docs.aws.amazon.com/lambda/latest/dg/with-sqs-cross-account-example.html)

### Περισσότερες SQS Persistence Techniques

{{#ref}}
aws-sqs-dlq-backdoor-persistence.md
{{#endref}}

{{#ref}}
aws-sqs-orgid-policy-backdoor.md
{{#endref}}

{{#include ../../../../banners/hacktricks-training.md}}
