# AWS - SQS 영속성

{{#include ../../../../banners/hacktricks-training.md}}

## SQS

자세한 내용은 다음을 확인하세요:

{{#ref}}
../../aws-services/aws-sqs-and-sns-enum.md
{{#endref}}

### 리소스 정책 사용

SQS에서는 IAM 정책으로 **누가 읽기 및 쓰기 권한이 있는지**를 지정해야 합니다. 외부 계정, 역할의 ARN, 또는 **심지어 "\*"**를 지정할 수 있습니다.\
다음 정책은 **MyTestQueue**라는 큐의 모든 항목에 대해 AWS의 모든 사용자에게 액세스 권한을 부여합니다:
```json
{
"Version": "2008-10-17",
"Id": "__default_policy_ID",
"Statement": [
{
"Sid": "__owner_statement",
"Effect": "Allow",
"Principal": {
"AWS": "*"
},
"Action": ["SQS:*"],
"Resource": "arn:aws:sqs:us-east-1:123123123123:MyTestQueue"
}
]
}
```
> [!NOTE]
> 큐에 새 메시지가 들어올 때마다 **attacker's account에 있는 Lambda를 트리거**할 수도 있습니다(다시 put해야 합니다). 이를 위해 다음 지침을 따르세요: [https://docs.aws.amazon.com/lambda/latest/dg/with-sqs-cross-account-example.html](https://docs.aws.amazon.com/lambda/latest/dg/with-sqs-cross-account-example.html)

### 추가 SQS Persistence Techniques

{{#ref}}
aws-sqs-dlq-backdoor-persistence.md
{{#endref}}

{{#ref}}
aws-sqs-orgid-policy-backdoor.md
{{#endref}}

{{#include ../../../../banners/hacktricks-training.md}}
