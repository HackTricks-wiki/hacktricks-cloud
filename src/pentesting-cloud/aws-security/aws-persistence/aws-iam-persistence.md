# AWS - IAM Persistence

{{#include ../../../banners/hacktricks-training.md}}

## IAM

Para más información accede a:

{{#ref}}
../aws-services/aws-iam-enum.md
{{#endref}}

### Persistencia Común de IAM

- Crear un usuario
- Agregar un usuario controlado a un grupo privilegiado
- Crear claves de acceso (del nuevo usuario o de todos los usuarios)
- Otorgar permisos adicionales a usuarios/grupos controlados (políticas adjuntas o políticas en línea)
- Deshabilitar MFA / Agregar tu propio dispositivo MFA
- Crear una situación de Cadena de Roles (más sobre esto a continuación en la persistencia de STS)

### Políticas de Confianza de Rol de Puerta Trasera

Podrías crear una puerta trasera en una política de confianza para poder asumirla para un recurso externo controlado por ti (o para todos):
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": ["*", "arn:aws:iam::123213123123:root"]
},
"Action": "sts:AssumeRole"
}
]
}
```
### Versión de Política de Puerta Trasera

Otorgar permisos de Administrador a una política que no sea su última versión (la última versión debe parecer legítima), luego asignar esa versión de la política a un usuario/grupo controlado.

### Puerta Trasera / Crear Proveedor de Identidad

Si la cuenta ya confía en un proveedor de identidad común (como Github), las condiciones de la confianza podrían aumentarse para que el atacante pueda abusar de ellas.

{{#include ../../../banners/hacktricks-training.md}}
