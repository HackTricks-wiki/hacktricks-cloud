# AWS - Persistência IAM

{{#include ../../../banners/hacktricks-training.md}}

## IAM

Para mais informações, acesse:

{{#ref}}
../aws-services/aws-iam-enum.md
{{#endref}}

### Persistência IAM Comum

- Criar um usuário
- Adicionar um usuário controlado a um grupo privilegiado
- Criar chaves de acesso (do novo usuário ou de todos os usuários)
- Conceder permissões extras a usuários/grupos controlados (políticas anexadas ou políticas inline)
- Desativar MFA / Adicionar seu próprio dispositivo MFA
- Criar uma situação de Cadeia de Funções (mais sobre isso abaixo na persistência STS)

### Políticas de Confiança de Função de Backdoor

Você pode backdoor uma política de confiança para poder assumi-la para um recurso externo controlado por você (ou para todos):
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": ["*", "arn:aws:iam::123213123123:root"]
},
"Action": "sts:AssumeRole"
}
]
}
```
### Versão da Política de Backdoor

Dê permissões de Administrador a uma política que não seja sua última versão (a última versão deve parecer legítima), e então atribua essa versão da política a um usuário/grupo controlado.

### Backdoor / Criar Provedor de Identidade

Se a conta já estiver confiando em um provedor de identidade comum (como o Github), as condições da confiança podem ser aumentadas para que o atacante possa abusar delas.

{{#include ../../../banners/hacktricks-training.md}}
