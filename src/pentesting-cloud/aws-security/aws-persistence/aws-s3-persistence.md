# AWS - S3 Persistence

{{#include ../../../banners/hacktricks-training.md}}

## S3

詳細については、次を確認してください：

{{#ref}}
../aws-services/aws-s3-athena-and-glacier-enum.md
{{#endref}}

### KMS クライアントサイド暗号化

暗号化プロセスが完了すると、ユーザーは KMS API を使用して新しいキー (`aws kms generate-data-key`) を生成し、**生成された暗号化キーをファイルのメタデータ内に保存します** ([python code example](https://aioboto3.readthedocs.io/en/latest/cse.html#how-it-works-kms-managed-keys))。これにより、復号化が行われるときに再度 KMS を使用して復号化できます：

<figure><img src="../../../images/image (226).png" alt=""><figcaption></figcaption></figure>

したがって、攻撃者はメタデータからこのキーを取得し、KMS (`aws kms decrypt`) を使用して復号化し、情報を暗号化するために使用されたキーを取得できます。この方法で、攻撃者は暗号化キーを持ち、そのキーが他のファイルを暗号化するために再利用されている場合、使用することができます。

### S3 ACL の使用

通常、バケットの ACL は無効になっていますが、十分な権限を持つ攻撃者は、それらを悪用することができます（有効な場合や攻撃者が有効にできる場合）ので、S3 バケットへのアクセスを維持できます。

{{#include ../../../banners/hacktricks-training.md}}
