# AWS - S3 Persistence

{{#include ../../../banners/hacktricks-training.md}}

## S3

Για περισσότερες πληροφορίες ελέγξτε:

{{#ref}}
../aws-services/aws-s3-athena-and-glacier-enum.md
{{#endref}}

### KMS Client-Side Encryption

Όταν η διαδικασία κρυπτογράφησης ολοκληρωθεί, ο χρήστης θα χρησιμοποιήσει το KMS API για να δημιουργήσει ένα νέο κλειδί (`aws kms generate-data-key`) και θα **αποθηκεύσει το παραγόμενο κρυπτογραφημένο κλειδί μέσα στα μεταδεδομένα** του αρχείου ([παράδειγμα κώδικα python](https://aioboto3.readthedocs.io/en/latest/cse.html#how-it-works-kms-managed-keys)) έτσι ώστε όταν γίνει η αποκρυπτογράφηση να μπορεί να το αποκρυπτογραφήσει χρησιμοποιώντας ξανά το KMS:

<figure><img src="../../../images/image (226).png" alt=""><figcaption></figcaption></figure>

Επομένως, ένας επιτιθέμενος θα μπορούσε να πάρει αυτό το κλειδί από τα μεταδεδομένα και να το αποκρυπτογραφήσει με το KMS (`aws kms decrypt`) για να αποκτήσει το κλειδί που χρησιμοποιήθηκε για την κρυπτογράφηση των πληροφοριών. Με αυτόν τον τρόπο, ο επιτιθέμενος θα έχει το κλειδί κρυπτογράφησης και αν αυτό το κλειδί επαναχρησιμοποιηθεί για την κρυπτογράφηση άλλων αρχείων, θα μπορεί να το χρησιμοποιήσει.

### Using S3 ACLs

Αν και συνήθως οι ACLs των buckets είναι απενεργοποιημένες, ένας επιτιθέμενος με αρκετά προνόμια θα μπορούσε να τις εκμεταλλευτεί (αν είναι ενεργοποιημένες ή αν ο επιτιθέμενος μπορεί να τις ενεργοποιήσει) για να διατηρήσει πρόσβαση στο S3 bucket.

{{#include ../../../banners/hacktricks-training.md}}
