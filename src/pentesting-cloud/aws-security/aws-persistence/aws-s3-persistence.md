# AWS - S3 Persistence

{{#include ../../../banners/hacktricks-training.md}}

## S3

Aby uzyskać więcej informacji, sprawdź:

{{#ref}}
../aws-services/aws-s3-athena-and-glacier-enum.md
{{#endref}}

### KMS Client-Side Encryption

Gdy proces szyfrowania jest zakończony, użytkownik użyje KMS API do wygenerowania nowego klucza (`aws kms generate-data-key`) i **przechowa wygenerowany zaszyfrowany klucz w metadanych** pliku ([przykład kodu python](https://aioboto3.readthedocs.io/en/latest/cse.html#how-it-works-kms-managed-keys)), aby podczas deszyfrowania mógł ponownie użyć KMS:

<figure><img src="../../../images/image (226).png" alt=""><figcaption></figcaption></figure>

W związku z tym, atakujący mógłby uzyskać ten klucz z metadanych i deszyfrować go za pomocą KMS (`aws kms decrypt`), aby uzyskać klucz użyty do szyfrowania informacji. W ten sposób atakujący będzie miał klucz szyfrowania, a jeśli ten klucz jest ponownie używany do szyfrowania innych plików, będzie mógł go użyć.

### Using S3 ACLs

Chociaż zazwyczaj ACL-e kubełków są wyłączone, atakujący z wystarczającymi uprawnieniami mógłby je nadużyć (jeśli są włączone lub jeśli atakujący może je włączyć), aby zachować dostęp do kubełka S3.

{{#include ../../../banners/hacktricks-training.md}}
