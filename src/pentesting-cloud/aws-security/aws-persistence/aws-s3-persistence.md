# AWS - S3 持久性

{{#include ../../../banners/hacktricks-training.md}}

## S3

有关更多信息，请查看：

{{#ref}}
../aws-services/aws-s3-athena-and-glacier-enum.md
{{#endref}}

### KMS 客户端加密

当加密过程完成后，用户将使用 KMS API 生成一个新密钥（`aws kms generate-data-key`），并将**生成的加密密钥存储在文件的元数据中**（[python 代码示例](https://aioboto3.readthedocs.io/en/latest/cse.html#how-it-works-kms-managed-keys)），以便在解密时可以再次使用 KMS 进行解密：

<figure><img src="../../../images/image (226).png" alt=""><figcaption></figcaption></figure>

因此，攻击者可以从元数据中获取此密钥，并使用 KMS（`aws kms decrypt`）进行解密，以获取用于加密信息的密钥。这样，攻击者将拥有加密密钥，如果该密钥被重用于加密其他文件，他将能够使用它。

### 使用 S3 ACLs

尽管通常存储桶的 ACL 被禁用，但具有足够权限的攻击者可以滥用它们（如果启用或攻击者可以启用它们）以保持对 S3 存储桶的访问。

{{#include ../../../banners/hacktricks-training.md}}
