# AWS - Διαχείριση Μυστικών Επιμονής

{{#include ../../../banners/hacktricks-training.md}}

## Διαχείριση Μυστικών

Για περισσότερες πληροφορίες, ελέγξτε:

{{#ref}}
../aws-services/aws-secrets-manager-enum.md
{{#endref}}

### Μέσω Πολιτικών Πόρων

Είναι δυνατόν να **παραχωρηθεί πρόσβαση σε μυστικά σε εξωτερικούς λογαριασμούς** μέσω πολιτικών πόρων. Ελέγξτε τη [**σελίδα Privesc της Διαχείρισης Μυστικών**](../aws-privilege-escalation/aws-secrets-manager-privesc.md) για περισσότερες πληροφορίες. Σημειώστε ότι για να **πρόσβαση σε ένα μυστικό**, ο εξωτερικός λογαριασμός θα χρειαστεί επίσης **πρόσβαση στο κλειδί KMS που κρυπτογραφεί το μυστικό**.

### Μέσω Lambda Περιστροφής Μυστικών

Για να **περιστρέφονται τα μυστικά** αυτόματα, καλείται μια ρυθμισμένη **Lambda**. Εάν ένας επιτιθέμενος μπορούσε να **αλλάξει** τον **κώδικα**, θα μπορούσε άμεσα να **εξάγει το νέο μυστικό** για τον εαυτό του.

Αυτός είναι ο τρόπος που θα μπορούσε να φαίνεται ο κώδικας lambda για μια τέτοια ενέργεια:
```python
import boto3

def rotate_secrets(event, context):
# Create a Secrets Manager client
client = boto3.client('secretsmanager')

# Retrieve the current secret value
secret_value = client.get_secret_value(SecretId='example_secret_id')['SecretString']

# Rotate the secret by updating its value
new_secret_value = rotate_secret(secret_value)
client.update_secret(SecretId='example_secret_id', SecretString=new_secret_value)

def rotate_secret(secret_value):
# Perform the rotation logic here, e.g., generate a new password

# Example: Generate a new password
new_secret_value = generate_password()

return new_secret_value

def generate_password():
# Example: Generate a random password using the secrets module
import secrets
import string
password = ''.join(secrets.choice(string.ascii_letters + string.digits) for i in range(16))
return password
```
{{#include ../../../banners/hacktricks-training.md}}
