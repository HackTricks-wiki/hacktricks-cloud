# AWS - SSM Perssitence

{{#include ../../../banners/hacktricks-training.md}}

## SSM

Aby uzyskać więcej informacji, sprawdź:

{{#ref}}
../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/README.md
{{#endref}}

### Używanie ssm:CreateAssociation do utrzymania

Atakujący z uprawnieniem **`ssm:CreateAssociation`** może utworzyć Stowarzyszenie Menedżera Stanu, aby automatycznie wykonywać polecenia na instancjach EC2 zarządzanych przez SSM. Te stowarzyszenia mogą być skonfigurowane do uruchamiania w stałych odstępach czasu, co czyni je odpowiednimi do utrzymania w stylu backdoor bez interaktywnych sesji.
```bash
aws ssm create-association \
--name SSM-Document-Name \
--targets Key=InstanceIds,Values=target-instance-id \
--parameters commands=["malicious-command"] \
--schedule-expression "rate(30 minutes)" \
--association-name association-name
```
> [!NOTE]
> Ta metoda utrzymywania dostępu działa, dopóki instancja EC2 jest zarządzana przez Systems Manager, agent SSM działa, a atakujący ma uprawnienia do tworzenia powiązań. Nie wymaga interaktywnych sesji ani wyraźnych uprawnień ssm:SendCommand. **Ważne:** Parametr `--schedule-expression` (np. `rate(30 minutes)`) musi respektować minimalny interwał AWS wynoszący 30 minut. Aby wykonać polecenie natychmiastowo lub jednorazowo, całkowicie pomiń `--schedule-expression` — powiązanie zostanie wykonane raz po utworzeniu.

{{#include ../../../banners/hacktricks-training.md}}
