# AWS - SSM パーシステンス

{{#include ../../../banners/hacktricks-training.md}}

## SSM

詳細については、次を確認してください:

{{#ref}}
../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/README.md
{{#endref}}

### ssm:CreateAssociationを使用したパーシステンス

**`ssm:CreateAssociation`** の権限を持つ攻撃者は、SSMによって管理されるEC2インスタンスでコマンドを自動的に実行するためのステートマネージャーアソシエーションを作成できます。これらのアソシエーションは、固定の間隔で実行されるように構成でき、インタラクティブなセッションなしでバックドアのようなパーシステンスに適しています。
```bash
aws ssm create-association \
--name SSM-Document-Name \
--targets Key=InstanceIds,Values=target-instance-id \
--parameters commands=["malicious-command"] \
--schedule-expression "rate(30 minutes)" \
--association-name association-name
```
> [!NOTE]
> この永続化方法は、EC2インスタンスがSystems Managerによって管理されており、SSMエージェントが実行中で、攻撃者が関連付けを作成する権限を持っている限り機能します。インタラクティブセッションや明示的なssm:SendCommand権限は必要ありません。**重要:** `--schedule-expression`パラメータ（例: `rate(30 minutes)`）は、AWSの最小間隔である30分を尊重する必要があります。即時または一度きりの実行の場合は、`--schedule-expression`を完全に省略してください — 関連付けは作成後に一度実行されます。

{{#include ../../../banners/hacktricks-training.md}}
