# AWS - SSM Perssitence

{{#include ../../../banners/hacktricks-training.md}}

## SSM

Για περισσότερες πληροφορίες ελέγξτε:

{{#ref}}
../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/README.md
{{#endref}}

### Χρησιμοποιώντας το ssm:CreateAssociation για επιμονή

Ένας επιτιθέμενος με την άδεια **`ssm:CreateAssociation`** μπορεί να δημιουργήσει μια Σύνδεση Διαχειριστή Κατάστασης για να εκτελεί αυτόματα εντολές σε EC2 instances που διαχειρίζεται το SSM. Αυτές οι συνδέσεις μπορούν να ρυθμιστούν ώστε να εκτελούνται σε σταθερά διαστήματα, καθιστώντας τις κατάλληλες για επιμονή τύπου backdoor χωρίς διαδραστικές συνεδρίες.
```bash
aws ssm create-association \
--name SSM-Document-Name \
--targets Key=InstanceIds,Values=target-instance-id \
--parameters commands=["malicious-command"] \
--schedule-expression "rate(30 minutes)" \
--association-name association-name
```
> [!NOTE]
> Αυτή η μέθοδος επιμονής λειτουργεί όσο η EC2 instance διαχειρίζεται από το Systems Manager, ο SSM agent είναι ενεργός και ο επιτιθέμενος έχει άδεια να δημιουργεί συσχετίσεις. Δεν απαιτεί διαδραστικές συνεδρίες ή ρητές άδειες ssm:SendCommand. **Σημαντικό:** Η παράμετρος `--schedule-expression` (π.χ., `rate(30 minutes)`) πρέπει να σέβεται το ελάχιστο διάστημα 30 λεπτών της AWS. Για άμεση ή μία φορά εκτέλεση, παραλείψτε εντελώς το `--schedule-expression` — η συσχέτιση θα εκτελείται μία φορά μετά τη δημιουργία.

{{#include ../../../banners/hacktricks-training.md}}
