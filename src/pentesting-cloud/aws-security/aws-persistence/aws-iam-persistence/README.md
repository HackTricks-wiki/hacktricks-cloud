# AWS - IAM Persistencia

{{#include ../../../../banners/hacktricks-training.md}}

## IAM

Para más información consulta:

{{#ref}}
../../aws-services/aws-iam-enum.md
{{#endref}}

### Persistencia común de IAM

- Crear un usuario
- Añadir un usuario controlado a un grupo privilegiado
- Crear access keys (del nuevo usuario o de todos los usuarios)
- Conceder permisos extra a usuarios/grupos controlados (attached policies o inline policies)
- Desactivar MFA / Añadir tu propio dispositivo MFA
- Crear una situación de Role Chain Juggling (más abajo en STS persistence)

### Backdoor Role Trust Policies

Podrías backdoor una trust policy para poder asumirla desde un recurso externo controlado por ti (o para todos):
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": ["*", "arn:aws:iam::123213123123:root"]
},
"Action": "sts:AssumeRole"
}
]
}
```
### Backdoor Policy Version

Otorga permisos de Administrator a una policy que no esté en su última versión (la última versión debe parecer legítima), luego asigna esa versión de la policy a un usuario o grupo controlado.

### Backdoor / Create Identity Provider

Si la cuenta ya confía en un proveedor de identidad común (por ejemplo Github), las condiciones de la confianza podrían ampliarse para que el atacante pueda abusar de ellas.

{{#include ../../../../banners/hacktricks-training.md}}
