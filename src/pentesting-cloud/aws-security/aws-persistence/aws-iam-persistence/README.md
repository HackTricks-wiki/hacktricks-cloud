# AWS - IAM Persistence

{{#include ../../../../banners/hacktricks-training.md}}

## IAM

Für weitere Informationen siehe:

{{#ref}}
../../aws-services/aws-iam-enum.md
{{#endref}}

### Häufige IAM Persistence

- Einen Benutzer erstellen
- Einen kontrollierten Benutzer zu einer privilegierten Gruppe hinzufügen
- Zugriffsschlüssel erstellen (des neuen Benutzers oder aller Benutzer)
- Kontrollierten Benutzern/Gruppen zusätzliche Berechtigungen gewähren (attached policies oder inline policies)
- MFA deaktivieren / eigenes MFA-Gerät hinzufügen
- Eine Role Chain Juggling-Situation erstellen (mehr dazu weiter unten in STS persistence)

### Backdoor Role Trust Policies

Du könntest eine trust policy backdooren, um sie für eine externe Ressource, die du kontrollierst (oder für alle), annehmen zu können:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": ["*", "arn:aws:iam::123213123123:root"]
},
"Action": "sts:AssumeRole"
}
]
}
```
### Backdoor Policy-Version

Gewähre einer Policy in einer nicht letzten Version Administratorrechte (die letzte Version sollte legitim wirken), und weise dann diese Version der Policy einem kontrollierten Benutzer/einer Gruppe zu.

### Backdoor / Identitätsanbieter erstellen

Wenn das Konto bereits einem gängigen Identitätsanbieter (z. B. Github) vertraut, könnten die Bedingungen des Vertrauens so erweitert werden, dass ein Angreifer sie ausnutzen kann.

{{#include ../../../../banners/hacktricks-training.md}}
