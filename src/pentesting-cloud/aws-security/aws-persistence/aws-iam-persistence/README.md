# AWS - IAM Persistence

{{#include ../../../../banners/hacktricks-training.md}}

## IAM

Para mais informações acesse:

{{#ref}}
../../aws-services/aws-iam-enum.md
{{#endref}}

### Persistência comum do IAM

- Criar um usuário
- Adicionar um usuário controlado a um grupo privilegiado
- Criar chaves de acesso (do novo usuário ou de todos os usuários)
- Conceder permissões extras a usuários/grupos controlados (políticas anexadas ou políticas inline)
- Desabilitar MFA / Adicionar seu próprio dispositivo MFA
- Criar uma situação de Role Chain Juggling (mais sobre isso abaixo em STS persistence)

### Backdoor Role Trust Policies

Você poderia inserir um backdoor em uma trust policy para que ela possa ser assumida por um recurso externo controlado por você (ou por todos):
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": ["*", "arn:aws:iam::123213123123:root"]
},
"Action": "sts:AssumeRole"
}
]
}
```
### Versão Backdoor da policy

Conceda permissões de Administrator a uma policy que não esteja na sua versão mais recente (a última versão deve parecer legítima), então atribua essa versão da policy a um usuário/grupo controlado.

### Backdoor / Criar Provedor de Identidade

Se a conta já confia em um provedor de identidade comum (como Github), as condições da relação de confiança podem ser aumentadas para que o atacante possa abusar delas.

{{#include ../../../../banners/hacktricks-training.md}}
