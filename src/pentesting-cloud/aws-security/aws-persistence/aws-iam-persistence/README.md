# AWS - IAM 持久化

{{#include ../../../../banners/hacktricks-training.md}}

## IAM

更多信息请查看：

{{#ref}}
../../aws-services/aws-iam-enum.md
{{#endref}}

### 常见的 IAM 持久化

- 创建用户
- 将受控用户添加到特权组
- 创建 access keys（新用户的或所有用户的）
- 授予受控用户/组额外权限（attached policies 或 inline policies）
- 禁用 MFA / 添加自己的 MFA 设备
- 创建 Role Chain Juggling 情况（在下面 STS persistence 中有更多说明）

### Backdoor Role Trust Policies

你可以 backdoor 一个 trust policy，使你能够对由你控制的外部资源（或对所有人）执行 assume：
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": ["*", "arn:aws:iam::123213123123:root"]
},
"Action": "sts:AssumeRole"
}
]
}
```
### Backdoor 策略版本

将管理员权限赋给某个不是最新版本的策略（最新版本应看起来合法），然后将该策略版本分配给受控的用户/组。

### Backdoor / 创建身份提供者

如果该账户已经信任某个常见的身份提供者（例如 Github），则可以放宽该信任的条件，从而让攻击者滥用它们。

{{#include ../../../../banners/hacktricks-training.md}}
