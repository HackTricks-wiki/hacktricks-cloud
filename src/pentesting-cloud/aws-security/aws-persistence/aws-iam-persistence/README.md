# AWS - IAM Persistence

{{#include ../../../../banners/hacktricks-training.md}}

## IAM

Aby uzyskać więcej informacji, zobacz:

{{#ref}}
../../aws-services/aws-iam-enum.md
{{#endref}}

### Typowe IAM Persistence

- Utwórz użytkownika
- Dodaj kontrolowanego użytkownika do uprzywilejowanej grupy
- Utwórz access keys (nowego użytkownika lub wszystkich użytkowników)
- Nadaj dodatkowe uprawnienia kontrolowanym użytkownikom/grupom (attached policies lub inline policies)
- Wyłącz MFA / Dodaj własne urządzenie MFA
- Stwórz sytuację Role Chain Juggling (więcej poniżej w STS persistence)

### Backdoor Role Trust Policies

Możesz wstawić backdoor w trust policy, aby móc assume'ować ją w kontekście zewnętrznego zasobu kontrolowanego przez Ciebie (lub dla wszystkich):
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": ["*", "arn:aws:iam::123213123123:root"]
},
"Action": "sts:AssumeRole"
}
]
}
```
### Backdoor Policy Version

Nadaj uprawnienia Administrator do polityki w wersji, która nie jest jej ostatnią (ostatnia wersja powinna wyglądać wiarygodnie), a następnie przypisz tę wersję polityki do kontrolowanego użytkownika/grupy.

### Backdoor / Create Identity Provider

Jeśli konto już ufa powszechnemu identity providerowi (np. Github), warunki zaufania mogą zostać zmienione tak, aby atakujący mógł je wykorzystać.

{{#include ../../../../banners/hacktricks-training.md}}
