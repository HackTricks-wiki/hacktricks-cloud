# AWS - IAM Persistence

{{#include ../../../../banners/hacktricks-training.md}}

## IAM

詳細については以下を参照してください:

{{#ref}}
../../aws-services/aws-iam-enum.md
{{#endref}}

### 一般的な IAM Persistence

- ユーザーを作成する
- 自分が管理するユーザーを特権グループに追加する
- アクセスキーを作成する（新しいユーザーの、またはすべてのユーザーの）
- 制御下のユーザー/グループに追加の権限を付与する（attached policies または inline policies）
- MFA を無効化する / 自分の MFA デバイスを追加する
- Role Chain Juggling の状況を作り出す（詳しくは下の STS persistence を参照）

### Backdoor Role Trust Policies

You could backdoor a trust policy to be able to assume it for an external resource controlled by you (or to everyone):
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": ["*", "arn:aws:iam::123213123123:root"]
},
"Action": "sts:AssumeRole"
}
]
}
```
### バックドアポリシーのバージョン

最新ではないバージョンのポリシーに管理者権限を付与し（最新バージョンは正規に見えるようにする）、そのポリシーの当該バージョンをコントロール下のユーザー／グループに割り当てる。

### バックドア / アイデンティティプロバイダーの作成

アカウントが既に一般的なアイデンティティプロバイダー（例えば Github）を信頼している場合、信頼の条件を拡大・緩和して攻撃者がそれを悪用できるようにすることが可能である。

{{#include ../../../../banners/hacktricks-training.md}}
