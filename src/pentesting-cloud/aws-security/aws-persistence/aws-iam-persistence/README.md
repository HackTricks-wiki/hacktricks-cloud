# AWS - IAM Persistance

{{#include ../../../../banners/hacktricks-training.md}}

## IAM

Pour plus d'informations, consultez :

{{#ref}}
../../aws-services/aws-iam-enum.md
{{#endref}}

### Persistance IAM courante

- Créer un utilisateur
- Ajouter un utilisateur contrôlé à un groupe privilégié
- Créer des clés d'accès (du nouvel utilisateur ou de tous les utilisateurs)
- Accorder des permissions supplémentaires aux utilisateurs/groupes contrôlés (politiques attachées ou politiques inline)
- Désactiver le MFA / Ajouter votre propre appareil MFA
- Créer une situation de Role Chain Juggling (plus d'infos ci-dessous dans la persistance STS)

### Backdoor Role Trust Policies

Vous pouvez backdoor une trust policy afin de pouvoir l'assumer pour une ressource externe contrôlée par vous (ou pour tout le monde) :
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": ["*", "arn:aws:iam::123213123123:root"]
},
"Action": "sts:AssumeRole"
}
]
}
```
### Backdoor Policy Version

Donner des permissions Administrator à une policy qui n'est pas dans sa dernière version (la dernière version doit sembler légitime), puis assigner cette version de la policy à un user/group contrôlé.

### Backdoor / Create Identity Provider

Si le compte fait déjà confiance à un identity provider courant (comme Github), les conditions du trust pourraient être étendues afin que l'attaquant puisse en abuser.

{{#include ../../../../banners/hacktricks-training.md}}
