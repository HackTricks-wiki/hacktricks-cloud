# AWS - IAM Persistence

{{#include ../../../../banners/hacktricks-training.md}}

## IAM

자세한 정보는 다음을 참조:

{{#ref}}
../../aws-services/aws-iam-enum.md
{{#endref}}

### 일반적인 IAM Persistence

- 사용자 생성
- 자신이 제어하는 사용자를 권한 있는 그룹에 추가
- 액세스 키 생성(신규 사용자 또는 모든 사용자용)
- 자신이 제어하는 사용자/그룹에 추가 권한 부여(첨부된 정책 또는 인라인 정책)
- MFA 비활성화 / 자신의 MFA 장치 추가
- Role Chain Juggling 상황 생성(자세한 내용은 아래 STS persistence 참조)

### Backdoor Role Trust Policies

자신이 제어하는 외부 리소스(또는 모든 사용자)가 이를 assume할 수 있도록 trust policy에 backdoor를 심을 수 있습니다:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": ["*", "arn:aws:iam::123213123123:root"]
},
"Action": "sts:AssumeRole"
}
]
}
```
### Backdoor 정책 버전

정책의 최신 버전이 아닌 버전에 Administrator 권한을 부여한 다음(최신 버전은 합법적으로 보이도록 유지), 해당 정책 버전을 제어하는 사용자/그룹에 할당합니다.

### Backdoor / Identity Provider 생성

계정이 이미 Github과 같은 일반적인 identity provider를 신뢰하고 있다면, 신뢰 조건을 강화하여 공격자가 이를 악용할 수 있습니다.

{{#include ../../../../banners/hacktricks-training.md}}
