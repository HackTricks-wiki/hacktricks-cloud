# AWS - IAM Persistence

{{#include ../../../../banners/hacktricks-training.md}}

## IAM

Для детальнішої інформації див.:

{{#ref}}
../../aws-services/aws-iam-enum.md
{{#endref}}

### Common IAM Persistence

- Створити користувача
- Додати контрольованого користувача до привілейованої групи
- Створити access keys (нового користувача або всіх користувачів)
- Надати додаткові дозволи контрольованим користувачам/групам (attached policies або inline policies)
- Вимкнути MFA / Додати власний MFA пристрій
- Створити ситуацію Role Chain Juggling (детальніше нижче в STS persistence)

### Backdoor Role Trust Policies

You could backdoor a trust policy to be able to assume it for an external resource controlled by you (or to everyone):
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": ["*", "arn:aws:iam::123213123123:root"]
},
"Action": "sts:AssumeRole"
}
]
}
```
### Backdoor Policy Version

Надати Administrator permissions до policy у версії, яка не є останньою (остання версія має виглядати легітимною), після чого призначити цю версію policy контрольованому user/group.

### Backdoor / Create Identity Provider

Якщо акаунт уже довіряє поширеному identity provider (наприклад, Github), умови довіри можна послабити/змінити так, щоб attacker міг ними зловживати.

{{#include ../../../../banners/hacktricks-training.md}}
