# AWS - SSM Perssitence

{{#include ../../../../banners/hacktricks-training.md}}

## SSM

Για περισσότερες πληροφορίες δείτε:

{{#ref}}
../../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/README.md
{{#endref}}

### Using ssm:CreateAssociation for persistence

Ένας επιτιθέμενος με την άδεια **`ssm:CreateAssociation`** μπορεί να δημιουργήσει ένα State Manager Association για να εκτελεί αυτόματα εντολές σε EC2 instances που διαχειρίζεται το SSM. Αυτές οι associations μπορούν να ρυθμιστούν να εκτελούνται σε σταθερά διαστήματα, καθιστώντας τες κατάλληλες για backdoor-like persistence χωρίς interactive sessions.
```bash
aws ssm create-association \
--name SSM-Document-Name \
--targets Key=InstanceIds,Values=target-instance-id \
--parameters commands=["malicious-command"] \
--schedule-expression "rate(30 minutes)" \
--association-name association-name
```
> [!NOTE]
> Αυτή η μέθοδος persistence λειτουργεί εφόσον το EC2 instance διαχειρίζεται από Systems Manager, ο SSM agent εκτελείται, και ο attacker έχει άδεια να δημιουργεί associations. Δεν απαιτεί διαδραστικές συνεδρίες ή ρητές άδειες ssm:SendCommand. **Σημαντικό:** Η παράμετρος `--schedule-expression` (π.χ., `rate(30 minutes)`) πρέπει να σέβεται το ελάχιστο διάστημα των 30 λεπτών της AWS. Για άμεση ή εφάπαξ εκτέλεση, παραλείψτε εντελώς το `--schedule-expression` — η association θα εκτελεστεί μία φορά μετά τη δημιουργία.

{{#include ../../../../banners/hacktricks-training.md}}
