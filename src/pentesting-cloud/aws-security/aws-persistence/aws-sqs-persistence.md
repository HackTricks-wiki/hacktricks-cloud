# AWS - SQS 持久性

{{#include ../../../banners/hacktricks-training.md}}

## SQS

有关更多信息，请查看：

{{#ref}}
../aws-services/aws-sqs-and-sns-enum.md
{{#endref}}

### 使用资源策略

在 SQS 中，您需要通过 IAM 策略指明 **谁可以访问读取和写入**。可以指明外部账户、角色的 ARN，或 **甚至 "\*"**。\
以下策略允许 AWS 中的每个人访问名为 **MyTestQueue** 的队列中的所有内容：
```json
{
"Version": "2008-10-17",
"Id": "__default_policy_ID",
"Statement": [
{
"Sid": "__owner_statement",
"Effect": "Allow",
"Principal": {
"AWS": "*"
},
"Action": ["SQS:*"],
"Resource": "arn:aws:sqs:us-east-1:123123123123:MyTestQueue"
}
]
}
```
> [!NOTE]
> 您甚至可以**在攻击者的账户中每次有新消息**放入队列时触发一个 Lambda（您需要以某种方式重新放入它）。为此，请遵循以下说明： [https://docs.aws.amazon.com/lambda/latest/dg/with-sqs-cross-account-example.html](https://docs.aws.amazon.com/lambda/latest/dg/with-sqs-cross-account-example.html)

{{#include ../../../banners/hacktricks-training.md}}
