# Ansible Tower / AWX / Automatiseringsbeheerder Sekuriteit

{{#include ../banners/hacktricks-training.md}}

## Basiese Inligting

**Ansible Tower** of sy oopbron weergawe [**AWX**](https://github.com/ansible/awx) is ook bekend as **Ansible se gebruikerskoppelvlak, dashboard, en REST API**. Met **rolgebaseerde toegangbeheer**, werkskedulering, en grafiese inventarisbestuur, kan jy jou Ansible-infrastruktuur vanaf 'n moderne UI bestuur. Tower se REST API en opdraglyn koppelvlak maak dit eenvoudig om dit in huidige gereedskap en werksvloei te integreer.

**Automatiseringsbeheerder is 'n nuwer** weergawe van Ansible Tower met meer vermoëns.

### Verskille

Volgens [**hierdie**](https://blog.devops.dev/ansible-tower-vs-awx-under-the-hood-65cfec78db00), is die hoofverskille tussen Ansible Tower en AWX die ontvangde ondersteuning en die Ansible Tower het addisionele funksies soos rolgebaseerde toegangbeheer, ondersteuning vir pasgemaakte API's, en gebruikersgedefinieerde werksvloei.

### Tegnologie Stapel

- **Web Koppelvlak**: Dit is die grafiese koppelvlak waar gebruikers inventarisse, akrediteer, sjablone, en werksgeleenthede kan bestuur. Dit is ontwerp om intuïtief te wees en bied visualisasies om te help met die begrip van die toestand en resultate van jou automatiseringswerk.
- **REST API**: Alles wat jy in die web koppelvlak kan doen, kan jy ook via die REST API doen. Dit beteken jy kan AWX/Tower met ander stelsels integreer of aksies skryf wat jy tipies in die koppelvlak sou uitvoer.
- **Databasis**: AWX/Tower gebruik 'n databasis (tipies PostgreSQL) om sy konfigurasie, werksresultate, en ander nodige operasionele data te stoor.
- **RabbitMQ**: Dit is die boodskapstelsel wat deur AWX/Tower gebruik word om tussen die verskillende komponente te kommunikeer, veral tussen die webdiens en die taaklopers.
- **Redis**: Redis dien as 'n kas en 'n agtergrond vir die taaklyn.

### Logiese Komponente

- **Inventarisse**: 'n Inventaris is 'n **versameling van gasheers (of nodes)** teenoor wie se **werksgeleenthede** (Ansible speelboeke) kan **loop**. AWX/Tower laat jou toe om jou inventarisse te definieer en te groepeer en ondersteun ook dinamiese inventarisse wat **gasheerlyste van ander stelsels** soos AWS, Azure, ens. kan **verkry**.
- **Projekte**: 'n Projek is in wese 'n **versameling van Ansible speelboeke** wat afkomstig is van 'n **weergawebeheerstelsel** (soos Git) om die nuutste speelboeke te trek wanneer nodig.
- **Sjablone**: Werk sjablone definieer **hoe 'n spesifieke speelboek uitgevoer sal word**, wat die **inventaris**, **akrediteer**, en ander **parameters** vir die werk spesifiseer.
- **Akrediteer**: AWX/Tower bied 'n veilige manier om **geheime, soos SSH sleutels, wagwoorde, en API tokens** te **bestuur en te stoor**. Hierdie akrediteer kan met werksjablone geassosieer word sodat speelboeke die nodige toegang het wanneer hulle loop.
- **Taak Enjin**: Dit is waar die magie gebeur. Die taak enjin is gebou op Ansible en is verantwoordelik vir **die uitvoering van die speelboeke**. Werksgeleenthede word na die taak enjin gestuur, wat dan die Ansible speelboeke teen die aangewese inventaris met die gespesifiseerde akrediteer uitvoer.
- **Skeerders en Terugroepe**: Dit is gevorderde funksies in AWX/Tower wat toelaat dat **werksgeleenthede geskeduleer** kan word om op spesifieke tye te loop of geaktiveer te word deur eksterne gebeurtenisse.
- **Kennisgewings**: AWX/Tower kan kennisgewings stuur gebaseer op die sukses of mislukking van werksgeleenthede. Dit ondersteun verskeie middele van kennisgewings soos e-pos, Slack boodskappe, webhooks, ens.
- **Ansible Speelboeke**: Ansible speelboeke is konfigurasie, ontplooiing, en orkestrasie gereedskap. Hulle beskryf die gewenste toestand van stelsels op 'n geoutomatiseerde, herhaalbare manier. Geskryf in YAML, gebruik speelboeke Ansible se verklarende outomatiseringstaal om konfigurasies, take, en stappe wat uitgevoer moet word te beskryf.

### Werk Uitvoering Stroom

1. **Gebruiker Interaksie**: 'n Gebruiker kan met AWX/Tower interaksie hê deur die **Web Koppelvlak** of die **REST API**. Hierdie bied front-end toegang tot al die funksies wat deur AWX/Tower aangebied word.
2. **Werk Inisiasie**:
- Die gebruiker, via die Web Koppelvlak of API, inisieer 'n werk gebaseer op 'n **Werk Sjabloon**.
- Die Werk Sjabloon sluit verwysings in na die **Inventaris**, **Projekt** (wat die speelboek bevat), en **Akrediteer**.
- By werk inisiasie, word 'n versoek na die AWX/Tower agtergrond gestuur om die werk vir uitvoering te plaas.
3. **Werk Plasing**:
- **RabbitMQ** hanteer die boodskappe tussen die webkomponent en die taaklopers. Sodra 'n werk geinisieer is, word 'n boodskap na die taak enjin gestuur met behulp van RabbitMQ.
- **Redis** dien as die agtergrond vir die taaklyn, wat geplaasde werksgeleenthede wat op uitvoering wag, bestuur.
4. **Werk Uitvoering**:
- Die **Taak Enjin** neem die geplaatste werk op. Dit verkry die nodige inligting van die **Databasis** oor die werk se geassosieerde speelboek, inventaris, en akrediteer.
- Met die verkrygde Ansible speelboek van die geassosieerde **Projekt**, voer die Taak Enjin die speelboek teen die gespesifiseerde **Inventaris** nodes uit met die verskafde **Akrediteer**.
- Soos die speelboek loop, word die uitvoeringsuitset (logs, feite, ens.) vasgevang en in die **Databasis** gestoor.
5. **Werk Resultate**:
- Sodra die speelboek klaar is met loop, word die resultate (sukses, mislukking, logs) in die **Databasis** gestoor.
- Gebruikers kan dan die resultate deur die Web Koppelvlak sien of dit via die REST API opvra.
- Gebaseer op werksuitkomste, kan **Kennisgewings** gestuur word om gebruikers of eksterne stelsels oor die werk se status in te lig. Kennisgewings kan e-posse, Slack boodskappe, webhooks, ens. wees.
6. **Eksterne Stelsels Integrasie**:
- **Inventarisse** kan dinamies van eksterne stelsels verkry word, wat AWX/Tower toelaat om gasheers van bronne soos AWS, Azure, VMware, en meer in te trek.
- **Projekte** (speelboeke) kan van weergawebeheerstelsels verkry word, wat die gebruik van op-datum speelboeke tydens werk uitvoering verseker.
- **Skeerders en Terugroepe** kan gebruik word om met ander stelsels of gereedskap te integreer, wat AWX/Tower toelaat om op eksterne triggers te reageer of werksgeleenthede op voorafbepaalde tye uit te voer.

### AWX laboratoriumskepping vir toetsing

[**Volg die dokumentasie**](https://github.com/ansible/awx/blob/devel/tools/docker-compose/README.md) is dit moontlik om docker-compose te gebruik om AWX te loop:
```bash
git clone -b x.y.z https://github.com/ansible/awx.git # Get in x.y.z the latest release version

cd awx

# Build
make docker-compose-build

# Run
make docker-compose

# Or to create a more complex env
MAIN_NODE_TYPE=control EXECUTION_NODE_COUNT=2 COMPOSE_TAG=devel make docker-compose

# Clean and build the UI
docker exec tools_awx_1 make clean-ui ui-devel

# Once migrations are completed and the UI is built, you can begin using AWX. The UI can be reached in your browser at https://localhost:8043/#/home, and the API can be found at https://localhost:8043/api/v2.

# Create an admin user
docker exec -ti tools_awx_1 awx-manage createsuperuser

# Load demo data
docker exec tools_awx_1 awx-manage create_preload_data
```
## RBAC

### Ondersteunde rolle

Die mees bevoorregte rol word **Stelselsadministrateur** genoem. Enigeen met hierdie rol kan **enige iets** **wysig**.

Vanuit 'n **wit boks sekuriteit** hersiening, sal jy die **Stelselauditor rol** benodig, wat toelaat om **alle stelseldatas** te **bekyk** maar geen veranderinge kan aanbring nie. 'n Ander opsie sou wees om die **Organisasieauditor rol** te verkry, maar dit sou beter wees om die ander een te kry.

<details>

<summary>Breek uit om 'n gedetailleerde beskrywing van beskikbare rolle te kry</summary>

1. **Stelselsadministrateur**:
- Dit is die supergebruiker rol met toestemmings om enige hulpbron in die stelsel te benader en te wysig.
- Hulle kan alle organisasies, spanne, projekte, inventarisse, werksjablone, ens. bestuur.
2. **Stelselauditor**:
- Gebruikers met hierdie rol kan alle stelseldatas bekijk maar kan geen veranderinge aanbring nie.
- Hierdie rol is ontwerp vir nakoming en toesig.
3. **Organisasie Rolle**:
- **Admin**: Volle beheer oor die organisasie se hulpbronne.
- **Auditor**: Slegs lees toegang tot die organisasie se hulpbronne.
- **Lid**: Basiese lidmaatskap in 'n organisasie sonder enige spesifieke toestemmings.
- **Voer uit**: Kan werksjablone binne die organisasie uitvoer.
- **Lees**: Kan die organisasie se hulpbronne bekijk.
4. **Projektrolle**:
- **Admin**: Kan die projek bestuur en wysig.
- **Gebruik**: Kan die projek in 'n werksjabloon gebruik.
- **Opdateer**: Kan die projek opdateer met SCM (bronbeheer).
5. **Inventariserolle**:
- **Admin**: Kan die inventaris bestuur en wysig.
- **Ad Hoc**: Kan ad hoc opdragte op die inventaris uitvoer.
- **Opdateer**: Kan die inventarisbron opdateer.
- **Gebruik**: Kan die inventaris in 'n werksjabloon gebruik.
- **Lees**: Slegs lees toegang.
6. **Werksjabloonrolle**:
- **Admin**: Kan die werksjabloon bestuur en wysig.
- **Voer uit**: Kan die werk uitvoer.
- **Lees**: Slegs lees toegang.
7. **Geloofsbriewe Rolle**:
- **Admin**: Kan die geloofsbriewe bestuur en wysig.
- **Gebruik**: Kan die geloofsbriewe in werksjablone of ander relevante hulpbronne gebruik.
- **Lees**: Slegs lees toegang.
8. **Spanrolle**:
- **Lid**: Deel van die span maar sonder enige spesifieke toestemmings.
- **Admin**: Kan die span se lede en geassosieerde hulpbronne bestuur.
9. **Werkvloei Rolle**:
- **Admin**: Kan die werkvloei bestuur en wysig.
- **Voer uit**: Kan die werkvloei uitvoer.
- **Lees**: Slegs lees toegang.

</details>

{{#include ../banners/hacktricks-training.md}}
