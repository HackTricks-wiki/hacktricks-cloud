# Concourse 架构

## Concourse 架构

{{#include ../../banners/hacktricks-training.md}}

[**来自 Concourse 文档的相关数据：**](https://concourse-ci.org/internals.html)

### 架构

![](<../../images/image (187).png>)

#### ATC: web UI 和构建调度器

ATC 是 Concourse 的核心。它运行 **web UI 和 API**，并负责所有管道的 **调度**。它 **连接到 PostgreSQL**，用于存储管道数据（包括构建日志）。

[checker](https://concourse-ci.org/checker.html) 的职责是持续检查资源的新版本。 [scheduler](https://concourse-ci.org/scheduler.html) 负责为作业调度构建，而 [build tracker](https://concourse-ci.org/build-tracker.html) 负责运行任何已调度的构建。 [garbage collector](https://concourse-ci.org/garbage-collector.html) 是用于清理任何未使用或过时对象（如容器和卷）的机制。

#### TSA: 工作节点注册与转发

TSA 是一个 **自定义构建的 SSH 服务器**，仅用于安全地 **注册** [**workers**](https://concourse-ci.org/internals.html#architecture-worker) 到 [ATC](https://concourse-ci.org/internals.html#component-atc)。

TSA 默认在端口 `2222` 上监听，通常与 [ATC](https://concourse-ci.org/internals.html#component-atc) 同处一地，并位于负载均衡器后面。

**TSA 通过 SSH 连接实现 CLI，** 支持 [**这些命令**](https://concourse-ci.org/internals.html#component-tsa)。

#### Workers

为了执行任务，Concourse 必须有一些工作节点。这些工作节点通过 [TSA](https://concourse-ci.org/internals.html#component-tsa) **注册自己**，并运行服务 [**Garden**](https://github.com/cloudfoundry-incubator/garden) 和 [**Baggageclaim**](https://github.com/concourse/baggageclaim)。

- **Garden**: 这是 **容器管理 API**，通常通过 **HTTP** 在 **端口 7777** 上运行。
- **Baggageclaim**: 这是 **卷管理 API**，通常通过 **HTTP** 在 **端口 7788** 上运行。

## 参考

- [https://concourse-ci.org/internals.html](https://concourse-ci.org/internals.html)

{{#include ../../banners/hacktricks-training.md}}
