# Basic Jenkins Information

{{#include ../../banners/hacktricks-training.md}}

## Access

### Username + Password

Ο πιο κοινός τρόπος σύνδεσης στο Jenkins είναι με ένα όνομα χρήστη ή έναν κωδικό πρόσβασης.

### Cookie

Αν ένα **εξουσιοδοτημένο cookie κλαπεί**, μπορεί να χρησιμοποιηθεί για πρόσβαση στη συνεδρία του χρήστη. Το cookie συνήθως ονομάζεται `JSESSIONID.*`. (Ένας χρήστης μπορεί να τερματίσει όλες τις συνεδρίες του, αλλά θα πρέπει πρώτα να ανακαλύψει ότι ένα cookie κλάπηκε).

### SSO/Plugins

Το Jenkins μπορεί να ρυθμιστεί χρησιμοποιώντας plugins για να είναι **προσβάσιμο μέσω τρίτου SSO**.

### Tokens

**Οι χρήστες μπορούν να δημιουργήσουν tokens** για να δώσουν πρόσβαση σε εφαρμογές να τους προσποιηθούν μέσω CLI ή REST API.

### SSH Keys

Αυτό το στοιχείο παρέχει έναν ενσωματωμένο SSH server για το Jenkins. Είναι μια εναλλακτική διεπαφή για το [Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/), και οι εντολές μπορούν να εκτελούνται με αυτόν τον τρόπο χρησιμοποιώντας οποιονδήποτε SSH client. (Από τα [docs](https://plugins.jenkins.io/sshd/))

## Authorization

Στο `/configureSecurity` είναι δυνατό να **ρυθμιστεί η μέθοδος εξουσιοδότησης του Jenkins**. Υπάρχουν πολλές επιλογές:

- **Ο καθένας μπορεί να κάνει οτιδήποτε**: Ακόμα και η ανώνυμη πρόσβαση μπορεί να διαχειριστεί τον server.
- **Legacy mode**: Ίδιο με το Jenkins <1.164. Αν έχετε τον **ρόλο "admin"**, θα έχετε **πλήρη έλεγχο** του συστήματος, και **διαφορετικά** (συμπεριλαμβανομένων των **ανώνυμων** χρηστών) θα έχετε **πρόσβαση μόνο για ανάγνωση**.
- **Οι συνδεδεμένοι χρήστες μπορούν να κάνουν οτιδήποτε**: Σε αυτή τη λειτουργία, κάθε **συνδεδεμένος χρήστης έχει πλήρη έλεγχο** του Jenkins. Ο μόνος χρήστης που δεν θα έχει πλήρη έλεγχο είναι ο **ανώνυμος χρήστης**, ο οποίος έχει μόνο **πρόσβαση για ανάγνωση**.
- **Matrix-based security**: Μπορείτε να ρυθμίσετε **ποιος μπορεί να κάνει τι** σε έναν πίνακα. Κάθε **στήλη** αντιπροσωπεύει μια **άδεια**. Κάθε **γραμμή** **αντιπροσωπεύει** έναν **χρήστη ή μια ομάδα/ρόλο.** Αυτό περιλαμβάνει έναν ειδικό χρήστη '**ανώνυμος**', ο οποίος αντιπροσωπεύει **μη αυθεντικοποιημένους χρήστες**, καθώς και '**αυθεντικοποιημένους**', που αντιπροσωπεύουν **όλους τους αυθεντικοποιημένους χρήστες**.

![](<../../images/image (149).png>)

- **Project-based Matrix Authorization Strategy:** Αυτή η λειτουργία είναι μια **επέκταση** της "**Matrix-based security**" που επιτρέπει την επιπλέον ACL matrix να ορίζεται **για κάθε έργο ξεχωριστά.**
- **Role-Based Strategy:** Ενεργοποιεί τον καθορισμό εξουσιοδοτήσεων χρησιμοποιώντας μια **στρατηγική βασισμένη σε ρόλους**. Διαχειριστείτε τους ρόλους στο `/role-strategy`.

## **Security Realm**

Στο `/configureSecurity` είναι δυνατό να **ρυθμιστεί το security realm.** Από προεπιλογή, το Jenkins περιλαμβάνει υποστήριξη για μερικά διαφορετικά Security Realms:

- **Delegate to servlet container**: Για **να ανατεθεί η αυθεντικοποίηση σε ένα servlet container που εκτελεί τον Jenkins controller**, όπως το [Jetty](https://www.eclipse.org/jetty/).
- **Jenkins’ own user database:** Χρησιμοποιήστε **τη δική του ενσωματωμένη βάση δεδομένων χρηστών του Jenkins** για αυθεντικοποίηση αντί να αναθέσετε σε ένα εξωτερικό σύστημα. Αυτό είναι ενεργοποιημένο από προεπιλογή.
- **LDAP**: Αναθέστε όλη την αυθεντικοποίηση σε έναν ρυθμισμένο LDAP server, συμπεριλαμβανομένων τόσο των χρηστών όσο και των ομάδων.
- **Unix user/group database**: **Αναθέτει την αυθεντικοποίηση στη βασική βάση δεδομένων χρηστών Unix** στο επίπεδο του λειτουργικού συστήματος στον Jenkins controller. Αυτή η λειτουργία θα επιτρέψει επίσης την επαναχρησιμοποίηση των ομάδων Unix για εξουσιοδότηση.

Τα plugins μπορούν να παρέχουν επιπλέον security realms που μπορεί να είναι χρήσιμα για την ενσωμάτωση του Jenkins σε υπάρχοντα συστήματα ταυτότητας, όπως:

- [Active Directory](https://plugins.jenkins.io/active-directory)
- [GitHub Authentication](https://plugins.jenkins.io/github-oauth)
- [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## Jenkins Nodes, Agents & Executors

Ορισμοί από τα [docs](https://www.jenkins.io/doc/book/managing/nodes/):

**Nodes** είναι οι **μηχανές** στις οποίες εκτελούνται οι **agents**. Το Jenkins παρακολουθεί κάθε συνδεδεμένο node για ελεύθερο χώρο δίσκου, ελεύθερο χώρο temp, ελεύθερο swap, χρόνο/συγχρονισμό ρολογιού και χρόνο απόκρισης. Ένα node τίθεται εκτός λειτουργίας αν οποιαδήποτε από αυτές τις τιμές ξεπεράσει το ρυθμισμένο όριο.

**Agents** **διαχειρίζονται** την **εκτέλεση εργασιών** εκ μέρους του Jenkins controller χρησιμοποιώντας **executors**. Ένας agent μπορεί να χρησιμοποιήσει οποιοδήποτε λειτουργικό σύστημα που υποστηρίζει Java. Τα εργαλεία που απαιτούνται για τις κατασκευές και τις δοκιμές εγκαθίστανται στο node όπου εκτελείται ο agent; μπορούν **να εγκατασταθούν απευθείας ή σε ένα container** (Docker ή Kubernetes). Κάθε **agent είναι ουσιαστικά μια διαδικασία με το δικό του PID** στη μηχανή φιλοξενίας.

Ένας **executor** είναι μια **θέση για την εκτέλεση εργασιών**; ουσιαστικά, είναι **ένα νήμα στον agent**. Ο **αριθμός των executors** σε ένα node καθορίζει τον αριθμό των **ταυτόχρονων εργασιών** που μπορούν να εκτελούνται σε αυτό το node ταυτόχρονα. Με άλλα λόγια, αυτό καθορίζει τον **αριθμό των ταυτόχρονων Pipeline `stages`** που μπορούν να εκτελούνται σε αυτό το node ταυτόχρονα.

## Jenkins Secrets

### Encryption of Secrets and Credentials

Ορισμός από τα [docs](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials): Το Jenkins χρησιμοποιεί **AES για την κρυπτογράφηση και την προστασία των μυστικών**, των διαπιστευτηρίων και των αντίστοιχων κλειδιών κρυπτογράφησης τους. Αυτά τα κλειδιά κρυπτογράφησης αποθηκεύονται στο `$JENKINS_HOME/secrets/` μαζί με το κύριο κλειδί που χρησιμοποιείται για την προστασία αυτών των κλειδιών. Αυτός ο φάκελος θα πρέπει να ρυθμιστεί έτσι ώστε μόνο ο χρήστης του λειτουργικού συστήματος που εκτελεί τον Jenkins controller να έχει πρόσβαση για ανάγνωση και εγγραφή σε αυτόν τον φάκελο (δηλαδή, μια τιμή `chmod` `0700` ή χρησιμοποιώντας κατάλληλα χαρακτηριστικά αρχείων). Το **κύριο κλειδί** (μερικές φορές αναφέρεται ως "κλειδί κρυπτογράφησης" στην κρυπτογραφία) είναι **αποθηκευμένο \_μη κρυπτογραφημένο\_** στο σύστημα αρχείων του Jenkins controller στο **`$JENKINS_HOME/secrets/master.key`** το οποίο δεν προστατεύει από επιτιθέμενους με άμεση πρόσβαση σε αυτό το αρχείο. Οι περισσότεροι χρήστες και προγραμματιστές θα χρησιμοποιήσουν αυτά τα κλειδιά κρυπτογράφησης έμμεσα είτε μέσω του [Secret](https://javadoc.jenkins.io/byShortName/Secret) API για την κρυπτογράφηση γενικών μυστικών δεδομένων είτε μέσω του credentials API. Για τους κρυπτογραφικά περίεργους, το Jenkins χρησιμοποιεί AES σε λειτουργία κρυπτογράφησης μπλοκ (CBC) με padding PKCS#5 και τυχαία IVs για την κρυπτογράφηση των περιπτώσεων του [CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey) που αποθηκεύονται στο `$JENKINS_HOME/secrets/` με ένα όνομα αρχείου που αντιστοιχεί στο `CryptoConfidentialKey` id τους. Κοινά ids κλειδιών περιλαμβάνουν:

- `hudson.util.Secret`: χρησιμοποιείται για γενικά μυστικά;
- `com.cloudbees.plugins.credentials.SecretBytes.KEY`: χρησιμοποιείται για ορισμένους τύπους διαπιστευτηρίων;
- `jenkins.model.Jenkins.crumbSalt`: χρησιμοποιείται από τον [μηχανισμό προστασίας CSRF](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery); και

### Credentials Access

Τα διαπιστευτήρια μπορούν να **περιοριστούν σε παγκόσμιους παρόχους** (`/credentials/`) που μπορούν να προσπελαστούν από οποιοδήποτε έργο είναι ρυθμισμένο, ή μπορούν να περιοριστούν σε **συγκεκριμένα έργα** (`/job/<project-name>/configure`) και επομένως να είναι προσβάσιμα μόνο από το συγκεκριμένο έργο.

Σύμφωνα με [**τα docs**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/): Τα διαπιστευτήρια που είναι σε πεδίο είναι διαθέσιμα στην pipeline χωρίς περιορισμούς. Για να **αποτραπεί η τυχαία έκθεση στο log κατασκευής**, τα διαπιστευτήρια είναι **κρυμμένα** από την κανονική έξοδο, έτσι ώστε μια κλήση του `env` (Linux) ή `set` (Windows), ή προγράμματα που εκτυπώνουν το περιβάλλον τους ή τις παραμέτρους τους να **μην τα αποκαλύπτουν στο log κατασκευής** σε χρήστες που διαφορετικά δεν θα είχαν πρόσβαση στα διαπιστευτήρια.

**Γι' αυτόν τον λόγο, προκειμένου να εξάγει τα διαπιστευτήρια, ένας επιτιθέμενος χρειάζεται, για παράδειγμα, να τα κωδικοποιήσει σε base64.**

## References

- [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
- [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
- [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)
- [https://www.jenkins.io/blog/2019/02/21/credentials-masking/](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)
- [https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)
- [https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials)
- [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)

{{#include ../../banners/hacktricks-training.md}}
