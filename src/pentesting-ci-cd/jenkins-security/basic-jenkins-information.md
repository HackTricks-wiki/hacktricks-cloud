# Βασικές Πληροφορίες για το Jenkins

{{#include ../../banners/hacktricks-training.md}}

## Πρόσβαση

### Όνομα Χρήστη + Κωδικός

Ο πιο κοινός τρόπος σύνδεσης στο Jenkins είναι με ένα όνομα χρήστη ή έναν κωδικό.

### Cookie

Αν ένα **εξουσιοδοτημένο cookie κλαπεί**, μπορεί να χρησιμοποιηθεί για πρόσβαση στη συνεδρία του χρήστη. Το cookie συνήθως ονομάζεται `JSESSIONID.*`. (Ένας χρήστης μπορεί να τερματίσει όλες τις συνεδρίες του, αλλά θα πρέπει πρώτα να ανακαλύψει ότι ένα cookie έχει κλαπεί).

### SSO/Πρόσθετα

Το Jenkins μπορεί να ρυθμιστεί χρησιμοποιώντας πρόσθετα για να είναι **προσβάσιμο μέσω τρίτου SSO**.

### Tokens

**Οι χρήστες μπορούν να δημιουργήσουν tokens** για να δώσουν πρόσβαση σε εφαρμογές να τους προσποιηθούν μέσω CLI ή REST API.

### SSH Κλειδιά

Αυτό το στοιχείο παρέχει έναν ενσωματωμένο SSH διακομιστή για το Jenkins. Είναι μια εναλλακτική διεπαφή για το [Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/), και οι εντολές μπορούν να εκτελούνται με αυτόν τον τρόπο χρησιμοποιώντας οποιονδήποτε SSH πελάτη. (Από τα [docs](https://plugins.jenkins.io/sshd/))

## Εξουσιοδότηση

Στο `/configureSecurity` είναι δυνατό να **ρυθμίσετε τη μέθοδο εξουσιοδότησης του Jenkins**. Υπάρχουν πολλές επιλογές:

- **Ο καθένας μπορεί να κάνει οτιδήποτε**: Ακόμα και η ανώνυμη πρόσβαση μπορεί να διαχειριστεί τον διακομιστή.
- **Κληρονομική λειτουργία**: Ίδιο με το Jenkins <1.164. Αν έχετε τον **ρόλο "admin"**, θα έχετε **πλήρη έλεγχο** του συστήματος, και **διαφορετικά** (συμπεριλαμβανομένων των **ανώνυμων** χρηστών) θα έχετε **πρόσβαση μόνο για ανάγνωση**.
- **Οι συνδεδεμένοι χρήστες μπορούν να κάνουν οτιδήποτε**: Σε αυτή τη λειτουργία, κάθε **συνδεδεμένος χρήστης αποκτά πλήρη έλεγχο** του Jenkins. Ο μόνος χρήστης που δεν θα έχει πλήρη έλεγχο είναι ο **ανώνυμος χρήστης**, ο οποίος αποκτά μόνο **πρόσβαση για ανάγνωση**.
- **Ασφάλεια βασισμένη σε πίνακα**: Μπορείτε να ρυθμίσετε **ποιος μπορεί να κάνει τι** σε έναν πίνακα. Κάθε **στήλη** αντιπροσωπεύει μια **άδεια**. Κάθε **γραμμή** **αντιπροσωπεύει** έναν **χρήστη ή μια ομάδα/ρόλο.** Αυτό περιλαμβάνει έναν ειδικό χρήστη '**ανώνυμος**', ο οποίος αντιπροσωπεύει **μη αυθεντικοποιημένους χρήστες**, καθώς και '**αυθεντικοποιημένος**', ο οποίος αντιπροσωπεύει **όλους τους αυθεντικοποιημένους χρήστες**.

![](<../../images/image (149).png>)

- **Στρατηγική Εξουσιοδότησης Βασισμένη σε Έργα:** Αυτή η λειτουργία είναι μια **επέκταση** της "**Ασφάλειας βασισμένης σε πίνακα**" που επιτρέπει την επιπλέον ACL matrix να ορίζεται **για κάθε έργο ξεχωριστά.**
- **Στρατηγική Βασισμένη σε Ρόλους:** Ενεργοποιεί τον καθορισμό εξουσιοδοτήσεων χρησιμοποιώντας μια **στρατηγική βασισμένη σε ρόλους**. Διαχειριστείτε τους ρόλους στο `/role-strategy`.

## **Βασίλειο Ασφαλείας**

Στο `/configureSecurity` είναι δυνατό να **ρυθμίσετε το βασίλειο ασφαλείας.** Από προεπιλογή, το Jenkins περιλαμβάνει υποστήριξη για μερικά διαφορετικά Βασίλεια Ασφαλείας:

- **Ανάθεση σε servlet container**: Για **ανάθεση αυθεντικοποίησης σε ένα servlet container που εκτελεί τον ελεγκτή Jenkins**, όπως το [Jetty](https://www.eclipse.org/jetty/).
- **Δική του βάση δεδομένων χρηστών του Jenkins:** Χρησιμοποιήστε **την ενσωματωμένη βάση δεδομένων χρηστών του Jenkins** για αυθεντικοποίηση αντί να αναθέσετε σε ένα εξωτερικό σύστημα. Αυτό είναι ενεργοποιημένο από προεπιλογή.
- **LDAP**: Ανάθεση όλης της αυθεντικοποίησης σε έναν ρυθμισμένο LDAP διακομιστή, συμπεριλαμβανομένων τόσο των χρηστών όσο και των ομάδων.
- **Βάση δεδομένων χρηστών/ομάδων Unix**: **Αναθέτει την αυθεντικοποίηση στη βάση δεδομένων χρηστών του Unix** στο επίπεδο του λειτουργικού συστήματος στον ελεγκτή Jenkins. Αυτή η λειτουργία θα επιτρέψει επίσης την επαναχρησιμοποίηση των ομάδων Unix για εξουσιοδότηση.

Τα πρόσθετα μπορούν να παρέχουν επιπλέον βασίλεια ασφαλείας που μπορεί να είναι χρήσιμα για την ενσωμάτωση του Jenkins σε υπάρχοντα συστήματα ταυτότητας, όπως:

- [Active Directory](https://plugins.jenkins.io/active-directory)
- [GitHub Authentication](https://plugins.jenkins.io/github-oauth)
- [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## Jenkins Κόμβοι, Πράκτορες & Εκτελεστές

Ορισμοί από τα [docs](https://www.jenkins.io/doc/book/managing/nodes/):

**Κόμβοι** είναι οι **μηχανές** στις οποίες εκτελούνται οι **πράκτορες**. Το Jenkins παρακολουθεί κάθε συνδεδεμένο κόμβο για ελεύθερο χώρο δίσκου, ελεύθερο χώρο temp, ελεύθερο swap, χρόνο/συγχρονισμό ρολογιού και χρόνο απόκρισης. Ένας κόμβος τίθεται εκτός σύνδεσης αν οποιαδήποτε από αυτές τις τιμές ξεπεράσει το ρυθμισμένο όριο.

**Πράκτορες** **διαχειρίζονται** την **εκτέλεση εργασιών** εκ μέρους του ελεγκτή Jenkins χρησιμοποιώντας **εκτελεστές**. Ένας πράκτορας μπορεί να χρησιμοποιήσει οποιοδήποτε λειτουργικό σύστημα που υποστηρίζει Java. Τα εργαλεία που απαιτούνται για τις κατασκευές και τις δοκιμές εγκαθίστανται στον κόμβο όπου εκτελείται ο πράκτορας; μπορούν να **εγκατασταθούν απευθείας ή σε ένα κοντέινερ** (Docker ή Kubernetes). Κάθε **πράκτορας είναι ουσιαστικά μια διαδικασία με το δικό του PID** στη μηχανή φιλοξενίας.

Ένας **εκτελεστής** είναι μια **θέση για την εκτέλεση εργασιών**; ουσιαστικά, είναι **ένα νήμα στον πράκτορα**. Ο **αριθμός των εκτελεστών** σε έναν κόμβο καθορίζει τον αριθμό των **ταυτόχρονων εργασιών** που μπορούν να εκτελούνται σε αυτόν τον κόμβο ταυτόχρονα. Με άλλα λόγια, αυτό καθορίζει τον **αριθμό των ταυτόχρονων Pipeline `stages`** που μπορούν να εκτελούνται σε αυτόν τον κόμβο ταυτόχρονα.

## Μυστικά Jenkins

### Κρυπτογράφηση Μυστικών και Διαπιστευτηρίων

Ορισμός από τα [docs](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials): Το Jenkins χρησιμοποιεί **AES για την κρυπτογράφηση και την προστασία μυστικών**, διαπιστευτηρίων και των αντίστοιχων κλειδιών κρυπτογράφησης τους. Αυτά τα κλειδιά κρυπτογράφησης αποθηκεύονται στο `$JENKINS_HOME/secrets/` μαζί με το κύριο κλειδί που χρησιμοποιείται για την προστασία αυτών των κλειδιών. Αυτός ο φάκελος θα πρέπει να ρυθμιστεί έτσι ώστε μόνο ο χρήστης του λειτουργικού συστήματος που εκτελεί τον ελεγκτή Jenkins να έχει δικαιώματα ανάγνωσης και εγγραφής σε αυτόν τον φάκελο (δηλαδή, μια τιμή `chmod` `0700` ή χρησιμοποιώντας κατάλληλα χαρακτηριστικά αρχείων). Το **κύριο κλειδί** (μερικές φορές αναφέρεται ως "κλειδί κρυπτογράφησης" στην κρυπτογραφία) είναι **αποθηκευμένο \_μη κρυπτογραφημένο\_** στο σύστημα αρχείων του ελεγκτή Jenkins στο **`$JENKINS_HOME/secrets/master.key`** το οποίο δεν προστατεύει από επιτιθέμενους με άμεση πρόσβαση σε αυτό το αρχείο. Οι περισσότεροι χρήστες και προγραμματιστές θα χρησιμοποιούν αυτά τα κλειδιά κρυπτογράφησης έμμεσα είτε μέσω του [Secret](https://javadoc.jenkins.io/byShortName/Secret) API για την κρυπτογράφηση γενικών μυστικών δεδομένων είτε μέσω του API διαπιστευτηρίων. Για τους κρυπτογραφικά περίεργους, το Jenkins χρησιμοποιεί AES σε λειτουργία αλυσίδας μπλοκ κρυπτογράφησης (CBC) με padding PKCS#5 και τυχαία IVs για την κρυπτογράφηση περιπτώσεων του [CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey) που αποθηκεύονται στο `$JENKINS_HOME/secrets/` με ένα όνομα αρχείου που αντιστοιχεί στο `CryptoConfidentialKey` id τους. Κοινά ids κλειδιών περιλαμβάνουν:

- `hudson.util.Secret`: χρησιμοποιείται για γενικά μυστικά;
- `com.cloudbees.plugins.credentials.SecretBytes.KEY`: χρησιμοποιείται για ορισμένους τύπους διαπιστευτηρίων;
- `jenkins.model.Jenkins.crumbSalt`: χρησιμοποιείται από τον [μηχανισμό προστασίας CSRF](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery); και

### Πρόσβαση σε Διαπιστευτήρια

Οι διαπιστευτήριες μπορούν να είναι **περιορισμένες σε παγκόσμιους παρόχους** (`/credentials/`) που μπορούν να προσπελαστούν από οποιοδήποτε έργο έχει ρυθμιστεί, ή μπορούν να περιοριστούν σε **συγκεκριμένα έργα** (`/job/<project-name>/configure`) και επομένως να είναι προσβάσιμες μόνο από το συγκεκριμένο έργο.

Σύμφωνα με [**τα docs**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/): Οι διαπιστευτήριες που είναι σε πεδίο είναι διαθέσιμες στην pipeline χωρίς περιορισμούς. Για να **αποτραπεί η τυχαία έκθεση στο αρχείο καταγραφής κατασκευής**, οι διαπιστευτήριες είναι **κρυμμένες** από την κανονική έξοδο, έτσι ώστε μια κλήση του `env` (Linux) ή `set` (Windows), ή προγράμματα που εκτυπώνουν το περιβάλλον τους ή τις παραμέτρους τους να **μην τις αποκαλύπτουν στο αρχείο καταγραφής κατασκευής** σε χρήστες που διαφορετικά δεν θα είχαν πρόσβαση στις διαπιστευτήριες.

**Γι' αυτόν τον λόγο, προκειμένου να εξάγει τις διαπιστευτήριες, ένας επιτιθέμενος χρειάζεται, για παράδειγμα, να τις κωδικοποιήσει σε base64.**

## Αναφορές

- [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
- [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
- [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)
- [https://www.jenkins.io/blog/2019/02/21/credentials-masking/](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)
- [https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)
- [https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials)
- [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)

{{#include ../../banners/hacktricks-training.md}}
