# Cloudflare Usalama

{{#include ../../banners/hacktricks-training.md}}

Katika akaunti ya Cloudflare kuna **general settings and services** ambazo zinaweza kusanidiwa. Kwenye ukurasa huu tutajifunza **kuchambua mipangilio inayohusiana na usalama ya kila sehemu:**

<figure><img src="../../images/image (117).png" alt=""><figcaption></figcaption></figure>

## Websites

Kagua kila moja kwa:

{{#ref}}
cloudflare-domains.md
{{#endref}}

### Domain Registration

- [ ] Kwenye **`Transfer Domains`** hakiki kuwa haiwezekani kuhamisha domain yoyote.

Kagua kila moja kwa:

{{#ref}}
cloudflare-domains.md
{{#endref}}

## Analytics

_Sikuwa na kitu cha kupatikana cha kukagua kwa uhakiki wa mipangilio ya usalama._

## Pages

Kwenye kila page ya Cloudflare:

- [ ] Hakiki kwa **sensitive information** katika **`Build log`**.
- [ ] Hakiki kwa **sensitive information** katika **Github repository** iliyowekwa kwa pages.
- [ ] Angalia uwezekano wa github repo compromise kupitia workflow command injection au `pull_request_target` compromise. More info katika [**Github Security page**](../github-security/index.html).
- [ ] Angalia **vulnerable functions** katika `/fuctions` directory (ikiwa ipo), angalia **redirects** katika `_redirects` file (ikiwa ipo) na **misconfigured headers** katika `_headers` file (ikiwa ipo).
- [ ] Angalia **vulnerabilities** katika **web page** kwa kutumia **blackbox** au **whitebox** ikiwa unaweza **access the code**.
- [ ] Katika maelezo ya kila page `/<page_id>/pages/view/blocklist/settings/functions`. Hakiki kwa **sensitive information** katika **`Environment variables`**.
- [ ] Katika ukurasa wa maelezo pia angalia **build command** na **root directory** kwa ajili ya **potential injections** zinazoweza kudhoofisha page.

## **Workers**

Kwenye kila Cloudflare's worker hakiki:

- [ ] The triggers: Nini kinachosababisha worker kuanzishwa? Je, **mtumiaji anaweza kutuma data** ambayo itatumika na worker?
- [ ] Kwenye **`Settings`**, hakiki kwa **`Variables`** zenye **sensitive information**
- [ ] Angalia code ya worker na tafuta **vulnerabilities** (hasa katika sehemu ambapo mtumiaji anaweza kudhibiti input)
- Angalia SSRFs zinazorudisha ukurasa ulioainishwa ambao unaweza kudhibiti
- Angalia XSSs zinazotekelezwa JS ndani ya picha ya svg
- Inawezekana worker inahusiana na huduma za ndani. Kwa mfano, worker inaweza kuwasiliana na R2 bucket kuhifadhi taarifa iliyopatikana kutokana na input. Katika hali hiyo, itahitajika kuchunguza uwezo wa worker juu ya R2 bucket na jinsi unaweza kutumiwa kutoka kwa user input.

> [!WARNING]
> Note that by default a **Worker is given a URL** such as `<worker-name>.<account>.workers.dev`. The user can set it to a **subdomain** but you can always access it with that **original URL** if you know it.

Kwa matumizi ya vitendo ya Workers kama pass-through proxies (IP rotation, FireProx-style), angalia:

{{#ref}}
cloudflare-workers-pass-through-proxy-ip-rotation.md
{{#endref}}

## R2

Kwenye kila R2 bucket hakiki:

- [ ] Configure **CORS Policy**.

## Stream

TODO

## Images

TODO

## Security Center

- [ ] Ikiwa inawezekana, run **`Security Insights`** **scan** na **`Infrastructure`** **scan**, kwani zitatoa taarifa muhimu zinazovutia kimausalama.
- [ ] Weka tu **kagua taarifa hizi** kwa ajili ya misconfigurations ya usalama na taarifa zinazovutia

## Turnstile

TODO

## **Zero Trust**

{{#ref}}
cloudflare-zero-trust-network.md
{{#endref}}

## Bulk Redirects

> [!NOTE]
> Unlike [Dynamic Redirects](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Bulk Redirects**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) are essentially static â€” they do **not support any string replacement** operations or regular expressions. However, you can configure URL redirect parameters that affect their URL matching behavior and their runtime behavior.

- [ ] Hakiki kuwa **expressions** na **requirements** za redirects zinafanya maana.
- [ ] Hakiki pia kwa **sensitive hidden endpoints** ambazo zinaweza kuwa na taarifa za kuvutia.

## Notifications

- [ ] Hakiki **notifications.** Hizi notifications zinapendekezwa kwa usalama:
- `Usage Based Billing`
- `HTTP DDoS Attack Alert`
- `Layer 3/4 DDoS Attack Alert`
- `Advanced HTTP DDoS Attack Alert`
- `Advanced Layer 3/4 DDoS Attack Alert`
- `Flow-based Monitoring: Volumetric Attack`
- `Route Leak Detection Alert`
- `Access mTLS Certificate Expiration Alert`
- `SSL for SaaS Custom Hostnames Alert`
- `Universal SSL Alert`
- `Script Monitor New Code Change Detection Alert`
- `Script Monitor New Domain Alert`
- `Script Monitor New Malicious Domain Alert`
- `Script Monitor New Malicious Script Alert`
- `Script Monitor New Malicious URL Alert`
- `Script Monitor New Scripts Alert`
- `Script Monitor New Script Exceeds Max URL Length Alert`
- `Advanced Security Events Alert`
- `Security Events Alert`
- [ ] Hakiki lahat la **destinations**, kwani kunaweza kuwa na **sensitive info** (basic http auth) katika webhook urls. Pia hakikisha webhook urls zinatumia **HTTPS**
- [ ] Kama ukaguzi wa ziada, unaweza kujaribu **kuiga notification ya cloudflare** kwa upande wa tatu, pengine unaweza kwa namna fulani **kuinject kitu hatari**

## Manage Account

- [ ] Inawezekana kuona **last 4 digits of the credit card**, **expiration** time na **billing address** katika **`Billing` -> `Payment info`**.
- [ ] Inawezekana kuona **plan type** inayotumika katika akaunti katika **`Billing` -> `Subscriptions`**.
- [ ] Kwenye **`Members`** inawezekana kuona wanachama wote wa akaunti na **role** zao. Kumbuka kwamba kama plan si Enterprise, kuna roles mbili tu: Administrator na Super Administrator. Lakini ikiwa **plan inayotumika ni Enterprise**, [**more roles**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) zinaweza kutumika ili kufuata kanuni ya least privilege.
- Kwa hivyo, inapendekezwa kutumia **Enterprise plan** iwezekanavyo.
- [ ] Kwenye Members inawezekana kuchunguza ni **members** gani wana **2FA enabled**. **Kila** mtumiaji anapaswa kuwa na hiyo imewezeshwa.

> [!NOTE]
> Note that fortunately the role **`Administrator`** doesn't give permissions to manage memberships (**cannot escalate privs or invite** new members)

## DDoS Investigation

[Check this part](cloudflare-domains.md#cloudflare-ddos-protection).

{{#include ../../banners/hacktricks-training.md}}
