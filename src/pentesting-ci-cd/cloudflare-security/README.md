# Cloudflare Güvenliği

{{#include ../../banners/hacktricks-training.md}}

Bir Cloudflare hesabında yapılandırılabilecek bazı **genel ayarlar ve hizmetler** bulunmaktadır. Bu sayfada her bölümün **güvenlikle ilgili ayarlarını analiz edeceğiz:**

<figure><img src="../../images/image (117).png" alt=""><figcaption></figcaption></figure>

## Web Siteleri

Her birini gözden geçirin:

{{#ref}}
cloudflare-domains.md
{{#endref}}

### Alan Adı Kaydı

- [ ] **`Alan Adlarını Transfer Et`** kısmında herhangi bir alan adının transfer edilemeyeceğinden emin olun.

Her birini gözden geçirin:

{{#ref}}
cloudflare-domains.md
{{#endref}}

## Analitik

_Güvenlik yapılandırma incelemesi için kontrol edilecek bir şey bulamadım._

## Sayfalar

Her Cloudflare sayfasında:

- [ ] **`Build log`** kısmında **hassas bilgileri** kontrol edin.
- [ ] Sayfalara atanan **Github deposunda** **hassas bilgileri** kontrol edin.
- [ ] **workflow command injection** veya `pull_request_target` ihlali yoluyla potansiyel github repo ihlalini kontrol edin. Daha fazla bilgi için [**Github Güvenlik sayfasına**](../github-security/) bakın.
- [ ] `/fuctions` dizininde **zayıf fonksiyonları** kontrol edin (varsa), `_redirects` dosyasındaki **yönlendirmeleri** kontrol edin (varsa) ve `_headers` dosyasındaki **yanlış yapılandırılmış başlıkları** kontrol edin (varsa).
- [ ] **Kod erişiminiz varsa** **web sayfasında** **zayıflıkları** kontrol edin **blackbox** veya **whitebox** ile.
- [ ] Her sayfanın detaylarında `/<page_id>/pages/view/blocklist/settings/functions`. **`Environment variables`** kısmında **hassas bilgileri** kontrol edin.
- [ ] Detay sayfasında ayrıca **build command** ve **root directory**'yi **potansiyel enjeksiyonlar** için kontrol edin.

## **Workers**

Her Cloudflare işçisinde kontrol edin:

- [ ] Tetikleyiciler: İşçiyi tetikleyen nedir? Bir **kullanıcı veri gönderebilir mi** ve bu veri işçi tarafından **kullanılabilir mi**?
- [ ] **`Ayarlar`** kısmında, **hassas bilgileri** içeren **`Değişkenleri`** kontrol edin.
- [ ] **İşçinin kodunu** kontrol edin ve **zayıflıkları** arayın (özellikle kullanıcının girişi yönetebileceği yerlerde).
- Kontrol edebileceğiniz belirtilen sayfayı döndüren SSRF'leri kontrol edin.
- Bir svg resminin içinde JS çalıştıran XSS'leri kontrol edin.
- İşçinin diğer iç hizmetlerle etkileşimde bulunması mümkündür. Örneğin, bir işçi, girdi olarak elde edilen bilgileri depolayan bir R2 bucket ile etkileşimde bulunabilir. Bu durumda, işçinin R2 bucket üzerindeki yeteneklerini ve kullanıcı girdisinden nasıl kötüye kullanılabileceğini kontrol etmek gerekecektir.

> [!WARNING]
> Varsayılan olarak bir **İşçiye** `<worker-name>.<account>.workers.dev` gibi bir URL verilir. Kullanıcı bunu bir **alt alan adı** olarak ayarlayabilir, ancak eğer biliyorsanız her zaman bu **orijinal URL** ile erişebilirsiniz.

## R2

Her R2 bucket'ta kontrol edin:

- [ ] **CORS Politikası** yapılandırın.

## Akış

TODO

## Görseller

TODO

## Güvenlik Merkezi

- [ ] Mümkünse, **`Güvenlik İçgörüleri`** **taraması** ve **`Altyapı`** **taraması** yapın, çünkü bunlar **güvenlik** açısından ilginç bilgileri **vurgulayacaktır**.
- [ ] Güvenlik yanlış yapılandırmaları ve ilginç bilgiler için sadece **bu bilgiyi** kontrol edin.

## Turnstile

TODO

## **Sıfır Güven**

{{#ref}}
cloudflare-zero-trust-network.md
{{#endref}}

## Toplu Yönlendirmeler

> [!NOTE]
> [Dinamik Yönlendirmeler](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/) ile karşılaştırıldığında, [**Toplu Yönlendirmeler**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) esasen statiktir — **herhangi bir dize değiştirme** işlemini veya düzenli ifadeleri desteklemez. Ancak, URL eşleşme davranışlarını ve çalışma zamanı davranışlarını etkileyen URL yönlendirme parametrelerini yapılandırabilirsiniz.

- [ ] **Yönlendirmeler için** **ifadelerin** ve **gereksinimlerin** **mantıklı** olduğundan emin olun.
- [ ] Ayrıca **ilginç bilgiler** içeren **hassas gizli uç noktaları** kontrol edin.

## Bildirimler

- [ ] **Bildirimleri** kontrol edin. Bu bildirimler güvenlik için önerilmektedir:
- `Kullanıma Dayalı Faturalama`
- `HTTP DDoS Saldırı Uyarısı`
- `Katman 3/4 DDoS Saldırı Uyarısı`
- `Gelişmiş HTTP DDoS Saldırı Uyarısı`
- `Gelişmiş Katman 3/4 DDoS Saldırı Uyarısı`
- `Akış Tabanlı İzleme: Hacimsel Saldırı`
- `Yönlendirme Sızıntısı Tespit Uyarısı`
- `Erişim mTLS Sertifika Süresi Dolma Uyarısı`
- `SaaS Özel Alan Adları için SSL Uyarısı`
- `Evrensel SSL Uyarısı`
- `Script İzleyici Yeni Kod Değişikliği Tespit Uyarısı`
- `Script İzleyici Yeni Alan Adı Uyarısı`
- `Script İzleyici Yeni Kötü Amaçlı Alan Adı Uyarısı`
- `Script İzleyici Yeni Kötü Amaçlı Script Uyarısı`
- `Script İzleyici Yeni Kötü Amaçlı URL Uyarısı`
- `Script İzleyici Yeni Scriptler Uyarısı`
- `Script İzleyici Yeni Script Maksimum URL Uzunluğunu Aşma Uyarısı`
- `Gelişmiş Güvenlik Olayları Uyarısı`
- `Güvenlik Olayları Uyarısı`
- [ ] Tüm **hedefleri** kontrol edin, çünkü webhook URL'lerinde **hassas bilgiler** (temel http kimlik doğrulaması) olabilir. Ayrıca webhook URL'lerinin **HTTPS** kullandığından emin olun.
- [ ] Ek bir kontrol olarak, belki bir şekilde **tehlikeli bir şey enjekte edebilirsiniz** diye bir üçüncü tarafa **cloudflare bildirimini taklit etmeyi** deneyebilirsiniz.

## Hesabı Yönet

- [ ] **`Faturalama` -> `Ödeme bilgileri`** kısmında **kredi kartının son 4 hanesini**, **son kullanma** tarihini ve **fatura adresini** görebilirsiniz.
- [ ] **`Faturalama` -> `Abonelikler`** kısmında hesabın kullanılan **plan türünü** görebilirsiniz.
- [ ] **`Üyeler`** kısmında hesabın tüm üyelerini ve onların **rollerini** görebilirsiniz. Plan türü Enterprise değilse, yalnızca 2 rol vardır: Yönetici ve Süper Yönetici. Ancak kullanılan **plan Enterprise** ise, [**daha fazla rol**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) kullanılabilir ve bu da en az ayrıcalık ilkesine uyulmasını sağlar.
- Bu nedenle, mümkün olduğunda **Enterprise planı** kullanılması **önerilir**.
- [ ] Üyeler kısmında hangi **üyelerin** **2FA etkin** olduğunu kontrol edebilirsiniz. **Her** kullanıcının bunu etkinleştirmesi gerekmektedir.

> [!NOTE]
> Neyse ki, **`Yönetici`** rolü, üyelikleri yönetme izinleri vermez (**yetkileri artırma veya** yeni üyeler davet etme **imkanı yoktur**).

## DDoS Soruşturması

[Burası kontrol edin](cloudflare-domains.md#cloudflare-ddos-protection).

{{#include ../../banners/hacktricks-training.md}}
