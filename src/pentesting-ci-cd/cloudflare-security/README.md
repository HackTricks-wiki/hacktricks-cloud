# Cloudflare Güvenliği

{{#include ../../banners/hacktricks-training.md}}

Bir Cloudflare hesabında yapılandırılabilecek bazı **genel ayarlar ve servisler** vardır. Bu sayfada her bölümün **güvenlikle ilgili ayarlarını** **inceleyeceğiz:**

<figure><img src="../../images/image (117).png" alt=""><figcaption></figcaption></figure>

## Web siteleri

Her birini şu sayfada inceleyin:

{{#ref}}
cloudflare-domains.md
{{#endref}}

### Alan Adı Kaydı

- [ ] **`Transfer Domains`** içinde herhangi bir domain'in transferinin mümkün olup olmadığını kontrol edin.

Her birini şu sayfada inceleyin:

{{#ref}}
cloudflare-domains.md
{{#endref}}

## Analitik

_I couldn't find anything to check for a config security review._

## Pages

Her Cloudflare Pages sayfasında:

- [ ] **`Build log`** içinde **hassas bilgi** olup olmadığını kontrol edin.
- [ ] Pages'e atanmış **Github repository** içinde **hassas bilgi** olup olmadığını kontrol edin.
- [ ] Olası github repo kompromisini **workflow command injection** veya `pull_request_target` kompromisi ile kontrol edin. Daha fazla bilgi için [**Github Security page**](../github-security/index.html) bölümüne bakın.
- [ ] `/fuctions` dizininde (varsa) **zayıf fonksiyonlar** için kontrol edin, `_redirects` dosyasındaki **redirect**leri (varsa) ve `_headers` dosyasındaki **yanlış yapılandırılmış header**ları (varsa) kontrol edin.
- [ ] Eğer koda erişiminiz varsa, web sayfasında **blackbox** veya **whitebox** ile **vulnerabilities** kontrolü yapın.
- [ ] Her sayfanın detaylarında `/<page_id>/pages/view/blocklist/settings/functions` kısmında **`Environment variables`** içinde **hassas bilgi** olup olmadığını kontrol edin.
- [ ] Detay sayfasında ayrıca **build command** ve **root directory**'yi sayfayı kompromize etmek için olası **injections** açısından kontrol edin.

## **Workers**

Her Cloudflare Workers için kontrol edin:

- [ ] Triggers: Worker'ı ne tetikliyor? Bir **kullanıcı veri gönderiyor** ve bu veri worker tarafından **kullanılıyor** mu?
- [ ] **`Settings`** içinde **`Variables`** olarak **hassas bilgi** içeren bir şey var mı kontrol edin
- [ ] Worker kodunu kontrol edin ve **vulnerabilities** arayın (özellikle kullanıcının girdiyi yönetebildiği yerlerde)
- SSRF'leri ve kontrolünüzdeki bir sayfayı döndüren durumları kontrol edin
- svg içinde JS çalıştıran XSS'leri kontrol edin
- Worker'ın diğer iç servislerle etkileşime girebileceğini unutmayın. Örneğin, bir worker input'tan elde edilen bilgileri depolayan bir R2 bucket ile etkileşime girebilir. Bu durumda, worker'ın R2 bucket üzerindeki yeteneklerini ve bunların kullanıcı girdisinden nasıl kötüye kullanılabileceğini kontrol etmek gerekir.

> [!WARNING]
> Varsayılan olarak bir **Worker'a şu tür bir URL verilir**: `<worker-name>.<account>.workers.dev`. Kullanıcı bunu bir **subdomain** olarak ayarlayabilir ama orijinal URL'i biliyorsanız worker'a her zaman o URL ile erişebilirsiniz.

Workers'ı geçiş proxy'si (IP rotation, FireProx tarzı) olarak pratik kötüye kullanım için şu bölüme bakın:

{{#ref}}
cloudflare-workers-pass-through-proxy-ip-rotation.md
{{#endref}}

## R2

Her R2 bucket için kontrol edin:

- [ ] **CORS Policy** yapılandırmasını kontrol edin.

## Stream

TODO

## Images

TODO

## Security Center

- [ ] Mümkünse bir **`Security Insights`** taraması ve bir **`Infrastructure`** taraması çalıştırın; bu taramalar güvenlik açısından ilginç bilgileri **vurgulayacaktır**.
- [ ] Bu bilgileri güvenlik yanlış yapılandırmaları ve ilginç bilgiler açısından **inceleyin**

## Turnstile

TODO

## **Zero Trust**

{{#ref}}
cloudflare-zero-trust-network.md
{{#endref}}

## Bulk Redirects

> [!NOTE]
> Unlike [Dynamic Redirects](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Bulk Redirects**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) are essentially static — they do **not support any string replacement** operations or regular expressions. However, you can configure URL redirect parameters that affect their URL matching behavior and their runtime behavior.

- [ ] Redirect ifadelerinin ve gereksinimlerinin **mantıklı** olduğundan emin olun.
- [ ] Ayrıca **gizli hassas endpoint'ler** olup olmadığını ve ilginç bilgi içerip içermediğini kontrol edin.

## Notifications

- [ ] **Notifications**'ları kontrol edin. Güvenlik için önerilen bildirimler:
- `Usage Based Billing`
- `HTTP DDoS Attack Alert`
- `Layer 3/4 DDoS Attack Alert`
- `Advanced HTTP DDoS Attack Alert`
- `Advanced Layer 3/4 DDoS Attack Alert`
- `Flow-based Monitoring: Volumetric Attack`
- `Route Leak Detection Alert`
- `Access mTLS Certificate Expiration Alert`
- `SSL for SaaS Custom Hostnames Alert`
- `Universal SSL Alert`
- `Script Monitor New Code Change Detection Alert`
- `Script Monitor New Domain Alert`
- `Script Monitor New Malicious Domain Alert`
- `Script Monitor New Malicious Script Alert`
- `Script Monitor New Malicious URL Alert`
- `Script Monitor New Scripts Alert`
- `Script Monitor New Script Exceeds Max URL Length Alert`
- `Advanced Security Events Alert`
- `Security Events Alert`
- [ ] Tüm **destinasyonları** kontrol edin; webhook URL'lerinde basic http auth gibi **hassas bilgi** olabilir. Ayrıca webhook URL'lerinin **HTTPS** kullandığından emin olun.
- [ ] Ek olarak, üçüncü taraflara gönderilen bir cloudflare bildirimi **taklit etmeyi** deneyebilirsiniz; belki bir şekilde **zararlı bir şey enjekte edebilirsiniz**.

## Hesap Yönetimi

- [ ] **`Billing` -> `Payment info`** bölümünde kredi kartının **son 4 hanesi**, **son geçerlilik tarihi** ve **fatura adresi** görülebilir.
- [ ] **`Billing` -> `Subscriptions`** bölümünde hesapta kullanılan **plan türü** görülebilir.
- [ ] **`Members`** bölümünde hesabın tüm üyeleri ve rollerini görebilirsiniz. Eğer plan Enterprise değilse yalnızca 2 rol vardır: Administrator ve Super Administrator. Ancak kullanılan **plan Enterprise** ise, en az ayrıcalık prensibini uygulamak için [**daha fazla rol**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) kullanılabilir.
- Bu nedenle, mümkünse **Enterprise planı** kullanılması **önerilir**.
- [ ] Members bölümünde hangi **üyelerin 2FA etkinleştirdiğini** kontrol edebilirsiniz. **Her** kullanıcıda 2FA etkin olmalıdır.

> [!NOTE]
> Neyse ki **`Administrator`** rolü üyelikleri yönetme yetkisi vermez (**yükseltme yapamaz veya yeni üye davet edemez**)

## DDoS Investigation

[Bunun kısmını kontrol edin](cloudflare-domains.md#cloudflare-ddos-protection).

{{#include ../../banners/hacktricks-training.md}}
