# Cloudflare Security

{{#include ../../banners/hacktricks-training.md}}

Σε έναν λογαριασμό Cloudflare υπάρχουν κάποιες **γενικές ρυθμίσεις και υπηρεσίες** που μπορούν να διαμορφωθούν. Σε αυτή τη σελίδα θα **αναλύσουμε τις ρυθμίσεις σχετικές με την ασφάλεια κάθε ενότητας:**

<figure><img src="../../images/image (117).png" alt=""><figcaption></figcaption></figure>

## Websites

Ελέγξτε κάθε μία με:

{{#ref}}
cloudflare-domains.md
{{#endref}}

### Καταχώρηση Domain

- [ ] Στο **`Transfer Domains`** ελέγξτε ότι δεν είναι δυνατό να μεταφερθεί κανένα domain.

Ελέγξτε κάθε μία με:

{{#ref}}
cloudflare-domains.md
{{#endref}}

## Analytics

_I couldn't find anything to check for a config security review._

## Pages

Σε κάθε σελίδα του Cloudflare:

- [ ] Ελέγξτε για **ευαίσθητες πληροφορίες** στο **`Build log`**.
- [ ] Ελέγξτε για **ευαίσθητες πληροφορίες** στο **Github repository** που είναι ανατεθειμένο στα Pages.
- [ ] Ελέγξτε για πιθανή συμβιβασμό του Github repo μέσω **workflow command injection** ή `pull_request_target` compromise. Περισσότερες πληροφορίες στη σελίδα [**Github Security page**](../github-security/index.html).
- [ ] Ελέγξτε για **vulnerable functions** στον κατάλογο `/fuctions` (εάν υπάρχουν), ελέγξτε τα **redirects** στο αρχείο `_redirects` (εάν υπάρχει) και για **λανθασμένα ρυθμισμένους headers** στο αρχείο `_headers` (εάν υπάρχει).
- [ ] Ελέγξτε για **ευπάθειες** στην **web page** μέσω **blackbox** ή **whitebox** αν μπορείτε να **έχετε πρόσβαση στον κώδικα**
- [ ] Στις λεπτομέρειες κάθε σελίδας `/<page_id>/pages/view/blocklist/settings/functions`. Ελέγξτε για **ευαίσθητες πληροφορίες** στις **`Environment variables`**.
- [ ] Στη σελίδα λεπτομερειών ελέγξτε επίσης την **build command** και το **root directory** για **ενδεχόμενες injections** που θα μπορούσαν να οδηγήσουν σε συμβιβασμό της σελίδας.

## **Workers**

Σε κάθε worker του Cloudflare ελέγξτε:

- [ ] Τα triggers: Τι κάνει τον worker να ενεργοποιηθεί; Μπορεί ένας **χρήστης να στείλει δεδομένα** που θα **χρησιμοποιηθούν** από τον worker;
- [ ] Στις **`Settings`**, ελέγξτε για **`Variables`** που περιέχουν **ευαίσθητες πληροφορίες**
- [ ] Ελέγξτε τον **κώδικα του worker** και αναζητήστε **ευπάθειες** (ειδικά σε σημεία όπου ο χρήστης μπορεί να διαχειριστεί την είσοδο)
- Ελέγξτε για SSRFs που επιστρέφουν τη συγκεκριμένη σελίδα που μπορείτε να ελέγξετε
- Ελέγξτε για XSSs που εκτελούν JS μέσα σε εικόνα svg
- Είναι πιθανό ο worker να αλληλεπιδρά με άλλες εσωτερικές υπηρεσίες. Για παράδειγμα, ένας worker μπορεί να αλληλεπιδρά με ένα R2 bucket που αποθηκεύει πληροφορίες σε αυτό οι οποίες λαμβάνονται από την είσοδο. Σε αυτή την περίπτωση, είναι απαραίτητο να ελέγξετε ποιες δυνατότητες έχει ο worker πάνω στο R2 bucket και πώς μπορούν να καταχραστούν από την είσοδο χρήστη.

> [!WARNING]
> Σημειώστε ότι εξ ορισμού ένας **Worker δίνεται ένα URL** όπως `<worker-name>.<account>.workers.dev`. Ο χρήστης μπορεί να το ορίσει σε ένα **subdomain** αλλά μπορείτε πάντα να το προσπελάσετε με αυτό το **original URL** αν το γνωρίζετε.

Για πρακτική κατάχρηση των Workers ως pass-through proxies (IP rotation, FireProx-style), δείτε:

{{#ref}}
cloudflare-workers-pass-through-proxy-ip-rotation.md
{{#endref}}

## R2

Σε κάθε R2 bucket ελέγξτε:

- [ ] Ρυθμίστε την **CORS Policy**.

## Stream

TODO

## Images

TODO

## Security Center

- [ ] Εάν είναι δυνατόν, τρέξτε ένα **`Security Insights`** **scan** και ένα **`Infrastructure`** **scan**, καθώς θα **αναδείξουν** ενδιαφέρουσες πληροφορίες από άποψη **ασφάλειας**.
- [ ] Απλώς **ελέγξτε αυτές τις πληροφορίες** για λανθασμένες ρυθμίσεις ασφαλείας και ενδιαφέροντα στοιχεία

## Turnstile

TODO

## **Zero Trust**

{{#ref}}
cloudflare-zero-trust-network.md
{{#endref}}

## Bulk Redirects

> [!NOTE]
> Unlike [Dynamic Redirects](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Bulk Redirects**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) είναι ουσιαστικά στατικές — δεν υποστηρίζουν καμία λειτουργία αντικατάστασης συμβολοσειρών ή regular expressions. Ωστόσο, μπορείτε να διαμορφώσετε παραμέτρους redirect URL που επηρεάζουν τη συμπεριφορά αντιστοίχισης URL και τη συμπεριφορά τους κατά την εκτέλεση.

- [ ] Ελέγξτε ότι οι **expressions** και οι **requirements** για τα redirects **βγάζουν νόημα**.
- [ ] Ελέγξτε επίσης για **ευαίσθητα κρυφά endpoints** που μπορεί να περιέχουν ενδιαφέρουσες πληροφορίες.

## Notifications

- [ ] Ελέγξτε τις **ειδοποιήσεις.** Αυτές οι ειδοποιήσεις συνιστώνται για σκοπούς ασφάλειας:
- `Usage Based Billing`
- `HTTP DDoS Attack Alert`
- `Layer 3/4 DDoS Attack Alert`
- `Advanced HTTP DDoS Attack Alert`
- `Advanced Layer 3/4 DDoS Attack Alert`
- `Flow-based Monitoring: Volumetric Attack`
- `Route Leak Detection Alert`
- `Access mTLS Certificate Expiration Alert`
- `SSL for SaaS Custom Hostnames Alert`
- `Universal SSL Alert`
- `Script Monitor New Code Change Detection Alert`
- `Script Monitor New Domain Alert`
- `Script Monitor New Malicious Domain Alert`
- `Script Monitor New Malicious Script Alert`
- `Script Monitor New Malicious URL Alert`
- `Script Monitor New Scripts Alert`
- `Script Monitor New Script Exceeds Max URL Length Alert`
- `Advanced Security Events Alert`
- `Security Events Alert`
- [ ] Ελέγξτε όλους τους **προορισμούς**, καθώς μπορεί να υπάρχει **ευαίσθητη πληροφορία** (basic http auth) σε webhook urls. Βεβαιωθείτε επίσης ότι τα webhook urls χρησιμοποιούν **HTTPS**
- [ ] Ως επιπλέον έλεγχο, μπορείτε να προσπαθήσετε να **προσποιηθείτε μια ειδοποίηση του Cloudflare** σε τρίτο μέρος — ίσως με κάποιο τρόπο να καταφέρετε να **εισάγετε κάτι επικίνδυνο**

## Manage Account

- [ ] Είναι δυνατό να δείτε τα **τελευταία 4 ψηφία της πιστωτικής κάρτας**, την **ημερομηνία λήξης** και τη **διεύθυνση χρέωσης** στο **`Billing` -> `Payment info`**.
- [ ] Είναι δυνατό να δείτε τον **τύπο πλάνου** που χρησιμοποιείται στο λογαριασμό στο **`Billing` -> `Subscriptions`**.
- [ ] Στο **`Members`** είναι δυνατό να δείτε όλα τα μέλη του λογαριασμού και τον ρόλο τους. Σημειώστε ότι αν ο τύπος πλάνου δεν είναι Enterprise, υπάρχουν μόνο 2 ρόλοι: Administrator και Super Administrator. Αλλά αν το χρησιμοποιούμενο **πλάνο είναι Enterprise**, [**more roles**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) μπορούν να χρησιμοποιηθούν για να ακολουθηθεί η αρχή των ελάχιστων προνομίων.
- Επομένως, όπου είναι δυνατόν **συνιστάται** η χρήση του **Enterprise plan**.
- [ ] Στους Members είναι δυνατό να ελέγξετε ποια **μέλη** έχουν ενεργοποιημένο **2FA**. **Κάθε** χρήστης θα πρέπει να το έχει ενεργοποιημένο.

> [!NOTE]
> Σημειώστε ότι ευτυχώς ο ρόλος **`Administrator`** δεν δίνει δικαιώματα διαχείρισης μελών (**δεν μπορεί να ανεβάσει προνόμια ή να προσκαλέσει** νέα μέλη)

## DDoS Investigation

[Ελέγξτε αυτό το μέρος](cloudflare-domains.md#cloudflare-ddos-protection).

{{#include ../../banners/hacktricks-training.md}}
