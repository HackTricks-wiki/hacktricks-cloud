# Cloudflare Security

{{#include ../../banners/hacktricks-training.md}}

Σε έναν λογαριασμό Cloudflare υπάρχουν ορισμένες **γενικές ρυθμίσεις και υπηρεσίες** που μπορούν να διαμορφωθούν. Σε αυτή τη σελίδα θα **αναλύσουμε τις ρυθμίσεις σχετικές με την ασφάλεια κάθε ενότητας:**

<figure><img src="../../images/image (117).png" alt=""><figcaption></figcaption></figure>

## Websites

Ελέγξτε κάθε μία με:

{{#ref}}
cloudflare-domains.md
{{#endref}}

### Domain Registration

- [ ] Στο **`Transfer Domains`** ελέγξτε ότι δεν είναι δυνατό να μεταφερθεί οποιοδήποτε domain.

Ελέγξτε κάθε μία με:

{{#ref}}
cloudflare-domains.md
{{#endref}}

## Analytics

_I couldn't find anything to check for a config security review._

## Pages

Σε κάθε σελίδα του Cloudflare:

- [ ] Ελέγξτε για **ευαίσθητες πληροφορίες** στο **`Build log`**.
- [ ] Ελέγξτε για **ευαίσθητες πληροφορίες** στο **Github repository** που είναι ανατεθειμένο στις pages.
- [ ] Ελέγξτε για πιθανό συμβιβασμό του github repo μέσω **workflow command injection** ή συμβιβασμού `pull_request_target`. Περισσότερες πληροφορίες στη [**Github Security page**](../github-security/index.html).
- [ ] Ελέγξτε για ευπάθειες στις **vulnerable functions** στον κατάλογο `/fuctions` (αν υπάρχει), ελέγξτε τα **redirects** στο αρχείο `_redirects` (αν υπάρχει) και τις **εσφαλμένες κεφαλίδες** στο αρχείο `_headers` (αν υπάρχει).
- [ ] Ελέγξτε για **ευπάθειες** στην **ιστοσελίδα** μέσω **blackbox** ή **whitebox** αν έχετε πρόσβαση στον κώδικα.
- [ ] Στις λεπτομέρειες κάθε σελίδας `/<page_id>/pages/view/blocklist/settings/functions`. Ελέγξτε για **ευαίσθητες πληροφορίες** στις **`Environment variables`**.
- [ ] Στη σελίδα λεπτομερειών ελέγξτε επίσης την **build command** και το **root directory** για **πιθανούς injection** που θα μπορούσαν να συμβιβάσουν τη σελίδα.

## **Workers**

Σε κάθε worker του Cloudflare ελέγξτε:

- [ ] Τους triggers: Τι ενεργοποιεί τον worker; Μπορεί ένας **χρήστης να στείλει δεδομένα** που θα **χρησιμοποιηθούν** από τον worker;
- [ ] Στις **`Settings`**, ελέγξτε για **`Variables`** που περιέχουν **ευαίσθητες πληροφορίες**
- [ ] Ελέγξτε τον **κώδικα του worker** και αναζητήστε **ευπάθειες** (ειδικά σε σημεία όπου ο χρήστης μπορεί να διαχειριστεί την είσοδο)
- Ελέγξτε για SSRFs που επιστρέφουν την ενδεικνυόμενη σελίδα που μπορείτε να ελέγξετε
- Ελέγξτε για XSSs που εκτελούν JS μέσα σε svg εικόνα
- Είναι πιθανό ο worker να αλληλεπιδρά με άλλες εσωτερικές υπηρεσίες. Για παράδειγμα, ένας worker μπορεί να αλληλεπιδράσει με έναν R2 bucket που αποθηκεύει πληροφορίες που λαμβάνονται από την είσοδο. Σε αυτή την περίπτωση, είναι απαραίτητο να ελέγξετε ποιες δυνατότητες έχει ο worker πάνω στον R2 bucket και πώς θα μπορούσαν να καταχραστούν μέσω της εισόδου του χρήστη.

> [!WARNING]
> Note that by default a **Worker is given a URL** such as `<worker-name>.<account>.workers.dev`. The user can set it to a **subdomain** but you can always access it with that **original URL** if you know it.

Για μια πρακτική κατάχρηση των Workers ως pass-through proxies (IP rotation, FireProx-style), ελέγξτε:

{{#ref}}
cloudflare-workers-pass-through-proxy-ip-rotation.md
{{#endref}}

## R2

Σε κάθε R2 bucket ελέγξτε:

- [ ] Διαμορφώστε την **CORS Policy**.

## Stream

TODO

## Images

TODO

## Security Center

- [ ] Αν είναι δυνατό, τρέξτε ένα **`Security Insights`** **scan** και ένα **`Infrastructure`** **scan**, καθώς θα **επισημάνουν** ενδιαφέρουσες πληροφορίες σε επίπεδο **security**.
- [ ] Απλώς **ελέγξτε αυτές τις πληροφορίες** για λανθασμένες ρυθμίσεις ασφάλειας και ενδιαφέρουσες πληροφορίες

## Turnstile

TODO

## **Zero Trust**

{{#ref}}
cloudflare-zero-trust-network.md
{{#endref}}

## Bulk Redirects

> [!NOTE]
> Unlike [Dynamic Redirects](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Bulk Redirects**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) are essentially static — they do **not support any string replacement** operations or regular expressions. However, you can configure URL redirect parameters that affect their URL matching behavior and their runtime behavior.

- [ ] Ελέγξτε ότι οι **εκφράσεις** και οι **προϋποθέσεις** για τα redirects **έχουν νόημα**.
- [ ] Ελέγξτε επίσης για **ευαίσθητα κρυφά endpoints** που μπορεί να περιέχουν ενδιαφέρουσες πληροφορίες.

## Notifications

- [ ] Ελέγξτε τις ειδοποιήσεις. Οι παρακάτω ειδοποιήσεις συνιστώνται για λόγους ασφάλειας:
- `Usage Based Billing`
- `HTTP DDoS Attack Alert`
- `Layer 3/4 DDoS Attack Alert`
- `Advanced HTTP DDoS Attack Alert`
- `Advanced Layer 3/4 DDoS Attack Alert`
- `Flow-based Monitoring: Volumetric Attack`
- `Route Leak Detection Alert`
- `Access mTLS Certificate Expiration Alert`
- `SSL for SaaS Custom Hostnames Alert`
- `Universal SSL Alert`
- `Script Monitor New Code Change Detection Alert`
- `Script Monitor New Domain Alert`
- `Script Monitor New Malicious Domain Alert`
- `Script Monitor New Malicious Script Alert`
- `Script Monitor New Malicious URL Alert`
- `Script Monitor New Scripts Alert`
- `Script Monitor New Script Exceeds Max URL Length Alert`
- `Advanced Security Events Alert`
- `Security Events Alert`
- [ ] Ελέγξτε όλους τους **προορισμούς**, καθώς μπορεί να υπάρχουν **ευαίσθητες πληροφορίες** (basic http auth) σε webhook urls. Βεβαιωθείτε επίσης ότι τα webhook urls χρησιμοποιούν **HTTPS**
- [ ] Ως επιπλέον έλεγχο, μπορείτε να δοκιμάσετε να **impersonate a cloudflare notification** προς τρίτο μέρος — ίσως καταφέρετε somehow να **inject something dangerous**

## Manage Account

- [ ] Είναι δυνατό να δείτε τα **τελευταία 4 ψηφία της πιστωτικής κάρτας**, την **ημερομηνία λήξης** και τη **διεύθυνση τιμολόγησης** στο **`Billing` -> `Payment info`**.
- [ ] Είναι δυνατό να δείτε τον **τύπο σχεδίου (plan type)** που χρησιμοποιείται στον λογαριασμό στο **`Billing` -> `Subscriptions`**.
- [ ] Στο **`Members`** είναι δυνατό να δείτε όλα τα μέλη του λογαριασμού και το ρόλο τους. Σημειώστε ότι αν ο τύπος σχεδίου δεν είναι Enterprise, υπάρχουν μόνο 2 ρόλοι: Administrator και Super Administrator. Αλλά αν το χρησιμοποιούμενο **plan είναι Enterprise**, [**more roles**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) μπορούν να χρησιμοποιηθούν για να εφαρμοστεί η αρχή του least privilege.
- Συνεπώς, όποτε είναι δυνατόν είναι **συνιστώμενο** να χρησιμοποιείτε το **Enterprise plan**.
- [ ] Στο Members είναι δυνατό να ελέγξετε ποια **members** έχουν **2FA enabled**. **Κάθε** χρήστης πρέπει να το έχει ενεργοποιημένο.

> [!NOTE]
> Note that fortunately the role **`Administrator`** doesn't give permissions to manage memberships (**cannot escalate privs or invite** new members)

## DDoS Investigation

[Check this part](cloudflare-domains.md#cloudflare-ddos-protection).

{{#include ../../banners/hacktricks-training.md}}
