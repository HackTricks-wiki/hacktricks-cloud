# Cloudflare Domains

{{#include ../../banners/hacktricks-training.md}}

Cloudflare에 구성된 각 TLD에는 구성할 수 있는 **일반 설정 및 서비스**가 있습니다. 이 페이지에서는 각 섹션의 **보안 관련 설정**을 **분석**할 것입니다:

<figure><img src="../../images/image (101).png" alt=""><figcaption></figcaption></figure>

### 개요

- [ ] 계정의 서비스가 **얼마나** **사용되고 있는지** 파악하기
- [ ] **존 ID**와 **계정 ID** 찾기

### 분석

- [ ] **`Security`**에서 **속도 제한**이 있는지 확인하기

### DNS

- [ ] DNS **레코드**에서 **흥미로운** (민감한?) 데이터 확인하기
- [ ] **이름**(예: admin173865324.domin.com)을 기반으로 **민감한 정보**를 포함할 수 있는 **서브도메인** 확인하기
- [ ] **프록시되지 않은** 웹 페이지 확인하기
- [ ] CNAME 또는 IP 주소로 **직접 접근할 수 있는** **프록시된 웹 페이지** 확인하기
- [ ] **DNSSEC**가 **활성화**되어 있는지 확인하기
- [ ] **모든 CNAME에서** **CNAME 평탄화**가 **사용**되고 있는지 확인하기
- 이는 **서브도메인 탈취 취약점**을 **숨기고** 로드 시간을 개선하는 데 유용할 수 있습니다.
- [ ] 도메인이 [**스푸핑에 취약하지 않은지**](https://book.hacktricks.xyz/network-services-pentesting/pentesting-smtp#mail-spoofing) 확인하기

### **이메일**

TODO

### 스펙트럼

TODO

### SSL/TLS

#### **개요**

- [ ] **SSL/TLS 암호화**는 **전체** 또는 **전체 (엄격)**이어야 합니다. 다른 경우에는 어느 시점에서 **명확한 텍스트 트래픽**이 전송됩니다.
- [ ] **SSL/TLS 추천기**가 활성화되어야 합니다.

#### 엣지 인증서

- [ ] **항상 HTTPS 사용**이 **활성화**되어야 합니다.
- [ ] **HTTP 엄격 전송 보안 (HSTS)**가 **활성화**되어야 합니다.
- [ ] **최소 TLS 버전은 1.2**여야 합니다.
- [ ] **TLS 1.3**이 **활성화**되어야 합니다.
- [ ] **자동 HTTPS 재작성**이 **활성화**되어야 합니다.
- [ ] **인증서 투명성 모니터링**이 **활성화**되어야 합니다.

### **보안**

- [ ] **`WAF`** 섹션에서 **방화벽** 및 **속도 제한 규칙이 사용되고 있는지** 확인하는 것이 흥미롭습니다.
- **`우회`** 작업은 요청에 대해 **Cloudflare 보안** 기능을 **비활성화**합니다. 사용해서는 안 됩니다.
- [ ] **`페이지 방패`** 섹션에서 페이지가 사용되는 경우 **활성화**되어 있는지 확인하는 것이 좋습니다.
- [ ] **`API 방패`** 섹션에서 Cloudflare에 노출된 API가 있는 경우 **활성화**되어 있는지 확인하는 것이 좋습니다.
- [ ] **`DDoS`** 섹션에서 **DDoS 보호**를 활성화하는 것이 좋습니다.
- [ ] **`설정`** 섹션에서:
- [ ] **`보안 수준`**이 **중간** 이상인지 확인하기
- [ ] **`도전 통과`**가 최대 1시간인지 확인하기
- [ ] **`브라우저 무결성 검사`**가 **활성화**되어 있는지 확인하기
- [ ] **`개인정보 통과 지원`**이 **활성화**되어 있는지 확인하기

#### **CloudFlare DDoS 보호**

- 가능하다면 **봇 전투 모드** 또는 **슈퍼 봇 전투 모드**를 활성화하세요. 프로그램적으로 접근하는 API를 보호하는 경우 (예: JS 프론트 엔드 페이지에서) 이 기능을 활성화할 수 없을 수 있습니다.
- **WAF**에서: **URL 경로**별로 **속도 제한**을 생성하거나 **검증된 봇**에 대해 (속도 제한 규칙), 또는 IP, 쿠키, 리퍼러 등을 기반으로 **접근 차단**을 할 수 있습니다. 따라서 웹 페이지에서 오지 않거나 쿠키가 없는 요청을 차단할 수 있습니다.
- 공격이 **검증된 봇**에서 발생하는 경우, 최소한 **봇에 대한 속도 제한**을 추가하세요.
- 공격이 **특정 경로**에 대한 경우, 예방 메커니즘으로 이 경로에 **속도 제한**을 추가하세요.
- **도구**에서 IP 주소, IP 범위, 국가 또는 ASN을 **허용 목록**에 추가할 수 있습니다.
- **관리 규칙**이 취약점 악용 방지에 도움이 될 수 있는지 확인하세요.
- **도구** 섹션에서 특정 IP 및 **사용자 에이전트**에 대해 **차단하거나 도전**을 줄 수 있습니다.
- DDoS에서는 **일부 규칙을 재정의하여 더 제한적으로 만들 수 있습니다**.
- **설정**: **보안 수준**을 **높음**으로 설정하고 **공격 중**인 경우 **브라우저 무결성 검사**가 활성화되어 있는지 확인하세요.
- Cloudflare Domains -> Analytics -> Security -> **속도 제한**이 활성화되어 있는지 확인하세요.
- Cloudflare Domains -> Security -> Events -> **탐지된 악성 이벤트** 확인하기

### 접근

{{#ref}}
cloudflare-zero-trust-network.md
{{#endref}}

### 속도

_보안과 관련된 옵션을 찾을 수 없었습니다._

### 캐싱

- [ ] **`구성`** 섹션에서 **CSAM 스캐닝 도구**를 활성화하는 것을 고려하세요.

### **워커 경로**

_이미_ [_cloudflare workers_](./#workers)를 확인했어야 합니다.

### 규칙

TODO

### 네트워크

- [ ] **`HTTP/2`**가 **활성화**되어 있다면, **`HTTP/2 to Origin`**도 **활성화**되어야 합니다.
- [ ] **`HTTP/3 (QUIC 사용)`**이 **활성화**되어야 합니다.
- [ ] **사용자**의 **개인정보**가 중요하다면 **`온ion 라우팅`**이 **활성화**되어 있는지 확인하세요.

### **트래픽**

TODO

### 사용자 정의 페이지

- [ ] 보안과 관련된 오류가 발생할 때 사용자 정의 페이지를 구성하는 것은 선택 사항입니다 (예: 차단, 속도 제한 또는 공격 중 모드).

### 앱

TODO

### 스크랩 방패

- [ ] **이메일 주소 난독화**가 **활성화**되어 있는지 확인하세요.
- [ ] **서버 측 제외**가 **활성화**되어 있는지 확인하세요.

### **자라즈**

TODO

### **Web3**

TODO

{{#include ../../banners/hacktricks-training.md}}
