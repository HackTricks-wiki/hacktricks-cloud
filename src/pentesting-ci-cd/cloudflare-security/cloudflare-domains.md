# Cloudflare Domains

{{#include ../../banners/hacktricks-training.md}}

Katika kila TLD iliyowekwa kwenye Cloudflare kuna **mipangilio na huduma za jumla** ambazo zinaweza kuwekwa. Katika ukurasa huu tutachambua **mipangilio inayohusiana na usalama ya kila sehemu:**

<figure><img src="../../images/image (101).png" alt=""><figcaption></figcaption></figure>

### Overview

- [ ] Pata hisia ya **ni kiasi gani** huduma za akaunti **zinatumika**
- [ ] Pata pia **zone ID** na **account ID**

### Analytics

- [ ] Katika **`Security`** angalia kama kuna **Rate limiting**

### DNS

- [ ] Angalia **data za kuvutia** (nyeti?) katika **records** za DNS
- [ ] Angalia **subdomains** ambazo zinaweza kuwa na **habari nyeti** kulingana na **jina** (kama admin173865324.domin.com)
- [ ] Angalia kurasa za wavuti ambazo **hazijapangwa** **proxied**
- [ ] Angalia kwa **kurasa za wavuti zilizopangwa** ambazo zinaweza **kupatikana moja kwa moja** kwa CNAME au anwani ya IP
- [ ] Hakikisha kwamba **DNSSEC** ime **wezeshwa**
- [ ] Hakikisha kwamba **CNAME Flattening** inatumika katika **CNAME zote**
- Hii inaweza kuwa na manufaa ili **kuficha udhaifu wa kuchukua subdomain** na kuboresha nyakati za upakiaji
- [ ] Hakikisha kwamba majina ya **hayana udhaifu wa spoofing** [**hayana udhaifu wa spoofing**](https://book.hacktricks.xyz/network-services-pentesting/pentesting-smtp#mail-spoofing)

### **Email**

TODO

### Spectrum

TODO

### SSL/TLS

#### **Overview**

- [ ] **SSL/TLS encryption** inapaswa kuwa **Full** au **Full (Strict)**. Mengineyo yatatuma **trafiki ya maandiko wazi** kwa wakati fulani.
- [ ] **SSL/TLS Recommender** inapaswa kuwezeshwa

#### Edge Certificates

- [ ] **Always Use HTTPS** inapaswa kuwa **imewezeshwa**
- [ ] **HTTP Strict Transport Security (HSTS)** inapaswa kuwa **imewezeshwa**
- [ ] **Minimum TLS Version inapaswa kuwa 1.2**
- [ ] **TLS 1.3 inapaswa kuwa imewezeshwa**
- [ ] **Automatic HTTPS Rewrites** inapaswa kuwa **imewezeshwa**
- [ ] **Certificate Transparency Monitoring** inapaswa kuwa **imewezeshwa**

### **Security**

- [ ] Katika sehemu ya **`WAF`** ni muhimu kuangalia kwamba **Firewall** na **kanuni za rate limiting zinatumika** kuzuia matumizi mabaya.
- Kitendo cha **`Bypass`** kita **zima vipengele vya usalama vya Cloudflare** kwa ombi. Hakipaswi kutumika.
- [ ] Katika sehemu ya **`Page Shield`** inapendekezwa kuangalia kwamba ime **wezeshwa** ikiwa kuna ukurasa wowote unatumika
- [ ] Katika sehemu ya **`API Shield`** inapendekezwa kuangalia kwamba ime **wezeshwa** ikiwa kuna API yoyote iliyofichuliwa kwenye Cloudflare
- [ ] Katika sehemu ya **`DDoS`** inapendekezwa kuwezesha **DDoS protections**
- [ ] Katika sehemu ya **`Settings`**:
- [ ] Hakikisha kwamba **`Security Level`** ni **kati** au zaidi
- [ ] Hakikisha kwamba **`Challenge Passage`** ni saa 1 kwa max
- [ ] Hakikisha kwamba **`Browser Integrity Check`** ime **wezeshwa**
- [ ] Hakikisha kwamba **`Privacy Pass Support`** ime **wezeshwa**

#### **CloudFlare DDoS Protection**

- Ikiwa unaweza, wezesha **Bot Fight Mode** au **Super Bot Fight Mode**. Ikiwa unalinda API fulani inayopatikana kwa njia ya programu (kutoka ukurasa wa mbele wa JS kwa mfano). Huenda usiweze kuwezesha hii bila kuvunja ufikiaji huo.
- Katika **WAF**: Unaweza kuunda **mipaka ya kiwango kwa njia ya URL** au kwa **bots zilizothibitishwa** (kanuni za rate limiting), au **kuzuia ufikiaji** kulingana na IP, Cookie, referrer...). Hivyo unaweza kuzuia maombi ambayo hayajatoka kwenye ukurasa wa wavuti au yana cookie.
- Ikiwa shambulio linatoka kwa **bot iliyothibitishwa**, angalau **ongeza kiwango cha mipaka** kwa bots.
- Ikiwa shambulio linahusiana na **njia maalum**, kama njia ya kuzuia, ongeza **mipaka ya kiwango** katika njia hii.
- Unaweza pia **kuongeza kwenye orodha ya nyeupe** anwani za IP, anuwai za IP, nchi au ASNs kutoka **Zana** katika WAF.
- Angalia ikiwa **Managed rules** zinaweza pia kusaidia kuzuia matumizi mabaya ya udhaifu.
- Katika sehemu ya **Zana** unaweza **kuzuia au kutoa changamoto kwa IP maalum** na **vifaa vya mtumiaji.**
- Katika DDoS unaweza **kubadilisha baadhi ya kanuni ili kuzifanya kuwa za kukatisha tamaa zaidi**.
- **Settings**: Weka **Security Level** kuwa **Juu** na kuwa **Chini ya Shambulio** ikiwa uko chini ya shambulio na kwamba **Browser Integrity Check imewezeshwa**.
- Katika Cloudflare Domains -> Analytics -> Security -> Angalia ikiwa **rate limit** imewezeshwa
- Katika Cloudflare Domains -> Security -> Events -> Angalia kwa **matukio mabaya yaliyogunduliwa**

### Access

{{#ref}}
cloudflare-zero-trust-network.md
{{#endref}}

### Speed

_Sikuweza kupata chaguo lolote linalohusiana na usalama_

### Caching

- [ ] Katika sehemu ya **`Configuration`** fikiria kuwezesha **CSAM Scanning Tool**

### **Workers Routes**

_Unapaswa kuwa umeshakagua_ [_cloudflare workers_](./#workers)

### Rules

TODO

### Network

- [ ] Ikiwa **`HTTP/2`** ime **wezeshwa**, **`HTTP/2 to Origin`** inapaswa kuwa **imewezeshwa**
- [ ] **`HTTP/3 (with QUIC)`** inapaswa kuwa **imewezeshwa**
- [ ] Ikiwa **faragha** ya **watumiaji** wako ni muhimu, hakikisha **`Onion Routing`** ime **wezeshwa**

### **Traffic**

TODO

### Custom Pages

- [ ] Ni hiari kuweka kurasa maalum wakati kosa linalohusiana na usalama linapotokea (kama kizuizi, rate limiting au niko chini ya shambulio)

### Apps

TODO

### Scrape Shield

- [ ] Angalia **Email Address Obfuscation** ime **wezeshwa**
- [ ] Angalia **Server-side Excludes** ime **wezeshwa**

### **Zaraz**

TODO

### **Web3**

TODO

{{#include ../../banners/hacktricks-training.md}}
