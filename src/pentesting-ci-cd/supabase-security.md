# Supabase Security

{{#include ../banners/hacktricks-training.md}}

## Basic Information

As per their [**landing page**](https://supabase.com/): Supabase είναι μια ανοιχτού κώδικα εναλλακτική λύση του Firebase. Ξεκινήστε το έργο σας με μια βάση δεδομένων Postgres, Αυθεντικοποίηση, άμεσες APIs, Edge Functions, Realtime subscriptions, Αποθήκευση και Vector embeddings.

### Subdomain

Βασικά, όταν δημιουργείται ένα έργο, ο χρήστης θα λάβει ένα υποτομέα supabase.co όπως: **`jnanozjdybtpqgcwhdiz.supabase.co`**

## **Database configuration**

> [!TIP]
> **Αυτά τα δεδομένα μπορούν να προσπελαστούν από έναν σύνδεσμο όπως `https://supabase.com/dashboard/project/<project-id>/settings/database`**

Αυτή η **βάση δεδομένων** θα αναπτυχθεί σε κάποια περιοχή AWS, και για να συνδεθείτε σε αυτήν, θα ήταν δυνατό να το κάνετε συνδεόμενοι σε: `postgres://postgres.jnanozjdybtpqgcwhdiz:[YOUR-PASSWORD]@aws-0-us-west-1.pooler.supabase.com:5432/postgres` (αυτό δημιουργήθηκε στην us-west-1).\
Ο κωδικός πρόσβασης είναι ένας **κωδικός πρόσβασης που έβαλε ο χρήστης** προηγουμένως.

Επομένως, καθώς ο υποτομέας είναι γνωστός και χρησιμοποιείται ως όνομα χρήστη και οι περιοχές AWS είναι περιορισμένες, μπορεί να είναι δυνατό να προσπαθήσετε να **brute force τον κωδικό πρόσβασης**.

Αυτή η ενότητα περιέχει επίσης επιλογές για:

- Επαναφορά του κωδικού πρόσβασης της βάσης δεδομένων
- Διαμόρφωση σύνδεσης pooling
- Διαμόρφωση SSL: Απόρριψη συνδέσεων σε απλό κείμενο (κατά προεπιλογή είναι ενεργοποιημένες)
- Διαμόρφωση μεγέθους δίσκου
- Εφαρμογή περιορισμών και απαγορεύσεων δικτύου

## API Configuration

> [!TIP]
> **Αυτά τα δεδομένα μπορούν να προσπελαστούν από έναν σύνδεσμο όπως `https://supabase.com/dashboard/project/<project-id>/settings/api`**

Η διεύθυνση URL για να αποκτήσετε πρόσβαση στο supabase API στο έργο σας θα είναι όπως: `https://jnanozjdybtpqgcwhdiz.supabase.co`.

### anon api keys

Θα δημιουργήσει επίσης ένα **anon API key** (`role: "anon"`), όπως: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk` που η εφαρμογή θα χρειαστεί να χρησιμοποιήσει για να επικοινωνήσει με το API key που εκτίθεται στο παράδειγμά μας.

Είναι δυνατόν να βρείτε το API REST για να επικοινωνήσετε με αυτό το API στα [**docs**](https://supabase.com/docs/reference/self-hosting-auth/returns-the-configuration-settings-for-the-gotrue-server), αλλά τα πιο ενδιαφέροντα endpoints θα είναι:

<details>

<summary>Signup (/auth/v1/signup)</summary>
```
POST /auth/v1/signup HTTP/2
Host: id.io.net
Content-Length: 90
X-Client-Info: supabase-js-web/2.39.2
Sec-Ch-Ua: "Not-A.Brand";v="99", "Chromium";v="124"
Sec-Ch-Ua-Mobile: ?0
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.60 Safari/537.36
Content-Type: application/json;charset=UTF-8
Apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
Sec-Ch-Ua-Platform: "macOS"
Accept: */*
Origin: https://cloud.io.net
Sec-Fetch-Site: same-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://cloud.io.net/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Priority: u=1, i

{"email":"test@exmaple.com","password":"SomeCOmplexPwd239."}
```
</details>

<details>

<summary>Σύνδεση (/auth/v1/token?grant_type=password)</summary>
```
POST /auth/v1/token?grant_type=password HTTP/2
Host: hypzbtgspjkludjcnjxl.supabase.co
Content-Length: 80
X-Client-Info: supabase-js-web/2.39.2
Sec-Ch-Ua: "Not-A.Brand";v="99", "Chromium";v="124"
Sec-Ch-Ua-Mobile: ?0
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.60 Safari/537.36
Content-Type: application/json;charset=UTF-8
Apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
Sec-Ch-Ua-Platform: "macOS"
Accept: */*
Origin: https://cloud.io.net
Sec-Fetch-Site: same-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://cloud.io.net/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Priority: u=1, i

{"email":"test@exmaple.com","password":"SomeCOmplexPwd239."}
```
</details>

Έτσι, όποτε ανακαλύπτετε έναν πελάτη που χρησιμοποιεί supabase με το υποτομέα που του έχει παραχωρηθεί (είναι πιθανό ότι ένας υποτομέας της εταιρείας έχει CNAME πάνω στον υποτομέα supabase), μπορείτε να προσπαθήσετε να **δημιουργήσετε έναν νέο λογαριασμό στην πλατφόρμα χρησιμοποιώντας το supabase API**.

### μυστικά / κλειδιά api ρόλου υπηρεσίας

Ένα μυστικό κλειδί API θα δημιουργηθεί επίσης με **`role: "service_role"`**. Αυτό το κλειδί API θα πρέπει να είναι μυστικό γιατί θα μπορεί να παρακάμψει **Row Level Security**.

Το κλειδί API μοιάζει με αυτό: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTcxNDk5MjcxOSwiZXhwIjoyMDMwNTY4NzE5fQ.0a8fHGp3N_GiPq0y0dwfs06ywd-zhTwsm486Tha7354`

### JWT Secret

Ένα **JWT Secret** θα δημιουργηθεί επίσης ώστε η εφαρμογή να μπορεί να **δημιουργεί και να υπογράφει προσαρμοσμένα JWT tokens**.

## Αυθεντικοποίηση

### Εγγραφές

> [!TIP]
> Από **προεπιλογή** το supabase θα επιτρέπει **σε νέους χρήστες να δημιουργούν λογαριασμούς** στο έργο σας χρησιμοποιώντας τα προαναφερθέντα API endpoints.

Ωστόσο, αυτοί οι νέοι λογαριασμοί, από προεπιλογή, **θα χρειαστεί να επιβεβαιώσουν τη διεύθυνση email τους** για να μπορέσουν να συνδεθούν στον λογαριασμό. Είναι δυνατόν να ενεργοποιήσετε το **"Επιτρέψτε ανώνυμες συνδέσεις"** για να επιτρέψετε στους ανθρώπους να συνδεθούν χωρίς να επιβεβαιώσουν τη διεύθυνση email τους. Αυτό θα μπορούσε να δώσει πρόσβαση σε **αναπάντεχα δεδομένα** (λαμβάνουν τους ρόλους `public` και `authenticated`).\
Αυτή είναι μια πολύ κακή ιδέα γιατί το supabase χρεώνει ανά ενεργό χρήστη, οπότε οι άνθρωποι θα μπορούσαν να δημιουργήσουν χρήστες και να συνδεθούν και το supabase θα χρεώσει γι' αυτούς:

<figure><img src="../images/image (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Κωδικοί πρόσβασης & συνεδρίες

Είναι δυνατόν να υποδείξετε το ελάχιστο μήκος κωδικού πρόσβασης (κατά προεπιλογή), απαιτήσεις (όχι κατά προεπιλογή) και να απαγορεύσετε τη χρήση κωδικών πρόσβασης που έχουν διαρρεύσει.\
Συνιστάται να **βελτιώσετε τις απαιτήσεις καθώς οι προεπιλεγμένες είναι αδύναμες**.

- Συνεδρίες Χρηστών: Είναι δυνατόν να ρυθμίσετε πώς λειτουργούν οι συνεδρίες χρηστών (χρονικά όρια, 1 συνεδρία ανά χρήστη...)
- Προστασία από Ρομπότ και Κατάχρηση: Είναι δυνατόν να ενεργοποιήσετε το Captcha.

### Ρυθμίσεις SMTP

Είναι δυνατόν να ρυθμίσετε ένα SMTP για να στέλνετε emails.

### Προχωρημένες Ρυθμίσεις

- Ρυθμίστε τον χρόνο λήξης για τα access tokens (3600 κατά προεπιλογή)
- Ρυθμίστε την ανίχνευση και την ανάκληση πιθανώς παραβιασμένων refresh tokens και χρονικών ορίων
- MFA: Υποδείξτε πόσοι παράγοντες MFA μπορούν να εγγραφούν ταυτόχρονα ανά χρήστη (10 κατά προεπιλογή)
- Μέγιστες Άμεσες Συνδέσεις Βάσης Δεδομένων: Μέγιστος αριθμός συνδέσεων που χρησιμοποιούνται για αυθεντικοποίηση (10 κατά προεπιλογή)
- Μέγιστη Διάρκεια Αίτησης: Μέγιστος χρόνος που επιτρέπεται για να διαρκέσει μια αίτηση Αυθεντικοποίησης (10s κατά προεπιλογή)

## Αποθήκευση

> [!TIP]
> Το supabase επιτρέπει **να αποθηκεύετε αρχεία** και να τα καθιστάτε προσβάσιμα μέσω μιας διεύθυνσης URL (χρησιμοποιεί S3 buckets).

- Ρυθμίστε το όριο μεγέθους αρχείου μεταφόρτωσης (η προεπιλογή είναι 50MB)
- Η σύνδεση S3 παρέχεται με μια διεύθυνση URL όπως: `https://jnanozjdybtpqgcwhdiz.supabase.co/storage/v1/s3`
- Είναι δυνατόν να **ζητήσετε κλειδί πρόσβασης S3** που σχηματίζεται από ένα `access key ID` (π.χ. `a37d96544d82ba90057e0e06131d0a7b`) και ένα `secret access key` (π.χ. `58420818223133077c2cec6712a4f909aec93b4daeedae205aa8e30d5a860628`)

## Edge Functions

Είναι δυνατόν να **αποθηκεύσετε μυστικά** στο supabase επίσης, τα οποία θα είναι **προσβάσιμα από edge functions** (μπορούν να δημιουργηθούν και να διαγραφούν από το web, αλλά δεν είναι δυνατόν να αποκτήσετε άμεση πρόσβαση στην τιμή τους).

{{#include ../banners/hacktricks-training.md}}
