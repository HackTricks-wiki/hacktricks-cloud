# Temel Github Bilgisi

{{#include ../../banners/hacktricks-training.md}}

## Temel Yapı

Büyük bir **şirketin** temel github ortam yapısı, **birden fazla organizasyona sahip olan bir **şirket** sahibi olmaktır ve her biri **birkaç depo** ve **birkaç takım** içerebilir. Daha küçük şirketler sadece **bir organizasyona ve hiçbir şirkete sahip olabilir**.

Bir kullanıcı açısından, bir **kullanıcı** **farklı şirketler ve organizasyonlar** üyesi olabilir. Bu organizasyonlar içinde kullanıcı, **farklı şirket, organizasyon ve depo rollerine** sahip olabilir.

Ayrıca, bir kullanıcı **farklı takımlarda** farklı şirket, organizasyon veya depo rollerine sahip olabilir.

Ve nihayetinde, **depolar özel koruma mekanizmalarına** sahip olabilir.

## Ayrıcalıklar

### Şirket Rolleri

- **Şirket sahibi**: Bu role sahip kişiler, **yönetici yönetimi, şirket içindeki organizasyonları yönetme, şirket ayarlarını yönetme, organizasyonlar arasında politika uygulama** gibi işlemleri gerçekleştirebilir. Ancak, **organizasyon ayarlarına veya içeriğine erişemezler**; yalnızca bir organizasyon sahibi yapılmışlarsa veya bir organizasyona ait bir depoya doğrudan erişim verilmişse erişebilirler.
- **Şirket üyeleri**: Şirketinizin sahip olduğu organizasyonların üyeleri de **otomatik olarak şirketin üyeleri**dir.

### Organizasyon Rolleri

Bir organizasyonda kullanıcıların farklı rolleri olabilir:

- **Organizasyon sahipleri**: Organizasyon sahipleri, **organizasyonunuza tam yönetim erişimine** sahiptir. Bu rol sınırlı olmalı, ancak organizasyonunuzda en az iki kişiye verilmelidir.
- **Organizasyon üyeleri**: **Varsayılan**, yönetici olmayan rol **organizasyondaki kişiler için** organizasyon üyesidir. Varsayılan olarak, organizasyon üyeleri **bir dizi izne** sahiptir.
- **Faturalama yöneticileri**: Faturalama yöneticileri, **organizasyonunuzun faturalama ayarlarını yönetebilen** kullanıcılardır; örneğin, ödeme bilgileri.
- **Güvenlik Yöneticileri**: Organizasyon sahiplerinin herhangi bir takıma atayabileceği bir roldür. Uygulandığında, takımın her üyesine **organizasyon genelinde güvenlik uyarılarını ve ayarlarını yönetme izinleri ile organizasyondaki tüm depolar için okuma izinleri** verir.
- Eğer organizasyonunuzun bir güvenlik takımı varsa, güvenlik yöneticisi rolünü kullanarak takım üyelerine organizasyona ihtiyaç duydukları en az erişimi verebilirsiniz.
- **Github Uygulama yöneticileri**: Bir organizasyona ait GitHub Uygulamalarını **yönetmek için ek kullanıcılara izin vermek** amacıyla, bir sahibi onlara GitHub Uygulama yöneticisi izinleri verebilir.
- **Dış işbirlikçileri**: Dış işbirlikçisi, **bir veya daha fazla organizasyon deposuna erişimi olan ancak organizasyonun açıkça bir üyesi olmayan** kişidir.

Bu rollerin izinlerini bu tabloda **karşılaştırabilirsiniz**: [https://docs.github.com/en/organizations/managing-peoples-access-to-your-organization-with-roles/roles-in-an-organization#permissions-for-organization-roles](https://docs.github.com/en/organizations/managing-peoples-access-to-your-organization-with-roles/roles-in-an-organization#permissions-for-organization-roles)

### Üye Ayrıcalıkları

_https://github.com/organizations/\<org_name>/settings/member_privileges_ adresinde, **organizasyona üye olmanın getirdiği izinleri** görebilirsiniz.

Burada yapılandırılan ayarlar, organizasyon üyelerinin aşağıdaki izinlerini gösterecektir:

- Tüm organizasyon depoları üzerinde yönetici, yazar, okuyucu veya hiçbir izin olma durumu.
- Üyelerin özel, dahili veya genel depolar oluşturup oluşturamayacağı.
- Depoların çatallanmasının mümkün olup olmadığı.
- Dış işbirlikçilerini davet etmenin mümkün olup olmadığı.
- Genel veya özel sitelerin yayınlanıp yayınlanamayacağı.
- Yöneticilerin depolar üzerindeki izinleri.
- Üyelerin yeni takımlar oluşturup oluşturamayacağı.

### Depo Rolleri

Varsayılan olarak depo rolleri oluşturulur:

- **Okuma**: Projenizi görüntülemek veya tartışmak isteyen **kod katkıda bulunmayanlar** için önerilir.
- **Triage**: Yazma erişimi olmadan **sorunları ve çekme isteklerini proaktif bir şekilde yönetmesi gereken katkıda bulunanlar** için önerilir.
- **Yazma**: Projenize **aktif olarak katkıda bulunanlar** için önerilir.
- **Bakım**: Hassas veya yıkıcı eylemlere erişim olmadan **depoları yönetmesi gereken proje yöneticileri** için önerilir.
- **Yönetici**: **Proje üzerinde tam erişime** ihtiyaç duyan kişiler için önerilir; bu, güvenliği yönetmek veya bir depoyu silmek gibi hassas ve yıkıcı eylemleri içerir.

Her rolün izinlerini bu tabloda **karşılaştırabilirsiniz**: [https://docs.github.com/en/organizations/managing-access-to-your-organizations-repositories/repository-roles-for-an-organization#permissions-for-each-role](https://docs.github.com/en/organizations/managing-access-to-your-organizations-repositories/repository-roles-for-an-organization#permissions-for-each-role)

Ayrıca, _https://github.com/organizations/\<org_name>/settings/roles_ adresinde **kendi rollerinizi oluşturabilirsiniz**.

### Takımlar

Bir organizasyonda **oluşturulan takımları listeleyebilirsiniz**: _https://github.com/orgs/\<org_name>/teams_. Diğer takımların alt takımlarını görmek için her ana takıma erişmeniz gerektiğini unutmayın.

### Kullanıcılar

Bir organizasyonun kullanıcıları _https://github.com/orgs/\<org_name>/people_ adresinde **listelenebilir**.

Her kullanıcının bilgileri içinde, **kullanıcının üyesi olduğu takımlar** ve **kullanıcının erişim sağladığı depolar** görülebilir.

## Github Kimlik Doğrulaması

Github, hesabınıza kimlik doğrulamak ve sizin adınıza işlemler gerçekleştirmek için farklı yollar sunar.

### Web Erişimi

**github.com** adresine erişerek **kullanıcı adınız ve şifreniz** (ve potansiyel olarak bir **2FA**) ile giriş yapabilirsiniz.

### **SSH Anahtarları**

Hesabınızı, ilgili **özel anahtarın sizin adınıza işlem yapmasına izin veren bir veya daha fazla genel anahtar ile yapılandırabilirsiniz.** [https://github.com/settings/keys](https://github.com/settings/keys)

#### **GPG Anahtarları**

Bu anahtarlarla kullanıcıyı taklit edemezsiniz, ancak kullanmıyorsanız, **imzasız gönderim yaparken keşfedilme olasılığınız** olabilir. Daha fazla bilgi için [dikkatli mod hakkında buradan öğrenin](https://docs.github.com/en/authentication/managing-commit-signature-verification/displaying-verification-statuses-for-all-of-your-commits#about-vigilant-mode).

### **Kişisel Erişim Jetonları**

Bir uygulamanın hesabınıza erişim sağlaması için kişisel erişim jetonu oluşturabilirsiniz. Kişisel erişim jetonu oluştururken, **kullanıcı** **jetonun** sahip olacağı **izinleri** **belirtmelidir**. [https://github.com/settings/tokens](https://github.com/settings/tokens)

### Oauth Uygulamaları

Oauth uygulamaları, **github bilginizin bir kısmına erişim izni veya sizi taklit etme** izni isteyebilir. Bu işlevselliğin yaygın bir örneği, bazı platformlarda bulabileceğiniz **github ile giriş yap** butonudur.

- Kendi **Oauth uygulamalarınızı** [https://github.com/settings/developers](https://github.com/settings/developers) adresinde **oluşturabilirsiniz**.
- Hesabınıza erişimi olan tüm **Oauth uygulamalarını** [https://github.com/settings/applications](https://github.com/settings/applications) adresinde görebilirsiniz.
- Oauth Uygulamaların isteyebileceği **kapsamları** [https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps](https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps) adresinde görebilirsiniz.
- Bir **organizasyondaki** uygulamaların üçüncü taraf erişimini _https://github.com/organizations/\<org_name>/settings/oauth_application_policy_ adresinde görebilirsiniz.

Bazı **güvenlik önerileri**:

- Bir **OAuth Uygulaması**, her zaman **tüm GitHub üzerinde kimlik doğrulaması yapılmış GitHub kullanıcısı gibi hareket etmelidir** (örneğin, kullanıcı bildirimleri sağlarken) ve yalnızca belirtilen kapsamlarla erişim sağlamalıdır.
- Bir OAuth Uygulaması, kimlik doğrulaması yapılmış kullanıcı için "GitHub ile Giriş Yap" özelliğini etkinleştirerek bir kimlik sağlayıcı olarak kullanılabilir.
- **Tek bir depo** üzerinde hareket etmesini istiyorsanız bir **OAuth Uygulaması** oluşturmayın. `repo` OAuth kapsamı ile, OAuth Uygulamaları **kimlik doğrulaması yapılmış kullanıcının tüm** depolarında **hareket edebilir**.
- **Takımınız veya şirketiniz** için bir uygulama olarak hareket etmesi için bir OAuth Uygulaması oluşturmayın. OAuth Uygulamaları **tek bir kullanıcı** olarak kimlik doğrulaması yapar, bu nedenle bir kişi bir şirketin kullanması için bir OAuth Uygulaması oluşturursa ve ardından şirketten ayrılırsa, başka kimse buna erişemez.
- **Daha fazla** bilgi için [buradan](https://docs.github.com/en/developers/apps/getting-started-with-apps/about-apps#about-oauth-apps) ulaşabilirsiniz.

### Github Uygulamaları

Github uygulamaları, **github bilginize erişim sağlamak veya sizi taklit etmek** için izin isteyebilir. Github Uygulamalarında, uygulamanın erişim sağlayacağı depoları belirtmeniz gerekir.

- Bir GitHub Uygulaması yüklemek için, **organizasyon sahibi olmalı veya bir depoda yönetici izinlerine sahip olmalısınız**.
- GitHub Uygulaması, **kişisel bir hesap veya bir organizasyon** ile **bağlanmalıdır**.
- Kendi Github uygulamanızı [https://github.com/settings/apps](https://github.com/settings/apps) adresinde oluşturabilirsiniz.
- Hesabınıza erişimi olan tüm **Github uygulamalarını** [https://github.com/settings/apps/authorizations](https://github.com/settings/apps/authorizations) adresinde görebilirsiniz.
- İşte **Github Uygulamaları için API Uç Noktaları**: [https://docs.github.com/en/rest/overview/endpoints-available-for-github-app](https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps). Uygulamanın izinlerine bağlı olarak bazılarına erişim sağlayabilir.
- Bir **organizasyondaki** yüklü uygulamaları _https://github.com/organizations/\<org_name>/settings/installations_ adresinde görebilirsiniz.

Bazı güvenlik önerileri:

- Bir GitHub Uygulaması, **bir kullanıcıdan bağımsız olarak eylemler gerçekleştirmelidir** (uygulama [kullanıcıdan sunucuya](https://docs.github.com/en/apps/building-github-apps/identifying-and-authorizing-users-for-github-apps#user-to-server-requests) jetonu kullanmıyorsa). Kullanıcıdan sunucuya erişim jetonlarını daha güvenli hale getirmek için, 8 saat sonra süresi dolacak erişim jetonları ve yeni bir erişim jetonu için değiştirilebilecek bir yenileme jetonu kullanabilirsiniz. Daha fazla bilgi için "[Kullanıcıdan sunucuya erişim jetonlarını yenileme](https://docs.github.com/en/apps/building-github-apps/refreshing-user-to-server-access-tokens)" kısmına bakın.
- GitHub Uygulamasının **belirli depolarla entegre olduğundan** emin olun.
- GitHub Uygulaması, **kişisel bir hesap veya bir organizasyon** ile **bağlanmalıdır**.
- GitHub Uygulamasının, bir kullanıcının yapabileceği her şeyi bilmesini ve yapmasını beklemeyin.
- **Sadece "GitHub ile Giriş Yap" hizmetine ihtiyacınız varsa GitHub Uygulaması kullanmayın**. Ancak bir GitHub Uygulaması, kullanıcıları _giriş yaparken_ ve diğer şeyleri yaparken bir [kullanıcı tanımlama akışı](https://docs.github.com/en/apps/building-github-apps/identifying-and-authorizing-users-for-github-apps) kullanabilir.
- Sadece bir GitHub kullanıcısı olarak hareket etmek ve o kullanıcının yapabileceği her şeyi yapmak istiyorsanız bir GitHub Uygulaması oluşturmayın.
- GitHub Actions ile uygulamanızı kullanıyorsanız ve iş akışı dosyalarını değiştirmek istiyorsanız, `workflow` kapsamını içeren bir OAuth jetonu ile kullanıcı adına kimlik doğrulaması yapmalısınız. Kullanıcının iş akışı dosyasını içeren depoda yönetici veya yazma iznine sahip olması gerekir. Daha fazla bilgi için "[OAuth uygulamaları için kapsamları anlama](https://docs.github.com/en/apps/building-oauth-apps/understanding-scopes-for-oauth-apps/#available-scopes)" kısmına bakın.
- **Daha fazla** bilgi için [buradan](https://docs.github.com/en/developers/apps/getting-started-with-apps/about-apps#about-github-apps) ulaşabilirsiniz.

### Github Actions

Bu, **github'da kimlik doğrulama yapmanın bir yolu değildir**, ancak **kötü niyetli** bir Github Action, **github'a yetkisiz erişim** elde edebilir ve **verilen** **ayrıcalıklara** bağlı olarak çeşitli **farklı saldırılar** gerçekleştirilebilir. Daha fazla bilgi için aşağıya bakın.

## Git Eylemleri

Git eylemleri, bir olay gerçekleştiğinde **kodun yürütülmesini otomatikleştirmeyi** sağlar. Genellikle yürütülen kod, **deponun koduyla bir şekilde ilişkilidir** (belki bir docker konteyneri oluşturmak veya PR'nin gizli bilgiler içermediğini kontrol etmek).

### Yapılandırma

_https://github.com/organizations/\<org_name>/settings/actions_ adresinde, organizasyon için **github eylemlerinin yapılandırmasını** kontrol etmek mümkündür.

Github eylemlerinin kullanımını tamamen yasaklamak, **tüm github eylemlerine izin vermek** veya yalnızca belirli eylemlere izin vermek mümkündür.

Ayrıca, bir Github Eylemi çalıştırmak için **kimin onay alması gerektiğini** ve bir Github Eylemi çalıştırıldığında **GITHUB_TOKEN'un izinlerini** yapılandırmak da mümkündür.

### Git Gizli Bilgileri

Github Eylemleri genellikle github veya üçüncü taraf uygulamalarla etkileşimde bulunmak için bazı gizli bilgilere ihtiyaç duyar. **Gizli bilgileri açık metin olarak** depoya koymaktan kaçınmak için, github bunları **Gizli Bilgiler** olarak koymanıza izin verir.

Bu gizli bilgiler, **depo veya tüm organizasyon için** yapılandırılabilir. Daha sonra, **Eylemin gizli bilgiye erişebilmesi için** bunu şu şekilde belirtmeniz gerekir:
```yaml
steps:
- name: Hello world action
with: # Set the secret as an input
super_secret:${{ secrets.SuperSecret }}
env: # Or as an environment variable
super_secret:${{ secrets.SuperSecret }}
```
#### Örnek Bash Kullanımı <a href="#example-using-bash" id="example-using-bash"></a>
```yaml
steps:
- shell: bash
env: SUPER_SECRET:${{ secrets.SuperSecret }}
run: |
example-command "$SUPER_SECRET"
```
> [!WARNING]
> Gizli bilgiler **yalnızca bunları tanımlayan Github Actions'tan erişilebilir**.

> Repo veya organizasyonlarda yapılandırıldıktan sonra **github kullanıcıları bunlara tekrar erişemeyecek**, yalnızca **değiştirebileceklerdir**.

Bu nedenle, **github gizli bilgilerini çalmanın tek yolu, Github Action'ı yürüten makineye erişim sağlamaktır** (bu senaryoda yalnızca Action için tanımlanan gizli bilgilere erişebileceksiniz).

### Git Ortamları

Github, **gizli bilgileri** saklayabileceğiniz **ortamlar** oluşturmanıza olanak tanır. Ardından, ortam içindeki gizli bilgilere erişim vermek için github action'a şöyle bir şey verebilirsiniz:
```yaml
jobs:
deployment:
runs-on: ubuntu-latest
environment: env_name
```
Bir ortamı **tüm dallar** (varsayılan), **yalnızca korumalı** dallar veya **hangi dalların erişebileceğini belirtmek** için yapılandırabilirsiniz.\
Ayrıca, bir **eylem** gerçekleştirmeden önce **gerekli inceleme sayısını** ayarlayabilir veya dağıtımların devam etmesine izin vermeden önce **bir süre bekleyebilirsiniz**.

### Git Action Runner

Bir Github Action, **github ortamında çalıştırılabilir** veya kullanıcı tarafından yapılandırılan bir **üçüncü taraf altyapısında** çalıştırılabilir.

Birçok organizasyon, **üçüncü taraf altyapısında** Github Actions çalıştırılmasına izin verecektir çünkü genellikle **daha ucuzdur**.

Bir organizasyonun **kendinden barındırılan çalıştırıcılarını** _https://github.com/organizations/\<org_name>/settings/actions/runners_ adresinde listeleyebilirsiniz.

**Github Actions'ın, github dışındaki altyapıda hangi eylemlerin çalıştırıldığını** bulmanın yolu, Github Action yapılandırma yaml'ında `runs-on: self-hosted` aramaktır.

**Farklı bir organizasyonun kendinden barındırılan kutusunda bir organizasyonun Github Action'ını çalıştırmak mümkün değildir** çünkü **çalıştırıcıyı yapılandırırken çalıştırıcının ait olduğu yeri bilmek için benzersiz bir token oluşturulur**.

Örneğin, özel **Github Runner bir makinede AWS veya GCP içinde yapılandırılmışsa**, Action **metadata uç noktasına erişim sağlayabilir** ve **makinenin çalıştığı hizmet hesabının token'ını çalabilir**.

### Git Action Kompromisi

Eğer tüm eylemlere (veya kötü niyetli bir eyleme) izin verilirse, bir kullanıcı **kötü niyetli** bir **Github action** kullanabilir ve bu, çalıştırıldığı **konteyneri tehlikeye atabilir**.

> [!CAUTION]
> Bir **kötü niyetli Github Action** çalıştırılması, saldırgan tarafından **istismar edilebilir**:
>
> - **Eylemin erişebildiği tüm gizli bilgileri çalmak**
> - **Yanlış yöne hareket etmek**, eğer eylem **üçüncü taraf altyapısında** çalıştırılıyorsa ve makineyi çalıştırmak için kullanılan SA token'ına erişim sağlanabiliyorsa (muhtemelen metadata servisi aracılığıyla)
> - **Çalışma akışında** kullanılan token'ı **istismar etmek** ve **eylemin çalıştırıldığı repo kodunu çalmak veya hatta değiştirmek**.

## Dalları Korumak

Dal korumaları, kullanıcılara bir depo üzerinde **tam kontrol vermemek** için tasarlanmıştır. Amaç, **bazı dallar içinde kod yazabilmek için birkaç koruma yöntemi koymaktır**.

Bir deponun **dal korumaları** _https://github.com/\<orgname>/\<reponame>/settings/branches_ adresinde bulunabilir.

> [!NOTE]
> **Bir dal korumasını organizasyon düzeyinde ayarlamak mümkün değildir**. Bu nedenle, hepsi her repo üzerinde belirtilmelidir.

Bir dala (örneğin master'a) farklı korumalar uygulanabilir:

- **Birleştirmeden önce bir PR gerektirebilirsiniz** (bu nedenle kodu doğrudan dal üzerinde birleştiremezsiniz). Eğer bu seçilirse, farklı diğer korumalar devreye girebilir:
- **Onay sayısı gerektirin**. PR'nızın onaylanması için genellikle 1 veya 2 kişinin daha onay vermesi istenir, böylece tek bir kullanıcı kodu doğrudan birleştiremez.
- **Yeni commitler gönderildiğinde onayları geçersiz kılın**. Aksi takdirde, bir kullanıcı meşru bir kodu onaylayabilir ve ardından kötü niyetli kod ekleyip birleştirebilir.
- **Kod Sahiplerinden inceleme gerektirin**. Repo için en az 1 kod sahibi PR'yı onaylamalıdır (bu nedenle "rastgele" kullanıcılar onay veremez).
- **Pull request incelemelerini geçersiz kılabilecek kişileri kısıtlayın.** Pull request incelemelerini geçersiz kılabilecek kişileri veya takımları belirtebilirsiniz.
- **Belirtilen aktörlerin pull request gereksinimlerini atlamasına izin verin**. Bu kullanıcılar önceki kısıtlamaları atlayabilecektir.
- **Birleştirmeden önce durum kontrollerinin geçmesini gerektirin.** Commit'i birleştirebilmek için bazı kontrollerin geçmesi gerekir (örneğin, açık metin gizli olmadığını kontrol eden bir github action).
- **Birleştirmeden önce konuşma çözümlemesi gerektirin**. Kod üzerindeki tüm yorumlar, PR birleştirilmeden önce çözülmelidir.
- **İmzalı commitler gerektirin**. Commitlerin imzalanması gerekir.
- **Doğrusal tarih gerektirin.** Eşleşen dallara birleştirme commitlerinin gönderilmesini engelleyin.
- **Yönetici dahil edin**. Bu ayarlanmazsa, yöneticiler kısıtlamaları atlayabilir.
- **Eşleşen dallara kimlerin itme yapabileceğini kısıtlayın**. PR gönderebilecek kişileri kısıtlayın.

> [!NOTE]
> Gördüğünüz gibi, bir kullanıcının bazı kimlik bilgilerini elde etmeyi başarsanız bile, **repo'lar korumalı olabilir ve bu nedenle örneğin master'a kod göndermenizi engelleyebilir**.

## Referanslar

- [https://docs.github.com/en/organizations/managing-access-to-your-organizations-repositories/repository-roles-for-an-organization](https://docs.github.com/en/organizations/managing-access-to-your-organizations-repositories/repository-roles-for-an-organization)
- [https://docs.github.com/en/enterprise-server@3.3/admin/user-management/managing-users-in-your-enterprise/roles-in-an-enterprise](https://docs.github.com/en/enterprise-server@3.3/admin/user-management/managing-users-in-your-enterprise/roles-in-an-enterprise)[https://docs.github.com/en/enterprise-server](https://docs.github.com/en/enterprise-server@3.3/admin/user-management/managing-users-in-your-enterprise/roles-in-an-enterprise)
- [https://docs.github.com/en/get-started/learning-about-github/access-permissions-on-github](https://docs.github.com/en/get-started/learning-about-github/access-permissions-on-github)
- [https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-github-user-account/managing-user-account-settings/permission-levels-for-user-owned-project-boards](https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-github-user-account/managing-user-account-settings/permission-levels-for-user-owned-project-boards)
- [https://docs.github.com/en/actions/security-guides/encrypted-secrets](https://docs.github.com/en/actions/security-guides/encrypted-secrets)

{{#include ../../banners/hacktricks-training.md}}
