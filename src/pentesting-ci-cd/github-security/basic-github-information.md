# 기본 Github 정보

{{#include ../../banners/hacktricks-training.md}}

## 기본 구조

큰 **company**의 기본 github 환경 구조는 **enterprise**를 소유하고 그 **enterprise**가 **여러 organizations**을 소유하며, 각 조직은 **여러 repositories**와 **여러 teams**를 포함할 수 있습니다. 작은 회사는 단지 **하나의 organization만 소유하고 enterprise는 없을 수 있습니다**.

사용자 관점에서 **user**는 **다른 enterprise와 organization의 멤버**일 수 있습니다. 그 안에서 사용자는 **enterprise, organization 및 repository에 대한 서로 다른 역할**을 가질 수 있습니다.

또한 사용자는 서로 다른 enterprise, organization 또는 repository 역할을 가진 **여러 teams의 구성원**일 수 있습니다.

마지막으로 **repositories는 특별한 보호 메커니즘을 가질 수 있습니다**.

## 권한

### Enterprise 역할

- **Enterprise owner**: 이 역할을 가진 사람은 **관리자 관리, enterprise 내 조직 관리, enterprise 설정 관리, 조직 전반의 정책 시행**을 할 수 있습니다. 그러나 조직 소유자(organization owner)가 되거나 조직 소유 레포지토리에 대한 직접 접근 권한이 부여되지 않는 한 **organization 설정이나 콘텐츠에 접근할 수 없습니다**.
- **Enterprise members**: 귀하의 enterprise가 소유한 조직의 구성원은 **자동으로 enterprise의 멤버**가 됩니다.

### Organization 역할

조직 내에서 사용자는 다양한 역할을 가질 수 있습니다:

- **Organization owners**: Organization owners는 **조직에 대한 완전한 관리 접근 권한**을 가집니다. 이 역할은 제한되어야 하며, 조직 내 최소 두 명 이상에게는 부여되어야 합니다.
- **Organization members**: 조직 내 사람들의 **기본(default)** 비관리자 역할은 organization member입니다. 기본적으로 organization members는 **여러 권한을 가집니다**.
- **Billing managers**: Billing managers는 조직의 **청구 설정(예: 결제 정보)을 관리할 수 있는 사용자**입니다.
- **Security Managers**: 조직 소유자가 조직 내의 어떤 팀에 할당할 수 있는 역할입니다. 적용되면 해당 팀의 모든 구성원에게 **조직 전반의 보안 경고 및 설정을 관리할 수 있는 권한과 조직 내 모든 리포지토리에 대한 읽기 권한**을 부여합니다.
- 조직에 security team이 있다면, security manager 역할을 사용하여 팀 구성원에게 조직에 필요한 최소한의 접근 권한을 줄 수 있습니다.
- **Github App managers**: 조직이 소유한 GitHub Apps를 **추가 사용자에게 관리할 수 있도록** 허용하려면, 소유자가 그들에게 GitHub App manager 권한을 부여할 수 있습니다.
- **Outside collaborators**: Outside collaborator는 **조직의 명시적 멤버는 아니지만 하나 이상의 조직 리포지토리에 접근 권한이 있는 사람**입니다.

이 역할들의 권한을 비교하려면 이 표를 참조하세요: [https://docs.github.com/en/organizations/managing-peoples-access-to-your-organization-with-roles/roles-in-an-organization#permissions-for-organization-roles](https://docs.github.com/en/organizations/managing-peoples-access-to-your-organization-with-roles/roles-in-an-organization#permissions-for-organization-roles)

### Members 권한

_https://github.com/organizations/\<org_name>/settings/member_privileges_에서 **조직의 구성원으로서 사용자가 갖게 될 권한**을 볼 수 있습니다.

여기 구성된 설정은 조직 구성원들의 다음 권한을 나타냅니다:

- 조직의 모든 레포지토리에 대해 admin, writer, reader 또는 권한 없음.
- 멤버가 private, internal 또는 public 리포지토리를 생성할 수 있는지 여부.
- 리포지토리의 fork가 가능한지 여부.
- outside collaborators를 초대할 수 있는지 여부.
- public 또는 private 사이트를 게시할 수 있는지 여부.
- 레포지토리에 대한 admins의 권한.
- 멤버가 새 팀을 생성할 수 있는지 여부.

### Repository 역할

기본적으로 리포지토리 역할은 다음과 같이 생성됩니다:

- **Read**: 프로젝트를 보거나 토론하려는 **비 코드 기여자(non-code contributors)**에게 권장됩니다.
- **Triage**: 쓰기 권한 없이도 이슈와 pull request를 능동적으로 관리해야 하는 **기여자**에게 권장됩니다.
- **Write**: 프로젝트에 **적극적으로 push하는 기여자**에게 권장됩니다.
- **Maintain**: 민감하거나 파괴적인 작업에 접근하지 않고 **리포지토리를 관리해야 하는 프로젝트 매니저**에게 권장됩니다.
- **Admin**: 보안 관리나 리포지토리 삭제와 같은 민감하고 파괴적인 작업을 포함하여 **프로젝트에 대한 전체 접근**이 필요한 사람들에게 권장됩니다.

각 역할의 권한을 비교하려면 이 표를 보세요: [https://docs.github.com/en/organizations/managing-access-to-your-organizations-repositories/repository-roles-for-an-organization#permissions-for-each-role](https://docs.github.com/en/organizations/managing-access-to-your-organizations-repositories/repository-roles-for-an-organization#permissions-for-each-role)

또한 _https://github.com/organizations/\<org_name>/settings/roles_에서 **사용자 정의 역할을 생성**할 수 있습니다.

### Teams

조직에서 생성된 팀 목록은 _https://github.com/orgs/\<org_name>/teams_에서 볼 수 있습니다. 주의할 점은 다른 팀의 하위 팀(children)까지 보려면 각 상위 팀(parent team)에 접근해야 한다는 것입니다.

### Users

조직의 사용자는 _https://github.com/orgs/\<org_name>/people_에서 **목록화**할 수 있습니다.

각 사용자 정보에서 사용자가 속한 **teams**와 사용자가 접근할 수 있는 **repos**를 볼 수 있습니다.

## Github 인증

Github는 계정에 인증하고 사용자를 대신하여 작업을 수행하는 다양한 방법을 제공합니다.

### 웹 액세스

**github.com**에 접근하면 **username과 password**(및 경우에 따라 **2FA**)로 로그인할 수 있습니다.

### **SSH Keys**

계정에 하나 이상의 공개 키를 구성하여 관련 **private key가 사용자를 대신해 작업을 수행하도록** 허용할 수 있습니다. [https://github.com/settings/keys](https://github.com/settings/keys)

#### **GPG Keys**

이 키들로는 사용자를 **가로채어 가장할 수는 없지만**, 서명 없는 커밋을 보냈을 때 **발견될 수 있습니다**. [vigilant mode에 대해 더 알아보기](https://docs.github.com/en/authentication/managing-commit-signature-verification/displaying-verification-statuses-for-all-of-your-commits#about-vigilant-mode).

### **Personal Access Tokens**

애플리케이션이 귀하의 계정에 접근하도록 **personal access token**을 생성할 수 있습니다. personal access token을 생성할 때 **사용자는 토큰이 가질 권한(permissions)을 명시해야 합니다**. [https://github.com/settings/tokens](https://github.com/settings/tokens)

### Oauth Applications

Oauth applications는 **귀하의 일부 github 정보에 접근하거나 귀하를 가장하여** 특정 작업을 수행하기 위해 권한을 요청할 수 있습니다. 흔한 예는 일부 플랫폼에서 찾을 수 있는 **login with github 버튼**입니다.

- 자신의 **Oauth applications**는 [https://github.com/settings/developers](https://github.com/settings/developers)에서 **생성**할 수 있습니다.
- 귀하의 계정에 접근 권한이 있는 모든 **Oauth applications**는 [https://github.com/settings/applications](https://github.com/settings/applications)에서 볼 수 있습니다.
- Oauth Apps가 요청할 수 있는 **scopes**는 [https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps](https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps)에서 확인할 수 있습니다.
- 조직의 서드파티 애플리케이션 접근은 _https://github.com/organizations/\<org_name>/settings/oauth_application_policy_에서 볼 수 있습니다.

몇 가지 **보안 권장 사항**:

- **OAuth App**은 항상 지정된 scopes에만 접근하면서 **인증된 GitHub 사용자로서 GitHub 전반에서 행동해야** 합니다(예: 사용자 알림 제공 시).
- OAuth App은 인증된 사용자를 위한 "Login with GitHub"를 활성화하여 **신원 제공자(identity provider)**로 사용될 수 있습니다.
- **단일 리포지토리에서만 동작하게 하려면 OAuth App을 만들지 마세요.** `repo` OAuth scope로 OAuth Apps는 **인증된 사용자의 모든 리포지토리(all of the authenticated user's repositories)**에 대해 동작할 수 있습니다.
- **팀이나 회사용 애플리케이션으로 OAuth App을 만들지 마세요.** OAuth Apps는 **단일 사용자로 인증**되므로, 한 사람이 회사용 OAuth App을 만들고 그 사람이 회사를 떠나면 다른 사람이 접근할 수 없게 됩니다.
- **추가 정보**는 [여기](https://docs.github.com/en/developers/apps/getting-started-with-apps/about-apps#about-oauth-apps)에서 확인하세요.

### Github Applications

Github applications는 특정 리소스에 대해 **귀하의 github 정보에 접근하거나 귀하를 가장하여** 특정 작업을 수행하는 권한을 요청할 수 있습니다. Github Apps에서는 앱이 접근할 리포지토리를 지정해야 합니다.

- GitHub App을 설치하려면 **organization owner이거나 리포지토리에 대한 admin 권한**이 있어야 합니다.
- GitHub App은 **개인 계정(personal account) 또는 organization에 연결되어야** 합니다.
- 자신의 Github application은 [https://github.com/settings/apps](https://github.com/settings/apps)에서 생성할 수 있습니다.
- 귀하의 계정에 접근 권한이 있는 모든 **Github applications**는 [https://github.com/settings/apps/authorizations](https://github.com/settings/apps/authorizations)에서 볼 수 있습니다.
- 다음은 **Github Applications에 대한 API Endpoints**입니다: [https://docs.github.com/en/rest/overview/endpoints-available-for-github-app](https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps). 앱의 권한에 따라 일부 엔드포인트에 접근할 수 있습니다.
- 조직에 설치된 앱은 _https://github.com/organizations/\<org_name>/settings/installations_에서 볼 수 있습니다.

몇 가지 보안 권장 사항:

- GitHub App은 **사용자와 독립적으로(action independent of a user)** 동작해야 합니다(앱이 [user-to-server](https://docs.github.com/en/apps/building-github-apps/identifying-and-authorizing-users-for-github-apps#user-to-server-requests) 토큰을 사용하지 않는 한). user-to-server 접근 토큰을 더 안전하게 유지하려면, 8시간 후 만료되는 access token과 새 access token으로 교환할 수 있는 refresh token을 사용하는 것이 좋습니다. 자세한 내용은 "Refreshing user-to-server access tokens"를 참조하세요.
- GitHub App이 **특정 리포지토리**와 통합되었는지 확인하세요.
- GitHub App은 **개인 계정 또는 organization에 연결되어야** 합니다.
- GitHub App이 사용자가 할 수 있는 모든 것을 알거나 수행할 것으로 기대하지 마세요.
- **"Login with GitHub" 서비스만 필요하다면 GitHub App을 사용하지 마세요.** 다만 GitHub App은 [user identification flow](https://docs.github.com/en/apps/building-github-apps/identifying-and-authorizing-users-for-github-apps)를 사용하여 사용자를 로그인시키고 추가 작업을 할 수 있습니다.
- GitHub App은 **사용자처럼만 행동하려는 목적**이라면 만들지 마세요.
- 앱을 GitHub Actions와 함께 사용하고 workflow 파일을 수정하려면 `workflow` scope를 포함한 OAuth 토큰으로 사용자를 대신해 인증해야 합니다. 사용자는 해당 workflow 파일을 포함한 리포지토리에 대해 admin 또는 write 권한을 가져야 합니다. 자세한 내용은 "Understanding scopes for OAuth apps"를 참조하세요.
- **추가 정보**는 [여기](https://docs.github.com/en/developers/apps/getting-started-with-apps/about-apps#about-github-apps)에서 확인하세요.

### Github Actions

이것은 **github에서 인증하는 방식은 아니지만**, **악의적인 Github Action**은 **무단으로 github에 접근**할 수 있고 Action에 부여된 **권한(privileges)에 따라 여러 가지 다른 공격**이 가능할 수 있습니다. 아래에서 더 많은 정보를 확인하세요.

## Git Actions

Git actions는 **이벤트가 발생할 때 코드 실행을 자동화**할 수 있게 합니다. 보통 실행되는 코드는 **레포지토리의 코드와 관련된 작업**(예: 도커 컨테이너 빌드 또는 PR에 비밀이 포함되지 않았는지 검사)입니다.

### 구성(Configuration)

_https://github.com/organizations/\<org_name>/settings/actions_에서 조직의 **github actions 구성**을 확인할 수 있습니다.

Github actions의 사용을 완전히 금지하거나, **모든 github actions를 허용**하거나, 특정 actions만 허용하도록 설정할 수 있습니다.

또한 **누가 Github Action을 실행하기 위해 승인이 필요한지**, 그리고 실행 시 Github Action의 **GITHUB_TOKEN 권한**을 구성할 수 있습니다.

### Git Secrets

Github Action은 보통 github 또는 서드파티 애플리케이션과 상호작용하기 위해 어떤 형태의 secrets가 필요합니다. 레포지토리에 **평문으로 두지 않기 위해**, github은 이를 **Secrets**로 저장할 수 있게 합니다.

이러한 secrets는 **레포지토리별 또는 조직 전체**로 구성할 수 있습니다. 그런 다음 Action이 secret에 접근할 수 있도록 선언하려면 다음과 같이 해야 합니다:
```yaml
steps:
- name: Hello world action
with: # Set the secret as an input
super_secret:${{ secrets.SuperSecret }}
env: # Or as an environment variable
super_secret:${{ secrets.SuperSecret }}
```
#### Bash 사용 예시 <a href="#example-using-bash" id="example-using-bash"></a>
```yaml
steps:
- shell: bash
env: SUPER_SECRET:${{ secrets.SuperSecret }}
run: |
example-command "$SUPER_SECRET"
```
> [!WARNING]
> Secrets **는 선언된 Github Actions에서만 접근할 수 있습니다.**

> 레포나 조직에 설정되면 **github의 사용자들은 더 이상 접근할 수 없습니다**, 단지 **변경만 할 수 있습니다**.

따라서, **github secrets를 훔치는 유일한 방법은 Github Action을 실행하는 머신에 접근할 수 있는 경우뿐입니다** (그 시나리오에서는 해당 Action에 선언된 secrets만 접근할 수 있습니다).

### Git Environments

Github는 **environments**를 생성하여 **secrets**를 저장할 수 있게 합니다. 그런 다음, 환경 내의 secrets에 대한 접근 권한을 github action에 다음과 같이 부여할 수 있습니다:
```yaml
jobs:
deployment:
runs-on: ubuntu-latest
environment: env_name
```
환경(environment)을 다음과 같이 구성할 수 있습니다: 기본값인 **all branches**(모든 브랜치), **only protected** branches(보호된 브랜치만) 또는 접근 가능한 브랜치를 **specify**(지정)할 수 있습니다.\
추가로, environment 보호에는 다음이 포함됩니다:
- **Required reviewers**: 환경을 대상으로 하는 gate 작업을 승인될 때까지 차단합니다. 승인 자체에서 적절한 사후 검토(4-eyes 원칙)를 강제하려면 **Prevent self-review**를 활성화하세요.
- **Deployment branches and tags**: 어떤 브랜치/태그가 environment에 배포할 수 있는지 제한합니다. 특정 브랜치/태그를 선택하고 해당 브랜치들이 보호(protected)되어 있는지 확인하는 것이 좋습니다. 참고: "Protected branches only" 옵션은 classic branch protections에 적용되며 rulesets를 사용하는 경우 기대한 대로 동작하지 않을 수 있습니다.
- **Wait timer**: 배포를 지연시킬 수 있는 구성 가능한 대기 시간을 설정합니다.

또한 **environment**를 사용하여 **action**을 **실행(executing)**하기 전에 필요한 **리뷰 수(number of required reviews)**를 설정하거나 배포가 진행되기 전에 일정 **시간(wait)**을 두도록 설정할 수 있습니다.

### Git Action Runner

A Github Action은 **github environment 내부에서 실행될** 수 있거나, 사용자가 구성한 **third party infrastructure**에서 실행될 수 있습니다.

여러 조직은 비용상 이유로 Github Actions를 **third party infrastructure**에서 실행하도록 허용합니다.

조직의 **self-hosted runners**를 나열하려면 _https://github.com/organizations/\<org_name>/settings/actions/runners_ 를 확인하세요.

어떤 **Github Actions가 non-github infrastructure에서 실행되는지** 찾는 방법은 Github Action 구성 yaml에서 `runs-on: self-hosted`를 검색하는 것입니다.

한 조직의 Github Action을 다른 조직의 self hosted box 안에서 실행하는 것은 **불가능**합니다. Runner를 구성할 때 해당 Runner가 어느 조직에 속하는지 알기 위해 **unique token**이 생성되기 때문입니다.

만약 custom **Github Runner가 AWS나 GCP 같은 머신 내부에 구성되어 있다면**, Action은 **metadata endpoint**에 접근할 수 있고 머신이 실행 중인 **SA token**을 탈취할 수 있습니다.

### Git Action Compromise

만약 모든 액션(또는 악성 action)이 허용된다면 사용자는 **malicious Github Action**을 사용하여 실행되는 **container**를 **compromise**할 수 있습니다.

> [!CAUTION]
> A **malicious Github Action** run could be **abused** by the attacker to:
>
> - **Steal all the secrets** the Action has access to
> - **Move laterally** if the Action is executed inside a **third party infrastructure** where the SA token used to run the machine can be accessed (probably via the metadata service)
> - **Abuse the token** used by the **workflow** to **steal the code of the repo** where the Action is executed or **even modify it**.

## Branch Protections

Branch protections는 사용자에게 저장소(repository)에 대한 완전한 권한을 부여하지 않도록 설계되었습니다. 목표는 특정 브랜치에 코드를 쓰기 전에 여러 보호 수단을 적용하는 것입니다.

해당 저장소의 **branch protections**는 _https://github.com/\<orgname>/\<reponame>/settings/branches_ 에서 확인할 수 있습니다.

> [!NOTE]
> 조직 수준에서 branch protection을 설정하는 것은 **불가능**합니다. 따라서 모든 보호 규칙은 각 repo에 대해 선언되어야 합니다.

다음과 같은 다양한 보호를 브랜치(예: master)에 적용할 수 있습니다:

- 병합 전에 **PR을 요구(require a PR before merging)**할 수 있습니다(즉, 브랜치에 직접 코드를 병합할 수 없음). 이를 선택하면 다른 보호 옵션들을 함께 적용할 수 있습니다.
- **Require a number of approvals**. 일반적으로 PR 승인에 대해 1명 또는 2명의 추가 승인을 요구하여 단일 사용자가 직접 코드를 병합하지 못하게 합니다.
- **Dismiss approvals when new commits are pushed**. 그렇지 않으면 사용자가 정상적인 코드를 승인한 뒤 악성 코드를 추가하고 병합할 수 있습니다.
- **Require approval of the most recent reviewable push**. 승인이 난 이후의 새로운 커밋(다른 협업자의 푸시 포함)이 있을 경우 리뷰를 재요청하여 공격자가 승인 이후 변경을 푸시하고 병합하는 것을 방지합니다.
- **Require reviews from Code Owners**. 적어도 1명의 코드 오너가 PR을 승인해야 합니다(따라서 "무작위" 사용자가 승인할 수 없음).
- **Restrict who can dismiss pull request reviews.** 풀 리퀘스트 리뷰를 취소할 수 있는 사람 또는 팀을 지정할 수 있습니다.
- **Allow specified actors to bypass pull request requirements**. 이 사용자들은 이전 제한을 우회할 수 있습니다.
- **Require status checks to pass before merging.** 일부 체크는 커밋을 병합하기 전에 통과되어야 합니다(예: SAST 결과를 보고하는 GitHub App). 팁: 필요한 체크를 특정 GitHub App에 바인딩하세요; 그렇지 않으면 어떤 앱이든 Checks API를 통해 체크를 스푸핑할 수 있고, 많은 봇이 skip 지시자(예: "@bot-name skip")를 허용합니다.
- **Require conversation resolution before merging**. PR을 병합하기 전에 코드에 대한 모든 코멘트가 해결되어야 합니다.
- **Require signed commits**. 커밋은 서명되어야 합니다.
- **Require linear history.** 일치하는 브랜치에 merge commits가 푸시되는 것을 방지합니다.
- **Include administrators**. 이 옵션을 설정하지 않으면 관리자는 제한을 우회할 수 있습니다.
- **Restrict who can push to matching branches**. 누가 해당 브랜치로 푸시할 수 있는지 제한합니다.

> [!NOTE]
> 보시다시피, 설령 어떤 사용자의 자격증명(credentials)을 획득했다고 해도, **레포지토리 보호 설정으로 인해 master 같은 브랜치에 코드를 푸시하지 못해** CI/CD 파이프라인을 악용하는 것을 막을 수 있습니다.

## Tag Protections

태그(latest, stable 등)는 기본적으로 변경 가능(mutable)합니다. 태그 업데이트에 대해 4-eyes 플로우를 강제하려면 태그를 보호하고 protections를 environment와 branch를 통해 연쇄적으로 연결하세요:

1) 태그 보호 규칙에서 **Require deployments to succeed**를 활성화하고 보호된 environment(예: prod)로의 성공적인 배포를 요구합니다.
2) 대상 environment에서 **Deployment branches and tags**를 릴리스 브랜치(예: main)로 제한하고, 선택적으로 **Required reviewers**와 **Prevent self-review**를 구성합니다.
3) 릴리스 브랜치에서 branch protections를 구성하여 **Require a pull request**를 설정하고, approvals를 1 이상으로 설정하며 **Dismiss approvals when new commits are pushed**와 **Require approval of the most recent reviewable push**를 모두 활성화합니다.

이 연쇄는 단일 협업자가 workflow YAML을 편집하여 릴리스를 재태그하거나 강제로 퍼블리시하는 것을 방지합니다. 배포 게이트는 workflow 외부에서 강제되기 때문입니다.

## References

- [https://docs.github.com/en/organizations/managing-access-to-your-organizations-repositories/repository-roles-for-an-organization](https://docs.github.com/en/organizations/managing-access-to-your-organizations-repositories/repository-roles-for-an-organization)
- [https://docs.github.com/en/enterprise-server@3.3/admin/user-management/managing-users-in-your-enterprise/roles-in-an-enterprise](https://docs.github.com/en/enterprise-server@3.3/admin/user-management/managing-users-in-your-enterprise/roles-in-an-enterprise)[https://docs.github.com/en/enterprise-server](https://docs.github.com/en/enterprise-server@3.3/admin/user-management/managing-users-in-your-enterprise/roles-in-an-enterprise)
- [https://docs.github.com/en/get-started/learning-about-github/access-permissions-on-github](https://docs.github.com/en/get-started/learning-about-github/access-permissions-on-github)
- [https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-github-user-account/managing-user-account-settings/permission-levels-for-user-owned-project-boards](https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-github-user-account/managing-user-account-settings/permission-levels-for-user-owned-project-boards)
- [https://docs.github.com/en/actions/security-guides/encrypted-secrets](https://docs.github.com/en/actions/security-guides/encrypted-secrets)
- [https://docs.github.com/en/actions/writing-workflows/workflow-syntax-for-github-actions](https://docs.github.com/en/actions/writing-workflows/workflow-syntax-for-github-actions)
- [https://securitylab.github.com/resources/github-actions-untrusted-input/](https://securitylab.github.com/resources/github-actions-untrusted-input/)
- [https://docs.github.com/en/rest/checks/runs](https://docs.github.com/en/rest/checks/runs)
- [https://docs.github.com/en/apps](https://docs.github.com/en/apps)
- [GitHub Actions: A Cloudy Day for Security - Part 1](https://binarysecurity.no/posts/2025/08/securing-gh-actions-part1)

{{#include ../../banners/hacktricks-training.md}}
