# Podstawowe informacje o Github

{{#include ../../banners/hacktricks-training.md}}

## Podstawowa struktura

Podstawowa struktura środowiska github w dużej **firmie** to posiadanie **enterprise**, które posiada **several organizations**, a każda z nich może zawierać **several repositories** i **several teams**. Mniejsze firmy mogą po prostu **own one organization and no enterprises**.

Z punktu widzenia użytkownika **user** może być **member** w **różnych enterprises i organizations**. W ich ramach użytkownik może mieć **różne enterprise, organization i repository roles**.

Dodatkowo użytkownik może być **częścią różnych teams** z różnymi enterprise, organization lub repository rolami.

I wreszcie **repositories mogą mieć specjalne mechanizmy ochronne**.

## Uprawnienia

### Enterprise Roles

- **Enterprise owner**: Osoby z tą rolą mogą **manage administrators, manage organizations within the enterprise, manage enterprise settings, enforce policy across organizations**. Jednak **cannot access organization settings or content** chyba że zostaną nadani organization owner lub otrzymają bezpośredni dostęp do repozytorium należącego do organizacji.
- **Enterprise members**: Członkowie organizations należących do twojego enterprise są również **automatycznie members of the enterprise**.

### Organization Roles

W organizacji użytkownicy mogą mieć różne role:

- **Organization owners**: Organization owners mają **complete administrative access to your organization**. Ta rola powinna być ograniczona, ale nie do mniej niż dwóch osób w organizacji.
- **Organization members**: **Domyślną**, nieadministracyjną rolą dla **osób w organization** jest organization member. Domyślnie organization members **mają szereg uprawnień**.
- **Billing managers**: Billing managers to użytkownicy, którzy mogą **manage the billing settings for your organization**, np. informacje płatnicze.
- **Security Managers**: To rola, którą organization owners mogą przypisać dowolnemu team w organizacji. Po zastosowaniu daje każdemu członkowi zespołu uprawnienia do **manage security alerts and settings across your organization, as well as read permissions for all repositories** w organizacji.
- Jeśli twoja organizacja ma security team, możesz użyć roli security manager, by dać członkom zespołu najniższy potrzebny dostęp do organizacji.
- **Github App managers**: Aby umożliwić dodatkowym użytkownikom **manage GitHub Apps owned by an organization**, owner może nadać im GitHub App manager permissions.
- **Outside collaborators**: Outside collaborator to osoba, która ma **access to one or more organization repositories but is not explicitly a member** of the organization.

Możesz **porównać uprawnienia** tych ról w tej tabeli: [https://docs.github.com/en/organizations/managing-peoples-access-to-your-organization-with-roles/roles-in-an-organization#permissions-for-organization-roles](https://docs.github.com/en/organizations/managing-peoples-access-to-your-organization-with-roles/roles-in-an-organization#permissions-for-organization-roles)

### Members Privileges

W _https://github.com/organizations/\<org_name>/settings/member_privileges_ możesz zobaczyć **uprawnienia, które użytkownicy będą mieli tylko za bycie częścią organizacji**.

Ustawienia skonfigurowane tutaj określą następujące uprawnienia członków organizacji:

- Być adminem, writerem, readerem lub nie mieć uprawnień do wszystkich repositories organizacji.
- Czy members mogą tworzyć private, internal lub public repositories.
- Czy forking repozytoriów jest możliwy.
- Czy możliwe jest zapraszanie outside collaborators.
- Czy public lub private sites mogą być publikowane.
- Uprawnienia, które admins mają względem repositories.
- Czy members mogą tworzyć nowe teams.

### Repository Roles

Domyślnie tworzone są role repozytorium:

- **Read**: Zalecane dla **non-code contributors**, którzy chcą przeglądać lub dyskutować nad projektem.
- **Triage**: Zalecane dla **contributors who need to proactively manage issues and pull requests** bez write access.
- **Write**: Zalecane dla contributorów, którzy **actively push to your project**.
- **Maintain**: Zalecane dla **project managers who need to manage the repository** bez dostępu do wrażliwych lub destrukcyjnych działań.
- **Admin**: Zalecane dla osób, które potrzebują **full access to the project**, w tym wrażliwych i destrukcyjnych działań jak zarządzanie security czy usunięcie repository.

Możesz **porównać uprawnienia** każdej roli w tej tabeli [https://docs.github.com/en/organizations/managing-access-to-your-organizations-repositories/repository-roles-for-an-organization#permissions-for-each-role](https://docs.github.com/en/organizations/managing-access-to-your-organizations-repositories/repository-roles-for-an-organization#permissions-for-each-role)

Możesz także **create your own roles** w _https://github.com/organizations/\<org_name>/settings/roles_

### Teams

Możesz **list the teams created in an organization** w _https://github.com/orgs/\<org_name>/teams_. Zauważ, że aby zobaczyć teams, które są childen innych teams, musisz wejść na stronę każdego parent team.

### Users

Użytkowników organizacji można **list** w _https://github.com/orgs/\<org_name>/people._

W informacji o każdym użytkowniku możesz zobaczyć **teams the user is member of**, oraz **repos the user has access to**.

## Github Authentication

Github oferuje różne sposoby uwierzytelniania do konta i wykonywania działań w twoim imieniu.

### Web Access

Dostęp do **github.com** możesz zalogować się używając **username and password** (i potencjalnie **2FA**).

### **SSH Keys**

Możesz skonfigurować konto z jednym lub kilkoma public keys, pozwalającymi powiązanemu **private key na wykonywanie akcji w twoim imieniu.** [https://github.com/settings/keys](https://github.com/settings/keys)

#### **GPG Keys**

Nie możesz podszyć się pod użytkownika za pomocą tych keys, ale jeśli ich nie używasz, może się zdarzyć, że **zostaniesz wykryty za wysyłanie commitów bez podpisu**. Dowiedz się więcej o [vigilant mode here](https://docs.github.com/en/authentication/managing-commit-signature-verification/displaying-verification-statuses-for-all-of-your-commits#about-vigilant-mode).

### **Personal Access Tokens**

Możesz wygenerować personal access token, aby **dać aplikacji dostęp do twojego konta**. Podczas tworzenia personal access token użytkownik musi **określić** **permissions**, które token będzie miał. [https://github.com/settings/tokens](https://github.com/settings/tokens)

### Oauth Applications

Oauth applications mogą poprosić o uprawnienia **to access part of your github information or to impersonate you** aby wykonać pewne działania. Częstym przykładem tej funkcjonalności jest przycisk **login with github**, który możesz znaleźć na niektórych platformach.

- Możesz **create** własne **Oauth applications** w [https://github.com/settings/developers](https://github.com/settings/developers)
- Możesz zobaczyć wszystkie **Oauth applications that has access to your account** w [https://github.com/settings/applications](https://github.com/settings/applications)
- Możesz zobaczyć **scopes that Oauth Apps can ask for** w [https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps](https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps)
- Możesz zobaczyć third party access aplikacji w organizacji w _https://github.com/organizations/\<org_name>/settings/oauth_application_policy_

Kilka **rekomendacji bezpieczeństwa**:

- An **OAuth App** powinno zawsze **act as the authenticated GitHub user across all of GitHub** (np. przy wysyłaniu powiadomień użytkownikowi) i mieć dostęp tylko do określonych scopes.
- An OAuth App może być użyte jako identity provider poprzez włączenie "Login with GitHub" dla uwierzytelnionego użytkownika.
- **Don't** budować **OAuth App** jeśli chcesz, aby twoja aplikacja działała na **single repository**. Z uprawnieniem `repo`, OAuth Apps mogą **act on _all_ of the authenticated user's repositories**.
- **Don't** budować OAuth App, aby działać jako aplikacja dla twojego **team or company**. OAuth Apps uwierzytelniają się jako **single user**, więc jeśli jedna osoba tworzy OAuth App dla firmy, a potem odchodzi, nikt inny nie będzie miał do niej dostępu.
- **More** w [here](https://docs.github.com/en/developers/apps/getting-started-with-apps/about-apps#about-oauth-apps).

### Github Applications

Github applications mogą prosić o uprawnienia, by **access your github information or impersonate you** i wykonać specyficzne akcje na określonych zasobach. W Github Apps musisz określić repositories, do których aplikacja będzie miała dostęp.

- Aby zainstalować GitHub App, musisz być **organisation owner lub mieć admin permissions** w repo.
- GitHub App powinien **connect to a personal account or an organisation**.
- Możesz stworzyć własną Github application w [https://github.com/settings/apps](https://github.com/settings/apps)
- Możesz zobaczyć wszystkie **Github applications that has access to your account** w [https://github.com/settings/apps/authorizations](https://github.com/settings/apps/authorizations)
- To są **API Endpoints for Github Applications** [https://docs.github.com/en/rest/overview/endpoints-available-for-github-app](https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps). W zależności od uprawnień App będzie mogło mieć dostęp do niektórych z nich.
- Możesz zobaczyć zainstalowane apps w organizacji w _https://github.com/organizations/\<org_name>/settings/installations_

Kilka rekomendacji bezpieczeństwa:

- GitHub App powinien **take actions independent of a user** (chyba że aplikacja używa [user-to-server](https://docs.github.com/en/apps/building-github-apps/identifying-and-authorizing-users-for-github-apps#user-to-server-requests) token). Aby utrzymać user-to-server access tokens bezpieczniejszymi, możesz użyć access tokens, które wygasają po 8 godzinach, oraz refresh tokena, który można wymienić na nowy access token. Więcej informacji w "[Refreshing user-to-server access tokens](https://docs.github.com/en/apps/building-github-apps/refreshing-user-to-server-access-tokens)."
- Upewnij się, że GitHub App integruje się ze **specific repositories**.
- GitHub App powinien **connect to a personal account or an organisation**.
- Nie oczekuj, że GitHub App będzie wiedział i robił wszystko, co użytkownik potrafi.
- **Don't use a GitHub App if you just need a "Login with GitHub" service**. Jednak GitHub App może użyć [user identification flow](https://docs.github.com/en/apps/building-github-apps/identifying-and-authorizing-users-for-github-apps) do logowania użytkowników _and_ wykonywania innych rzeczy.
- Nie twórz GitHub App jeśli chcesz _only_ działać jako użytkownik GitHub i robić wszystko, co ten użytkownik może.
- Jeśli używasz swojej aplikacji z Github Actions i chcesz modyfikować workflow files, musisz uwierzytelnić się w imieniu użytkownika za pomocą OAuth tokena, który zawiera scope `workflow`. Użytkownik musi mieć admin lub write permission do repo, które zawiera workflow file. Więcej informacji w "[Understanding scopes for OAuth apps](https://docs.github.com/en/apps/building-oauth-apps/understanding-scopes-for-oauth-apps/#available-scopes)."
- **More** w [here](https://docs.github.com/en/developers/apps/getting-started-with-apps/about-apps#about-github-apps).

### Github Actions

To **nie jest sposób na uwierzytelnianie w github**, ale **złośliwy** Github Action może uzyskać **unauthorised access to github** i **w zależności** od **privileges** nadanych Action może wykonać kilka **różnych ataków**. Zobacz niżej po więcej informacji.

## Git Actions

Git actions pozwalają automatyzować **execution of code when an event happen**. Zazwyczaj wykonywany kod jest **jakoś powiązany z kodem repozytorium** (np. budowanie docker container lub sprawdzenie, że PR nie zawiera sekretów).

### Configuration

W _https://github.com/organizations/\<org_name>/settings/actions_ można sprawdzić **configuration of the github actions** dla organizacji.

Można całkowicie wyłączyć użycie github actions, **allow all github actions**, lub tylko zezwolić na określone actions.

Można także skonfigurować **who needs approval to run a Github Action** oraz **permissions of the GITHUB_TOKEN** dla Github Action podczas jego uruchomienia.

### Git Secrets

Github Action zwykle potrzebują jakichś sekretów, by wchodzić w interakcję z github lub aplikacjami third party. Aby **uniknąć umieszczania ich w clear-text** w repo, github pozwala umieścić je jako **Secrets**.

Te secrets mogą być skonfigurowane **dla repo lub dla całej organization**. Następnie, aby **Action miał dostęp do secret** musisz zadeklarować go w następujący sposób:
```yaml
steps:
- name: Hello world action
with: # Set the secret as an input
super_secret:${{ secrets.SuperSecret }}
env: # Or as an environment variable
super_secret:${{ secrets.SuperSecret }}
```
#### Przykład użycia Bash <a href="#example-using-bash" id="example-using-bash"></a>
```yaml
steps:
- shell: bash
env: SUPER_SECRET:${{ secrets.SuperSecret }}
run: |
example-command "$SUPER_SECRET"
```
> [!WARNING]
> Secrets **can only be accessed from the Github Actions** które je zadeklarowały.

> Po skonfigurowaniu w repo lub w organizacji **użytkownicy github nie będą już mieli do nich dostępu**, będą mogli jedynie je **zmieniać**.

W związku z tym, **jedynym sposobem na kradzież github secrets jest uzyskanie dostępu do maszyny wykonującej Github Action** (w takim scenariuszu będziesz mieć dostęp tylko do secrets zadeklarowanych dla tej Action).

### Środowiska Git

Github pozwala tworzyć **environments**, gdzie możesz przechowywać **secrets**. Następnie możesz dać github action dostęp do secrets wewnątrz environment przy użyciu czegoś takiego:
```yaml
jobs:
deployment:
runs-on: ubuntu-latest
environment: env_name
```
You can configure an environment to be **accessed** by **all branches** (default), **only protected** branches or **specify** which branches can access it.\
Additionally, environment protections include:
- **Required reviewers**: blokuje joby kierujące do environment aż do zatwierdzenia. Włącz **Prevent self-review**, aby egzekwować zasadę czterech oczu przy samym zatwierdzeniu.
- **Deployment branches and tags**: ogranicza, które branches/tags mogą deployować do environment. Lepiej wybierać konkretne branches/tags i upewnić się, że te branches są chronione. Uwaga: opcja "Protected branches only" odnosi się do klasycznych zabezpieczeń branchy i może nie zachowywać się zgodnie z oczekiwaniami przy użyciu rulesets.
- **Wait timer**: opóźnia deployments o konfigurowalny okres.

Można również ustawić **number of required reviews** przed **executing** **an** **action** używając **environment** lub **wait** pewien **time** zanim zezwoli się na kontynuację deployments.
### Git Action Runner

A Github Action can be **executed inside the github environment** or can be executed in a **third party infrastructure** configured by the user.

Wiele organizacji pozwala uruchamiać Github Actions w **third party infrastructure**, ponieważ zwykle jest to **cheaper**.

Możesz wyświetlić listę **self-hosted runners** organizacji pod adresem _https://github.com/organizations/\<org_name>/settings/actions/runners_

Sposób na znalezienie, które **Github Actions are being executed in non-github infrastructure** to wyszukanie `runs-on: self-hosted` w pliku konfiguracyjnym Github Action yaml.

It's **not possible to run a Github Action of an organization inside a self hosted box** of a different organization because **a unique token is generated for the Runner** when configuring it to know where the runner belongs.

If the custom **Github Runner is configured in a machine inside AWS or GCP** for example, the Action **could have access to the metadata endpoint** and **steal the token of the service account** the machine is running with.

### Git Action Compromise

If all actions (or a malicious action) are allowed a user could use a **Github action** that is **malicious** and will **compromise** the **container** where it's being executed.

> [!CAUTION]
> Uruchomienie **malicious Github Action** może zostać wykorzystane przez atakującego do:
>
> - **Steal all the secrets** do których Action ma dostęp
> - **Move laterally** jeśli Action jest uruchomiona w **third party infrastructure**, gdzie token SA używany do uruchomienia maszyny może być dostępny (prawdopodobnie przez metadata service)
> - **Abuse the token** użyty przez **workflow** aby **steal the code of the repo** gdzie Action jest uruchomiona lub **nawet go modify**.

## Branch Protections

Branch protections mają na celu, aby użytkownicy **nie uzyskali pełnej kontroli nad repozytorium**. Celem jest **wprowadzenie kilku metod ochrony zanim będzie można zapisać kod w danej branch**.

Ustawienia **branch protections of a repository** można znaleźć pod adresem _https://github.com/\<orgname>/\<reponame>/settings/branches_

> [!NOTE]
> Nie jest **possible to set a branch protection at organization level**. Wszystkie muszą być zadeklarowane w każdym repo.

Różne zabezpieczenia można zastosować do branch (np. master):

- Możesz **require a PR before merging** (czyli nie możesz bezpośrednio merge'ować kodu do branch). Jeśli to zostanie wybrane, mogą obowiązywać różne inne zabezpieczenia:
- **Require a number of approvals**. Często wymaga się 1 lub 2 dodatkowych osób do zatwierdzenia PR, żeby pojedynczy użytkownik nie mógł bezpośrednio merge'ować kodu.
- **Dismiss approvals when new commits are pushed**. W przeciwnym razie użytkownik może zatwierdzić legalny kod, a potem dodać złośliwy kod i go zmerge'ować.
- **Require approval of the most recent reviewable push**. Zapewnia, że wszelkie nowe commity po zatwierdzeniu (włącznie z pushami innych współpracowników) ponownie wywołują review, więc atakujący nie może wprowadzić zmian po zatwierdzeniu i zmerge'ować ich.
- **Require reviews from Code Owners**. Przynajmniej 1 Code Owner repo musi zatwierdzić PR (więc "random" użytkownicy nie mogą go zatwierdzić).
- **Restrict who can dismiss pull request reviews.** Możesz określić osoby lub zespoły uprawnione do cofania review pull requestów.
- **Allow specified actors to bypass pull request requirements**. Wyznaczeni aktorzy będą mogli ominąć poprzednie ograniczenia.
- **Require status checks to pass before merging.** Niektóre checks muszą przejść przed możliwością merge'owania commita (np. GitHub App raportujące wyniki SAST). Tip: powiąż wymagane checks z konkretną GitHub App; w przeciwnym razie każda aplikacja mogłaby sfałszować check przez Checks API, a wiele botów akceptuje dyrektywy skip (np. "@bot-name skip").
- **Require conversation resolution before merging**. Wszystkie komentarze w kodzie muszą być rozwiązane zanim PR będzie mógł zostać zmerge'owany.
- **Require signed commits**. Commity muszą być podpisane.
- **Require linear history.** Zapobiega pushowaniu merge commitów do pasujących branchy.
- **Include administrators**. Jeśli to nie jest ustawione, admini mogą ominąć ograniczenia.
- **Restrict who can push to matching branches**. Ogranicz, kto może pushować do pasujących branchy oraz kto może tworzyć PR.

> [!NOTE]
> Jak widać, nawet jeśli uda ci się zdobyć poświadczenia użytkownika, **repozytoria mogą być chronione uniemożliwiając ci pushowanie kodu do master**, co np. zapobiega skompromitowaniu pipeline'u CI/CD.

## Tag Protections

Tagi (np. latest, stable) są domyślnie mutowalne. Aby wymusić zasadę czterech oczu przy aktualizacjach tagów, chroń tagi i połącz zabezpieczenia przez environments i branchy:

1) W regule ochrony tagów włącz **Require deployments to succeed** i wymagaj pomyślnego deploymentu do chronionego environment (np. prod).
2) W docelowym environment ogranicz **Deployment branches and tags** do gałęzi release (np. main) i opcjonalnie skonfiguruj **Required reviewers** z włączonym **Prevent self-review**.
3) Na gałęzi release skonfiguruj branch protections tak, aby **Require a pull request**, ustaw approvals ≥ 1 oraz włącz zarówno **Dismiss approvals when new commits are pushed**, jak i **Require approval of the most recent reviewable push**.

Taki łańcuch zapobiega temu, by pojedynczy współpracownik mógł przetagować lub force-publishować release'y przez edycję workflow YAML, ponieważ bramy deploymentu są egzekwowane poza workflowami.

## References

- [https://docs.github.com/en/organizations/managing-access-to-your-organizations-repositories/repository-roles-for-an-organization](https://docs.github.com/en/organizations/managing-access-to-your-organizations-repositories/repository-roles-for-an-organization)
- [https://docs.github.com/en/enterprise-server@3.3/admin/user-management/managing-users-in-your-enterprise/roles-in-an-enterprise](https://docs.github.com/en/enterprise-server@3.3/admin/user-management/managing-users-in-your-enterprise/roles-in-an-enterprise)[https://docs.github.com/en/enterprise-server](https://docs.github.com/en/enterprise-server@3.3/admin/user-management/managing-users-in-your-enterprise/roles-in-an-enterprise)
- [https://docs.github.com/en/get-started/learning-about-github/access-permissions-on-github](https://docs.github.com/en/get-started/learning-about-github/access-permissions-on-github)
- [https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-github-user-account/managing-user-account-settings/permission-levels-for-user-owned-project-boards](https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-github-user-account/managing-user-account-settings/permission-levels-for-user-owned-project-boards)
- [https://docs.github.com/en/actions/security-guides/encrypted-secrets](https://docs.github.com/en/actions/security-guides/encrypted-secrets)
- [https://docs.github.com/en/actions/writing-workflows/workflow-syntax-for-github-actions](https://docs.github.com/en/actions/writing-workflows/workflow-syntax-for-github-actions)
- [https://securitylab.github.com/resources/github-actions-untrusted-input/](https://securitylab.github.com/resources/github-actions-untrusted-input/)
- [https://docs.github.com/en/rest/checks/runs](https://docs.github.com/en/rest/checks/runs)
- [https://docs.github.com/en/apps](https://docs.github.com/en/apps)
- [GitHub Actions: A Cloudy Day for Security - Part 1](https://binarysecurity.no/posts/2025/08/securing-gh-actions-part1)

{{#include ../../banners/hacktricks-training.md}}
